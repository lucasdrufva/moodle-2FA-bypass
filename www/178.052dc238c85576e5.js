"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[178],{80178:(e,r,o)=>{o.r(r),o.d(r,{AddonModWorkshopHelper:()=>F,AddonModWorkshopHelperProvider:()=>A});var s=o(10467),t=o(75629),i=o(16082),n=o(45507),d=o(52749),l=o(75383),a=o(81690),u=o(79555),m=o(65964),c=o(67193),p=o(26327),f=o(81552),g=o(55554),h=o(54438);let A=(()=>{var e;class AddonModWorkshopHelperProvider{getTask(e,r){return e.find((e=>e.code==r))}isTaskDone(e,r){const o=this.getTask(e,r);return!o||!!o.completed}canSubmit(e,r,o){const s=e.useexamples&&1==e.examplesmode,t=r.canmanageexamples||0==e.examplesmode||this.isTaskDone(o,"examples");return e.phase>10&&r.cansubmit&&(!s||t)}canAssess(e,r){return!(e.useexamples&&2==e.examplesmode)||r.canmanageexamples}getUserSubmission(e,r={}){return(0,s.A)((function*(){const o=r.userId||d.CoreSites.getCurrentSiteUserId();return(yield c.AddonModWorkshop.getSubmissions(e,r)).find((e=>e.authorid==o))}))()}getSubmissionById(e,r,o={}){return(0,s.A)((function*(){try{return yield c.AddonModWorkshop.getSubmission(e,r,o)}catch{const s=(yield c.AddonModWorkshop.getSubmissions(e,o)).find((e=>e.id==r));if(!s)throw new t.CoreError("Submission not found");return s}}))()}getReviewerAssessmentById(e,r,o={}){return(0,s.A)((function*(){let s;try{s=yield c.AddonModWorkshop.getAssessment(e,r,o)}catch(t){if(s=(yield c.AddonModWorkshop.getReviewerAssessments(e,o)).find((e=>e.id===r)),!s)throw t}return s.form=yield c.AddonModWorkshop.getAssessmentForm(e,r,o),s}))()}getReviewerAssessments(e,r={}){var o=this;return(0,s.A)((function*(){r.siteId=r.siteId||d.CoreSites.getCurrentSiteId();const s=yield c.AddonModWorkshop.getReviewerAssessments(e,r),t=[];return s.forEach((s=>{t.push(o.getSubmissionById(e,s.submissionid,r).then((e=>{s.submission=e}))),t.push(c.AddonModWorkshop.getAssessmentForm(e,s.id,r).then((e=>{s.form=e})))})),yield Promise.all(t),s}))()}deleteSubmissionStoredFiles(e,r){return(0,s.A)((function*(){const o=yield p.AddonModWorkshopOffline.getSubmissionFolder(e,r);yield g.g.ignoreErrors(n.CoreFile.removeDir(o))}))()}storeSubmissionFiles(e,r,o){return(0,s.A)((function*(){const s=yield p.AddonModWorkshopOffline.getSubmissionFolder(e,o);return i.CoreFileUploader.storeFilesToUpload(s,r)}))()}uploadOrStoreSubmissionFiles(e,r,o,s){return o?this.storeSubmissionFiles(e,r,s):i.CoreFileUploader.uploadOrReuploadFiles(r,f.Ug,e,s)}getStoredSubmissionFiles(e,r){return(0,s.A)((function*(){const o=yield p.AddonModWorkshopOffline.getSubmissionFolder(e,r);return g.g.ignoreErrors(i.CoreFileUploader.getStoredFiles(o),[])}))()}getSubmissionFilesFromOfflineFilesObject(e,r,o){return(0,s.A)((function*(){const s=yield p.AddonModWorkshopOffline.getSubmissionFolder(r,o);return i.CoreFileUploader.getStoredFilesFromOfflineFilesObject(e,s)}))()}deleteAssessmentStoredFiles(e,r,o){return(0,s.A)((function*(){const s=yield p.AddonModWorkshopOffline.getAssessmentFolder(e,r,o);yield g.g.ignoreErrors(n.CoreFile.removeDir(s))}))()}storeAssessmentFiles(e,r,o,t){return(0,s.A)((function*(){const s=yield p.AddonModWorkshopOffline.getAssessmentFolder(e,r,t);return i.CoreFileUploader.storeFilesToUpload(s,o)}))()}uploadOrStoreAssessmentFiles(e,r,o,s,t){return s?this.storeAssessmentFiles(e,r,o,t):i.CoreFileUploader.uploadOrReuploadFiles(o,f.Ug,e,t)}getStoredAssessmentFiles(e,r,o){return(0,s.A)((function*(){const s=yield p.AddonModWorkshopOffline.getAssessmentFolder(e,r,o);return g.g.ignoreErrors(i.CoreFileUploader.getStoredFiles(s),[])}))()}getAssessmentFilesFromOfflineFilesObject(e,r,o,t){return(0,s.A)((function*(){const s=yield p.AddonModWorkshopOffline.getAssessmentFolder(r,o,t);return i.CoreFileUploader.getStoredFilesFromOfflineFilesObject(e,s)}))()}applyOfflineData(e,r=[]){var o=this;return(0,s.A)((function*(){if(0===r.length)return e;const s=null!=e?e:{id:0,workshopid:0,title:"",content:"",timemodified:0,example:!1,authorid:0,timecreated:0,contenttrust:0,attachment:0,published:!1,late:0};let t;const i=r[0].workshopid;return r.forEach((e=>{switch(e.action){case"add":case"update":s.title=e.title,s.content=e.content,s.title=e.title,s.courseid=e.courseid,s.submissionmodified=e.timemodified/1e3,s.offline=!0,t=e.attachmentsid;break;case"delete":s.deleted=!0,s.submissionmodified=e.timemodified/1e3}})),s.attachmentfiles=t?yield o.getSubmissionFilesFromOfflineFilesObject(t,i):[],s}))()}prepareAssessmentData(e,r,o,t,i=0){return(0,s.A)((function*(){var s;if(2==e.overallfeedbackmode&&!o){throw{feedbackauthor:u.HT.instant("core.err_required")}}const n=(yield m.AddonWorkshopAssessmentStrategyDelegate.prepareAssessmentData(null!==(s=e.strategy)&&void 0!==s?s:"",r,t))||{};return n.feedbackauthor=o,n.feedbackauthorformat=l.II.FORMAT_HTML,n.feedbackauthorattachmentsid=i,n.nodims=t.dimenssionscount,n}))()}realGradeValueHelper(e,r=0,o=0){return"string"==typeof e?e:null!=e?0===r?"0":(e=l.Ni.roundToDecimals(r*e/100,o),a.j.formatFloat(e)):void 0}realGradeValue(e,r){return r.grade=this.realGradeValueHelper(r.grade,e.grade,e.gradedecimals),r.gradinggrade=this.realGradeValueHelper(r.gradinggrade,e.gradinggrade,e.gradedecimals),r.gradinggradeover=this.realGradeValueHelper(r.gradinggradeover,e.gradinggrade,e.gradedecimals),r}showGrade(e){return null!=e}}return(e=AddonModWorkshopHelperProvider).ɵfac=function AddonModWorkshopHelperProvider_Factory(r){return new(r||e)},e.ɵprov=h.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),AddonModWorkshopHelperProvider})();const F=(0,u.Qd)(A)}}]);