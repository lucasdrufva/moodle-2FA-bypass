"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4548],{64548:(o,t,n)=>{n.d(t,{Y:()=>l});var e=n(31249),a=n(98833),i=n(3353),r=n(8444),s=n(66121),d=n(93593),m=n(88603),c=n(54438);let l=(()=>{var o;class AddonModForumComponentsModule{}return(o=AddonModForumComponentsModule).ɵfac=function AddonModForumComponentsModule_Factory(t){return new(t||o)},o.ɵmod=c.$C({type:o}),o.ɵinj=c.G2t({imports:[i.n,e.r,r.O,a.d,s.H]}),AddonModForumComponentsModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&c.Obh(l,{declarations:[d.AddonModForumIndexComponent,m.v],imports:[i.n,e.r,r.O,a.d,s.H],exports:[d.AddonModForumIndexComponent,m.v]}))},88603:(o,t,n)=>{n.d(t,{v:()=>B});var e=n(10467),a=n(54438),i=n(89417),r=n(89911),s=n(49882),d=n(52749),m=n(16179),c=n(41094),l=n(79555),_=n(16082),p=n(86275),g=n(48966),u=n(75383),f=n(93956),h=n(11945),C=n(87809),I=n(63153),M=n(88436),v=n(82907),b=n(22693),P=n(2216),R=n(45433),F=n(91416),T=n(23039),y=n(23780),D=n(55554),A=n(43411),O=n(60177),G=n(95638),E=n(31498),j=n(16658),x=n(86198),k=n(58197),$=n(43570),S=n(73465),w=n(25367),Y=n(41450),N=n(55608),U=n(76990),L=n(59528),V=n(73955);const X=["replyFormEl"],_c1=o=>({$a:o}),_c2=o=>({reply:o});function AddonModForumPostComponent_ng_container_1_div_4_ion_icon_2_Template(o,t){1&o&&(a.nrm(0,"ion-icon",24),a.nI1(1,"translate")),2&o&&a.BMQ("aria-label",a.bMT(1,1,"addon.mod_forum.discussionpinned"))}function AddonModForumPostComponent_ng_container_1_div_4_ion_icon_3_Template(o,t){1&o&&(a.nrm(0,"ion-icon",25),a.nI1(1,"translate")),2&o&&a.BMQ("aria-label",a.bMT(1,1,"addon.mod_forum.favourites"))}function AddonModForumPostComponent_ng_container_1_div_4_ion_note_5_Template(o,t){1&o&&(a.j41(0,"ion-note",26),a.nI1(1,"translate"),a.nrm(2,"ion-icon",27),a.k0s()),2&o&&a.BMQ("aria-label",a.bMT(1,1,"addon.mod_forum.unread"))}function AddonModForumPostComponent_ng_container_1_div_4_ion_button_6_Template(o,t){if(1&o){const o=a.RV6();a.j41(0,"ion-button",28),a.nI1(1,"translate"),a.bIt("click",(function AddonModForumPostComponent_ng_container_1_div_4_ion_button_6_Template_ion_button_click_0_listener(t){a.eBV(o);const n=a.XpG(3);return a.Njj(n.showOptionsMenu(t))})),a.nrm(2,"ion-icon",29),a.k0s()}2&o&&a.Y8G("ariaLabel",a.bMT(1,1,"core.displayoptions"))}function AddonModForumPostComponent_ng_container_1_div_4_Template(o,t){if(1&o&&(a.j41(0,"div",18)(1,"h2",5),a.DNE(2,AddonModForumPostComponent_ng_container_1_div_4_ion_icon_2_Template,2,3,"ion-icon",19)(3,AddonModForumPostComponent_ng_container_1_div_4_ion_icon_3_Template,2,3,"ion-icon",20),a.nrm(4,"core-format-text",21),a.k0s(),a.DNE(5,AddonModForumPostComponent_ng_container_1_div_4_ion_note_5_Template,3,3,"ion-note",22)(6,AddonModForumPostComponent_ng_container_1_div_4_ion_button_6_Template,3,3,"ion-button",23),a.k0s()),2&o){const o=a.XpG(2);a.R7$(2),a.Y8G("ngIf",o.discussion&&!o.post.parentid&&o.discussion.pinned),a.R7$(),a.Y8G("ngIf",o.discussion&&!o.post.parentid&&!o.discussion.pinned&&o.discussion.starred),a.R7$(),a.Y8G("text",o.post.subject)("contextInstanceId",o.forum&&o.forum.cmid)("courseId",o.courseId),a.R7$(),a.Y8G("ngIf",o.trackPosts&&o.post.unread),a.R7$(),a.Y8G("ngIf",o.optionsMenuEnabled)}}function AddonModForumPostComponent_ng_container_1_core_user_avatar_6_Template(o,t){if(1&o&&a.nrm(0,"core-user-avatar",30),2&o){const o=a.XpG(2);a.Y8G("user",o.post.author)("courseId",o.courseId)}}function AddonModForumPostComponent_ng_container_1_span_8_Template(o,t){if(1&o&&(a.j41(0,"span",31),a.EFF(1),a.k0s()),2&o){const o=a.XpG(2);a.R7$(),a.SpI(" ",o.post.author.fullname," ")}}function AddonModForumPostComponent_ng_container_1_div_9_p_1_Template(o,t){if(1&o&&(a.j41(0,"p",33),a.nrm(1,"ion-icon",34),a.nI1(2,"translate"),a.nrm(3,"core-format-text",35),a.k0s()),2&o){const o=t.$implicit,n=a.XpG(3);a.R7$(),a.BMQ("aria-label",a.bMT(2,4,"addon.mod_forum.group")),a.R7$(2),a.Y8G("text",o.name)("contextInstanceId",n.courseId)("wsNotFiltered",!0)}}function AddonModForumPostComponent_ng_container_1_div_9_Template(o,t){if(1&o&&(a.j41(0,"div"),a.DNE(1,AddonModForumPostComponent_ng_container_1_div_9_p_1_Template,4,6,"p",32),a.k0s()),2&o){const o=a.XpG(2);a.R7$(),a.Y8G("ngForOf",o.post.author.groups)}}function AddonModForumPostComponent_ng_container_1_p_10_Template(o,t){if(1&o&&(a.j41(0,"p"),a.EFF(1),a.nI1(2,"coreFormatDate"),a.k0s()),2&o){const o=a.XpG(2);a.R7$(),a.JRh(a.i5U(2,1,1e3*o.post.timecreated,"strftimerecentfull"))}}function AddonModForumPostComponent_ng_container_1_p_11_Template(o,t){1&o&&(a.j41(0,"p"),a.nrm(1,"ion-icon",36),a.EFF(2),a.nI1(3,"translate"),a.k0s()),2&o&&(a.R7$(2),a.SpI(" ",a.bMT(3,1,"core.notsent")," "))}function AddonModForumPostComponent_ng_container_1_ng_container_12_ion_note_1_Template(o,t){1&o&&(a.j41(0,"ion-note",26),a.nI1(1,"translate"),a.nrm(2,"ion-icon",27),a.k0s()),2&o&&a.BMQ("aria-label",a.bMT(1,1,"addon.mod_forum.unread"))}function AddonModForumPostComponent_ng_container_1_ng_container_12_ion_button_2_Template(o,t){if(1&o){const o=a.RV6();a.j41(0,"ion-button",28),a.nI1(1,"translate"),a.bIt("click",(function AddonModForumPostComponent_ng_container_1_ng_container_12_ion_button_2_Template_ion_button_click_0_listener(t){a.eBV(o);const n=a.XpG(3);return a.Njj(n.showOptionsMenu(t))})),a.nrm(2,"ion-icon",29),a.k0s()}2&o&&a.Y8G("ariaLabel",a.bMT(1,1,"core.displayoptions"))}function AddonModForumPostComponent_ng_container_1_ng_container_12_Template(o,t){if(1&o&&(a.qex(0),a.DNE(1,AddonModForumPostComponent_ng_container_1_ng_container_12_ion_note_1_Template,3,3,"ion-note",22)(2,AddonModForumPostComponent_ng_container_1_ng_container_12_ion_button_2_Template,3,3,"ion-button",23),a.bVm()),2&o){const o=a.XpG(2);a.R7$(),a.Y8G("ngIf",o.trackPosts&&o.post.unread),a.R7$(),a.Y8G("ngIf",o.optionsMenuEnabled)}}function AddonModForumPostComponent_ng_container_1_div_14_Template(o,t){1&o&&(a.j41(0,"div",37)(1,"ion-note",38),a.EFF(2),a.nI1(3,"translate"),a.k0s()()),2&o&&(a.R7$(2),a.JRh(a.bMT(3,1,"addon.mod_forum.postisprivatereply")))}function AddonModForumPostComponent_ng_container_1_p_16_Template(o,t){if(1&o&&(a.j41(0,"p")(1,"em"),a.EFF(2),a.nI1(3,"translate"),a.k0s()()),2&o){const o=a.XpG(2);a.R7$(2),a.JRh(a.i5U(3,1,"core.numwords",a.eq3(4,_c1,o.post.wordcount)))}}function AddonModForumPostComponent_ng_container_1_div_17_Template(o,t){if(1&o&&(a.j41(0,"div"),a.nrm(1,"core-files",39),a.k0s()),2&o){const o=a.XpG(2);a.R7$(),a.Y8G("files",o.post.attachments)("component",o.component)("componentId",o.componentId)}}function AddonModForumPostComponent_ng_container_1_ion_item_19_Template(o,t){if(1&o&&(a.j41(0,"ion-item",5)(1,"div",40),a.EFF(2),a.nI1(3,"translate"),a.k0s(),a.j41(4,"ion-label"),a.nrm(5,"core-tag-list",41),a.k0s()()),2&o){const o=a.XpG(2);a.R7$(2),a.SpI("",a.bMT(3,2,"core.tag.tags"),":"),a.R7$(3),a.Y8G("tags",o.post.tags)}}function AddonModForumPostComponent_ng_container_1_core_rating_rate_20_Template(o,t){if(1&o){const o=a.RV6();a.j41(0,"core-rating-rate",42),a.bIt("onUpdate",(function AddonModForumPostComponent_ng_container_1_core_rating_rate_20_Template_core_rating_rate_onUpdate_0_listener(){a.eBV(o);const t=a.XpG(2);return a.Njj(t.ratingUpdated())})),a.k0s()}if(2&o){const o=a.XpG(2);a.Y8G("ratingInfo",o.ratingInfo)("instanceId",o.componentId)("itemId",o.post.id)("itemSetId",o.discussionId)("courseId",o.courseId)("aggregateMethod",o.forum.assessed)("scaleId",o.forum.scale)("userId",o.post.author.id)}}function AddonModForumPostComponent_ng_container_1_core_rating_aggregate_21_Template(o,t){if(1&o&&a.nrm(0,"core-rating-aggregate",43),2&o){const o=a.XpG(2);a.Y8G("ratingInfo",o.ratingInfo)("instanceId",o.componentId)("itemId",o.post.id)("courseId",o.courseId)("aggregateMethod",o.forum.assessed)("scaleId",o.forum.scale)}}function AddonModForumPostComponent_ng_container_1_ion_item_22_Template(o,t){if(1&o){const o=a.RV6();a.j41(0,"ion-item",44)(1,"ion-label")(2,"ion-button",45),a.bIt("click",(function AddonModForumPostComponent_ng_container_1_ion_item_22_Template_ion_button_click_2_listener(t){a.eBV(o);const n=a.XpG(2);return a.Njj(n.showReplyForm(t))})),a.nrm(3,"ion-icon",46),a.EFF(4),a.nI1(5,"translate"),a.k0s()()()}if(2&o){const o=a.XpG(2);a.R7$(2),a.BMQ("aria-controls","addon-forum-reply-edit-form-"+o.uniqueId)("aria-expanded",o.formData.replyingTo===o.post.id),a.R7$(2),a.SpI(" ",a.bMT(5,3,"addon.mod_forum.reply")," ")}}function AddonModForumPostComponent_ng_container_1_Template(o,t){if(1&o&&(a.qex(0),a.j41(1,"ion-card-header",4)(2,"ion-item",5)(3,"ion-label"),a.DNE(4,AddonModForumPostComponent_ng_container_1_div_4_Template,7,7,"div",6),a.j41(5,"div",7),a.DNE(6,AddonModForumPostComponent_ng_container_1_core_user_avatar_6_Template,1,2,"core-user-avatar",8),a.j41(7,"div",9),a.DNE(8,AddonModForumPostComponent_ng_container_1_span_8_Template,2,1,"span",10)(9,AddonModForumPostComponent_ng_container_1_div_9_Template,2,1,"div",2)(10,AddonModForumPostComponent_ng_container_1_p_10_Template,3,4,"p",2)(11,AddonModForumPostComponent_ng_container_1_p_11_Template,4,3,"p",2),a.k0s(),a.DNE(12,AddonModForumPostComponent_ng_container_1_ng_container_12_Template,3,2,"ng-container",2),a.k0s()()()(),a.j41(13,"ion-card-content"),a.DNE(14,AddonModForumPostComponent_ng_container_1_div_14_Template,4,3,"div",11),a.nrm(15,"core-format-text",12),a.DNE(16,AddonModForumPostComponent_ng_container_1_p_16_Template,4,6,"p",2)(17,AddonModForumPostComponent_ng_container_1_div_17_Template,2,3,"div",2),a.k0s(),a.j41(18,"div",13),a.DNE(19,AddonModForumPostComponent_ng_container_1_ion_item_19_Template,6,4,"ion-item",14)(20,AddonModForumPostComponent_ng_container_1_core_rating_rate_20_Template,1,8,"core-rating-rate",15)(21,AddonModForumPostComponent_ng_container_1_core_rating_aggregate_21_Template,1,6,"core-rating-aggregate",16)(22,AddonModForumPostComponent_ng_container_1_ion_item_22_Template,6,5,"ion-item",17),a.k0s(),a.bVm()),2&o){const o=a.XpG();a.R7$(),a.Mz_("id","addon-mod_forum-post-",o.post.id,""),a.R7$(),a.AVh("highlight",o.highlight),a.R7$(2),a.Y8G("ngIf",o.displaySubject),a.R7$(2),a.Y8G("ngIf",o.post.author&&o.post.author.fullname),a.R7$(2),a.Y8G("ngIf",o.post.author&&o.post.author.fullname),a.R7$(),a.Y8G("ngIf",o.post.author&&o.post.author.groups),a.R7$(),a.Y8G("ngIf",o.post.timecreated),a.R7$(),a.Y8G("ngIf",!o.post.timecreated),a.R7$(),a.Y8G("ngIf",!o.displaySubject),a.R7$(),a.HbH(0===o.post.parentid?"ion-padding-top":""),a.R7$(),a.Y8G("ngIf",o.post.isprivatereply),a.R7$(),a.Y8G("component",o.component)("componentId",o.componentId)("text",o.post.message)("contextInstanceId",o.forum&&o.forum.cmid)("courseId",o.courseId),a.R7$(),a.Y8G("ngIf",o.post.haswordcount&&o.post.wordcount),a.R7$(),a.Y8G("ngIf",o.post.attachments&&o.post.attachments.length>0),a.R7$(2),a.Y8G("ngIf",o.tagsEnabled&&o.post.tags&&o.post.tags.length>0),a.R7$(),a.Y8G("ngIf",o.forum&&o.ratingInfo),a.R7$(),a.Y8G("ngIf",o.forum&&o.ratingInfo),a.R7$(),a.Y8G("ngIf",o.post.id>0&&o.post.capabilities.reply&&!o.post.isprivatereply)}}function AddonModForumPostComponent_form_2_ion_item_12_Template(o,t){if(1&o){const o=a.RV6();a.j41(0,"ion-item",5)(1,"ion-checkbox",53),a.mxI("ngModelChange",(function AddonModForumPostComponent_form_2_ion_item_12_Template_ion_checkbox_ngModelChange_1_listener(t){a.eBV(o);const n=a.XpG(2);return a.DH7(n.formData.isprivatereply,t)||(n.formData.isprivatereply=t),a.Njj(t)})),a.EFF(2),a.nI1(3,"translate"),a.k0s()()}if(2&o){const o=a.XpG(2);a.R7$(),a.R50("ngModel",o.formData.isprivatereply),a.R7$(),a.SpI(" ",a.bMT(3,2,"addon.mod_forum.privatereply")," ")}}function AddonModForumPostComponent_form_2_ng_container_13_ion_icon_3_Template(o,t){1&o&&a.nrm(0,"ion-icon",58)}function AddonModForumPostComponent_form_2_ng_container_13_ion_icon_4_Template(o,t){1&o&&a.nrm(0,"ion-icon",59)}function AddonModForumPostComponent_form_2_ng_container_13_div_9_Template(o,t){if(1&o&&(a.j41(0,"div",47),a.nrm(1,"core-attachments",60),a.k0s()),2&o){const o=a.XpG(3);a.Y8G("id","addon-forum-reply-edit-form-advanced-"+o.uniqueId),a.R7$(),a.Y8G("files",o.formData.files)("maxSize",o.forum.maxbytes)("maxSubmissions",o.forum.maxattachments)("component",o.component)("componentId",o.forum.cmid)("allowOffline",!0)("courseId",o.courseId)}}function AddonModForumPostComponent_form_2_ng_container_13_Template(o,t){if(1&o){const o=a.RV6();a.qex(0),a.j41(1,"ion-item",54),a.nI1(2,"translate"),a.bIt("click",(function AddonModForumPostComponent_form_2_ng_container_13_Template_ion_item_click_1_listener(){a.eBV(o);const t=a.XpG(2);return a.Njj(t.toggleAdvanced())})),a.DNE(3,AddonModForumPostComponent_form_2_ng_container_13_ion_icon_3_Template,1,0,"ion-icon",55)(4,AddonModForumPostComponent_form_2_ng_container_13_ion_icon_4_Template,1,0,"ion-icon",56),a.j41(5,"ion-label")(6,"h3",57),a.EFF(7),a.nI1(8,"translate"),a.k0s()()(),a.DNE(9,AddonModForumPostComponent_form_2_ng_container_13_div_9_Template,2,8,"div",3),a.bVm()}if(2&o){const o=a.XpG(2);a.R7$(),a.Y8G("detail",!1),a.BMQ("aria-expanded",o.advanced)("aria-controls","addon-forum-reply-edit-form-advanced-"+o.uniqueId)("aria-label",a.bMT(2,8,o.advanced?"core.hideadvanced":"core.showadvanced")),a.R7$(2),a.Y8G("ngIf",!o.advanced),a.R7$(),a.Y8G("ngIf",o.advanced),a.R7$(3),a.JRh(a.bMT(8,10,"addon.mod_forum.advanced")),a.R7$(2),a.Y8G("ngIf",o.advanced)}}function AddonModForumPostComponent_form_2_span_22_Template(o,t){1&o&&(a.j41(0,"span"),a.EFF(1),a.nI1(2,"translate"),a.k0s()),2&o&&(a.R7$(),a.JRh(a.bMT(2,1,"core.savechanges")))}function AddonModForumPostComponent_form_2_span_23_Template(o,t){1&o&&(a.j41(0,"span"),a.EFF(1),a.nI1(2,"translate"),a.k0s()),2&o&&(a.R7$(),a.JRh(a.bMT(2,1,"addon.mod_forum.posttoforum")))}function AddonModForumPostComponent_form_2_Template(o,t){if(1&o){const o=a.RV6();a.j41(0,"form",47,0)(2,"ion-item",5)(3,"ion-input",48),a.nI1(4,"translate"),a.nI1(5,"translate"),a.mxI("ngModelChange",(function AddonModForumPostComponent_form_2_Template_ion_input_ngModelChange_3_listener(t){a.eBV(o);const n=a.XpG();return a.DH7(n.formData.subject,t)||(n.formData.subject=t),a.Njj(t)})),a.k0s()(),a.j41(6,"ion-item")(7,"ion-label",49),a.EFF(8),a.nI1(9,"translate"),a.k0s(),a.j41(10,"core-rich-text-editor",50),a.nI1(11,"translate"),a.bIt("contentChanged",(function AddonModForumPostComponent_form_2_Template_core_rich_text_editor_contentChanged_10_listener(t){a.eBV(o);const n=a.XpG();return a.Njj(n.onMessageChange(t))})),a.k0s()(),a.DNE(12,AddonModForumPostComponent_form_2_ion_item_12_Template,4,4,"ion-item",14)(13,AddonModForumPostComponent_form_2_ng_container_13_Template,10,12,"ng-container",2),a.j41(14,"ion-grid")(15,"ion-row")(16,"ion-col")(17,"ion-button",51),a.bIt("click",(function AddonModForumPostComponent_form_2_Template_ion_button_click_17_listener(){a.eBV(o);const t=a.XpG();return a.Njj(t.cancel())})),a.EFF(18),a.nI1(19,"translate"),a.k0s()(),a.j41(20,"ion-col")(21,"ion-button",52),a.bIt("click",(function AddonModForumPostComponent_form_2_Template_ion_button_click_21_listener(){a.eBV(o);const t=a.XpG();return a.Njj(t.send())})),a.DNE(22,AddonModForumPostComponent_form_2_span_22_Template,3,3,"span",2)(23,AddonModForumPostComponent_form_2_span_23_Template,3,3,"span",2),a.k0s()()()()()}if(2&o){const o=a.XpG();a.Y8G("id","addon-forum-reply-edit-form-"+o.uniqueId),a.R7$(3),a.Y8G("placeholder",a.bMT(4,19,"addon.mod_forum.subject")),a.R50("ngModel",o.formData.subject),a.Y8G("label",a.bMT(5,21,"addon.mod_forum.subject")),a.R7$(5),a.JRh(a.bMT(9,23,"addon.mod_forum.message")),a.R7$(2),a.Y8G("control",o.messageControl)("placeholder",a.bMT(11,25,"addon.mod_forum.replyplaceholder"))("name","mod_forum_reply_"+o.post.id)("component",o.component)("componentId",o.componentId)("autoSave",!0)("contextInstanceId",o.forum&&o.forum.cmid)("draftExtraParams",a.eq3(29,_c2,o.post.id)),a.R7$(2),a.Y8G("ngIf",o.accessInfo.canpostprivatereply),a.R7$(),a.Y8G("ngIf",o.forum.id&&o.forum.maxattachments>0),a.R7$(5),a.JRh(a.bMT(19,27,"core.cancel")),a.R7$(3),a.Y8G("disabled",""===o.formData.subject||null===o.formData.message),a.R7$(),a.Y8G("ngIf",o.formData.isEditing),a.R7$(),a.Y8G("ngIf",!o.formData.isEditing)}}let B=(()=>{var o;class AddonModForumPostComponent{constructor(o){this.elementRef=o,this.trackPosts=!1,this.leavingPage=!1,this.highlight=!1,this.onPostChange=new a.bkB,this.messageControl=new i.MJ(null),this.advanced=!1,this.displaySubject=!0,this.optionsMenuEnabled=!1}get showForm(){return this.post.id>0?!this.formData.isEditing&&this.formData.replyingTo===this.post.id||!!this.formData.isEditing&&this.formData.id===this.post.id:!!this.formData.isEditing&&this.formData.replyingTo===this.post.parentid}ngOnInit(){this.tagsEnabled=c.CoreTag.areTagsAvailableInSite(),this.uniqueId=this.post.id>0?"reply"+this.post.id:"edit"+this.post.parentid;const o=l.HT.instant("addon.mod_forum.re");this.displaySubject=!this.parentSubject||this.post.subject!=this.parentSubject&&this.post.subject!=`Re: ${this.parentSubject}`&&this.post.subject!=`${o} ${this.parentSubject}`,this.defaultReplySubject=this.post.replysubject||(this.post.subject.startsWith("Re: ")||this.post.subject.startsWith(o)?this.post.subject:`${o} ${this.post.subject}`),this.optionsMenuEnabled=this.post.id<0||(void 0!==this.post.capabilities.delete?!0===this.post.capabilities.delete||!0===this.post.capabilities.edit:this.post.id<0||m.AddonModForum.isGetDiscussionPostAvailable()&&(m.AddonModForum.isDeletePostAvailable()||m.AddonModForum.isUpdatePostAvailable()))}ngOnChanges(o){o.leavingPage&&this.leavingPage&&I.R.triggerFormCancelledEvent(this.formElement,d.CoreSites.getCurrentSiteId())}deletePost(){var o=this;return(0,e.A)((function*(){o.analyticsLogEvent("mod_forum_delete_post",`/mod/forum/post.php?delete=${o.post.id}`);try{yield r.CoreDomUtils.showDeleteConfirm("addon.mod_forum.deletesure");const t=yield y.CoreLoadings.show("core.deleting",!0);try{const t=yield m.AddonModForum.deletePost(o.post.id);s.z.trigger(P.rh,{forumId:o.forum.id,discussionId:o.discussionId,cmId:o.forum.cmid,deleted:t.status,post:o.post},d.CoreSites.getCurrentSiteId()),R.CoreToasts.show({message:"addon.mod_forum.deletedpost",translateMessage:!0})}catch(o){r.CoreDomUtils.showErrorModal(o)}finally{t.dismiss()}}catch(o){}}))()}setFormData(o,t,n,e,a,i,r){_.CoreFileUploader.clearTmpFiles(this.formData.files),this.formData.replyingTo=o||0,this.formData.isEditing=!!t,this.formData.subject=n||this.defaultReplySubject||"",this.formData.message=e||null,this.formData.files=(null!=a?a:[]).slice(),this.formData.isprivatereply=!!i,this.formData.id=r,this.messageControl.setValue(this.formData.message),this.originalData.subject=this.formData.subject,this.originalData.message=this.formData.message,this.originalData.files=this.formData.files.slice(),this.originalData.isprivatereply=this.formData.isprivatereply,this.advanced=this.formData.files.length>0,(!t||!r||r<=0)&&(this.preparePostData=void 0)}showOptionsMenu(o){var t=this;return(0,e.A)((function*(){const{AddonModForumPostOptionsMenuComponent:e}=yield n.e(697).then(n.bind(n,80697)),a=yield T.CorePopovers.open({component:e,componentProps:{post:t.post,forumId:t.forum.id,cmId:t.forum.cmid},event:o,waitForDismissCompleted:!0});if(a&&a.action)switch(a.action){case"edit":t.editPost();break;case"delete":t.deletePost();break;case"deleteoffline":t.discardOfflineReply()}}))()}showReplyForm(o){var t=this;return(0,e.A)((function*(){if(o.preventDefault(),o.stopPropagation(),t.formData.isEditing)try{yield t.confirmDiscard(),t.setFormData(t.post.id),t.scrollToForm()}catch{}else t.formData.replyingTo?(t.formData.replyingTo=t.post.id,t.formData.subject==t.originalData.subject&&(t.formData.subject=t.defaultReplySubject,t.originalData.subject=t.defaultReplySubject),t.messageControl.setValue(t.formData.message)):t.setFormData(t.post.id),t.scrollToForm(),t.analyticsLogEvent("mod_forum_add_discussion_post",`/mod/forum/post.php?reply=${t.post.id}`)}))()}editPost(){var o=this;return(0,e.A)((function*(){try{yield o.confirmDiscard()}catch{return}const t=yield y.CoreLoadings.show();try{let t=o.post.message;if(o.post.id>0){var n,e;o.preparePostData=yield m.AddonModForum.preparePostForEdition(o.post.id,"post");const{text:a}=M.CoreFileHelper.replaceDraftfileUrls(d.CoreSites.getRequiredCurrentSite().getURL(),o.preparePostData.messagetext,null!==(n=o.post.messageinlinefiles)&&void 0!==n&&n.length?o.post.messageinlinefiles:null!==(e=o.preparePostData.files)&&void 0!==e?e:[]);t=a}o.formData.syncId=p.F.getDiscussionSyncId(o.discussionId),g.CoreSync.blockOperation(P.Ep,o.formData.syncId),o.setFormData(o.post.parentid,!0,o.post.subject,t,o.post.attachments,o.post.isprivatereply,o.post.id>0?o.post.id:void 0),o.scrollToForm(),o.analyticsLogEvent("mod_forum_update_discussion_post",`/mod/forum/post.php?edit=${o.post.id}`)}catch(o){r.CoreDomUtils.showErrorModalDefault(o,"addon.mod_forum.errorgetpost",!0)}finally{t.dismiss()}}))()}onMessageChange(o){this.formData.message=null!=o?o:null}send(){var o=this;return(0,e.A)((function*(){var t;if(!o.formData.subject)return r.CoreDomUtils.showErrorModal("addon.mod_forum.erroremptysubject",!0),void 0;if(!o.formData.message)return r.CoreDomUtils.showErrorModal("addon.mod_forum.erroremptymessage",!0),void 0;let n=o.formData.message;const e=o.formData.subject,a=null!==(t=o.formData.replyingTo)&&void 0!==t?t:0,i=o.formData.files||[],s=o.formData.id&&o.formData.id>0,c=yield y.CoreLoadings.show("core.sending",!0);var l,_;s&&o.preparePostData&&(n=M.CoreFileHelper.restoreDraftfileUrls(d.CoreSites.getRequiredCurrentSite().getURL(),n,o.preparePostData.messagetext,null!==(l=o.post.messageinlinefiles)&&void 0!==l&&l.length?o.post.messageinlinefiles:null!==(_=o.preparePostData.files)&&void 0!==_?_:[]));n=u.Ni.formatHtmlLines(n);try{let t=!1;if(o.formData.id&&o.formData.id>0){var p;const a=yield o.uploadAttachmentsForEditOnline(o.formData.id);t=yield m.AddonModForum.updatePost(o.formData.id,e,n,{attachmentsid:a,inlineattachmentsid:null===(p=o.preparePostData)||void 0===p?void 0:p.draftitemid})}else{const{attachments:r,saveOffline:s}=yield o.uploadAttachmentsForReply(a);s?(yield h.p.replyPost(a,o.discussionId,o.forum.id,o.forum.name,o.courseId,e,n,{attachmentsid:r,private:!!o.formData.isprivatereply}),t=!1):t=yield m.AddonModForum.replyPost(a,o.discussionId,o.forum.id,o.forum.name,o.courseId,e,n,{attachmentsid:r,private:!!o.formData.isprivatereply},void 0,!i.length)}t&&o.forum.id&&f.i.deleteReplyStoredFiles(o.forum.id,a),o.setFormData(),o.onPostChange.emit(),I.R.triggerFormSubmittedEvent(o.formElement,t,d.CoreSites.getCurrentSiteId()),o.unblockOperation()}catch(o){r.CoreDomUtils.showErrorModalDefault(o,s?"addon.mod_forum.couldnotupdate":"addon.mod_forum.couldnotadd",!0)}finally{c.dismiss()}}))()}uploadAttachmentsForEditOnline(o){var t=this;return(0,e.A)((function*(){var n,e;const a=t.formData.files||[],i=null!==(n=t.post.attachments)&&void 0!==n?n:[];if(!_.CoreFileUploader.areFileListDifferent(a,i))return;let r,s=a.filter((o=>!C.H.isFileEntry(o)));var d,c;i.length&&!s.length&&(s=[i[0]],r=[{filename:null!==(d=i[0].filename)&&void 0!==d?d:"",filepath:null!==(c=i[0].filepath)&&void 0!==c?c:""}]);const l=yield m.AddonModForum.preparePostForEdition(o,"attachment",{filesToKeep:s});return null!==(e=r)&&void 0!==e&&e.length&&(yield _.CoreFileUploader.deleteDraftFiles(l.draftitemid,r)),yield _.CoreFileUploader.uploadFiles(l.draftitemid,a),l.draftitemid}))()}uploadAttachmentsForReply(o){var t=this;return(0,e.A)((function*(){const n=t.formData.files||[];if(!n.length)return{attachments:void 0,saveOffline:!1};try{return{attachments:yield f.i.uploadOrStoreReplyFiles(t.forum.id,o,n,!1),saveOffline:!1}}catch(e){if(!t.forum.id||A.CoreWSError.isWebServiceError(e))throw e;return{attachments:yield f.i.uploadOrStoreReplyFiles(t.forum.id,o,n,!0),saveOffline:!0}}}))()}cancel(){var o=this;return(0,e.A)((function*(){try{yield o.confirmDiscard(),o.setFormData(),I.R.triggerFormCancelledEvent(o.formElement,d.CoreSites.getCurrentSiteId()),o.unblockOperation()}catch(o){}}))()}discardOfflineReply(){var o=this;return(0,e.A)((function*(){try{yield r.CoreDomUtils.showDeleteConfirm();const t=[];t.push(h.p.deleteReply(o.post.parentid)),o.forum.id&&t.push(f.i.deleteReplyStoredFiles(o.forum.id,o.post.parentid).catch((()=>{}))),yield D.g.ignoreErrors(Promise.all(t)),o.setFormData(),o.onPostChange.emit(),o.unblockOperation()}catch(o){}}))()}ratingUpdated(){m.AddonModForum.invalidateDiscussionPosts(this.discussionId,this.forum.id)}toggleAdvanced(){this.advanced=!this.advanced}ngOnDestroy(){this.unblockOperation()}confirmDiscard(){var o=this;return(0,e.A)((function*(){f.i.hasPostDataChanged(o.formData,o.originalData)&&(yield r.CoreDomUtils.showConfirm(l.HT.instant("core.confirmloss"))),o.unblockOperation()}))()}unblockOperation(){this.formData.syncId&&(g.CoreSync.unblockOperation(P.Ep,this.formData.syncId),delete this.formData.syncId)}scrollToForm(){var o=this;return(0,e.A)((function*(){yield v.y.scrollToElement(o.elementRef.nativeElement,"#addon-forum-reply-edit-form-"+o.uniqueId)}))()}analyticsLogEvent(o,t){this.post.id<=0||b.OF.logEvent({type:b.qr.VIEW_ITEM,ws:o,name:this.post.subject,data:{id:this.post.id,forumid:this.forum.id,category:"forum"},url:t})}}return(o=AddonModForumPostComponent).ɵfac=function AddonModForumPostComponent_Factory(t){return new(t||o)(a.rXU(a.aKT))},o.ɵcmp=a.VBU({type:o,selectors:[["addon-mod-forum-post"]],viewQuery:function AddonModForumPostComponent_Query(o,t){if(1&o&&a.GBs(X,5),2&o){let o;a.mGM(o=a.lsd())&&(t.formElement=o.first)}},inputs:{post:"post",courseId:"courseId",discussionId:"discussionId",discussion:"discussion",component:"component",componentId:"componentId",formData:"formData",originalData:"originalData",trackPosts:[a.Mj6.HasDecoratorInputTransform,"trackPosts","trackPosts",F.G],forum:"forum",accessInfo:"accessInfo",parentSubject:"parentSubject",ratingInfo:"ratingInfo",leavingPage:[a.Mj6.HasDecoratorInputTransform,"leavingPage","leavingPage",F.G],highlight:[a.Mj6.HasDecoratorInputTransform,"highlight","highlight",F.G]},outputs:{onPostChange:"onPostChange"},features:[a.GFd,a.OA$],decls:3,vars:2,consts:[["replyFormEl",""],[1,"addon-mod_forum-post"],[4,"ngIf"],[3,"id",4,"ngIf"],[1,"ion-text-wrap","ion-no-padding",3,"id"],[1,"ion-text-wrap"],["class","addon-mod-forum-post-title",4,"ngIf"],[1,"addon-mod-forum-post-info"],["slot","start",3,"user","courseId",4,"ngIf"],[1,"addon-mod-forum-post-author"],["class","core-discussionusername",4,"ngIf"],["class","ion-padding-bottom",4,"ngIf"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[1,"addon-mod-forum-post-more-info"],["class","ion-text-wrap",4,"ngIf"],["contextLevel","module",3,"ratingInfo","instanceId","itemId","itemSetId","courseId","aggregateMethod","scaleId","userId","onUpdate",4,"ngIf"],["contextLevel","module",3,"ratingInfo","instanceId","itemId","courseId","aggregateMethod","scaleId",4,"ngIf"],["class","ion-no-padding ion-text-end addon-forum-reply-button",4,"ngIf"],[1,"addon-mod-forum-post-title"],["name","fas-map-pin",4,"ngIf"],["name","fas-star","class","addon-forum-star",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["class","ion-float-end ion-padding-start ion-text-end",4,"ngIf"],["fill","clear",3,"ariaLabel","click",4,"ngIf"],["name","fas-map-pin"],["name","fas-star",1,"addon-forum-star"],[1,"ion-float-end","ion-padding-start","ion-text-end"],["name","fas-circle","color","primary","aria-hidden","true"],["fill","clear",3,"click","ariaLabel"],["name","ellipsis-vertical","slot","icon-only","aria-hidden","true"],["slot","start",3,"user","courseId"],[1,"core-discussionusername"],["class","core-groupname",4,"ngFor","ngForOf"],[1,"core-groupname"],["name","fas-users"],["contextLevel","course",3,"text","contextInstanceId","wsNotFiltered"],["name","fas-clock","aria-hidden","true"],[1,"ion-padding-bottom"],["color","danger"],["showInline","true",3,"files","component","componentId"],["slot","start"],[3,"tags"],["contextLevel","module",3,"onUpdate","ratingInfo","instanceId","itemId","itemSetId","courseId","aggregateMethod","scaleId","userId"],["contextLevel","module",3,"ratingInfo","instanceId","itemId","courseId","aggregateMethod","scaleId"],[1,"ion-no-padding","ion-text-end","addon-forum-reply-button"],["fill","clear","size","small",3,"click"],["name","fas-reply","slot","start","aria-hidden","true"],[3,"id"],["labelPlacement","stacked","type","text","name","subject",3,"ngModelChange","placeholder","ngModel","label"],["position","stacked"],["elementId","message","contextLevel","module",3,"contentChanged","control","placeholder","name","component","componentId","autoSave","contextInstanceId","draftExtraParams"],["expand","block","fill","outline",3,"click"],["expand","block",3,"click","disabled"],["name","isprivatereply",3,"ngModelChange","ngModel"],["button","",1,"divider","ion-text-wrap",3,"click","detail"],["name","fas-chevron-right","flip-rtl","","slot","start","aria-hidden","true","class","expandable-status-icon",4,"ngIf"],["name","fas-chevron-down","slot","start","aria-hidden","true","class","expandable-status-icon",4,"ngIf"],[1,"item-heading"],["name","fas-chevron-right","flip-rtl","","slot","start","aria-hidden","true",1,"expandable-status-icon"],["name","fas-chevron-down","slot","start","aria-hidden","true",1,"expandable-status-icon"],[3,"files","maxSize","maxSubmissions","component","componentId","allowOffline","courseId"]],template:function AddonModForumPostComponent_Template(o,t){1&o&&(a.j41(0,"div",1),a.DNE(1,AddonModForumPostComponent_ng_container_1_Template,23,25,"ng-container",2)(2,AddonModForumPostComponent_form_2_Template,24,31,"form",3),a.k0s()),2&o&&(a.R7$(),a.Y8G("ngIf",!t.formData.isEditing||!t.showForm),a.R7$(),a.Y8G("ngIf",t.showForm))},dependencies:[O.Sq,O.bT,G.V,E.Y,j.T,x.t,k.B,$.T,i.qT,i.BC,i.cb,i.vS,i.cV,S.Jm,S.I9,S.ME,S.eY,S.hU,S.lO,S.iq,S.$w,S.uz,S.he,S.JI,S.ln,S.hB,S.Gw,w.v,Y.u,N.z,U.w,L.f,V.D9],styles:["[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]{background-color:var(--ion-item-background);border-bottom:var(--addon-forum-border-color, 1px) solid var(--addon-forum-border-color)}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   .addon-forum-star[_ngcontent-%COMP%]{color:var(--core-star-color)}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   .core-groupname[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item.highlight[_ngcontent-%COMP%]::part(native){background-color:var(--addon-forum-highlight-color)}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:4px}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px;font-weight:700;flex-grow:1}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-start:0;margin-inline-end:6px;margin-top:0;margin-bottom:0}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   core-user-avatar[_ngcontent-%COMP%]{--core-avatar-size: var(--addon-forum-avatar-size);margin-inline-start:0;margin-inline-end:8px;margin-top:0;margin-bottom:0}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .addon-mod-forum-post-title[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .addon-mod-forum-post-info[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .addon-mod-forum-post-info[_ngcontent-%COMP%]{margin-top:8px}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .addon-mod-forum-post-title[_ngcontent-%COMP%] + .addon-mod-forum-post-info[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .addon-mod-forum-post-title[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .addon-mod-forum-post-info[_ngcontent-%COMP%]   .addon-mod-forum-post-author[_ngcontent-%COMP%]{flex-grow:1}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding-top:14px}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .item-inner[_ngcontent-%COMP%]{border-bottom:0}[_nghost-%COMP%]   .addon-mod_forum-post[_ngcontent-%COMP%]   .addon-mod-forum-post-more-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:1rem}"]}),AddonModForumPostComponent})()},55608:(o,t,n)=>{n.d(t,{z:()=>_});var e=n(10467),a=n(87326),i=n(6319),r=n(52749),s=n(49882),d=n(54438),m=n(60177),c=n(73465),l=n(73955);function CoreRatingAggregateComponent_ion_item_0_span_5_Template(o,t){if(1&o&&(d.j41(0,"span"),d.EFF(1),d.k0s()),2&o){const o=d.XpG(2);d.R7$(),d.SpI("(",o.item.count,")")}}function CoreRatingAggregateComponent_ion_item_0_Template(o,t){if(1&o){const o=d.RV6();d.j41(0,"ion-item",1),d.bIt("click",(function CoreRatingAggregateComponent_ion_item_0_Template_ion_item_click_0_listener(){d.eBV(o);const t=d.XpG();return d.Njj(t.openRatings())})),d.j41(1,"ion-label"),d.EFF(2),d.nI1(3,"translate"),d.nI1(4,"translate"),d.DNE(5,CoreRatingAggregateComponent_ion_item_0_span_5_Template,2,1,"span",2),d.k0s()()}if(2&o){const o=d.XpG();d.Y8G("detail",o.ratingInfo.canviewall&&o.item.count)("button",o.ratingInfo.canviewall&&o.item.count),d.R7$(2),d.E5c(" ",d.bMT(3,6,o.labelKey),"",d.bMT(4,8,"core.labelsep")," ",o.item.aggregatestr||"-"," "),d.R7$(3),d.Y8G("ngIf",o.showCount&&o.item.count&&o.item.count>0)}}let _=(()=>{var o;class CoreRatingAggregateComponent{constructor(){this.showCount=!1,this.disabled=!1,this.labelKey="",this.disabled=a.CoreRating.isRatingDisabledInSite(),this.updateSiteObserver=s.z.on(s.z.SITE_UPDATED,(()=>{this.disabled=a.CoreRating.isRatingDisabledInSite()}),r.CoreSites.getCurrentSiteId())}ngOnChanges(){var o;if(null===(o=this.aggregateObserver)||void 0===o||o.off(),delete this.aggregateObserver,this.item=(this.ratingInfo.ratings||[]).find((o=>o.itemid===this.itemId)),this.item){switch(this.aggregateMethod){case a.CoreRatingProvider.AGGREGATE_AVERAGE:this.labelKey="core.rating.aggregateavg";break;case a.CoreRatingProvider.AGGREGATE_COUNT:this.labelKey="core.rating.aggregatecount";break;case a.CoreRatingProvider.AGGREGATE_MAXIMUM:this.labelKey="core.rating.aggregatemax";break;case a.CoreRatingProvider.AGGREGATE_MINIMUM:this.labelKey="core.rating.aggregatemin";break;case a.CoreRatingProvider.AGGREGATE_SUM:this.labelKey="core.rating.aggregatesum";break;default:return this.labelKey="",void 0}this.showCount=this.aggregateMethod!=a.CoreRatingProvider.AGGREGATE_COUNT,this.aggregateObserver=s.z.on(a.CoreRatingProvider.AGGREGATE_CHANGED_EVENT,(o=>{this.item&&o.contextLevel===this.contextLevel&&o.instanceId===this.instanceId&&o.component===this.ratingInfo.component&&o.ratingArea===this.ratingInfo.ratingarea&&o.itemId===this.itemId&&(this.item.aggregatestr=o.aggregate,this.item.count=o.count)}))}}openRatings(){var o=this;return(0,e.A)((function*(){var t;if(!o.ratingInfo.canviewall||null===(t=o.item)||void 0===t||!t.count||o.disabled)return;const{CoreRatingRatingsComponent:e}=yield n.e(24).then(n.bind(n,80024));yield i.I.openModal({component:e,componentProps:{contextLevel:o.contextLevel,instanceId:o.instanceId,ratingComponent:o.ratingInfo.component,ratingArea:o.ratingInfo.ratingarea,itemId:o.itemId,scaleId:o.scaleId,courseId:o.courseId}})}))()}ngOnDestroy(){var o;null===(o=this.aggregateObserver)||void 0===o||o.off(),this.updateSiteObserver.off()}}return(o=CoreRatingAggregateComponent).ɵfac=function CoreRatingAggregateComponent_Factory(t){return new(t||o)},o.ɵcmp=d.VBU({type:o,selectors:[["core-rating-aggregate"]],inputs:{ratingInfo:"ratingInfo",contextLevel:"contextLevel",instanceId:"instanceId",itemId:"itemId",aggregateMethod:"aggregateMethod",scaleId:"scaleId",courseId:"courseId"},features:[d.OA$],decls:1,vars:1,consts:[["class","ion-text-wrap",3,"detail","button","click",4,"ngIf"],[1,"ion-text-wrap",3,"click","detail","button"],[4,"ngIf"]],template:function CoreRatingAggregateComponent_Template(o,t){1&o&&d.DNE(0,CoreRatingAggregateComponent_ion_item_0_Template,6,10,"ion-item",0),2&o&&d.Y8G("ngIf",t.item&&t.item.canviewaggregate&&t.labelKey&&!t.disabled)},dependencies:[m.bT,c.uz,c.he,l.D9],encapsulation:2}),CoreRatingAggregateComponent})()},66121:(o,t,n)=>{n.d(t,{H:()=>s});var e=n(55608),a=n(76990),i=n(3353),r=n(54438);let s=(()=>{var o;class CoreRatingComponentsModule{}return(o=CoreRatingComponentsModule).ɵfac=function CoreRatingComponentsModule_Factory(t){return new(t||o)},o.ɵmod=r.$C({type:o}),o.ɵinj=r.G2t({imports:[i.n]}),CoreRatingComponentsModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&r.Obh(s,{declarations:[e.z,a.w],imports:[i.n],exports:[e.z,a.w]}))},76990:(o,t,n)=>{n.d(t,{w:()=>h});var e=n(10467),a=n(54438),i=n(87326),r=n(32440),s=n(52749),d=n(89911),m=n(45433),c=n(79555),l=n(49882),_=n(23780),p=n(60177),g=n(89417),u=n(73465),f=n(73955);const _c0=o=>({header:o});function CoreRatingRateComponent_ion_item_0_ion_select_option_5_Template(o,t){if(1&o&&(a.j41(0,"ion-select-option",4),a.EFF(1),a.k0s()),2&o){const o=t.$implicit;a.Y8G("value",o.value),a.R7$(),a.JRh(o.name)}}function CoreRatingRateComponent_ion_item_0_Template(o,t){if(1&o){const o=a.RV6();a.j41(0,"ion-item",1)(1,"ion-select",2),a.nI1(2,"translate"),a.nI1(3,"translate"),a.nI1(4,"translate"),a.mxI("ngModelChange",(function CoreRatingRateComponent_ion_item_0_Template_ion_select_ngModelChange_1_listener(t){a.eBV(o);const n=a.XpG();return a.DH7(n.rating,t)||(n.rating=t),a.Njj(t)})),a.bIt("ngModelChange",(function CoreRatingRateComponent_ion_item_0_Template_ion_select_ngModelChange_1_listener(){a.eBV(o);const t=a.XpG();return a.Njj(t.userRatingChanged())})),a.DNE(5,CoreRatingRateComponent_ion_item_0_ion_select_option_5_Template,2,2,"ion-select-option",3),a.k0s()()}if(2&o){const o=a.XpG();a.R7$(),a.R50("ngModel",o.rating),a.Y8G("cancelText",a.bMT(2,6,"core.cancel"))("disabled",!o.item.canrate)("interfaceOptions",a.eq3(12,_c0,a.bMT(3,8,"core.rating.rating")))("label",a.bMT(4,10,"core.rating.rating")),a.R7$(4),a.Y8G("ngForOf",o.scale.items)}}let h=(()=>{var o;class CoreRatingRateComponent{constructor(){this.disabled=!1,this.onLoading=new a.bkB,this.onUpdate=new a.bkB,this.disabled=i.CoreRating.isRatingDisabledInSite(),this.updateSiteObserver=l.z.on(l.z.SITE_UPDATED,(()=>{this.disabled=i.CoreRating.isRatingDisabledInSite()}),s.CoreSites.getCurrentSiteId())}ngOnChanges(){var o=this;return(0,e.A)((function*(){if(o.item=(o.ratingInfo.ratings||[]).find((t=>t.itemid==o.itemId)),o.scale=(o.ratingInfo.scales||[]).find((t=>t.id==o.scaleId)),!o.item||!o.scale)return o.item=void 0,void 0;if(!o.scale.items&&(o.scale.items=[],o.scale.isnumeric))for(let t=0;t<=o.scale.max;t++)o.scale.items.push({name:String(t),value:t});o.scale.items[0]&&o.scale.items[0].value==i.CoreRatingProvider.UNSET_RATING||o.scale.items.unshift({name:c.HT.instant("core.none"),value:i.CoreRatingProvider.UNSET_RATING}),o.onLoading.emit(!0);try{const t=yield r.CoreRatingOffline.getRating(o.contextLevel,o.instanceId,o.ratingInfo.component,o.ratingInfo.ratingarea,o.itemId);o.rating=t.rating}catch{o.rating=o.item&&null!=o.item.rating?o.item.rating:i.CoreRatingProvider.UNSET_RATING}finally{o.onLoading.emit(!1)}}))()}userRatingChanged(){var o=this;return(0,e.A)((function*(){if(void 0===o.rating)return;const t=yield _.CoreLoadings.show("core.sending",!0);try{void 0===(yield i.CoreRating.addRating(o.ratingInfo.component,o.ratingInfo.ratingarea,o.contextLevel,o.instanceId,o.itemId,o.itemSetId,o.courseId,o.scaleId,o.rating,o.userId,o.aggregateMethod))?m.CoreToasts.show({message:"core.datastoredoffline",translateMessage:!0,duration:m.ToastDuration.LONG}):o.onUpdate.emit()}catch(o){d.CoreDomUtils.showErrorModal(o)}finally{t.dismiss()}}))()}ngOnDestroy(){this.updateSiteObserver.off()}}return(o=CoreRatingRateComponent).ɵfac=function CoreRatingRateComponent_Factory(t){return new(t||o)},o.ɵcmp=a.VBU({type:o,selectors:[["core-rating-rate"]],inputs:{ratingInfo:"ratingInfo",contextLevel:"contextLevel",instanceId:"instanceId",itemId:"itemId",itemSetId:"itemSetId",courseId:"courseId",aggregateMethod:"aggregateMethod",scaleId:"scaleId",userId:"userId"},outputs:{onLoading:"onLoading",onUpdate:"onUpdate"},features:[a.OA$],decls:1,vars:1,consts:[["class","ion-text-wrap",4,"ngIf"],[1,"ion-text-wrap"],["interface","action-sheet",1,"ion-text-start",3,"ngModelChange","ngModel","cancelText","disabled","interfaceOptions","label"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function CoreRatingRateComponent_Template(o,t){1&o&&a.DNE(0,CoreRatingRateComponent_ion_item_0_Template,6,14,"ion-item",0),2&o&&a.Y8G("ngIf",t.item&&(t.item.canrate||null!==t.item.rating)&&!t.disabled)},dependencies:[p.Sq,p.bT,g.BC,g.vS,u.uz,u.Nm,u.Ip,u.Je,f.D9],encapsulation:2}),CoreRatingRateComponent})()}}]);