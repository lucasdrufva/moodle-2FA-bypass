"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3832],{3832:(e,n,o)=>{o.r(n),o.d(n,{default:()=>Te});var t=o(21182),i=o(3353),r=o(10467),a=o(52749),s=o(55554),l=o(79555),c=o(82461);const g=function(){var e=(0,r.A)((function*(){if((yield s.g.ignoreErrors(a.CoreSites.getSites(),[])).length>0)return!0;const[e,n]=yield c.CoreLoginHelper.getAddSiteRouteInfo(),o=l.Ix.parseUrl(e);return o.queryParams=n,o}));return function hasSitesGuard(){return e.apply(this,arguments)}}();var _=o(3791),m=o(89417),d=o(89911),p=o(15324),u=o(63153),f=o(18022),h=o(83804),C=o(41722),b=o(23780),P=o(54438),S=o(60177),M=o(69901),v=o(88246),R=o(43570),k=o(73465),T=o(2950),O=o(73955);const y=["resetPasswordForm"];function CoreLoginForgottenPasswordPage_core_login_exceeded_attempts_11_Template(e,n){if(1&e&&(P.j41(0,"core-login-exceeded-attempts",14),P.nI1(1,"translate"),P.EFF(2),P.nI1(3,"translate"),P.k0s()),2&e){const e=P.XpG();P.Y8G("supportConfig",e.supportConfig)("supportSubject",P.bMT(1,3,"core.login.exceededpasswordresetattemptssupportsubject")),P.R7$(2),P.SpI(" ",P.bMT(3,5,"core.login.exceededpasswordresetattempts")," ")}}let L=(()=>{var e;class CoreLoginForgottenPasswordPage{constructor(e){this.formBuilder=e,this.wasPasswordResetRequestedRecently=!1}ngOnInit(){var e=this;return(0,r.A)((function*(){var n;const o=p.CoreNavigator.getRouteParam("siteUrl");if(!o)return d.CoreDomUtils.showErrorModal("Site URL not supplied."),p.CoreNavigator.back(),void 0;const t=p.CoreNavigator.getRouteParam("siteConfig");e.site=C.a.makeUnauthenticatedSite(o,t),e.autoFocus=f.CorePlatform.is("tablet"),e.myForm=e.formBuilder.group({field:["username",m.k0.required],value:[p.CoreNavigator.getRouteParam("username")||"",m.k0.required]}),e.supportConfig=t&&new h.Q(e.site,t),e.canContactSupport=null===(n=e.supportConfig)||void 0===n?void 0:n.canContactSupport(),e.wasPasswordResetRequestedRecently=yield c.CoreLoginHelper.wasPasswordResetRequestedRecently(o)}))()}resetPassword(e){var n=this;return(0,r.A)((function*(){e.preventDefault(),e.stopPropagation();const o=n.myForm.value.field,t=n.myForm.value.value;if(!t)return d.CoreDomUtils.showErrorModal("core.login.usernameoremail",!0),void 0;const i=yield b.CoreLoadings.show("core.sending",!0),r="email"===o;try{const e=yield c.CoreLoginHelper.requestPasswordReset(n.site.getURL(),r?"":t,r?t:"");if("dataerror"===e.status){var a;const n=null===(a=e.warnings)||void 0===a?void 0:a.find((e=>"email"===e.item&&r||"username"===e.item&&!r));n&&d.CoreDomUtils.showErrorModal(n.message)}else"emailpasswordconfirmnotsent"===e.status||"emailpasswordconfirmnoemail"===e.status?d.CoreDomUtils.showErrorModal(e.notice):(u.R.triggerFormSubmittedEvent(n.formElement,!0),yield d.CoreDomUtils.showAlert(l.HT.instant("core.success"),e.notice),yield p.CoreNavigator.back(),yield c.CoreLoginHelper.passwordResetRequested(n.site.getURL()))}catch(e){d.CoreDomUtils.showErrorModal(e)}finally{i.dismiss()}}))()}}return(e=CoreLoginForgottenPasswordPage).ɵfac=function CoreLoginForgottenPasswordPage_Factory(n){return new(n||e)(P.rXU(m.ok))},e.ɵcmp=P.VBU({type:e,selectors:[["page-core-login-forgotten-password"]],viewQuery:function CoreLoginForgottenPasswordPage_Query(e,n){if(1&e&&P.GBs(y,5),2&e){let e;P.mGM(e=P.lsd())&&(n.formElement=e.first)}},decls:41,vars:31,consts:[["resetPasswordForm",""],["slot","start"],[3,"text"],[1,"list-item-limited-width"],[3,"supportConfig","supportSubject",4,"ngIf"],[1,"ion-text-wrap"],[3,"ngSubmit","formGroup"],[1,"item-heading"],["formControlName","field"],["value","username"],["value","email"],["lines","full"],["type","text","name","value","formControlName","value","autocapitalize","none","autocorrect","off",3,"placeholder","core-auto-focus","ariaLabel"],["type","submit","expand","block",1,"ion-margin",3,"disabled"],[3,"supportConfig","supportSubject"]],template:function CoreLoginForgottenPasswordPage_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),P.nrm(3,"ion-back-button",2),P.nI1(4,"translate"),P.k0s(),P.j41(5,"ion-title")(6,"h1"),P.EFF(7),P.nI1(8,"translate"),P.k0s()()()(),P.j41(9,"ion-content")(10,"div",3),P.DNE(11,CoreLoginForgottenPasswordPage_core_login_exceeded_attempts_11_Template,4,7,"core-login-exceeded-attempts",4),P.j41(12,"ion-list")(13,"ion-item",5)(14,"ion-label"),P.EFF(15),P.nI1(16,"translate"),P.k0s()()(),P.j41(17,"ion-card")(18,"form",6,0),P.bIt("ngSubmit",(function CoreLoginForgottenPasswordPage_Template_form_ngSubmit_18_listener(o){return P.eBV(e),P.Njj(n.resetPassword(o))})),P.j41(20,"ion-item-divider",5)(21,"ion-label")(22,"p",7),P.EFF(23),P.nI1(24,"translate"),P.k0s()()(),P.j41(25,"ion-radio-group",8)(26,"ion-item")(27,"ion-radio",9),P.EFF(28),P.nI1(29,"translate"),P.k0s()(),P.j41(30,"ion-item")(31,"ion-radio",10),P.EFF(32),P.nI1(33,"translate"),P.k0s()()(),P.j41(34,"ion-item",11),P.nrm(35,"ion-input",12),P.nI1(36,"translate"),P.nI1(37,"translate"),P.k0s(),P.j41(38,"ion-button",13),P.EFF(39),P.nI1(40,"translate"),P.k0s()()()()()}2&e&&(P.R7$(3),P.Y8G("text",P.bMT(4,13,"core.back")),P.R7$(4),P.JRh(P.bMT(8,15,"core.login.passwordforgotten")),P.R7$(4),P.Y8G("ngIf",n.canContactSupport&&n.wasPasswordResetRequestedRecently),P.R7$(4),P.JRh(P.bMT(16,17,"core.login.passwordforgotteninstructions2")),P.R7$(3),P.Y8G("formGroup",n.myForm),P.R7$(5),P.JRh(P.bMT(24,19,"core.login.searchby")),P.R7$(5),P.JRh(P.bMT(29,21,"core.login.username")),P.R7$(4),P.JRh(P.bMT(33,23,"core.user.email")),P.R7$(3),P.FS9("placeholder",P.bMT(36,25,"core.login.usernameoremail")),P.Y8G("core-auto-focus",n.autoFocus)("ariaLabel",P.bMT(37,27,"core.login.usernameoremail")),P.R7$(3),P.Y8G("disabled",!n.myForm.valid),P.R7$(),P.SpI(" ",P.bMT(40,29,"core.courses.search")," "))},dependencies:[S.bT,M.i,v.i,R.T,m.qT,m.BC,m.cb,k.Jm,k.QW,k.b_,k.W9,k.eU,k.$w,k.uz,k.Dg,k.he,k.nf,k.KO,k.f0,k.BC,k.ai,k.Je,k.Gw,k.el,m.j4,m.JD,T.L,O.D9],encapsulation:2}),CoreLoginForgottenPasswordPage})();var E=o(70579),w=o(75383),F=o(85505),I=o(99121),x=o(999),G=o(62398),$=o(8756),j=o(82907),U=o(84129),N=o(69534),D=o(86552),Y=o(25880),A=o(64422),q=o(17778),V=o(86198),B=o(58197),H=o(23007),J=o(89163);const X=["ageForm"],Q=["signupFormEl"];function CoreLoginEmailSignupPage_ion_button_10_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"ion-button",9),P.nI1(1,"translate"),P.bIt("click",(function CoreLoginEmailSignupPage_ion_button_10_Template_ion_button_click_0_listener(){P.eBV(e);const n=P.XpG();return P.Njj(n.showAuthInstructions())})),P.nrm(2,"ion-icon",10),P.k0s()}2&e&&P.Y8G("ariaLabel",P.bMT(1,1,"core.login.instructions"))}function CoreLoginEmailSignupPage_core_loading_12_ion_list_2_Template(e,n){if(1&e&&(P.j41(0,"ion-list",13)(1,"ion-item",14)(2,"ion-label"),P.EFF(3),P.nI1(4,"translate"),P.k0s()(),P.j41(5,"ion-button",15),P.EFF(6),P.nI1(7,"translate"),P.k0s()()),2&e){const e=P.XpG(2);P.R7$(3),P.SpI(" ",P.bMT(4,5,"core.login.signuprequiredfieldnotsupported")," "),P.R7$(2),P.Y8G("href",e.signupUrl)("autoLogin",!1)("showBrowserWarning",!1),P.R7$(),P.SpI(" ",P.bMT(7,7,"core.openinbrowser")," ")}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_ion_select_option_23_Template(e,n){if(1&e&&(P.j41(0,"ion-select-option",25),P.EFF(1),P.k0s()),2&e){const e=n.$implicit;P.Y8G("value",e.code),P.R7$(),P.JRh(e.name)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"form",17,0),P.bIt("ngSubmit",(function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template_form_ngSubmit_0_listener(n){P.eBV(e);const o=P.XpG(3);return P.Njj(o.verifyAge(n))})),P.j41(2,"ion-item-divider",14)(3,"ion-label")(4,"h2"),P.EFF(5),P.nI1(6,"translate"),P.k0s()()(),P.j41(7,"ion-item",14)(8,"ion-input",18)(9,"div",19),P.EFF(10),P.nI1(11,"translate"),P.k0s()()(),P.j41(12,"ion-item",14)(13,"ion-select",20),P.nI1(14,"translate"),P.nI1(15,"translate"),P.nI1(16,"translate"),P.j41(17,"div",19),P.EFF(18),P.nI1(19,"translate"),P.k0s(),P.j41(20,"ion-select-option",21),P.EFF(21),P.nI1(22,"translate"),P.k0s(),P.DNE(23,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_ion_select_option_23_Template,2,2,"ion-select-option",22),P.k0s()(),P.j41(24,"div",13)(25,"ion-button",23),P.EFF(26),P.nI1(27,"translate"),P.k0s()(),P.j41(28,"ion-item",14)(29,"ion-label")(30,"p",24),P.EFF(31),P.nI1(32,"translate"),P.k0s(),P.j41(33,"p"),P.EFF(34),P.nI1(35,"translate"),P.k0s()()()()}if(2&e){const e=P.XpG(3);P.Y8G("formGroup",e.ageVerificationForm),P.R7$(5),P.JRh(P.bMT(6,15,"core.agelocationverification")),P.R7$(4),P.Y8G("core-mark-required",!0),P.R7$(),P.JRh(P.bMT(11,17,"core.whatisyourage")),P.R7$(3),P.Y8G("cancelText",P.bMT(14,19,"core.cancel"))("okText",P.bMT(15,21,"core.ok"))("placeholder",P.bMT(16,23,"core.login.selectacountry")),P.R7$(4),P.Y8G("core-mark-required",!0),P.R7$(),P.JRh(P.bMT(19,25,"core.wheredoyoulive")),P.R7$(3),P.JRh(P.bMT(22,27,"core.login.selectacountry")),P.R7$(2),P.Y8G("ngForOf",e.countries),P.R7$(2),P.Y8G("disabled",!e.ageVerificationForm.valid),P.R7$(),P.SpI(" ",P.bMT(27,29,"core.proceed")," "),P.R7$(5),P.JRh(P.bMT(32,31,"core.whyisthisrequired")),P.R7$(3),P.JRh(P.bMT(35,33,"core.explanationdigitalminor"))}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_4_Template(e,n){if(1&e&&(P.j41(0,"p",41),P.EFF(1),P.k0s()),2&e){const e=P.XpG(4);P.R7$(),P.JRh(e.site.siteUrl)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_5_Template(e,n){if(1&e&&(P.j41(0,"p",41),P.nrm(1,"core-format-text",42),P.k0s()),2&e){const e=P.XpG(4);P.R7$(),P.Y8G("text",e.siteName)("filter",!1)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_6_Template(e,n){if(1&e&&(P.j41(0,"p"),P.EFF(1),P.k0s()),2&e){const e=P.XpG(4);P.R7$(),P.JRh(e.site.siteUrl)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_21_Template(e,n){if(1&e&&(P.j41(0,"p",43),P.EFF(1),P.k0s()),2&e){const e=P.XpG(4);P.R7$(),P.SpI(" ",e.settings.passwordpolicy," ")}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_item_37_Template(e,n){if(1&e&&(P.j41(0,"ion-item",14)(1,"ion-input",44),P.nI1(2,"translate"),P.j41(3,"div",19),P.EFF(4),P.nI1(5,"translate"),P.k0s()(),P.nrm(6,"core-input-errors",29),P.k0s()),2&e){const e=n.$implicit,o=P.XpG(4);P.R7$(),P.FS9("formControlName",e),P.Y8G("name",e)("placeholder",P.bMT(2,7,"core.user."+e)),P.R7$(2),P.Y8G("core-mark-required",!0),P.R7$(),P.JRh(P.bMT(5,9,"core.user."+e)),P.R7$(2),P.Y8G("control",o.signupForm.controls[e])("errorMessages",o.namefieldsErrors[e])}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_select_option_51_Template(e,n){if(1&e&&(P.j41(0,"ion-select-option",25),P.EFF(1),P.k0s()),2&e){const e=n.$implicit;P.Y8G("value",e.code),P.R7$(),P.JRh(e.name)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_52_core_user_profile_field_5_Template(e,n){if(1&e&&P.nrm(0,"core-user-profile-field",46),2&e){const e=n.$implicit,o=P.XpG(5);P.Y8G("field",e)("edit",!0)("signup",!0)("form",o.signupForm)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_52_Template(e,n){if(1&e&&(P.qex(0),P.j41(1,"ion-item-divider",14)(2,"ion-label")(3,"p",24),P.EFF(4),P.k0s()()(),P.DNE(5,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_52_core_user_profile_field_5_Template,1,4,"core-user-profile-field",45),P.bVm()),2&e){const e=n.$implicit;P.R7$(4),P.JRh(e.name),P.R7$(),P.Y8G("ngForOf",e.fields)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_53_Template(e,n){if(1&e&&(P.qex(0),P.j41(1,"ion-item-divider",14)(2,"ion-label")(3,"h2",47),P.EFF(4),P.nI1(5,"translate"),P.k0s()()(),P.nrm(6,"core-recaptcha",48),P.bVm()),2&e){const e=P.XpG(4);P.R7$(3),P.Y8G("core-mark-required",!0),P.R7$(),P.JRh(P.bMT(5,6,"core.login.security_question")),P.R7$(2),P.Y8G("publicKey",e.settings.recaptchapublickey)("model",e.captcha)("siteUrl",e.site.siteUrl)("showRequiredError",e.formSubmitClicked)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_54_Template(e,n){if(1&e&&(P.qex(0),P.j41(1,"ion-item-divider",14)(2,"ion-label")(3,"h2"),P.EFF(4),P.nI1(5,"translate"),P.k0s()()(),P.j41(6,"ion-item",14)(7,"ion-label")(8,"a",49),P.EFF(9),P.nI1(10,"translate"),P.k0s()()(),P.j41(11,"ion-item",14)(12,"ion-checkbox",50)(13,"p",47),P.EFF(14),P.nI1(15,"translate"),P.k0s()(),P.nrm(16,"core-input-errors",29),P.k0s(),P.bVm()),2&e){const e=P.XpG(4);P.R7$(4),P.JRh(P.bMT(5,7,"core.policy.policyagreement")),P.R7$(4),P.Y8G("href",e.settings.sitepolicy,P.B4B),P.R7$(),P.SpI(" ",P.bMT(10,9,"core.policy.policyagreementclick")," "),P.R7$(4),P.Y8G("core-mark-required",!0),P.R7$(),P.JRh(P.bMT(15,11,"core.policy.policyacceptmandatory")),P.R7$(2),P.Y8G("control",e.signupForm.controls.policyagreed)("errorMessages",e.policyErrors)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"form",17,1),P.bIt("ngSubmit",(function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template_form_ngSubmit_0_listener(n){P.eBV(e);const o=P.XpG(3);return P.Njj(o.create(n))})),P.j41(2,"ion-item",26)(3,"ion-label"),P.DNE(4,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_4_Template,2,1,"p",27)(5,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_5_Template,2,2,"p",27)(6,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_6_Template,2,1,"p",8),P.k0s()(),P.j41(7,"ion-item",14)(8,"ion-input",28),P.nI1(9,"translate"),P.j41(10,"div",19),P.EFF(11),P.nI1(12,"translate"),P.k0s()(),P.nrm(13,"core-input-errors",29),P.k0s(),P.j41(14,"ion-item",14)(15,"ion-input",30),P.nI1(16,"translate"),P.j41(17,"div",19),P.EFF(18),P.nI1(19,"translate"),P.k0s(),P.nrm(20,"ion-input-password-toggle",31),P.k0s(),P.DNE(21,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_21_Template,2,1,"p",32),P.nrm(22,"core-input-errors",29),P.k0s(),P.j41(23,"ion-item",14)(24,"ion-input",33),P.nI1(25,"translate"),P.j41(26,"div",19),P.EFF(27),P.nI1(28,"translate"),P.k0s()(),P.nrm(29,"core-input-errors",29),P.k0s(),P.j41(30,"ion-item",14)(31,"ion-input",34),P.nI1(32,"translate"),P.j41(33,"div",19),P.EFF(34),P.nI1(35,"translate"),P.k0s()(),P.nrm(36,"core-input-errors",29),P.k0s(),P.DNE(37,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_item_37_Template,7,11,"ion-item",35),P.j41(38,"ion-item",14),P.nrm(39,"ion-input",36),P.nI1(40,"translate"),P.nI1(41,"translate"),P.k0s(),P.j41(42,"ion-item",14)(43,"ion-select",37),P.nI1(44,"translate"),P.nI1(45,"translate"),P.nI1(46,"translate"),P.nI1(47,"translate"),P.j41(48,"ion-select-option",21),P.EFF(49),P.nI1(50,"translate"),P.k0s(),P.DNE(51,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_select_option_51_Template,2,2,"ion-select-option",22),P.k0s()(),P.DNE(52,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_52_Template,6,2,"ng-container",38)(53,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_53_Template,7,8,"ng-container",8)(54,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_54_Template,17,13,"ng-container",8),P.j41(55,"div",13)(56,"ion-button",39),P.EFF(57),P.nI1(58,"translate"),P.k0s(),P.nrm(59,"input",40),P.k0s()()}if(2&e){const e=P.XpG(3);P.Y8G("formGroup",e.signupForm),P.R7$(4),P.Y8G("ngIf",!e.siteName&&e.displaySiteUrl),P.R7$(),P.Y8G("ngIf",e.siteName),P.R7$(),P.Y8G("ngIf",e.siteName&&e.displaySiteUrl),P.R7$(2),P.FS9("placeholder",P.bMT(9,40,"core.login.username")),P.R7$(2),P.Y8G("core-mark-required",!0),P.R7$(),P.JRh(P.bMT(12,42,"core.login.username")),P.R7$(2),P.Y8G("control",e.signupForm.controls.username)("errorMessages",e.usernameErrors),P.R7$(2),P.FS9("placeholder",P.bMT(16,44,"core.login.password")),P.Y8G("clearOnEdit",!1),P.R7$(2),P.Y8G("core-mark-required",!0),P.R7$(),P.JRh(P.bMT(19,46,"core.login.password")),P.R7$(3),P.Y8G("ngIf",e.settings.passwordpolicy),P.R7$(),P.Y8G("control",e.signupForm.controls.password)("errorMessages",e.passwordErrors),P.R7$(2),P.FS9("placeholder",P.bMT(25,48,"core.user.email")),P.R7$(2),P.Y8G("core-mark-required",!0),P.R7$(),P.JRh(P.bMT(28,50,"core.user.email")),P.R7$(2),P.Y8G("control",e.signupForm.controls.email)("errorMessages",e.emailErrors),P.R7$(2),P.FS9("placeholder",P.bMT(32,52,"core.user.emailagain")),P.Y8G("pattern",e.escapeMail(e.signupForm.controls.email.value)),P.R7$(2),P.Y8G("core-mark-required",!0),P.R7$(),P.JRh(P.bMT(35,54,"core.user.emailagain")),P.R7$(2),P.Y8G("control",e.signupForm.controls.email2)("errorMessages",e.email2Errors),P.R7$(),P.Y8G("ngForOf",e.settings.namefields),P.R7$(2),P.FS9("placeholder",P.bMT(40,56,"core.user.city")),P.Y8G("label",P.bMT(41,58,"core.user.city")),P.R7$(4),P.Y8G("placeholder",P.bMT(44,60,"core.login.selectacountry"))("cancelText",P.bMT(45,62,"core.cancel"))("okText",P.bMT(46,64,"core.ok"))("label",P.bMT(47,66,"core.user.country")),P.R7$(6),P.JRh(P.bMT(50,68,"core.login.selectacountry")),P.R7$(2),P.Y8G("ngForOf",e.countries),P.R7$(),P.Y8G("ngForOf",e.categories),P.R7$(),P.Y8G("ngIf",e.settings.recaptchapublickey),P.R7$(),P.Y8G("ngIf",e.settings.sitepolicy),P.R7$(3),P.JRh(P.bMT(58,70,"core.login.createaccount"))}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_Template(e,n){if(1&e&&(P.qex(0),P.DNE(1,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template,36,35,"form",16)(2,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template,60,72,"form",16),P.bVm()),2&e){const e=P.XpG(2);P.R7$(),P.Y8G("ngIf",e.ageDigitalConsentVerification),P.R7$(),P.Y8G("ngIf",!e.ageDigitalConsentVerification&&e.site)}}function CoreLoginEmailSignupPage_core_loading_12_Template(e,n){if(1&e&&(P.j41(0,"core-loading",11)(1,"div",7),P.DNE(2,CoreLoginEmailSignupPage_core_loading_12_ion_list_2_Template,8,9,"ion-list",12)(3,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_Template,3,2,"ng-container",8),P.k0s()()),2&e){const e=P.XpG();P.Y8G("hideUntil",e.settingsLoaded),P.R7$(2),P.Y8G("ngIf",!e.allRequiredSupported),P.R7$(),P.Y8G("ngIf",e.allRequiredSupported&&e.settingsLoaded&&e.settings)}}function CoreLoginEmailSignupPage_ion_list_14_h2_3_Template(e,n){if(1&e&&(P.j41(0,"h2",53),P.nrm(1,"core-format-text",42),P.k0s()),2&e){const e=P.XpG(2);P.R7$(),P.Y8G("text",e.siteName)("filter",!1)}}function CoreLoginEmailSignupPage_ion_list_14_p_12_Template(e,n){if(1&e&&(P.j41(0,"p"),P.EFF(1),P.k0s()),2&e){const e=P.XpG(2);P.R7$(),P.JRh(e.supportName)}}function CoreLoginEmailSignupPage_ion_list_14_p_13_Template(e,n){if(1&e&&(P.j41(0,"p"),P.EFF(1),P.k0s()),2&e){const e=P.XpG(2);P.R7$(),P.JRh(e.supportEmail)}}function CoreLoginEmailSignupPage_ion_list_14_ion_button_15_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"ion-button",54),P.bIt("click",(function CoreLoginEmailSignupPage_ion_list_14_ion_button_15_Template_ion_button_click_0_listener(){P.eBV(e);const n=P.XpG(2);return P.Njj(n.showContactOnSite())})),P.EFF(1),P.nI1(2,"translate"),P.k0s()}2&e&&(P.R7$(),P.SpI(" ",P.bMT(2,1,"core.openinbrowser")," "))}function CoreLoginEmailSignupPage_ion_list_14_Template(e,n){if(1&e&&(P.j41(0,"ion-list")(1,"ion-item-divider",14)(2,"ion-label"),P.DNE(3,CoreLoginEmailSignupPage_ion_list_14_h2_3_Template,2,2,"h2",51),P.k0s()(),P.j41(4,"ion-item",14)(5,"ion-label")(6,"p",24),P.EFF(7),P.nI1(8,"translate"),P.k0s(),P.j41(9,"p"),P.EFF(10),P.nI1(11,"translate"),P.k0s(),P.DNE(12,CoreLoginEmailSignupPage_ion_list_14_p_12_Template,2,1,"p",8)(13,CoreLoginEmailSignupPage_ion_list_14_p_13_Template,2,1,"p",8),P.k0s()(),P.j41(14,"div",13),P.DNE(15,CoreLoginEmailSignupPage_ion_list_14_ion_button_15_Template,3,3,"ion-button",52),P.k0s()()),2&e){const e=P.XpG();P.R7$(3),P.Y8G("ngIf",e.siteName),P.R7$(4),P.JRh(P.bMT(8,6,"core.considereddigitalminor")),P.R7$(3),P.JRh(P.bMT(11,8,"core.digitalminor_desc")),P.R7$(2),P.Y8G("ngIf",e.supportName),P.R7$(),P.Y8G("ngIf",e.supportEmail),P.R7$(2),P.Y8G("ngIf",!e.supportName&&!e.supportEmail)}}let z=(()=>{var e;class CoreLoginEmailSignupPage{constructor(e,n,o){this.fb=e,this.elementRef=n,this.changeDetector=o,this.displaySiteUrl=!1,this.authInstructions="",this.settingsLoaded=!1,this.allRequiredSupported=!0,this.formSubmitClicked=!1,this.captcha={recaptcharesponse:""},this.isMinor=!1,this.ageVerificationForm=this.fb.group({age:["",m.k0.required]}),this.countryControl=this.fb.control("",{validators:m.k0.required,nonNullable:!0}),this.ageVerificationForm.addControl("country",this.countryControl),this.signupForm=this.fb.group({password:["",m.k0.required],email:["",m.k0.compose([m.k0.required,m.k0.email])],email2:["",m.k0.compose([m.k0.required,m.k0.email])]}),this.usernameErrors={required:"core.login.usernamerequired",pattern:{[CoreLoginEmailSignupPage.USERNAME_STRICT_CHARS_PATTERN]:"core.login.invalidusername",[CoreLoginEmailSignupPage.USERNAME_LOWERCASE_PATTERN]:"core.login.usernamelowercase"}},this.passwordErrors={required:"core.login.passwordrequired"},this.emailErrors={required:"core.login.missingemail"},this.policyErrors={required:"core.policy.policyagree"},this.email2Errors={required:"core.login.missingemail",pattern:"core.login.emailnotmatch"}}ngOnInit(){const e=p.CoreNavigator.getRouteParam("siteUrl");if(!e)return d.CoreDomUtils.showErrorModal("Site URL not supplied."),p.CoreNavigator.back(),void 0;this.site=C.a.makeUnauthenticatedSite(e),this.displaySiteUrl=this.site.shouldDisplayInformativeLinks(),this.fetchData().finally((()=>{this.settingsLoaded=!0}))}completeFormGroup(){var e,n,o,t;const i=!1===(null===(e=this.settings)||void 0===e?void 0:e.extendedusernamechars);this.signupForm.addControl("username",this.fb.control("",m.k0.compose([m.k0.required,m.k0.pattern(CoreLoginEmailSignupPage.USERNAME_LOWERCASE_PATTERN),i?m.k0.pattern(CoreLoginEmailSignupPage.USERNAME_STRICT_CHARS_PATTERN):void 0]))),this.signupForm.addControl("city",this.fb.control((null===(n=this.settings)||void 0===n?void 0:n.defaultcity)||"")),this.signUpCountryControl=this.fb.control((null===(o=this.settings)||void 0===o?void 0:o.country)||"",{nonNullable:!0}),this.signupForm.addControl("country",this.signUpCountryControl);for(const e in null===(r=this.settings)||void 0===r?void 0:r.namefields){var r,a;this.signupForm.addControl(null===(a=this.settings)||void 0===a?void 0:a.namefields[e],this.fb.control("",m.k0.required))}null!==(t=this.settings)&&void 0!==t&&t.sitepolicy&&this.signupForm.addControl("policyagreed",this.fb.control(!1,m.k0.requiredTrue))}fetchData(){var e=this;return(0,r.A)((function*(){try{e.siteConfig=yield e.site.getPublicConfig(),e.signupUrl=$.$.concatenatePaths(e.siteConfig.httpswwwroot,"login/signup.php");if(yield e.treatSiteConfig()){if(void 0===e.ageDigitalConsentVerification){const n=yield s.g.ignoreErrors(I.CoreWS.callAjax("core_auth_is_age_digital_consent_verification_enabled",{},{siteUrl:e.site.getURL()}));e.ageDigitalConsentVerification=!(null==n||!n.status)}yield e.getSignupSettings()}e.completeFormGroup()}catch(n){e.allRequiredSupported&&d.CoreDomUtils.showErrorModal(n)}}))()}getSignupSettings(){var e=this;return(0,r.A)((function*(){if(e.settings=yield c.CoreLoginHelper.getEmailSignupSettings(e.site.getURL()),x.CoreUserProfileFieldDelegate.hasRequiredUnsupportedField(e.settings.profilefields))throw e.allRequiredSupported=!1,new Error(l.HT.instant("core.login.signuprequiredfieldnotsupported"));e.categories=c.CoreLoginHelper.formatProfileFieldsForSignup(e.settings.profilefields),e.settings.recaptchapublickey&&(e.captcha.recaptcharesponse=""),e.countryControl.value||e.countryControl.setValue(e.settings.country||"");const n={};e.settings.namefields&&e.settings.namefields.forEach((e=>{n[e]={required:"core.login.missing"+e}})),e.namefieldsErrors=n,e.countries=yield F.A.getCountryListSorted()}))()}treatSiteConfig(){var e=this;return(0,r.A)((function*(){var n;return"email"!=(null===(n=e.siteConfig)||void 0===n?void 0:n.registerauth)||e.site.isFeatureDisabled(U.ty)?(d.CoreDomUtils.showErrorModal(l.HT.instant("core.login.signupplugindisabled",{$a:l.HT.instant("core.login.auth_email")})),p.CoreNavigator.back(),!1):(e.siteName=yield e.site.getSiteName(),e.authInstructions=e.siteConfig.authinstructions,e.ageDigitalConsentVerification=e.siteConfig.agedigitalconsentverification,e.supportName=e.siteConfig.supportname,e.supportEmail=e.siteConfig.supportemail,e.countryControl.setValue(e.siteConfig.country||""),!0)}))()}create(e){var n=this;return(0,r.A)((function*(){var o,t,i;if(e.preventDefault(),e.stopPropagation(),n.formSubmitClicked=!0,!n.signupForm.valid||null!==(o=n.settings)&&void 0!==o&&o.recaptchapublickey&&!n.captcha.recaptcharesponse){for(const e in n.signupForm.controls)n.signupForm.controls[e].markAsDirty();n.changeDetector.detectChanges();return(yield j.y.scrollToInputError(n.elementRef.nativeElement))||d.CoreDomUtils.showErrorModal("core.errorinvalidform",!0),void 0}const r=yield b.CoreLoadings.show("core.sending",!0),a={username:n.signupForm.value.username.trim().toLowerCase(),password:n.signupForm.value.password,firstname:w.Ni.cleanTags(n.signupForm.value.firstname),lastname:w.Ni.cleanTags(n.signupForm.value.lastname),email:n.signupForm.value.email.trim(),city:w.Ni.cleanTags(n.signupForm.value.city),country:n.signupForm.value.country};null!==(t=n.siteConfig)&&void 0!==t&&t.launchurl&&(a.redirect=yield c.CoreLoginHelper.prepareForSSOLogin(n.site.getURL(),void 0,n.siteConfig.launchurl)),null!==(i=n.settings)&&void 0!==i&&i.recaptchapublickey&&n.captcha.recaptcharesponse&&(a.recaptcharesponse=n.captcha.recaptcharesponse);try{var s;a.customprofilefields=yield x.CoreUserProfileFieldDelegate.getDataForFields(null===(s=n.settings)||void 0===s?void 0:s.profilefields,!0,"email",n.signupForm.value);const e=yield I.CoreWS.callAjax("auth_email_signup_user",a,{siteUrl:n.site.getURL()});if(e.success){u.R.triggerFormSubmittedEvent(n.signupFormElement,!0);const e=l.HT.instant("core.login.emailconfirmsent",{$a:a.email});d.CoreDomUtils.showAlert(l.HT.instant("core.success"),e),p.CoreNavigator.back()}else{var g,_;null===(g=n.recaptchaComponent)||void 0===g||g.expireRecaptchaAnswer();const o=null===(_=e.warnings)||void 0===_?void 0:_[0];if(o){let e=o.message;("incorrect-captcha-sol"==e||!e&&"recaptcharesponse"==o.item)&&(e=l.HT.instant("core.login.recaptchaincorrect")),d.CoreDomUtils.showErrorModal(e)}else d.CoreDomUtils.showErrorModal("core.login.usernotaddederror",!0)}}catch(e){d.CoreDomUtils.showErrorModalDefault(e,"core.login.usernotaddederror",!0)}finally{r.dismiss()}}))()}escapeMail(e){return w.Ni.escapeForRegex(e)}showAuthInstructions(){N.m.viewText(l.HT.instant("core.login.instructions"),this.authInstructions)}showContactOnSite(){D.j.openInBrowser($.$.concatenatePaths(this.site.getURL(),"/login/verify_age_location.php"),{showBrowserWarning:!1})}verifyAge(e){var n=this;return(0,r.A)((function*(){if(e.preventDefault(),e.stopPropagation(),!n.ageVerificationForm.valid)return d.CoreDomUtils.showErrorModal("core.errorinvalidform",!0),void 0;const o=yield b.CoreLoadings.show("core.sending",!0),t=n.ageVerificationForm.value;t.age=parseInt(t.age,10);try{const e=yield I.CoreWS.callAjax("core_auth_is_minor",t,{siteUrl:n.site.getURL()});if(u.R.triggerFormSubmittedEvent(n.ageFormElement,!0),e.status)n.isMinor=!0;else{var i;if(n.countryControl.value)null===(i=n.signUpCountryControl)||void 0===i||i.setValue(n.countryControl.value);n.ageDigitalConsentVerification=!1}}catch{d.CoreDomUtils.showErrorModal("There was an error verifying your age, please try again using the browser.")}finally{o.dismiss()}}))()}}return(e=CoreLoginEmailSignupPage).USERNAME_STRICT_CHARS_PATTERN="^[A-Z-.@_a-z0-9]*$",e.USERNAME_LOWERCASE_PATTERN="^[^A-Z]*$",e.ɵfac=function CoreLoginEmailSignupPage_Factory(n){return new(n||e)(P.rXU(m.ok),P.rXU(P.aKT),P.rXU(P.gRc))},e.ɵcmp=P.VBU({type:e,selectors:[["page-core-login-email-signup"]],viewQuery:function CoreLoginEmailSignupPage_Query(e,n){if(1&e&&(P.GBs(G.i,5),P.GBs(X,5),P.GBs(Q,5)),2&e){let e;P.mGM(e=P.lsd())&&(n.recaptchaComponent=e.first),P.mGM(e=P.lsd())&&(n.ageFormElement=e.first),P.mGM(e=P.lsd())&&(n.signupFormElement=e.first)}},decls:15,vars:9,consts:[["ageForm",""],["signupFormEl",""],["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"ariaLabel","click",4,"ngIf"],[3,"hideUntil",4,"ngIf"],[1,"list-item-limited-width"],[4,"ngIf"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","far-circle-question","aria-hidden","true"],[3,"hideUntil"],["class","ion-padding",4,"ngIf"],[1,"ion-padding"],[1,"ion-text-wrap"],["expand","block","core-link","",3,"href","autoLogin","showBrowserWarning"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"ngSubmit","formGroup"],["labelPlacement","stacked","type","number","name","age","placeholder","0","formControlName","age","autocapitalize","none","autocorrect","off"],["slot","label",3,"core-mark-required"],["labelPlacement","stacked","name","country","formControlName","country",3,"cancelText","okText","placeholder"],["value",""],[3,"value",4,"ngFor","ngForOf"],["expand","block","type","submit",3,"disabled"],[1,"item-heading"],[3,"value"],[1,"ion-text-wrap","ion-text-center"],["class","ion-padding item-heading",4,"ngIf"],["labelPlacement","stacked","type","text","name","username","formControlName","username","autocapitalize","none","autocorrect","off",3,"placeholder"],[3,"control","errorMessages"],["labelPlacement","stacked","name","password","type","password","formControlName","password","autocomplete","new-password","required","true",3,"placeholder","clearOnEdit"],["slot","end","showIcon","fas-eye","hideIcon","fas-eye-slash"],["class","core-input-footnote",4,"ngIf"],["labelPlacement","stacked","type","email","name","email","formControlName","email","autocapitalize","none","autocorrect","off",3,"placeholder"],["labelPlacement","stacked","type","email","name","email2","autocapitalize","none","formControlName","email2","autocorrect","off",3,"placeholder","pattern"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["labelPlacement","stacked","type","text","name","city","formControlName","city","autocorrect","off",3,"placeholder","label"],["labelPlacement","stacked","name","country","formControlName","country",3,"placeholder","cancelText","okText","label"],[4,"ngFor","ngForOf"],["expand","block","type","submit"],["type","submit",1,"core-submit-hidden-enter"],[1,"ion-padding","item-heading"],[3,"text","filter"],[1,"core-input-footnote"],["labelPlacement","stacked","type","text","autocorrect","off",3,"name","formControlName","placeholder"],["registerAuth","email",3,"field","edit","signup","form",4,"ngFor","ngForOf"],["registerAuth","email",3,"field","edit","signup","form"],[3,"core-mark-required"],[3,"publicKey","model","siteUrl","showRequiredError"],["core-link","","capture","false",3,"href"],["labelPlacement","start","justify","space-between","name","policyagreed","formControlName","policyagreed"],["class","item-heading ion-padding",4,"ngIf"],["expand","block",3,"click",4,"ngIf"],[1,"item-heading","ion-padding"],["expand","block",3,"click"]],template:function CoreLoginEmailSignupPage_Template(e,n){1&e&&(P.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),P.nrm(3,"ion-back-button",3),P.nI1(4,"translate"),P.k0s(),P.j41(5,"ion-title")(6,"h1"),P.EFF(7),P.nI1(8,"translate"),P.k0s()(),P.j41(9,"ion-buttons",4),P.DNE(10,CoreLoginEmailSignupPage_ion_button_10_Template,3,3,"ion-button",5),P.k0s()()(),P.j41(11,"ion-content"),P.DNE(12,CoreLoginEmailSignupPage_core_loading_12_Template,4,3,"core-loading",6),P.j41(13,"div",7),P.DNE(14,CoreLoginEmailSignupPage_ion_list_14_Template,16,10,"ion-list",8),P.k0s()()),2&e&&(P.R7$(3),P.Y8G("text",P.bMT(4,5,"core.back")),P.R7$(4),P.JRh(P.bMT(8,7,"core.login.newaccount")),P.R7$(3),P.Y8G("ngIf",n.authInstructions),P.R7$(2),P.Y8G("ngIf",!n.isMinor),P.R7$(2),P.Y8G("ngIf",n.allRequiredSupported&&n.isMinor))},dependencies:[S.Sq,S.bT,Y.q,A.R,q.j,G.i,V.t,B.B,H.j,v.i,R.T,m.qT,m.BC,m.cb,m.YS,m.R_,k.Jm,k.QW,k.eY,k.W9,k.eU,k.iq,k.$w,k.Wv,k.uz,k.Dg,k.he,k.nf,k.Nm,k.Ip,k.BC,k.ai,k.hB,k.su,k.Je,k.Gw,k.el,m.j4,m.JD,J.h,O.D9],styles:['[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--background: var(--core-login-background);--ion-item-background: var(--core-login-background);--color: var(--core-login-text-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--color: var(--core-login-text-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .core-oauth-icon[_ngcontent-%COMP%]{color:var(--color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]{--color: var(--core-login-text-color);text-decoration-color:var(--color)}[_nghost-%COMP%]   .core-login-reconnect-warning[_ngcontent-%COMP%]{margin:0 0 32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]{margin-bottom:32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{width:90%;max-width:300px;margin:0 auto}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:104px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-sitename[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:8px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-siteurl[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%] + .core-login-user[_ngcontent-%COMP%]{margin-top:24px}[_nghost-%COMP%]   core-user-avatar.large-avatar[_ngcontent-%COMP%]{--core-avatar-size: var(--core-large-avatar-size)}[_nghost-%COMP%]   .core-login-fullname[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--background: var(--core-login-input-background);--color: var(--core-login-input-color)}[_nghost-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-left:0;margin-right:0}[_nghost-%COMP%]   .core-login-forgotten-password[_ngcontent-%COMP%]{text-decoration:underline}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]{position:relative;padding:8px 0}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:var(--core-login-background);padding:0 8px}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]:before{height:1px;position:absolute;top:50%;left:0;right:0;border-bottom:1px solid var(--gray-300);content:"";z-index:-1}[_nghost-%COMP%]   .core-login-login-button[_ngcontent-%COMP%]{margin-top:32px}[_nghost-%COMP%]   .core-login-login-inbrowser-button[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   p.core-login-inbrowser[_ngcontent-%COMP%]{font:var(--mdl-typography-body-font-sm);margin-top:8px;margin-bottom:8px}[_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]{margin-top:8px;border-top:1px solid var(--gray-300)}[_nghost-%COMP%]   .core-login-identity-providers[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px;font:var(--mdl-typography-heading6-font)}:root.dark[_nghost-%COMP%]   core-loading[_ngcontent-%COMP%], :root.dark   [_nghost-%COMP%]   core-loading[_ngcontent-%COMP%]{--loading-background: var(--core-login-background-dark);--loading-text-color: #ffffff;--loading-spinner: #ffffff}']}),CoreLoginEmailSignupPage})();var W=o(94455),K=o(85190),Z=o(81690),ee=o(75629),ne=o(74431),oe=o(8014),te=o(85850),ie=o(49588),re=o(51092),ae=o(60378),se=o(21776),le=o(99622),ce=o(246);let ge=(()=>{var e;class CoreReferrerService{consumeInstallReferrerUrl(){return(0,r.A)((function*(){const e=ce.b.plugin("installReferrer");if(!e)return;if(!(yield K.CoreConfig.get(CoreReferrerService.INSTALL_REFERRER_CONSUMED,0)))try{var n;const o=(null!==(n=(yield e.getReferrer()).referrer)&&void 0!==n?n:"").match(/siteurl=([^&]+)/);return null==o?void 0:o[1]}catch{}finally{yield K.CoreConfig.set(CoreReferrerService.INSTALL_REFERRER_CONSUMED,1)}}))()}}return(e=CoreReferrerService).INSTALL_REFERRER_CONSUMED="install_referrer_consumed",e.ɵfac=function CoreReferrerService_Factory(n){return new(n||e)},e.ɵprov=P.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),CoreReferrerService})();const _e=(0,l.Qd)(ge);var me=o(44426),de=o(6319),pe=o(68831),ue=o(10892);const fe=["siteFormEl"],site_c1=e=>({site:e});function CoreLoginSitePage_form_17_ng_container_2_Template(e,n){if(1&e&&(P.qex(0),P.j41(1,"ion-item",15),P.nrm(2,"ion-input",16),P.nI1(3,"translate"),P.nI1(4,"translate"),P.k0s(),P.bVm()),2&e){const e=P.XpG(2);P.R7$(2),P.FS9("placeholder",P.bMT(3,4,"core.login.siteaddressplaceholder")),P.Y8G("core-auto-focus",e.showKeyboard&&!e.showScanQR)("label",P.bMT(4,6,"core.login.siteaddress"))("clearInput",!0)}}function CoreLoginSitePage_form_17_ng_container_3_ion_item_11_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"ion-item",26),P.nI1(1,"translate"),P.bIt("click",(function CoreLoginSitePage_form_17_ng_container_3_ion_item_11_Template_ion_item_click_0_listener(n){P.eBV(e);const o=P.XpG(3);return P.Njj(o.connect(o.enteredSiteUrl.url,n))})),P.j41(2,"ion-thumbnail",27),P.nrm(3,"ion-icon",28),P.k0s(),P.j41(4,"ion-label")(5,"h2",29),P.EFF(6),P.nI1(7,"translate"),P.k0s(),P.j41(8,"p"),P.EFF(9),P.k0s()()()}if(2&e){const e=P.XpG(3);P.Y8G("detail",!0),P.BMQ("aria-label",P.bMT(1,4,"core.login.connect")),P.R7$(6),P.JRh(P.bMT(7,6,"core.login.yourenteredsite")),P.R7$(3),P.JRh(e.enteredSiteUrl.noProtocolUrl)}}function CoreLoginSitePage_form_17_ng_container_3_div_13_Template(e,n){1&e&&(P.j41(0,"div",30),P.nrm(1,"ion-spinner"),P.nI1(2,"translate"),P.k0s()),2&e&&(P.R7$(),P.BMQ("aria-label",P.bMT(2,1,"core.loading")))}function CoreLoginSitePage_form_17_ng_container_3_ng_container_14_ng_container_1_Template(e,n){1&e&&P.eu8(0)}function CoreLoginSitePage_form_17_ng_container_3_ng_container_14_Template(e,n){if(1&e&&(P.qex(0),P.DNE(1,CoreLoginSitePage_form_17_ng_container_3_ng_container_14_ng_container_1_Template,1,0,"ng-container",31),P.bVm()),2&e){const e=n.$implicit;P.XpG(3);const o=P.sdS(24);P.R7$(),P.Y8G("ngTemplateOutlet",o)("ngTemplateOutletContext",P.eq3(2,site_c1,e))}}function CoreLoginSitePage_form_17_ng_container_3_div_15_Template(e,n){1&e&&(P.j41(0,"div",32),P.nrm(1,"ion-spinner"),P.nI1(2,"translate"),P.k0s()),2&e&&(P.R7$(),P.BMQ("aria-label",P.bMT(2,1,"core.loading")))}function CoreLoginSitePage_form_17_ng_container_3_Template(e,n){if(1&e){const e=P.RV6();P.qex(0),P.j41(1,"ion-item",15)(2,"ion-input",17),P.nI1(3,"translate"),P.nI1(4,"translate"),P.bIt("ionInput",(function CoreLoginSitePage_form_17_ng_container_3_Template_ion_input_ionInput_2_listener(n){P.eBV(e);const o=P.XpG(2);return P.Njj(o.searchSite(n,o.siteForm.value.siteUrl))})),P.k0s()(),P.j41(5,"ion-list",18)(6,"ion-item",19)(7,"ion-label")(8,"h2",20),P.EFF(9),P.nI1(10,"translate"),P.k0s()()(),P.DNE(11,CoreLoginSitePage_form_17_ng_container_3_ion_item_11_Template,10,8,"ion-item",21),P.j41(12,"div",22),P.DNE(13,CoreLoginSitePage_form_17_ng_container_3_div_13_Template,3,3,"div",23)(14,CoreLoginSitePage_form_17_ng_container_3_ng_container_14_Template,2,4,"ng-container",24),P.k0s()(),P.DNE(15,CoreLoginSitePage_form_17_ng_container_3_div_15_Template,3,3,"div",25),P.bVm()}if(2&e){const e=P.XpG(2);P.R7$(2),P.FS9("placeholder",P.bMT(3,15,"core.login.siteaddressplaceholder")),P.Y8G("core-auto-focus",e.showKeyboard&&!e.showScanQR)("label",P.bMT(4,17,"core.login.siteaddress"))("clearInput",!0),P.R7$(3),P.AVh("hidden",!e.hasSites&&!e.enteredSiteUrl),P.R7$(4),P.JRh(P.bMT(10,19,"core.login.selectsite")),P.R7$(2),P.Y8G("ngIf",e.enteredSiteUrl),P.R7$(),P.AVh("hidden",!e.hasSites)("dimmed",e.loadingSites),P.R7$(),P.Y8G("ngIf",e.loadingSites),P.R7$(),P.Y8G("ngForOf",e.sites),P.R7$(),P.Y8G("ngIf",!e.hasSites&&e.loadingSites)}}function CoreLoginSitePage_form_17_ion_item_4_Template(e,n){if(1&e&&(P.j41(0,"ion-item")(1,"ion-label")(2,"ion-button",33),P.EFF(3),P.nI1(4,"translate"),P.k0s()()()),2&e){const e=P.XpG(2);P.R7$(2),P.Y8G("disabled",!e.siteForm.valid),P.R7$(),P.SpI(" ",P.bMT(4,2,"core.login.connect")," ")}}function CoreLoginSitePage_form_17_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"form",14,1),P.bIt("ngSubmit",(function CoreLoginSitePage_form_17_Template_form_ngSubmit_0_listener(n){P.eBV(e);const o=P.XpG();return P.Njj(o.connect(o.siteForm.value.siteUrl,n))})),P.DNE(2,CoreLoginSitePage_form_17_ng_container_2_Template,5,8,"ng-container",12)(3,CoreLoginSitePage_form_17_ng_container_3_Template,16,21,"ng-container",12)(4,CoreLoginSitePage_form_17_ion_item_4_Template,5,4,"ion-item",12),P.k0s()}if(2&e){const e=P.XpG();P.Y8G("formGroup",e.siteForm),P.R7$(2),P.Y8G("ngIf","url"===e.siteSelector),P.R7$(),P.Y8G("ngIf","url"!==e.siteSelector),P.R7$(),P.Y8G("ngIf","url"===e.siteSelector)}}function CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"ion-searchbar",35),P.nI1(1,"translate"),P.mxI("ngModelChange",(function CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ngModelChange_0_listener(n){P.eBV(e);const o=P.XpG(3);return P.DH7(o.filter,n)||(o.filter=n),P.Njj(n)})),P.bIt("ionInput",(function CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ionInput_0_listener(n){P.eBV(e);const o=P.XpG(3);return P.Njj(o.filterChanged(n))}))("ionCancel",(function CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ionCancel_0_listener(){P.eBV(e);const n=P.XpG(3);return P.Njj(n.filterChanged())})),P.k0s()}if(2&e){const e=P.XpG(3);P.R50("ngModel",e.filter),P.Y8G("placeholder",P.bMT(1,2,"core.login.findyoursite"))}}function CoreLoginSitePage_ng_container_18_ion_list_1_ng_container_7_ng_container_1_Template(e,n){1&e&&P.eu8(0)}function CoreLoginSitePage_ng_container_18_ion_list_1_ng_container_7_Template(e,n){if(1&e&&(P.qex(0),P.DNE(1,CoreLoginSitePage_ng_container_18_ion_list_1_ng_container_7_ng_container_1_Template,1,0,"ng-container",31),P.bVm()),2&e){const e=n.$implicit;P.XpG(3);const o=P.sdS(24);P.R7$(),P.Y8G("ngTemplateOutlet",o)("ngTemplateOutletContext",P.eq3(2,site_c1,e))}}function CoreLoginSitePage_ng_container_18_ion_list_1_Template(e,n){if(1&e&&(P.j41(0,"ion-list")(1,"ion-item")(2,"ion-label")(3,"h2",20),P.EFF(4),P.nI1(5,"translate"),P.k0s()()(),P.DNE(6,CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template,2,4,"ion-searchbar",34)(7,CoreLoginSitePage_ng_container_18_ion_list_1_ng_container_7_Template,2,4,"ng-container",24),P.k0s()),2&e){const e=P.XpG(2);P.R7$(4),P.JRh(P.bMT(5,3,"core.login.selectsite")),P.R7$(2),P.Y8G("ngIf",e.fixedSites.length>4),P.R7$(),P.Y8G("ngForOf",e.filteredSites)}}function CoreLoginSitePage_ng_container_18_Template(e,n){if(1&e&&(P.qex(0),P.DNE(1,CoreLoginSitePage_ng_container_18_ion_list_1_Template,8,5,"ion-list",12),P.bVm()),2&e){const e=P.XpG();P.R7$(),P.Y8G("ngIf","list"===e.siteSelector)}}function CoreLoginSitePage_ng_container_19_Template(e,n){if(1&e){const e=P.RV6();P.qex(0),P.j41(1,"div",36),P.EFF(2),P.nI1(3,"translate"),P.k0s(),P.j41(4,"ion-button",37),P.bIt("click",(function CoreLoginSitePage_ng_container_19_Template_ion_button_click_4_listener(){P.eBV(e);const n=P.XpG();return P.Njj(n.showInstructionsAndScanQR())})),P.nrm(5,"ion-icon",38),P.EFF(6),P.nI1(7,"translate"),P.k0s(),P.bVm()}2&e&&(P.R7$(2),P.SpI("",P.bMT(3,2,"core.login.or")," "),P.R7$(4),P.SpI(" ",P.bMT(7,4,"core.scanqr")," "))}function CoreLoginSitePage_ng_template_23_ion_thumbnail_1_img_1_Template(e,n){if(1&e&&P.nrm(0,"img",44),2&e){const e=P.XpG(2).site;P.Y8G("src",e.imageurl,P.B4B)}}function CoreLoginSitePage_ng_template_23_ion_thumbnail_1_img_2_Template(e,n){1&e&&P.nrm(0,"img",45)}function CoreLoginSitePage_ng_template_23_ion_thumbnail_1_Template(e,n){if(1&e&&(P.j41(0,"ion-thumbnail",2),P.DNE(1,CoreLoginSitePage_ng_template_23_ion_thumbnail_1_img_1_Template,1,1,"img",42)(2,CoreLoginSitePage_ng_template_23_ion_thumbnail_1_img_2_Template,1,0,"img",43),P.k0s()),2&e){const e=P.XpG().site;P.R7$(),P.Y8G("ngIf",e.imageurl),P.R7$(),P.Y8G("ngIf",!e.imageurl)}}function CoreLoginSitePage_ng_template_23_p_3_Template(e,n){if(1&e&&(P.j41(0,"p",46),P.EFF(1),P.k0s()),2&e){const e=P.XpG().site;P.R7$(),P.JRh(e.title)}}function CoreLoginSitePage_ng_template_23_p_4_Template(e,n){if(1&e&&(P.j41(0,"p"),P.EFF(1),P.k0s()),2&e){const e=P.XpG().site;P.R7$(),P.JRh(e.noProtocolUrl)}}function CoreLoginSitePage_ng_template_23_p_5_Template(e,n){if(1&e&&(P.j41(0,"p"),P.EFF(1),P.k0s()),2&e){const e=P.XpG().site;P.R7$(),P.JRh(e.location)}}function CoreLoginSitePage_ng_template_23_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"ion-item",39),P.bIt("click",(function CoreLoginSitePage_ng_template_23_Template_ion_item_click_0_listener(n){const o=P.eBV(e).site,t=P.XpG();return P.Njj(t.connect(o.url,n))})),P.DNE(1,CoreLoginSitePage_ng_template_23_ion_thumbnail_1_Template,3,2,"ion-thumbnail",40),P.j41(2,"ion-label"),P.DNE(3,CoreLoginSitePage_ng_template_23_p_3_Template,2,1,"p",41)(4,CoreLoginSitePage_ng_template_23_p_4_Template,2,1,"p",12)(5,CoreLoginSitePage_ng_template_23_p_5_Template,2,1,"p",12),P.k0s()()}if(2&e){const e=n.site,o=P.XpG();P.Y8G("ngClass",e.className)("detail",!0),P.BMQ("aria-label",e.name),P.R7$(),P.Y8G("ngIf",o.siteFinderSettings.displayimage),P.R7$(2),P.Y8G("ngIf",e.title),P.R7$(),P.Y8G("ngIf",o.displaySiteUrl(e.url)),P.R7$(),P.Y8G("ngIf",e.location)}}let he=(()=>{var e;class CoreLoginSitePage{constructor(e){this.formBuilder=e,this.siteSelector="sitefinder",this.showKeyboard=!1,this.filter="",this.sites=[],this.hasSites=!1,this.loadingSites=!1}ngOnInit(){var e=this;return(0,r.A)((function*(){e.login({siteUrl:"https://lms.mil.se",code:1,service:"moodle_mobile_app",config:{wwwroot:"https://lms.mil.se",httpswwwroot:"https://lms.mil.se",sitename:"Försvarsmaktens LMS Extern",guestlogin:0,rememberusername:2,authloginviaemail:1,registerauth:"",forgottenpasswordurl:"",authinstructions:'<p class="MsoNormal">Detta system tillhör Försvarsmakten. För att få tillgång till detta system krävs tillstånd från Försvarsmakten.</p><p class="MsoNormal">Den som olovligen bereder sig tillträde till detta system kan komma att straffas för dataintrång enligt 4 kap 9 c § brottsbalken.</p><p class="MsoNormal">Ditt agerande i systemet kan komma att loggas.</p><p> </p>',authnoneenabled:0,enablewebservices:1,enablemobilewebservice:1,maintenanceenabled:0,maintenancemessage:'<p dir="ltr" style="text-align:left;">Sidan håller på att uppdateras och beräknas vara tillgänglig fredag den 23:e februari. </p>',logourl:"https://lms.mil.se/pluginfile.php/1/theme_boost_union/logo/0x200/1732108927/FM_v%C3%A4nster_svv.png",compactlogourl:"https://lms.mil.se/pluginfile.php/1/theme_boost_union/logocompact/300x300/1732108927/FM_v%C3%A4nster_svv.png",typeoflogin:1,launchurl:"https://lms.mil.se/admin/tool/mobile/launch.php",mobilecssurl:"",tool_mobile_disabledfeatures:"NoDelegate_ForgottenPassword",country:"SE",agedigitalconsentverification:!1,supportpage:"",supportavailability:1,autolang:1,lang:"sv_wp",langmenu:1,langlist:"en|English,sv_wp|Svenska",locale:"",tool_mobile_minimumversion:"",tool_mobile_iosappid:"633359593",tool_mobile_androidappid:"com.moodle.moodlemobile",tool_mobile_setuplink:"https://download.moodle.org/mobile",tool_mobile_qrcodetype:0,warnings:[]}});let n="";e.siteSelector=ne.CoreConstants.CONFIG.multisitesdisplay;e.siteFinderSettings={displaysitename:!0,displayimage:!0,displayalias:!0,displaycity:!0,displaycountry:!0,displayurl:!0,...ne.CoreConstants.CONFIG.sitefindersettings||{}};if((yield c.CoreLoginHelper.getAvailableSites()).length)n=yield e.initSiteSelector();else{var o;n=null!==(o=yield e.consumeInstallReferrerUrl())&&void 0!==o?o:"";const t=ne.CoreConstants.CONFIG.enableonboarding&&!f.CorePlatform.isIOS();n?(e.connect(n),t&&K.CoreConfig.set(U.n5,1)):t&&e.initOnboarding()}e.showScanQR=c.CoreLoginHelper.displayQRInSiteScreen(),e.siteForm=e.formBuilder.group({siteUrl:[n,e.moodleUrlValidator()]}),e.searchFunction=Z.j.debounce(function(){var n=(0,r.A)((function*(n){if((n=n.trim()).length>=3){const o=yield a.CoreSites.findSites(n);e.sites=e.extendCoreLoginSiteInfo(o),e.hasSites=!!e.sites.length}else e.hasSites=!1;e.loadingSites=!1}));return function(e){return n.apply(this,arguments)}}(),1e3),e.showKeyboard=!!p.CoreNavigator.getRouteBooleanParam("showKeyboard")}))()}initSiteSelector(){var e=this;return(0,r.A)((function*(){const n=yield c.CoreLoginHelper.getAvailableSites();return e.fixedSites=e.extendCoreLoginSiteInfo(n),e.siteSelector="list",e.fixedSites.some((e=>!!e.imageurl))||(e.siteFinderSettings.displayimage=!1),e.filteredSites=e.fixedSites,e.fixedSites[0].url}))()}consumeInstallReferrerUrl(){return(0,r.A)((function*(){const e=yield s.g.ignoreErrors(s.g.timeoutPromise(_e.consumeInstallReferrerUrl(),1e3));if(!e)return;return(yield s.g.ignoreErrors(a.CoreSites.getSites(),[])).length>0?void 0:e}))()}initOnboarding(){var e=this;return(0,r.A)((function*(){(yield K.CoreConfig.get(U.n5,!1))||e.showOnboarding()}))()}extendCoreLoginSiteInfo(e){return e.map((e=>{e.noProtocolUrl=this.siteFinderSettings.displayurl&&e.url?oe.F.removeUrlParts(e.url,"protocol"):"";const n=this.siteFinderSettings.displaysitename?e.name:"",o=this.siteFinderSettings.displayalias&&e.alias?e.alias:"";e.title=n&&o?n+" ("+o+")":n+o;const t=this.siteFinderSettings.displaycountry&&e.countrycode?F.A.getCountryName(e.countrycode):"",i=this.siteFinderSettings.displaycity&&e.city?e.city:"";return e.location=i&&t?i+" - "+t:i+t,a.CoreSites.hasDefaultImage(e)&&this.siteFinderSettings.defaultimageurl&&(e.imageurl=this.siteFinderSettings.defaultimageurl),e}))}moodleUrlValidator(){return e=>{const n=e.value.trim();let o=n.length>=3&&oe.F.isValidMoodleUrl(n);if(!o){!!a.CoreSites.getDemoSiteData(n)&&(o=!0)}return o?null:{siteUrl:{value:e.value}}}}showHelp(){return(0,r.A)((function*(){const{CoreLoginSiteHelpComponent:e}=yield o.e(1470).then(o.bind(o,71470));yield de.I.openModal({component:e,cssClass:"core-modal-fullscreen"})}))()}showOnboarding(){return(0,r.A)((function*(){const{CoreLoginSiteOnboardingComponent:e}=yield o.e(9818).then(o.bind(o,9818));yield de.I.openModal({component:e,cssClass:"core-modal-fullscreen"})}))()}connect(e,n){var o=this;return(0,r.A)((function*(){if(null==n||n.preventDefault(),null==n||n.stopPropagation(),me.p.close(),!e)return d.CoreDomUtils.showErrorModal("core.login.siteurlrequired",!0),void 0;if(!W.WE.isOnline())return d.CoreDomUtils.showErrorModal("core.networkerrormsg",!0),void 0;if((e=e.trim()).match(/^(https?:\/\/)?campus\.example\.edu/))return o.showLoginIssue(e,new ee.CoreError(l.HT.instant("core.login.errorexampleurl"))),void 0;const t=a.CoreSites.getDemoSiteData(e);if(t)yield o.loginDemoSite(t);else{const n=yield b.CoreLoadings.show();let t;try{t=yield a.CoreSites.checkSite(e,void 0,"Site URL page")}catch(i){const r=oe.F.guessMoodleDomain(e);if(!r||r==e)return n.dismiss(),o.showLoginIssue(e,i);try{t=yield a.CoreSites.checkSite(r,void 0,"Site URL page")}catch(t){return n.dismiss(),o.showLoginIssue(e,i||t)}}console.log("Check done:"),console.log(t),yield o.login(t),n.dismiss()}}))()}loginDemoSite(e){var n=this;return(0,r.A)((function*(){const o=yield b.CoreLoadings.show();try{const o=yield a.CoreSites.getUserToken(e.url,e.username,e.password);return yield a.CoreSites.newSite(o.siteUrl,o.token,o.privateToken),u.R.triggerFormSubmittedEvent(n.formElement,!0),yield p.CoreNavigator.navigateToSiteHome(),void 0}catch(n){console.log("site.ts"),c.CoreLoginHelper.treatUserTokenError(e.url,n,e.username,e.password),n.loggedout&&p.CoreNavigator.navigate("/login/sites",{reset:!0})}finally{o.dismiss()}}))()}login(e){var n=this;return(0,r.A)((function*(){try{yield a.CoreSites.checkApplication(e.config),u.R.triggerFormSubmittedEvent(n.formElement,!0),p.CoreNavigator.navigate("/login/credentials",{params:{siteCheck:e}})}catch{}}))()}showLoginIssue(e,n){var o=this;return(0,r.A)((function*(){var t,i;let r,a,s,g,_=d.CoreDomUtils.getErrorMessage(n);if(n instanceof re.CoreSiteError&&(g=n.supportConfig,s=g instanceof h.Q?g.getSite():void 0,r=n.debug,c.CoreLoginHelper.isAppUnsupportedError(n)))return yield c.CoreLoginHelper.showAppUnsupportedModal(e,s,r),void 0;n instanceof le.CoreLoginError&&(a=n.title),r&&(_=`<p>${_}</p><div class="core-error-accordion-container"></div>`);const m=g,p=[{text:l.HT.instant("core.tryagain"),role:"cancel"},null!=m&&m.canContactSupport()?{text:l.HT.instant("core.contactsupport"),handler:()=>{var e,n;return ae.I.contact({supportConfig:m,subject:l.HT.instant("core.cannotconnect"),message:`Error: ${null===(e=r)||void 0===e?void 0:e.code}\n\n${null===(n=r)||void 0===n?void 0:n.details}`})}}:s?null:{text:l.HT.instant("core.needhelp"),cssClass:"core-login-need-help",handler:()=>o.showHelp()}].filter((e=>!!e)),u=yield d.CoreDomUtils.showAlertWithOptions({header:null!==(t=a)&&void 0!==t?t:l.HT.instant("core.cannotconnect"),message:null!==(i=_)&&void 0!==i?i:l.HT.instant("core.sitenotfoundhelp"),buttons:p});if(r){const e=u.querySelector(".core-error-accordion-container");e&&(yield se.S.render(e,r.details,r.code))}}))()}filterChanged(e){var n;const o=null==e||null===(n=e.target.value)||void 0===n?void 0:n.trim().toLowerCase();this.filteredSites=o&&this.fixedSites?this.fixedSites.filter((e=>e.title.toLowerCase().indexOf(o)>-1||e.noProtocolUrl.toLowerCase().indexOf(o)>-1||e.location.toLowerCase().indexOf(o)>-1)):this.fixedSites}searchSite(e,n){this.loadingSites=!0,n=n.trim(),this.enteredSiteUrl=this.siteForm.valid&&n.length>=3?{url:n,name:"connect",title:"",location:"",noProtocolUrl:oe.F.removeUrlParts(n,"protocol")}:void 0,this.searchFunction(n.trim())}showInstructionsAndScanQR(){var e=this;return(0,r.A)((function*(){try{yield c.CoreLoginHelper.showScanQRInstructions(),yield e.scanQR()}catch{}}))()}scanQR(){var e=this;return(0,r.A)((function*(){const n=yield pe.CoreQRScan.scanQR();if(!n)return;if(te.CoreCustomURLSchemes.isCustomURL(n)){try{yield te.CoreCustomURLSchemes.handleCustomURL(n)}catch(o){o&&o.data&&o.data.isAuthenticationURL&&o.data.siteUrl?e.treatErrorInAuthenticationCustomURL(n,o):te.CoreCustomURLSchemes.treatHandleCustomURLError(o)}return}const o=oe.F.getUrlProtocol(n);if(o&&"http"!=o&&"https"!=o)return d.CoreDomUtils.showErrorModal(l.HT.instant("core.errorurlschemeinvalidscheme",{$a:n})),void 0;(yield c.CoreLoginHelper.isSiteUrlAllowed(n))?(e.siteForm.controls.siteUrl.setValue(n),e.connect(n)):d.CoreDomUtils.showErrorModal("core.errorurlschemeinvalidsite",!0)}))()}treatErrorInAuthenticationCustomURL(e,n){var o=this;return(0,r.A)((function*(){var e;const t=(null===(e=n.data)||void 0===e?void 0:e.siteUrl)||"",i=yield b.CoreLoadings.show();o.siteForm.controls.siteUrl.setValue(t);try{const e=yield a.CoreSites.checkSite(t,void 0,"Site URL page");yield a.CoreSites.checkApplication(e.config),c.CoreLoginHelper.isSSOLoginNeeded(e.code)||(yield p.CoreNavigator.navigate("/login/credentials",{params:{siteCheck:e}}))}catch{}finally{i.dismiss()}n.error=ie.CoreErrorHelper.addTextToError(n.error,"<br><br>"+l.HT.instant("core.login.youcanstillconnectwithcredentials")),te.CoreCustomURLSchemes.treatHandleCustomURLError(n)}))()}openSettings(){p.CoreNavigator.navigate("/settings")}displaySiteUrl(e){return C.a.makeUnauthenticatedSite(e).shouldDisplayInformativeLinks()}}return(e=CoreLoginSitePage).ɵfac=function CoreLoginSitePage_Factory(n){return new(n||e)(P.rXU(m.ok))},e.ɵcmp=P.VBU({type:e,selectors:[["page-core-login-site"]],viewQuery:function CoreLoginSitePage_Query(e,n){if(1&e&&P.GBs(fe,5),2&e){let e;P.mGM(e=P.lsd())&&(n.formElement=e.first)}},decls:25,vars:17,consts:[["sitelisting",""],["siteFormEl",""],["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","fas-gear","aria-hidden","true"],[1,"ion-padding"],[1,"list-item-limited-width"],[1,"ion-text-center","ion-padding","ion-margin-bottom","core-login-site-logo"],["src","assets/img/login_logo.png","role","presentation","alt","",1,"avatar-full","login-logo"],[3,"formGroup","ngSubmit",4,"ngIf"],[4,"ngIf"],["aria-haspopup","dialog","expand","block","fill","clear",1,"ion-margin-top","core-login-need-help","core-button-as-link","ion-text-wrap",3,"click"],[3,"ngSubmit","formGroup"],["lines","inset"],["name","url","type","url","formControlName","siteUrl","labelPlacement","stacked",3,"placeholder","core-auto-focus","label","clearInput"],["name","url","formControlName","siteUrl","labelPlacement","stacked",3,"ionInput","placeholder","core-auto-focus","label","clearInput"],[1,"core-login-site-list"],[1,"core-login-site-list-title"],[1,"item-heading"],["button","","class","core-login-entered-site",3,"detail","click",4,"ngIf"],[1,"core-login-site-list-found"],["class","core-login-site-list-loading",4,"ngIf"],[4,"ngFor","ngForOf"],["class","core-login-site-nolist-loading",4,"ngIf"],["button","",1,"core-login-entered-site",3,"click","detail"],["slot","start","aria-hidden","true"],["name","fas-pen","aria-hidden","true"],[1,"ion-text-wrap"],[1,"core-login-site-list-loading"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"core-login-site-nolist-loading"],["expand","block","type","submit",1,"ion-text-wrap",3,"disabled"],[3,"ngModel","placeholder","ngModelChange","ionInput","ionCancel",4,"ngIf"],[3,"ngModelChange","ionInput","ionCancel","ngModel","placeholder"],[1,"ion-text-center","ion-padding","ion-margin-top","core-login-site-qrcode-separator"],["expand","block","fill","outline","aria-haspopup","dialog",1,"ion-margin","core-login-site-qrcode",3,"click"],["slot","start","name","fas-qrcode","aria-hidden","true"],["button","",3,"click","ngClass","detail"],["slot","start",4,"ngIf"],["class","item-heading ion-text-wrap",4,"ngIf"],["core-external-content","","onError","this.src='assets/icon/icon.png'","alt","","role","presentation",3,"src",4,"ngIf"],["src","assets/icon/icon.png","class","core-login-default-icon","alt","","role","presentation",4,"ngIf"],["core-external-content","","onError","this.src='assets/icon/icon.png'","alt","","role","presentation",3,"src"],["src","assets/icon/icon.png","alt","","role","presentation",1,"core-login-default-icon"],[1,"item-heading","ion-text-wrap"]],template:function CoreLoginSitePage_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),P.nrm(3,"ion-back-button",3),P.nI1(4,"translate"),P.k0s(),P.j41(5,"ion-title")(6,"h1"),P.EFF(7),P.nI1(8,"translate"),P.k0s()(),P.j41(9,"ion-buttons",4)(10,"ion-button",5),P.nI1(11,"translate"),P.bIt("click",(function CoreLoginSitePage_Template_ion_button_click_10_listener(){return P.eBV(e),P.Njj(n.openSettings())})),P.nrm(12,"ion-icon",6),P.k0s()()()(),P.j41(13,"ion-content",7)(14,"div",8)(15,"div",9),P.nrm(16,"img",10),P.k0s(),P.DNE(17,CoreLoginSitePage_form_17_Template,5,4,"form",11)(18,CoreLoginSitePage_ng_container_18_Template,2,1,"ng-container",12)(19,CoreLoginSitePage_ng_container_19_Template,8,6,"ng-container",12),P.j41(20,"ion-button",13),P.bIt("click",(function CoreLoginSitePage_Template_ion_button_click_20_listener(){return P.eBV(e),P.Njj(n.showHelp())})),P.EFF(21),P.nI1(22,"translate"),P.k0s()()(),P.DNE(23,CoreLoginSitePage_ng_template_23_Template,6,7,"ng-template",null,0,P.C5r)}2&e&&(P.R7$(3),P.Y8G("text",P.bMT(4,9,"core.back")),P.R7$(4),P.JRh(P.bMT(8,11,"core.login.connecttomoodle")),P.R7$(3),P.Y8G("ariaLabel",P.bMT(11,13,"core.settings.appsettings")),P.R7$(5),P.AVh("hidden",n.hasSites||n.enteredSiteUrl),P.R7$(2),P.Y8G("ngIf",!n.fixedSites&&n.siteForm),P.R7$(),P.Y8G("ngIf",n.fixedSites),P.R7$(),P.Y8G("ngIf",n.showScanQR&&!n.hasSites&&!n.enteredSiteUrl),P.R7$(2),P.SpI(" ",P.bMT(22,15,"core.needhelp")," "))},dependencies:[S.YU,S.Sq,S.bT,S.T3,M.i,ue.l,V.t,v.i,R.T,m.qT,m.BC,m.cb,m.vS,k.Jm,k.QW,k.W9,k.eU,k.iq,k.$w,k.uz,k.he,k.nf,k.S1,k.w2,k.Zx,k.BC,k.ai,k.Gw,k.el,m.j4,m.JD,O.D9],styles:["[_nghost-%COMP%]{--list-item-max-width: 600px}.core-login-site-connect[_ngcontent-%COMP%]{margin-top:1.4rem}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{min-width:50px;min-height:50px;width:50px;height:50px;border-radius:20%;box-shadow:0 0 4px var(--gray-200);text-align:center;overflow:hidden}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:50px;max-width:fit-content;width:auto;height:auto;margin:0 auto 0 50%;transform:translate3d(-50%,0,0);object-fit:cover;object-position:50% 50%}[dir=rtl][_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transform:translate3d(50%,0,0)}[dir=rtl][_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transform:translate3d(50%,0,0)}@supports selector(:dir(rtl)){.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:dir(rtl){transform:translate3d(50%,0,0)}}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin:0 auto;font-size:2.1875rem;height:50px}[dir=rtl][_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-left:0;margin-right:50%}.core-login-site-logo[_ngcontent-%COMP%], .core-login-site-list[_ngcontent-%COMP%], .core-login-site-list-found[_ngcontent-%COMP%]{transition-delay:0s;visibility:visible;opacity:1;transition:all .7s ease-in-out;max-height:9999px}.core-login-site-logo.hidden[_ngcontent-%COMP%], .core-login-site-list.hidden[_ngcontent-%COMP%], .core-login-site-list-found.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden;margin-top:0;margin-bottom:0;padding:0;max-height:0}.core-login-site-list-found.dimmed[_ngcontent-%COMP%]{pointer-events:none;position:relative}.core-login-site-list-loading[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;display:flex;align-content:center;align-items:center;background-color:#ffffff80;z-index:1}.core-login-site-list-loading[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin:0 auto}.core-login-site-nolist-loading[_ngcontent-%COMP%]{margin-top:16px;text-align:center}.item.core-login-site-list-title[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], .item.core-login-site-list-title[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2.item-heading[_ngcontent-%COMP%]{margin-top:0}@media (min-width: 768px){ion-content[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{margin-top:20%}ion-content[_ngcontent-%COMP%]   .core-login-site-logo.hidden[_ngcontent-%COMP%]{margin-top:0}}.core-login-entered-site[_ngcontent-%COMP%]{background-color:var(--light)}.core-login-entered-site[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{box-shadow:0 0 4px var(--gray-300)}.core-login-default-icon[_ngcontent-%COMP%]{filter:grayscale(100%)}",'[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--background: var(--core-login-background);--ion-item-background: var(--core-login-background);--color: var(--core-login-text-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--color: var(--core-login-text-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .core-oauth-icon[_ngcontent-%COMP%]{color:var(--color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]{--color: var(--core-login-text-color);text-decoration-color:var(--color)}[_nghost-%COMP%]   .core-login-reconnect-warning[_ngcontent-%COMP%]{margin:0 0 32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]{margin-bottom:32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{width:90%;max-width:300px;margin:0 auto}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:104px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-sitename[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:8px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-siteurl[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%] + .core-login-user[_ngcontent-%COMP%]{margin-top:24px}[_nghost-%COMP%]   core-user-avatar.large-avatar[_ngcontent-%COMP%]{--core-avatar-size: var(--core-large-avatar-size)}[_nghost-%COMP%]   .core-login-fullname[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--background: var(--core-login-input-background);--color: var(--core-login-input-color)}[_nghost-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-left:0;margin-right:0}[_nghost-%COMP%]   .core-login-forgotten-password[_ngcontent-%COMP%]{text-decoration:underline}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]{position:relative;padding:8px 0}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:var(--core-login-background);padding:0 8px}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]:before{height:1px;position:absolute;top:50%;left:0;right:0;border-bottom:1px solid var(--gray-300);content:"";z-index:-1}[_nghost-%COMP%]   .core-login-login-button[_ngcontent-%COMP%]{margin-top:32px}[_nghost-%COMP%]   .core-login-login-inbrowser-button[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   p.core-login-inbrowser[_ngcontent-%COMP%]{font:var(--mdl-typography-body-font-sm);margin-top:8px;margin-bottom:8px}[_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]{margin-top:8px;border-top:1px solid var(--gray-300)}[_nghost-%COMP%]   .core-login-identity-providers[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px;font:var(--mdl-typography-heading6-font)}:root.dark[_nghost-%COMP%]   core-loading[_ngcontent-%COMP%], :root.dark   [_nghost-%COMP%]   core-loading[_ngcontent-%COMP%]{--loading-background: var(--core-login-background-dark);--loading-text-color: #ffffff;--loading-spinner: #ffffff}']}),CoreLoginSitePage})();var Ce=o(7310),be=o(89818),Pe=o(69418),Se=o(19858);const sites_c0=e=>({count:e});function CoreLoginSitesPage_ion_button_10_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"ion-button",14),P.nI1(1,"translate"),P.bIt("click",(function CoreLoginSitesPage_ion_button_10_Template_ion_button_click_0_listener(){P.eBV(e);const n=P.XpG();return P.Njj(n.toggleDelete())})),P.nrm(2,"ion-icon",15),P.k0s()}2&e&&P.Y8G("ariaLabel",P.bMT(1,1,"core.login.toggleremove"))}function CoreLoginSitesPage_ng_template_17_ion_badge_0_Template(e,n){if(1&e&&(P.j41(0,"ion-badge",3)(1,"span",18),P.EFF(2),P.k0s(),P.j41(3,"span",13),P.EFF(4),P.nI1(5,"translate"),P.k0s()()),2&e){const e=P.XpG().site;P.Y8G("@coreShowHideAnimation",void 0),P.R7$(2),P.JRh(e.badge),P.R7$(2),P.JRh(P.i5U(5,3,"core.login.sitebadgedescription",P.eq3(6,sites_c0,e.badge)))}}function CoreLoginSitesPage_ng_template_17_ion_button_1_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"ion-button",19),P.nI1(1,"translate"),P.bIt("click",(function CoreLoginSitesPage_ng_template_17_ion_button_1_Template_ion_button_click_0_listener(n){P.eBV(e);const o=P.XpG().site,t=P.XpG();return P.Njj(t.deleteSite(n,o))})),P.nrm(2,"ion-icon",20),P.k0s()}2&e&&P.Y8G("ariaLabel",P.bMT(1,2,"core.login.removeaccount"))("@coreSlideInOut","fromRight")}function CoreLoginSitesPage_ng_template_17_Template(e,n){if(1&e&&P.DNE(0,CoreLoginSitesPage_ng_template_17_ion_badge_0_Template,6,8,"ion-badge",16)(1,CoreLoginSitesPage_ng_template_17_ion_button_1_Template,3,4,"ion-button",17),2&e){const e=n.site,o=P.XpG();P.Y8G("ngIf",!o.showDelete&&e.badge),P.R7$(),P.Y8G("ngIf",o.showDelete)}}let Me=(()=>{var e;class CoreLoginSitesPage{constructor(){this.accountsList={sameSite:[],otherSites:[],count:0},this.showDelete=!1,this.loaded=!1}ngOnInit(){var e=this;return(0,r.A)((function*(){p.CoreNavigator.getRouteBooleanParam("openAddSite")&&e.add(),e.accountsList=yield c.CoreLoginHelper.getAccountsList(),e.loaded=!0,0!=e.accountsList.count||p.CoreNavigator.getRouteBooleanParam("openAddSite")||e.add()}))()}add(){c.CoreLoginHelper.goToAddSite(!1,!0)}deleteSite(e,n){var o=this;return(0,r.A)((function*(){e.stopPropagation();let t=n.siteName||"";t=yield Ce.CoreFilter.formatText(t,{clean:!0,singleLine:!0,filter:!1},[],n.id);try{yield d.CoreDomUtils.showDeleteConfirm("core.login.confirmdeletesite",{sitename:t})}catch(e){return}try{yield c.CoreLoginHelper.deleteAccountFromList(o.accountsList,n),o.showDelete=!1,0==o.accountsList.count&&c.CoreLoginHelper.goToAddSite(!0,!0)}catch(e){d.CoreDomUtils.showErrorModalDefault(e,"core.login.errordeletesite",!0)}}))()}login(e){return(0,r.A)((function*(){const n=yield b.CoreLoadings.show();try{if(yield a.CoreSites.loadSite(e.id))return yield p.CoreNavigator.navigateToSiteHome(),void 0}catch(e){d.CoreDomUtils.showErrorModalDefault(e,"Error loading site.")}finally{n.dismiss()}}))()}toggleDelete(){this.showDelete=!this.showDelete}openSettings(){p.CoreNavigator.navigate("/settings")}}return(e=CoreLoginSitesPage).ɵfac=function CoreLoginSitesPage_Factory(n){return new(n||e)},e.ɵcmp=P.VBU({type:e,selectors:[["page-core-login-sites"]],decls:26,vars:19,consts:[["siteItem",""],["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"ariaLabel","click",4,"ngIf"],[3,"click","ariaLabel"],["slot","icon-only","name","fas-gear","aria-hidden","true"],[1,"limited-width"],[3,"hideUntil"],[3,"onSiteClicked","accountsList","sitesClickable"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","fas-pen","aria-hidden","true"],["slot","end",4,"ngIf"],["slot","end","fill","clear","color","danger",3,"ariaLabel","click",4,"ngIf"],["aria-hidden","true"],["slot","end","fill","clear","color","danger",3,"click","ariaLabel"],["name","fas-trash","slot","icon-only","aria-hidden","true"]],template:function CoreLoginSitesPage_Template(e,n){if(1&e){const e=P.RV6();P.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),P.nrm(3,"ion-back-button",2),P.nI1(4,"translate"),P.k0s(),P.j41(5,"ion-title")(6,"h1"),P.EFF(7),P.nI1(8,"translate"),P.k0s()(),P.j41(9,"ion-buttons",3),P.DNE(10,CoreLoginSitesPage_ion_button_10_Template,3,3,"ion-button",4),P.j41(11,"ion-button",5),P.nI1(12,"translate"),P.bIt("click",(function CoreLoginSitesPage_Template_ion_button_click_11_listener(){return P.eBV(e),P.Njj(n.openSettings())})),P.nrm(13,"ion-icon",6),P.k0s()()()(),P.j41(14,"ion-content",7)(15,"core-loading",8)(16,"core-sites-list",9),P.bIt("onSiteClicked",(function CoreLoginSitesPage_Template_core_sites_list_onSiteClicked_16_listener(o){return P.eBV(e),P.Njj(n.login(o))})),P.DNE(17,CoreLoginSitesPage_ng_template_17_Template,2,2,"ng-template",null,0,P.C5r),P.k0s()(),P.j41(19,"ion-fab",10)(20,"ion-fab-button",11),P.nI1(21,"translate"),P.bIt("click",(function CoreLoginSitesPage_Template_ion_fab_button_click_20_listener(){return P.eBV(e),P.Njj(n.add())})),P.nrm(22,"ion-icon",12),P.j41(23,"span",13),P.EFF(24),P.nI1(25,"translate"),P.k0s()()()()}2&e&&(P.R7$(3),P.Y8G("text",P.bMT(4,9,"core.back")),P.R7$(4),P.JRh(P.bMT(8,11,"core.login.accounts")),P.R7$(3),P.Y8G("ngIf",n.accountsList.count>0),P.R7$(),P.Y8G("ariaLabel",P.bMT(12,13,"core.settings.appsettings")),P.R7$(4),P.Y8G("hideUntil",n.loaded),P.R7$(),P.Y8G("accountsList",n.accountsList)("sitesClickable",!0),P.R7$(4),P.BMQ("aria-label",P.bMT(21,15,"core.login.add")),P.R7$(4),P.JRh(P.bMT(25,17,"core.login.add")))},dependencies:[S.bT,A.R,Pe.L,Se.A,V.t,v.i,R.T,k.In,k.Jm,k.QW,k.W9,k.Q8,k.YW,k.eU,k.iq,k.BC,k.ai,k.el,O.D9],encapsulation:2,data:{animation:[be.d.SLIDE_IN_OUT,be.d.SHOW_HIDE]}}),CoreLoginSitesPage})();var ve=o(49882);function CoreLoginChangePasswordPage_h1_6_Template(e,n){1&e&&(P.j41(0,"h1"),P.EFF(1),P.nI1(2,"translate"),P.k0s()),2&e&&(P.R7$(),P.JRh(P.bMT(2,1,"core.login.changepassword")))}function CoreLoginChangePasswordPage_h1_7_Template(e,n){1&e&&(P.j41(0,"h1"),P.EFF(1),P.nI1(2,"translate"),P.k0s()),2&e&&(P.R7$(),P.JRh(P.bMT(2,1,"core.login.reconnecttosite")))}function CoreLoginChangePasswordPage_ng_container_14_Template(e,n){if(1&e){const e=P.RV6();P.qex(0),P.j41(1,"ion-item",7)(2,"ion-label")(3,"h2"),P.EFF(4),P.nI1(5,"translate"),P.k0s()()(),P.j41(6,"ion-button",9),P.bIt("click",(function CoreLoginChangePasswordPage_ng_container_14_Template_ion_button_click_6_listener(){P.eBV(e);const n=P.XpG();return P.Njj(n.openChangePasswordPage())})),P.EFF(7),P.nI1(8,"translate"),P.k0s(),P.bVm()}2&e&&(P.R7$(4),P.JRh(P.bMT(5,2,"core.login.forcepasswordchangenotice")),P.R7$(3),P.SpI(" ",P.bMT(8,4,"core.login.changepasswordbutton")," "))}function CoreLoginChangePasswordPage_ng_container_15_Template(e,n){if(1&e){const e=P.RV6();P.qex(0),P.j41(1,"ion-item",7)(2,"ion-label")(3,"p"),P.EFF(4),P.nI1(5,"translate"),P.k0s()()(),P.j41(6,"ion-button",9),P.bIt("click",(function CoreLoginChangePasswordPage_ng_container_15_Template_ion_button_click_6_listener(){P.eBV(e);const n=P.XpG();return P.Njj(n.login())})),P.EFF(7),P.nI1(8,"translate"),P.k0s(),P.bVm()}2&e&&(P.R7$(4),P.JRh(P.bMT(5,2,"core.login.changepasswordreconnectinstructions")),P.R7$(3),P.SpI(" ",P.bMT(8,4,"core.login.reconnect")," "))}let Re=(()=>{var e;class CoreLoginChangePasswordPage{constructor(){this.changingPassword=!1,this.logoutLabel=c.CoreLoginHelper.getLogoutLabel()}showHelp(){ae.I.showHelp(l.HT.instant("core.login.changepasswordhelp"),l.HT.instant("core.login.changepasswordsupportsubject"))}openChangePasswordPage(){c.CoreLoginHelper.openInAppForEdit(a.CoreSites.getCurrentSiteId(),"/login/change_password.php",void 0,!0),this.changingPassword=!0,this.detectPasswordChanged()}login(){p.CoreNavigator.navigateToSiteHome(),this.changingPassword=!1}logout(){a.CoreSites.logout(),this.changingPassword=!1}detectPasswordChanged(){this.urlLoadedObserver||(this.urlLoadedObserver=ve.z.on(ve.z.IAB_LOAD_STOP,(e=>{var n;if(e.url.match(/\/login\/change_password\.php.*return=1/))return D.j.closeInAppBrowser(),this.login(),void 0;e.url.match(/\/login\/change_password\.php/)&&(null===(n=D.j.getInAppBrowserInstance())||void 0===n||n.executeScript({code:"\n                    if (\n                        document.querySelector('input[type=\"password\"]') === null &&\n                        document.querySelector('button[type=\"submit\"]') !== null\n                    ) {\n                        webkit.messageHandlers.cordova_iab.postMessage(JSON.stringify({ passwordChanged: true }));\n                    }\n                "}))})),this.messageObserver=ve.z.on(ve.z.IAB_MESSAGE,(e=>{e.passwordChanged&&(D.j.closeInAppBrowser(),this.login())})),this.browserClosedObserver=ve.z.on(ve.z.IAB_EXIT,(()=>{var e,n,o;null===(e=this.urlLoadedObserver)||void 0===e||e.off(),null===(n=this.messageObserver)||void 0===n||n.off(),null===(o=this.browserClosedObserver)||void 0===o||o.off(),delete this.urlLoadedObserver,delete this.messageObserver,delete this.browserClosedObserver})))}ngOnDestroy(){var e,n,o;null===(e=this.urlLoadedObserver)||void 0===e||e.off(),null===(n=this.messageObserver)||void 0===n||n.off(),null===(o=this.browserClosedObserver)||void 0===o||o.off()}}return(e=CoreLoginChangePasswordPage).ɵfac=function CoreLoginChangePasswordPage_Factory(n){return new(n||e)},e.ɵcmp=P.VBU({type:e,selectors:[["page-core-login-change-password"]],decls:24,vars:16,consts:[["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","far-circle-question","aria-hidden","true"],[1,"list-item-limited-width"],[1,"ion-text-wrap"],["expand","block","fill","outline",1,"ion-text-wrap","ion-margin",3,"click"],["expand","block",1,"ion-text-wrap","ion-margin",3,"click"]],template:function CoreLoginChangePasswordPage_Template(e,n){1&e&&(P.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),P.nrm(3,"ion-back-button",1),P.nI1(4,"translate"),P.k0s(),P.j41(5,"ion-title"),P.DNE(6,CoreLoginChangePasswordPage_h1_6_Template,3,3,"h1",2)(7,CoreLoginChangePasswordPage_h1_7_Template,3,3,"h1",2),P.k0s(),P.j41(8,"ion-buttons",3)(9,"ion-button",4),P.nI1(10,"translate"),P.bIt("click",(function CoreLoginChangePasswordPage_Template_ion_button_click_9_listener(){return n.showHelp()})),P.nrm(11,"ion-icon",5),P.k0s()()()(),P.j41(12,"ion-content")(13,"ion-list",6),P.DNE(14,CoreLoginChangePasswordPage_ng_container_14_Template,9,6,"ng-container",2)(15,CoreLoginChangePasswordPage_ng_container_15_Template,9,6,"ng-container",2),P.j41(16,"ion-item",7)(17,"ion-label")(18,"p"),P.EFF(19),P.nI1(20,"translate"),P.k0s()()(),P.j41(21,"ion-button",8),P.bIt("click",(function CoreLoginChangePasswordPage_Template_ion_button_click_21_listener(){return n.logout()})),P.EFF(22),P.nI1(23,"translate"),P.k0s()()()),2&e&&(P.R7$(3),P.Y8G("text",P.bMT(4,8,"core.back")),P.R7$(3),P.Y8G("ngIf",!n.changingPassword),P.R7$(),P.Y8G("ngIf",n.changingPassword),P.R7$(2),P.Y8G("ariaLabel",P.bMT(10,10,"core.help")),P.R7$(5),P.Y8G("ngIf",!n.changingPassword),P.R7$(),P.Y8G("ngIf",n.changingPassword),P.R7$(4),P.JRh(P.bMT(20,12,"core.wanttochangesite")),P.R7$(3),P.SpI(" ",P.bMT(23,14,n.logoutLabel)," "))},dependencies:[S.bT,V.t,v.i,R.T,k.Jm,k.QW,k.W9,k.eU,k.iq,k.uz,k.he,k.nf,k.BC,k.ai,k.el,O.D9],encapsulation:2}),CoreLoginChangePasswordPage})();const ke=[{path:"",pathMatch:"full",redirectTo:"sites"},{path:"site",component:he},{path:"credentials",loadChildren:()=>c.CoreLoginHelper.getCredentialsRouteModule()},{path:"sites",component:Me,canActivate:[g]},{path:"forgottenpassword",component:L},{path:"changepassword",component:Re},{path:"emailsignup",component:z},{path:"reconnect",loadChildren:()=>c.CoreLoginHelper.getReconnectRouteModule()}];let Te=(()=>{var e;class CoreLoginLazyModule{}return(e=CoreLoginLazyModule).ɵfac=function CoreLoginLazyModule_Factory(n){return new(n||e)},e.ɵmod=P.$C({type:e}),e.ɵinj=P.G2t({imports:[i.n,_.f,E.h,t.iI.forChild(ke)]}),CoreLoginLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&P.Obh(Te,{declarations:[L,he,Me,Re,z],imports:[i.n,_.f,E.h,t.iI]}))}}]);