"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[621],{70621:(e,t,r)=>{r.r(t),r.d(t,{default:()=>te});var o=r(21182),i=r(3353),a=r(79080),s=r(31249),n=r(54438);let c=(()=>{var e;class AddonModScormComponentsModule{}return(e=AddonModScormComponentsModule).ɵfac=function AddonModScormComponentsModule_Factory(t){return new(t||e)},e.ɵmod=n.$C({type:e}),e.ɵinj=n.G2t({imports:[i.n,s.r]}),AddonModScormComponentsModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&n.Obh(c,{declarations:[a.AddonModScormIndexComponent],imports:[i.n,s.r],exports:[a.AddonModScormIndexComponent]}));var d=r(2138),l=r(15324),m=r(58197),u=r(68273),h=r(88246),f=r(73465),p=r(73955);let v=(()=>{var e;class AddonModScormIndexPage extends d._{ngOnInit(){super.ngOnInit(),l.CoreNavigator.getRouteBooleanParam("autoPlay")&&(this.autoPlayData={mode:l.CoreNavigator.getRouteParam("mode"),newAttempt:l.CoreNavigator.getRouteBooleanParam("newAttempt"),organizationId:l.CoreNavigator.getRouteParam("organizationId"),scoId:l.CoreNavigator.getRouteNumberParam("scoId")})}}return(e=AddonModScormIndexPage).ɵfac=(()=>{let t;return function AddonModScormIndexPage_Factory(r){return(t||(t=n.xGo(e)))(r||e)}})(),e.ɵcmp=n.VBU({type:e,selectors:[["page-addon-mod-scorm-index"]],viewQuery:function AddonModScormIndexPage_Query(e,t){if(1&e&&n.GBs(a.AddonModScormIndexComponent,5),2&e){let e;n.mGM(e=n.lsd())&&(t.activityComponent=e.first)}},features:[n.Vt3],decls:14,vars:13,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"dataRetrieved","module","courseId","autoPlayData"]],template:function AddonModScormIndexPage_Template(e,t){1&e&&(n.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),n.nrm(3,"ion-back-button",2),n.nI1(4,"translate"),n.k0s(),n.j41(5,"ion-title")(6,"h1"),n.nrm(7,"core-format-text",3),n.k0s()(),n.nrm(8,"ion-buttons",4),n.k0s()(),n.j41(9,"ion-content",5)(10,"ion-refresher",6),n.bIt("ionRefresh",(function AddonModScormIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==t.activityComponent?null:t.activityComponent.doRefresh(e.target)})),n.nrm(11,"ion-refresher-content",7),n.nI1(12,"translate"),n.k0s(),n.j41(13,"addon-mod-scorm-index",8),n.bIt("dataRetrieved",(function AddonModScormIndexPage_Template_addon_mod_scorm_index_dataRetrieved_13_listener(e){return t.updateData(e)})),n.k0s()()),2&e&&(n.R7$(3),n.Y8G("text",n.bMT(4,9,"core.back")),n.R7$(4),n.Y8G("text",t.title)("contextInstanceId",t.module.id)("courseId",t.courseId),n.R7$(3),n.Y8G("disabled",null==t.activityComponent?null:t.activityComponent.showLoading),n.R7$(),n.FS9("pullingText",n.bMT(12,11,"core.pulltorefresh")),n.R7$(2),n.Y8G("module",t.module)("courseId",t.courseId)("autoPlayData",t.autoPlayData))},dependencies:[m.B,u.M,h.i,f.QW,f.W9,f.eU,f.To,f.Ki,f.BC,f.ai,f.el,a.AddonModScormIndexComponent,p.D9],encapsulation:2}),AddonModScormIndexPage})();var g=r(10467),_=r(52749),I=r(48966),w=r(89911),M=r(16474),y=r(55554),b=r(49882),S=r(81690),C=r(1717),T=r(50891);let A="^[\\u0000-\\uFFFF]{0,255}$",E="^[\\u0000-\\uFFFF]{0,4096}$";const x="^([0-2]{1}[0-9]{1}):([0-5]{1}[0-9]{1}):([0-5]{1}[0-9]{1})(.[0-9]{1,2})?$",D="^([0-9]{2,4}):([0-9]{2}):([0-9]{2})(.[0-9]{1,2})?$",P="^-?([0-9]+)$",$="^-?([0-9]{0,3})(.[0-9]*)?$",U="^[\\u0021-\\u007E]{0,255}$",k=A,R="[._](\\d+).",N="raw,min,max",j="0#100",O={0:"No error",101:"General exception",201:"Invalid argument error",202:"Element cannot have children",203:"Element not an array - cannot have count",301:"Not initialized",401:"Not implemented error",402:"Invalid set value, element is a keyword",403:"Element is read only",404:"Element is write only",405:"Incorrect data type"};class AddonModScormDataModel12{constructor(e,t,r,o,i,a="normal",s=!1,n=!0){this.siteId=e,this.scorm=t,this.scoId=r,this.attempt=o,this.userData=i,this.mode=a,this.offline=s,this.canSaveTracks=n,this.currentUserData={},this.def={},this.defExtra={},this.dataModel={},this.initialized=!1,this.errorCode="0",this.init(i)}addTime(e,t){const r=e.split(":"),o=t.split(":"),i=r[2].split("."),a=o[2].split(".");let s=0,n=0;i.length>1&&(n=parseInt(i[1],10));let c=0;a.length>1&&(c=parseInt(a[1],10));let d=n+c;s=Math.floor(d/100),d-=100*s,Math.floor(d)<10&&(d="0"+d.toString());let l=parseInt(i[0],10)+parseInt(a[0],10)+s;s=Math.floor(l/60),l-=60*s,Math.floor(l)<10&&(l="0"+l.toString());let m=parseInt(r[1],10)+parseInt(o[1],10)+s;s=Math.floor(m/60),m-=60*s,m<10&&(m="0"+m.toString());let u=parseInt(r[0],10)+parseInt(o[0],10)+s;return u<10&&(u="0"+u.toString()),"0"!=d?u+":"+m+":"+l+"."+d:u+":"+m+":"+l}collectData(){if(!this.currentUserData[this.scoId])return[];const e=[];for(const t in this.currentUserData[this.scoId].userdata){if("cmi"!=t.substring(0,3)||"cmi.core.session_time"==t)continue;const r=new RegExp(R,"g"),o=t.replace(r,".n.");if(void 0===this.dataModel[this.scoId][t]&&void 0!==this.dataModel[this.scoId][o]&&(this.dataModel[this.scoId][t]=S.j.clone(this.dataModel[this.scoId][o])),void 0===this.dataModel[this.scoId][t]||"r"==this.dataModel[this.scoId][t].mod)continue;const i={element:t.replace(r,"_$1."),value:this.getEl(t)};void 0!==this.dataModel[this.scoId][t].defaultvalue?this.dataModel[this.scoId][t].defaultvalue!==i.value&&(e.push(i),this.dataModel[this.scoId][t].defaultvalue=i.value):(e.push(i),this.dataModel[this.scoId][t].defaultvalue=i.value)}return e}getEl(e){return this.currentUserData[this.scoId]&&void 0!==this.currentUserData[this.scoId].userdata[e]?this.currentUserData[this.scoId].userdata[e]:""}init(e){this.scorm.scormStandard||(A="^[\\u0000-\\uFFFF]{0,64000}$",E=A);for(const t in e){const r=e[t];this.def[t]=r.defaultdata,this.defExtra[t]=r.userdata}for(const e in this.def){this.dataModel[e]={"cmi._children":{defaultvalue:"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions",mod:"r",writeerror:"402"},"cmi._version":{defaultvalue:"3.4",mod:"r",writeerror:"402"},"cmi.core._children":{defaultvalue:"student_id,student_name,lesson_location,credit,lesson_status,entry,score,total_time,lesson_mode,exit,session_time",mod:"r",writeerror:"402"},"cmi.core.student_id":{defaultvalue:this.def[e]["cmi.core.student_id"],mod:"r",writeerror:"403"},"cmi.core.student_name":{defaultvalue:this.def[e]["cmi.core.student_name"],mod:"r",writeerror:"403"},"cmi.core.lesson_location":{defaultvalue:this.def[e]["cmi.core.lesson_location"],format:A,mod:"rw",writeerror:"405"},"cmi.core.credit":{defaultvalue:this.def[e]["cmi.core.credit"],mod:"r",writeerror:"403"},"cmi.core.lesson_status":{defaultvalue:this.def[e]["cmi.core.lesson_status"],format:"^passed$|^completed$|^failed$|^incomplete$|^browsed$",mod:"rw",writeerror:"405"},"cmi.core.entry":{defaultvalue:this.def[e]["cmi.core.entry"],mod:"r",writeerror:"403"},"cmi.core.score._children":{defaultvalue:N,mod:"r",writeerror:"402"},"cmi.core.score.raw":{defaultvalue:this.def[e]["cmi.core.score.raw"],format:$,range:j,mod:"rw",writeerror:"405"},"cmi.core.score.max":{defaultvalue:this.def[e]["cmi.core.score.max"],format:$,range:j,mod:"rw",writeerror:"405"},"cmi.core.score.min":{defaultvalue:this.def[e]["cmi.core.score.min"],format:$,range:j,mod:"rw",writeerror:"405"},"cmi.core.total_time":{defaultvalue:this.def[e]["cmi.core.total_time"],mod:"r",writeerror:"403"},"cmi.core.lesson_mode":{defaultvalue:this.def[e]["cmi.core.lesson_mode"],mod:"r",writeerror:"403"},"cmi.core.exit":{defaultvalue:this.def[e]["cmi.core.exit"],format:"^time-out$|^suspend$|^logout$|^$",mod:"w",readerror:"404",writeerror:"405"},"cmi.core.session_time":{format:D,mod:"w",defaultvalue:"00:00:00",readerror:"404",writeerror:"405"},"cmi.suspend_data":{defaultvalue:this.def[e]["cmi.suspend_data"],format:E,mod:"rw",writeerror:"405"},"cmi.launch_data":{defaultvalue:this.def[e]["cmi.launch_data"],mod:"r",writeerror:"403"},"cmi.comments":{defaultvalue:this.def[e]["cmi.comments"],format:E,mod:"rw",writeerror:"405"},"cmi.evaluation.comments._count":{defaultvalue:"0",mod:"r",writeerror:"402"},"cmi.evaluation.comments._children":{defaultvalue:"content,location,time",mod:"r",writeerror:"402"},"cmi.evaluation.comments.n.content":{defaultvalue:"",pattern:R,format:A,mod:"rw",writeerror:"405"},"cmi.evaluation.comments.n.location":{defaultvalue:"",pattern:R,format:A,mod:"rw",writeerror:"405"},"cmi.evaluation.comments.n.time":{defaultvalue:"",pattern:R,format:x,mod:"rw",writeerror:"405"},"cmi.comments_from_lms":{mod:"r",writeerror:"403"},"cmi.objectives._children":{defaultvalue:"id,score,status",mod:"r",writeerror:"402"},"cmi.objectives._count":{mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.objectives.n.id":{pattern:R,format:U,mod:"rw",writeerror:"405"},"cmi.objectives.n.score._children":{pattern:R,mod:"r",writeerror:"402"},"cmi.objectives.n.score.raw":{defaultvalue:"",pattern:R,format:$,range:j,mod:"rw",writeerror:"405"},"cmi.objectives.n.score.min":{defaultvalue:"",pattern:R,format:$,range:j,mod:"rw",writeerror:"405"},"cmi.objectives.n.score.max":{defaultvalue:"",pattern:R,format:$,range:j,mod:"rw",writeerror:"405"},"cmi.objectives.n.status":{pattern:R,format:"^passed$|^completed$|^failed$|^incomplete$|^browsed$|^not attempted$",mod:"rw",writeerror:"405"},"cmi.student_data._children":{defaultvalue:"mastery_score,max_time_allowed,time_limit_action",mod:"r",writeerror:"402"},"cmi.student_data.mastery_score":{defaultvalue:this.def[e]["cmi.student_data.mastery_score"],mod:"r",writeerror:"403"},"cmi.student_data.max_time_allowed":{defaultvalue:this.def[e]["cmi.student_data.max_time_allowed"],mod:"r",writeerror:"403"},"cmi.student_data.time_limit_action":{defaultvalue:this.def[e]["cmi.student_data.time_limit_action"],mod:"r",writeerror:"403"},"cmi.student_preference._children":{defaultvalue:"audio,language,speed,text",mod:"r",writeerror:"402"},"cmi.student_preference.audio":{defaultvalue:this.def[e]["cmi.student_preference.audio"],format:P,range:"-1#100",mod:"rw",writeerror:"405"},"cmi.student_preference.language":{defaultvalue:this.def[e]["cmi.student_preference.language"],format:A,mod:"rw",writeerror:"405"},"cmi.student_preference.speed":{defaultvalue:this.def[e]["cmi.student_preference.speed"],format:P,range:"-100#100",mod:"rw",writeerror:"405"},"cmi.student_preference.text":{defaultvalue:this.def[e]["cmi.student_preference.text"],format:P,range:"-1#1",mod:"rw",writeerror:"405"},"cmi.interactions._children":{defaultvalue:"id,objectives,time,type,correct_responses,weighting,student_response,result,latency",mod:"r",writeerror:"402"},"cmi.interactions._count":{mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.id":{pattern:R,format:U,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.objectives._count":{pattern:R,mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.objectives.n.id":{pattern:R,format:U,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.time":{pattern:R,format:x,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.type":{pattern:R,format:"^true-false$|^choice$|^fill-in$|^matching$|^performance$|^sequencing$|^likert$|^numeric$",mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.correct_responses._count":{pattern:R,mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.correct_responses.n.pattern":{pattern:R,format:k,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.weighting":{pattern:R,format:$,range:"-100#100",mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.student_response":{pattern:R,format:k,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.result":{pattern:R,format:"^correct$|^wrong$|^unanticipated$|^neutral$|^([0-9]{0,3})?(.[0-9]*)?$",mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.latency":{pattern:R,format:D,mod:"w",readerror:"404",writeerror:"405"},"nav.event":{defaultvalue:"",format:"^previous$|^continue$",mod:"w",readerror:"404",writeerror:"405"}},this.currentUserData[e]={scoid:Number(e),userdata:{},defaultdata:{}};for(const t in this.dataModel[e])if(null===t.match(/\.n\./)){const r=this.dataModel[e][t].defaultvalue;void 0!==r&&(this.currentUserData[e].userdata[t]=r)}for(const t in this.def[e])if(null===t.match(/\.n\./)){const r=this.dataModel[e][t].defaultvalue;this.currentUserData[e].userdata[t]=void 0!==r?r:void 0!==this.defExtra[e][t]?this.defExtra[e][t]:""}const c=new RegExp(R,"g");for(const d in this.defExtra[e]){let l="",m="0";if(d.match(c)){const u=d.replace(c,".$1.");var t;if(this.currentUserData[e].userdata[u]=this.defExtra[e][d],0===u.indexOf("cmi.evaluation.comments"))l="cmi.evaluation.comments._count",m=(null===(t=u.match(/.(\d+)./))||void 0===t?void 0:t[1])||"0";else if(0===u.indexOf("cmi.objectives")){var r;l="cmi.objectives._count",m=(null===(r=u.match(/.(\d+)./))||void 0===r?void 0:r[1])||"0"}else if(0===u.indexOf("cmi.interactions"))if(u.indexOf(".objectives.")>0){var o,i;const e=null===(o=u.match(/cmi.interactions.(\d+)./))||void 0===o?void 0:o[1];m=(null===(i=u.match(/objectives.(\d+)./))||void 0===i?void 0:i[1])||"0",l="cmi.interactions."+e+".objectives._count"}else if(u.indexOf(".correct_responses.")>0){var a,s;const e=null===(a=u.match(/cmi.interactions.(\d+)./))||void 0===a?void 0:a[1];m=(null===(s=u.match(/correct_responses.(\d+)./))||void 0===s?void 0:s[1])||"0",l="cmi.interactions."+e+".correct_responses._count"}else{var n;l="cmi.interactions._count",m=(null===(n=u.match(/.(\d+)./))||void 0===n?void 0:n[1])||"0"}if(l){const t=this.currentUserData[e].userdata[l];void 0===t&&(this.currentUserData[e].userdata[l]=0),Number(m)==Number(t)&&(this.currentUserData[e].userdata[l]=Number(t)+1),Number(m)>Number(t)&&(this.currentUserData[e].userdata[l]=Number(m)-1)}}}""===this.currentUserData[e].userdata["cmi.core.lesson_status"]&&(this.currentUserData[e].userdata["cmi.core.lesson_status"]="not attempted"),this.currentUserData[e].userdata["cmi.core.credit"]="normal"===this.mode?"credit":"no-credit",this.currentUserData[e].userdata["cmi.core.lesson_mode"]=this.mode}}LMSCommit(e){if(this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.errorCode="0",""==e){if(this.initialized){const e=this.storeData(!1);return this.triggerEvent(T.lt),this.errorCode=e?"0":"101",e?"true":"false"}this.errorCode="301"}else this.errorCode="201";return"false"}LMSFinish(e){if(this.errorCode="0",""==e){if(this.initialized){this.initialized=!1;const e=this.storeData(!0);return""!=this.getEl("nav.event")?"continue"==this.getEl("nav.event")?this.triggerEvent(T.UK):this.triggerEvent(T.M2):this.scorm.auto&&this.triggerEvent(T.UK),this.errorCode=e?"0":"101",this.triggerEvent(T.lt),e?"true":"false"}this.errorCode="301"}else this.errorCode="201";return"false"}LMSGetDiagnostic(e){return""==e&&(e=this.errorCode),e}LMSGetErrorString(e){return""!=e?O[e]:""}LMSGetLastError(){return this.errorCode}LMSGetValue(e){if(this.errorCode="0",this.initialized)if(""!=e){const t=new RegExp(R,"g"),r=String(e).replace(t,".n.");if(void 0!==this.dataModel[this.scoId][r]){if("w"!=this.dataModel[this.scoId][r].mod)return this.errorCode="0",this.getEl(e);this.errorCode=this.dataModel[this.scoId][r].readerror||"0"}else{const e="._children",t="._count";if(r.substring(r.length-e.length)==e){const t=r.substring(0,r.length-e.length);this.errorCode=void 0!==this.dataModel[this.scoId][t]?"202":"201"}else if(r.substring(r.length-t.length)==t){const e=r.substring(0,r.length-t.length);this.errorCode=void 0!==this.dataModel[this.scoId][e]?"203":"201"}else this.errorCode="201"}}else this.errorCode="201";else this.errorCode="301";return""}LMSInitialize(e){if(this.errorCode="0",""==e){if(!this.initialized)return this.initialized=!0,this.errorCode="0","true";this.errorCode="101"}else this.errorCode="201";return"false"}LMSSetValue(e,t){if(this.errorCode="0",this.initialized)if(""!=e){let a=new RegExp(R,"g");const s=String(e).replace(a,".n.");if(void 0!==this.dataModel[this.scoId][s])if("r"!=this.dataModel[this.scoId][s].mod){var r;a=new RegExp(null!==(r=this.dataModel[this.scoId][s].format)&&void 0!==r?r:"");if(null!=(t+="").match(a)){if(e!=s){if(0===e.indexOf("cmi.objectives")){var o;const t="cmi.objectives."+(null===(o=e.match(/cmi.objectives.(\d+)./))||void 0===o?void 0:o[1])+".score";void 0===this.currentUserData[this.scoId].userdata[t+"._children"]&&(this.setEl(this.currentUserData[this.scoId].userdata[t+"._children"],N),this.setEl(this.currentUserData[this.scoId].userdata[t+".raw"],""),this.setEl(this.currentUserData[this.scoId].userdata[t+".min"],""),this.setEl(this.currentUserData[this.scoId].userdata[t+".max"],""))}else if(0===e.indexOf("cmi.interactions")){var i;const t=null===(i=e.match(/cmi.interactions.(\d+)./))||void 0===i?void 0:i[1];let r="cmi.interactions."+t+".objectives._count";void 0===this.currentUserData[this.scoId].userdata[r]&&this.setEl(r,0),r="cmi.interactions."+t+".correct_responses._count",void 0===this.currentUserData[this.scoId].userdata[r]&&this.setEl(r,0)}const t=e.split(".");let r="cmi";for(let e=1;e<t.length-1;e++){const o=t[e];if(t[e+1].match(/^\d+$/)){const i=r+"."+o+"._count";if(void 0===this.currentUserData[this.scoId].userdata[i]&&this.setEl(i,0),t[e+1]==this.getEl(i)){const e=this.getEl(i);this.setEl(i,Number(e)+1)}t[e+1]>this.getEl(i)&&(this.errorCode="201"),r=r.concat("."+o+"."+t[e+1]),e++}else r=r.concat("."+o)}e=r.concat("."+t[t.length-1])}if("0"==this.errorCode){this.scorm.autocommit&&!this.timeout&&(this.timeout=window.setTimeout((()=>this.LMSCommit("")),6e4));const r=this.dataModel[this.scoId][s].range;if(void 0===r)return"cmi.comments"==e?this.setEl("cmi.comments",this.getEl("cmi.comments")+t):this.setEl(e,t),this.errorCode="0","true";{const o=r.split("#");if((t=Number(t))>=Number(o[0])&&t<=Number(o[1]))return this.setEl(e,Number(t)),this.errorCode="0","true";this.errorCode=this.dataModel[this.scoId][s].writeerror}}}else this.errorCode=this.dataModel[this.scoId][s].writeerror}else this.errorCode=this.dataModel[this.scoId][s].writeerror;else this.errorCode="201"}else this.errorCode="201";else this.errorCode="301";return"false"}loadSco(e){this.scoId=e}setEl(e,t){this.currentUserData[this.scoId]=this.currentUserData[this.scoId]||{scoid:this.scoId,userdata:{},defaultdata:{}},this.currentUserData[this.scoId].userdata[e]=t}setOffline(e){this.offline=e}storeData(e){if(!this.canSaveTracks)return!0;let t;e?("not attempted"==this.getEl("cmi.core.lesson_status")&&this.setEl("cmi.core.lesson_status","completed"),"normal"===this.getEl("cmi.core.lesson_mode")&&"credit"===this.getEl("cmi.core.credit")&&""!==this.getEl("cmi.student_data.mastery_score")&&""!==this.getEl("cmi.core.score.raw")&&(parseFloat(this.getEl("cmi.core.score.raw"))>=parseFloat(this.getEl("cmi.student_data.mastery_score"))?this.setEl("cmi.core.lesson_status","passed"):this.setEl("cmi.core.lesson_status","failed")),"browse"===this.getEl("cmi.core.lesson_mode")&&""==this.dataModel[this.scoId]["cmi.core.lesson_status"].defaultvalue&&"not attempted"==this.getEl("cmi.core.lesson_status")&&this.setEl("cmi.core.lesson_status","browsed"),t=this.collectData(),t.push(this.totalTime())):t=this.collectData();const r=C.v.saveTracksSync(this.scoId,this.attempt,t,this.scorm,this.offline,this.currentUserData);return this.offline||r?r:(this.offline=!0,this.triggerEvent(T.Bm),C.v.saveTracksSync(this.scoId,this.attempt,t,this.scorm,this.offline,this.currentUserData))}totalTime(){return{element:"cmi.core.total_time",value:this.addTime(this.getEl("cmi.core.total_time"),this.getEl("cmi.core.session_time"))}}triggerEvent(e){b.z.trigger(e,{scormId:this.scorm.id,scoId:this.scoId,attempt:this.attempt},this.siteId)}}var z=r(8214),F=r(98045),G=r(22693),V=r(53794),L=r(6319),Y=r(5854),B=r(60177),W=r(76954),q=r(7476),X=r(64422),H=r(46036),J=r(86198),K=r(66731),Q=r(43570);function AddonModScormPlayerPage_core_button_with_spinner_9_ion_button_1_Template(e,t){if(1&e){const e=n.RV6();n.j41(0,"ion-button",11),n.nI1(1,"translate"),n.bIt("click",(function AddonModScormPlayerPage_core_button_with_spinner_9_ion_button_1_Template_ion_button_click_0_listener(){n.eBV(e);const t=n.XpG(2);return n.Njj(t.openToc())})),n.nrm(2,"ion-icon",12),n.k0s()}2&e&&n.Y8G("ariaLabel",n.bMT(1,1,"addon.mod_scorm.toc"))}function AddonModScormPlayerPage_core_button_with_spinner_9_Template(e,t){if(1&e&&(n.j41(0,"core-button-with-spinner",9),n.DNE(1,AddonModScormPlayerPage_core_button_with_spinner_9_ion_button_1_Template,3,3,"ion-button",10),n.k0s()),2&e){const e=n.XpG();n.Y8G("loading",e.loadingToc),n.R7$(),n.Y8G("ngIf",e.toc.length)}}function AddonModScormPlayerPage_core_iframe_12_Template(e,t){if(1&e&&n.nrm(0,"core-iframe",13),2&e){const e=n.XpG();n.Y8G("src",e.src)("iframeWidth",e.scormWidth)("iframeHeight",e.scormHeight)("showFullscreenOnToolbar",!0)("autoFullscreenOnRotate",!0)}}function AddonModScormPlayerPage_p_13_Template(e,t){if(1&e&&(n.j41(0,"p"),n.EFF(1),n.nI1(2,"translate"),n.k0s()),2&e){const e=n.XpG();n.R7$(),n.JRh(n.bMT(2,1,e.errorMessage))}}function AddonModScormPlayerPage_core_navigation_bar_14_Template(e,t){if(1&e){const e=n.RV6();n.j41(0,"core-navigation-bar",14),n.bIt("action",(function AddonModScormPlayerPage_core_navigation_bar_14_Template_core_navigation_bar_action_0_listener(t){n.eBV(e);const r=n.XpG();return n.Njj(r.loadSco(t))})),n.k0s()}if(2&e){const e=n.XpG();n.Y8G("items",e.navigationItems)}}let Z=(()=>{var e;class AddonModScormPlayerPage{constructor(e){this.mainMenuPage=e,this.showToc=!1,this.loadingToc=!0,this.toc=[],this.loaded=!1,this.incomplete=!1,this.navigationItems=[],this.newAttempt=!1,this.attempt=0,this.offline=!1}ngOnInit(){var e=this;return(0,g.A)((function*(){try{e.cmId=l.CoreNavigator.getRequiredRouteNumberParam("cmId"),e.courseId=l.CoreNavigator.getRequiredRouteNumberParam("courseId"),e.mode=l.CoreNavigator.getRouteParam("mode")||"normal",e.moduleUrl=l.CoreNavigator.getRouteParam("moduleUrl")||"",e.newAttempt=!!l.CoreNavigator.getRouteBooleanParam("newAttempt"),e.organizationId=l.CoreNavigator.getRouteParam("organizationId"),e.initialScoId=l.CoreNavigator.getRouteNumberParam("scoId"),e.siteId=_.CoreSites.getRequiredCurrentSite().getId()}catch(e){return w.CoreDomUtils.showErrorModal(e),l.CoreNavigator.back(),void 0}try{if(yield e.fetchData(),!e.currentSco)return l.CoreNavigator.back(),void 0;if(e.newAttempt)try{yield e.setStartTime(e.currentSco.id)}catch(e){w.CoreDomUtils.showErrorModalDefault(e,"addon.mod_scorm.errorgetscorm",!0)}e.loadSco(e.currentSco)}finally{e.loaded=!0}}))()}get canSaveTracks(){return!this.accessInfo||!!this.accessInfo.cansavetrack}initialize(){var e=this;return(0,g.A)((function*(){e.scorm=yield C.v.getScorm(e.courseId,e.cmId,{moduleUrl:e.moduleUrl,readingStrategy:1}),I.CoreSync.blockOperation(T.Rz,e.scorm.id,"player"),e.title=e.scorm.name,e.showToc=C.v.displayTocInPlayer(e.scorm),e.scorm.popup&&e.scorm.width&&e.scorm.width>100&&(e.scormWidth=e.scorm.width,e.scorm.height&&e.scorm.height>100&&(e.scormHeight=e.scorm.height)),e.tocObserver=b.z.on(T.lt,(t=>{t.scormId===e.scorm.id&&(e.offline?setTimeout((()=>e.refreshToc()),100):e.refreshToc())}),e.siteId),e.launchNextObserver=b.z.on(T.UK,(t=>{if(t.scormId===e.scorm.id&&e.currentSco){const t=z.V.getNextScoFromToc(e.toc,e.currentSco.id);t&&e.loadSco(t)}}),e.siteId),e.launchPrevObserver=b.z.on(T.M2,(t=>{if(t.scormId===e.scorm.id&&e.currentSco){const t=z.V.getPreviousScoFromToc(e.toc,e.currentSco.id);t&&e.loadSco(t)}}),e.siteId),e.goOfflineObserver=b.z.on(T.Bm,(t=>{t.scormId!==e.scorm.id||e.offline||(e.offline=!0,setTimeout((0,g.A)((function*(){try{z.V.convertAttemptToOffline(e.scorm,e.attempt)}catch(e){w.CoreDomUtils.showErrorModalDefault(e,"core.error",!0)}e.refreshToc()})),200))}),e.siteId)}))()}calculateNavigationItems(e){this.navigationItems=this.toc.filter((e=>e.isvisible)).map((t=>({item:t,title:t.title,current:t.id==e,enabled:!(!t.prereq||!t.launch)})))}determineAttemptAndMode(e,t){var r=this;return(0,g.A)((function*(){const o=yield z.V.determineAttemptToContinue(r.scorm,e);let i=!1;r.attempt=o.num,r.offline=o.offline,r.attempt!=e.lastAttempt.num&&(r.attemptToContinue=r.attempt),r.attempt>0&&(i=yield C.v.isAttemptIncomplete(r.scorm.id,r.attempt,{offline:r.offline,cmId:r.cmId}));const a=C.v.determineAttemptAndMode(r.scorm,r.mode,r.attempt,r.newAttempt,i,t.cansavetrack);if(a.attempt>r.attempt)if(r.offline)yield z.V.createOfflineAttempt(r.scorm,a.attempt,e.online.length);else try{yield C.v.getScormUserData(r.scorm.id,a.attempt,{cmId:r.cmId,readingStrategy:2})}catch{r.offline=!0,yield z.V.createOfflineAttempt(r.scorm,a.attempt,e.online.length)}r.mode=a.mode,r.newAttempt=a.newAttempt,r.attempt=a.attempt}))()}fetchData(){var e=this;return(0,g.A)((function*(){e.scorm||(yield e.initialize()),yield F.S.waitForSync(e.scorm.id);try{const[t,r]=yield Promise.all([C.v.getAttemptCount(e.scorm.id,{cmId:e.cmId}),C.v.getAccessInformation(e.scorm.id,{cmId:e.cmId})]);e.accessInfo=r,yield e.determineAttemptAndMode(t,r);const[o]=yield Promise.all([C.v.getScormUserData(e.scorm.id,e.attempt,{cmId:e.cmId,offline:e.offline}),e.fetchToc()]);e.userData=o}catch(e){w.CoreDomUtils.showErrorModalDefault(e,"addon.mod_scorm.errorgetscorm",!0)}}))()}fetchToc(){var e=this;return(0,g.A)((function*(){e.loadingToc=!0;try{if(e.incomplete=yield C.v.isAttemptIncomplete(e.scorm.id,e.attempt,{offline:e.offline,cmId:e.cmId}),e.toc=yield z.V.getToc(e.scorm.id,e.attempt,e.incomplete,{organization:e.organizationId,offline:e.offline,cmId:e.cmId}),e.currentSco)return;if(e.newAttempt&&(e.initialScoId=e.scorm.launch),e.initialScoId&&e.initialScoId>0&&(e.currentSco=z.V.getScoFromToc(e.toc,e.initialScoId)),e.currentSco)return;const t=yield z.V.getFirstSco(e.scorm.id,e.attempt,{toc:e.toc,organization:e.organizationId,mode:e.mode,offline:e.offline,cmId:e.cmId});t?e.currentSco=t:e.errorMessage="addon.mod_scorm.errornovalidsco"}finally{e.loadingToc=!1}}))()}loadSco(e){var t=this;return(0,g.A)((function*(){var r;t.dataModel?(t.src="",yield V.H.nextTick(),t.dataModel.loadSco(e.id)):(t.dataModel=new AddonModScormDataModel12(t.siteId,t.scorm,e.id,t.attempt,null!==(r=t.userData)&&void 0!==r?r:{},t.mode,t.offline,t.canSaveTracks),window.API=t.dataModel);t.currentSco=e,t.title=e.title||t.scorm.name,t.calculateNavigationItems(e.id),t.src=yield C.v.getScoSrc(t.scorm,e),"asset"==e.scormtype&&t.markCompleted(e),t.logEvent(e.id)}))()}markCompleted(e){var t=this;return(0,g.A)((function*(){if(!t.canSaveTracks)return;const r=[{element:"cmi.core.lesson_status",value:"completed"}];try{C.v.saveTracks(e.id,t.attempt,r,t.scorm,t.offline)}catch{if(t.offline)return;const i=yield C.v.getScormUserData(t.scorm.id,t.attempt,{cmId:t.cmId});if(i[e.id]&&"completed"==i[e.id].userdata["cmi.core.lesson_status"])return;try{var o;yield z.V.convertAttemptToOffline(t.scorm,t.attempt),t.offline=!0,null===(o=t.dataModel)||void 0===o||o.setOffline(!0),yield C.v.saveTracks(e.id,t.attempt,r,t.scorm,!0)}catch(e){w.CoreDomUtils.showErrorModalDefault(e,"core.error",!0)}}finally{t.refreshToc()}}))()}openToc(){var e=this;return(0,g.A)((function*(){const{AddonModScormTocComponent:t}=yield r.e(5640).then(r.bind(r,75640)),o=yield L.I.openSideModal({component:t,componentProps:{toc:e.toc,attemptToContinue:e.attemptToContinue,selected:e.currentSco&&e.currentSco.id,moduleId:e.cmId,courseId:e.courseId,accessInfo:e.accessInfo,mode:e.mode}});o&&e.loadSco(o)}))()}refreshToc(){var e=this;return(0,g.A)((function*(){try{yield y.g.ignoreErrors(C.v.invalidateAllScormData(e.scorm.id)),yield e.fetchToc()}catch(e){w.CoreDomUtils.showErrorModalDefault(e,"addon.mod_scorm.errorgetscorm",!0)}}))()}setStartTime(e){var t=this;return(0,g.A)((function*(){if(!t.canSaveTracks)return;const r=[{element:"x.start.time",value:String(M.CoreTimeUtils.timestamp())}];yield C.v.saveTracks(e,t.attempt,r,t.scorm,t.offline),t.offline||(yield y.g.ignoreErrors(C.v.getAttemptCount(t.scorm.id,{cmId:t.cmId,readingStrategy:2})))}))()}logEvent(e){var t=this;return(0,g.A)((function*(){yield y.g.ignoreErrors(C.v.logLaunchSco(t.scorm.id,e));let r="/mod/scorm/player.php";t.scorm.popup&&(r+=`?a=${t.scorm.id}&currentorg=${t.organizationId}&scoid=${e}&display=popup&mode=${t.mode}`),G.OF.logEvent({type:G.qr.VIEW_ITEM,ws:"mod_scorm_get_scorm_user_data",name:t.scorm.name,data:{id:t.scorm.id,scoid:e,organization:t.organizationId,category:"scorm"},url:r})}))()}ngOnDestroy(){var e,t,r;this.src="",b.z.trigger(b.z.ACTIVITY_DATA_SENT,{module:"scorm"}),null===(e=this.tocObserver)||void 0===e||e.off(),null===(t=this.launchNextObserver)||void 0===t||t.off(),null===(r=this.launchPrevObserver)||void 0===r||r.off(),setTimeout((()=>{var e;null===(e=this.goOfflineObserver)||void 0===e||e.off()}),500),I.CoreSync.unblockOperation(T.Rz,this.scorm.id,"player")}}return(e=AddonModScormPlayerPage).ɵfac=function AddonModScormPlayerPage_Factory(t){return new(t||e)(n.rXU(Y.V))},e.ɵcmp=n.VBU({type:e,selectors:[["page-addon-mod-scorm-player"]],decls:15,vars:11,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[3,"loading",4,"ngIf"],[3,"hideUntil"],["id","scorm_object",3,"src","iframeWidth","iframeHeight","showFullscreenOnToolbar","autoFullscreenOnRotate",4,"ngIf"],[4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",3,"items","action",4,"ngIf"],[3,"loading"],["fill","clear","aria-haspopup","true",3,"ariaLabel","click",4,"ngIf"],["fill","clear","aria-haspopup","true",3,"click","ariaLabel"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],["id","scorm_object",3,"src","iframeWidth","iframeHeight","showFullscreenOnToolbar","autoFullscreenOnRotate"],["collapsible-footer","","appearOnBottom","","slot","fixed",3,"action","items"]],template:function AddonModScormPlayerPage_Template(e,t){1&e&&(n.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),n.nrm(3,"ion-back-button",1),n.nI1(4,"translate"),n.k0s(),n.j41(5,"ion-title")(6,"h1"),n.nrm(7,"core-format-text",2),n.k0s()(),n.j41(8,"ion-buttons",3),n.DNE(9,AddonModScormPlayerPage_core_button_with_spinner_9_Template,2,2,"core-button-with-spinner",4),n.k0s()()(),n.j41(10,"ion-content")(11,"core-loading",5),n.DNE(12,AddonModScormPlayerPage_core_iframe_12_Template,1,5,"core-iframe",6)(13,AddonModScormPlayerPage_p_13_Template,3,3,"p",7),n.k0s(),n.DNE(14,AddonModScormPlayerPage_core_navigation_bar_14_Template,1,1,"core-navigation-bar",8),n.k0s()),2&e&&(n.R7$(3),n.Y8G("text",n.bMT(4,9,"core.back")),n.R7$(4),n.Y8G("text",t.title)("contextInstanceId",t.cmId)("courseId",t.courseId),n.R7$(2),n.Y8G("ngIf",t.showToc),n.R7$(2),n.Y8G("hideUntil",t.loaded),n.R7$(),n.Y8G("ngIf",t.loaded),n.R7$(),n.Y8G("ngIf",!t.src&&t.errorMessage),n.R7$(),n.Y8G("ngIf",t.loaded&&t.navigationItems.length>1))},dependencies:[B.bT,W.q,q.l,X.R,H.o,J.t,m.B,K.i,h.i,Q.T,f.Jm,f.QW,f.W9,f.eU,f.iq,f.BC,f.ai,f.el,p.D9],encapsulation:2}),AddonModScormPlayerPage})();const ee=[{path:":courseId/:cmId",component:v},{path:":courseId/:cmId/player",component:Z}];let te=(()=>{var e;class AddonModScormLazyModule{}return(e=AddonModScormLazyModule).ɵfac=function AddonModScormLazyModule_Factory(t){return new(t||e)},e.ɵmod=n.$C({type:e}),e.ɵinj=n.G2t({imports:[o.iI.forChild(ee),i.n,c]}),AddonModScormLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&n.Obh(te,{declarations:[v,Z],imports:[o.iI,i.n,c]}))}}]);