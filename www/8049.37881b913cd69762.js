"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8049],{45157:(o,e,n)=>{n.d(e,{o:()=>N});var s=n(10467),i=n(89417),t=n(75629),d=n(16082),a=n(45507),r=n(88436),m=n(24942),_=n(52749),l=n(48966),c=n(89911),p=n(81690),u=n(79555),h=n(49882),f=n(63153),k=n(65964),g=n(67193),b=n(80178),I=n(26327),v=n(81552),A=n(91416),w=n(23780),M=n(55554),S=n(43411),T=n(58364),C=n(54438),W=n(60177),G=n(95638),R=n(68162),x=n(31498),y=n(25880),$=n(64422),F=n(17778),E=n(58197),P=n(73465),Y=n(41450),D=n(73955);const j=["assessmentForm"],_c1=o=>({$a:o}),_c2=o=>({asid:o}),_c3=o=>({header:o});function AddonModWorkshopAssessmentStrategyComponent_ng_container_6_Template(o,e){if(1&o&&(C.qex(0),C.nrm(1,"core-dynamic-component",6),C.bVm()),2&o){const o=C.XpG();C.R7$(),C.Y8G("component",o.componentClass)("data",o.data)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_7_Template(o,e){if(1&o&&(C.j41(0,"ion-card",7)(1,"ion-item")(2,"ion-label")(3,"p"),C.EFF(4),C.nI1(5,"translate"),C.k0s()()()()),2&o){const o=C.XpG();C.R7$(4),C.JRh(C.i5U(5,1,"addon.mod_workshop.assessmentstrategynotsupported",C.eq3(4,_c1,o.strategy)))}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_core_input_errors_6_Template(o,e){if(1&o&&C.nrm(0,"core-input-errors",16),2&o){const o=C.XpG(3);C.Y8G("errorText",o.data.fieldErrors.feedbackauthor)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_Template(o,e){if(1&o){const o=C.RV6();C.j41(0,"ion-item")(1,"ion-label",12)(2,"span",13),C.EFF(3),C.nI1(4,"translate"),C.k0s()(),C.j41(5,"core-rich-text-editor",14),C.bIt("contentChanged",(function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_Template_core_rich_text_editor_contentChanged_5_listener(e){C.eBV(o);const n=C.XpG(2);return C.Njj(n.onFeedbackChange(e))})),C.k0s(),C.DNE(6,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_core_input_errors_6_Template,1,1,"core-input-errors",15),C.k0s()}if(2&o){const o=C.XpG(2);C.R7$(2),C.Y8G("core-mark-required",o.overallFeedkbackRequired),C.R7$(),C.SpI(" ",C.bMT(4,9,"addon.mod_workshop.feedbackauthor")," "),C.R7$(2),C.Y8G("control",o.feedbackControl)("component",o.component)("componentId",o.workshop.coursemodule)("autoSave",!0)("contextInstanceId",o.workshop.coursemodule)("draftExtraParams",C.eq3(11,_c2,o.assessmentId)),C.R7$(),C.Y8G("ngIf",o.overallFeedkbackRequired&&o.data.fieldErrors&&o.data.fieldErrors.feedbackauthor)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_core_attachments_7_Template(o,e){if(1&o&&C.nrm(0,"core-attachments",17),2&o){const o=C.XpG(2);C.Y8G("files",null==o.data.assessment?null:o.data.assessment.feedbackattachmentfiles)("maxSize",o.workshop.overallfeedbackmaxbytes)("maxSubmissions",o.workshop.overallfeedbackfiles)("component",o.component)("componentId",o.componentId)("allowOffline",!0)("courseId",o.workshop.course)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_ion_select_option_7_Template(o,e){if(1&o&&(C.j41(0,"ion-select-option",21),C.EFF(1),C.k0s()),2&o){const o=e.$implicit;C.Y8G("value",o),C.R7$(),C.JRh(o)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_Template(o,e){if(1&o){const o=C.RV6();C.j41(0,"ion-item")(1,"ion-select",18),C.nI1(2,"translate"),C.nI1(3,"translate"),C.mxI("ngModelChange",(function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_Template_ion_select_ngModelChange_1_listener(e){C.eBV(o);const n=C.XpG(2);return C.DH7(n.weight,e)||(n.weight=e),C.Njj(e)})),C.j41(4,"div",19),C.EFF(5),C.nI1(6,"translate"),C.k0s(),C.DNE(7,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_ion_select_option_7_Template,2,2,"ion-select-option",20),C.k0s()()}if(2&o){const o=C.XpG(2);C.R7$(),C.R50("ngModel",o.weight),C.Y8G("cancelText",C.bMT(2,6,"core.cancel"))("interfaceOptions",C.eq3(12,_c3,C.bMT(3,8,"addon.mod_workshop.assessmentweight"))),C.R7$(3),C.Y8G("core-mark-required",!0),C.R7$(),C.SpI(" ",C.bMT(6,10,"addon.mod_workshop.assessmentweight")," "),C.R7$(2),C.Y8G("ngForOf",o.weights)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_9_Template(o,e){if(1&o&&(C.j41(0,"ion-item",8)(1,"ion-label"),C.nrm(2,"core-format-text",22),C.k0s()()),2&o){const o=C.XpG(2);C.R7$(2),C.Y8G("component",o.component)("componentId",o.componentId)("text",null==o.data.assessment?null:o.data.assessment.feedbackauthor)("contextInstanceId",o.workshop.coursemodule)("courseId",o.workshop.course)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_10_Template(o,e){if(1&o&&(C.j41(0,"ion-item")(1,"ion-label"),C.nrm(2,"core-files",23),C.k0s()()),2&o){const o=C.XpG(2);C.R7$(2),C.Y8G("files",null==o.data.assessment?null:o.data.assessment.feedbackattachmentfiles)("component",o.component)("componentId",o.componentId)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_Template(o,e){if(1&o&&(C.j41(0,"ion-card")(1,"ion-item",8)(2,"ion-label")(3,"h3",9),C.EFF(4),C.nI1(5,"translate"),C.k0s()()(),C.DNE(6,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_Template,7,13,"ion-item",4)(7,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_core_attachments_7_Template,1,7,"core-attachments",10)(8,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_Template,8,14,"ion-item",4)(9,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_9_Template,3,5,"ion-item",11)(10,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_10_Template,3,3,"ion-item",4),C.k0s()),2&o){const o=C.XpG();C.R7$(4),C.JRh(C.bMT(5,6,"addon.mod_workshop.overallfeedback")),C.R7$(2),C.Y8G("ngIf",o.edit),C.R7$(),C.Y8G("ngIf",o.edit&&o.workshop.overallfeedbackfiles),C.R7$(),C.Y8G("ngIf",o.edit&&o.access&&o.access.canallocate),C.R7$(),C.Y8G("ngIf",!o.edit&&(null==o.data.assessment?null:o.data.assessment.feedbackauthor)),C.R7$(),C.Y8G("ngIf",!o.edit&&o.workshop.overallfeedbackfiles&&(null==o.data.assessment||null==o.data.assessment.feedbackattachmentfiles?null:o.data.assessment.feedbackattachmentfiles.length))}}let N=(()=>{var o;class AddonModWorkshopAssessmentStrategyComponent{constructor(){this.edit=!1,this.data={workshopId:0,assessment:void 0,edit:!1,selectedValues:[],fieldErrors:{},strategy:"",moduleId:0,courseId:void 0},this.assessmentStrategyLoaded=!1,this.notSupported=!1,this.feedbackText="",this.feedbackControl=new i.MJ(null),this.overallFeedkback=!1,this.overallFeedkbackRequired=!1,this.component=v.Ug,this.weights=[],this.hasOffline=!1,this.originalData={text:"",files:[],weight:1,selectedValues:[]}}ngOnInit(){var o=this;return(0,s.A)((function*(){if(!o.assessmentId||!o.strategy)return o.assessmentStrategyLoaded=!0,void 0;if(o.data.workshopId=o.workshop.id,o.data.edit=o.edit,o.data.strategy=o.strategy,o.data.moduleId=o.workshop.coursemodule,o.data.courseId=o.workshop.course,o.componentClass=yield k.AddonWorkshopAssessmentStrategyDelegate.getComponentForPlugin(o.strategy),o.componentClass){if(o.overallFeedkback=0!=o.workshop.overallfeedbackmode,o.overallFeedkbackRequired=2==o.workshop.overallfeedbackmode,o.componentId=o.workshop.coursemodule,o.edit&&o.access.canallocate){o.weights=[];for(let e=16;e>=0;e--)o.weights[e]=e}o.edit&&l.CoreSync.blockOperation(v.Ug,o.workshop.id);try{yield o.load(),o.obsInvalidated=h.z.on(v.Dl,(()=>o.load()),_.CoreSites.getCurrentSiteId())}catch(e){o.componentClass=void 0,c.CoreDomUtils.showErrorModalDefault(e,"Error loading assessment.")}finally{o.assessmentStrategyLoaded=!0}}else o.notSupported=!k.AddonWorkshopAssessmentStrategyDelegate.isPluginSupported(o.strategy),o.assessmentStrategyLoaded=!0}))()}load(){var o=this;return(0,s.A)((function*(){if(o.data.assessment=yield b.AddonModWorkshopHelper.getReviewerAssessmentById(o.workshop.id,o.assessmentId,{userId:o.userId,cmId:o.workshop.coursemodule}),o.data.assessment.form){if(o.edit)try{const e=(yield I.AddonModWorkshopOffline.getAssessment(o.workshop.id,o.assessmentId)).inputdata;o.hasOffline=!0,o.data.assessment.feedbackauthor=e.feedbackauthor,o.access.canallocate&&(o.data.assessment.weight=e.weight),o.data.assessment.form.current=g.AddonModWorkshop.parseFields(T.T.toArrayOfObjects(e,"name","value")),e&&(o.data.assessment.feedbackattachmentfiles=yield b.AddonModWorkshopHelper.getAssessmentFilesFromOfflineFilesObject(e.feedbackauthorattachmentsid,o.workshop.id,o.assessmentId))}catch{o.hasOffline=!1}finally{o.feedbackText=o.data.assessment.feedbackauthor,o.feedbackControl.setValue(o.feedbackText),o.originalData.text=o.data.assessment.feedbackauthor,o.access.canallocate&&(o.originalData.weight=o.data.assessment.weight),o.originalData.files=[],o.data.assessment.feedbackattachmentfiles.forEach((e=>{let n=a.CoreFile.getFileName(e);n||(n=r.CoreFileHelper.getFilenameFromPath(e)||""),o.originalData.files.push({filename:n,fileurl:""})}))}try{o.data.selectedValues=yield k.AddonWorkshopAssessmentStrategyDelegate.getOriginalValues(o.strategy,o.data.assessment.form,o.workshop.id)}finally{o.originalData.selectedValues=p.j.clone(o.data.selectedValues),o.edit&&(m.CoreFileSession.setFiles(v.Ug,o.workshop.id+"_"+o.assessmentId,o.data.assessment.feedbackattachmentfiles),o.access.canallocate&&(o.weight=o.data.assessment.weight))}}}))()}hasDataChanged(){var o;if(!this.assessmentStrategyLoaded||!this.workshop.strategy||!this.edit)return!1;const e=r.CoreFileHelper.restorePluginfileUrls(this.feedbackText,(null===(o=this.data.assessment)||void 0===o?void 0:o.feedbackcontentfiles)||[]);if(this.originalData.text!=e)return!0;if(this.access.canallocate&&this.originalData.weight!=this.weight)return!0;const n=m.CoreFileSession.getFiles(v.Ug,this.workshop.id+"_"+this.assessmentId)||[];return!!d.CoreFileUploader.areFileListDifferent(n,this.originalData.files)||k.AddonWorkshopAssessmentStrategyDelegate.hasDataChanged(this.workshop.strategy,this.originalData.selectedValues,this.data.selectedValues)}saveAssessment(){var o=this;return(0,s.A)((function*(){var e;if(null===(e=o.data.assessment)||void 0===e||!e.form)return;const n=m.CoreFileSession.getFiles(v.Ug,o.workshop.id+"_"+o.assessmentId)||[];let s=!1,i=!n.length;const a=yield w.CoreLoadings.show("core.sending",!0);o.data.fieldErrors={};try{var l;let e;try{e=yield b.AddonModWorkshopHelper.uploadOrStoreAssessmentFiles(o.workshop.id,o.assessmentId,n,s)}catch(t){if(S.CoreWSError.isWebServiceError(t))throw t;s=!0,i=!0,e=yield b.AddonModWorkshopHelper.uploadOrStoreAssessmentFiles(o.workshop.id,o.assessmentId,n,s)}const a=r.CoreFileHelper.restorePluginfileUrls(o.feedbackText,(null===(l=o.data.assessment)||void 0===l?void 0:l.feedbackcontentfiles)||[]);let m;try{m=yield b.AddonModWorkshopHelper.prepareAssessmentData(o.workshop,o.data.selectedValues,a,o.data.assessment.form,e)}catch(e){throw o.data.fieldErrors=e,new t.CoreError(u.HT.instant("core.errorinvalidform"))}let c=!1;s?yield I.AddonModWorkshopOffline.saveAssessment(o.workshop.id,o.assessmentId,o.workshop.course,m):c=yield g.AddonModWorkshop.updateAssessment(o.workshop.id,o.assessmentId,o.workshop.course,m,void 0,i),f.R.triggerFormSubmittedEvent(o.formElement,!!c,_.CoreSites.getCurrentSiteId());const p=[];c&&(p.push(b.AddonModWorkshopHelper.deleteAssessmentStoredFiles(o.workshop.id,o.assessmentId)),p.push(g.AddonModWorkshop.invalidateAssessmentFormData(o.workshop.id,o.assessmentId)),p.push(g.AddonModWorkshop.invalidateAssessmentData(o.workshop.id,o.assessmentId))),yield M.g.ignoreErrors(Promise.all(p)),h.z.trigger(v.Px,{workshopId:o.workshop.id,assessmentId:o.assessmentId,userId:_.CoreSites.getCurrentSiteUserId()},_.CoreSites.getCurrentSiteId()),n&&d.CoreFileUploader.clearTmpFiles(n)}catch(o){c.CoreDomUtils.showErrorModalDefault(o,"Error saving assessment.")}finally{a.dismiss()}}))()}onFeedbackChange(o){this.feedbackText=null!=o?o:""}ngOnDestroy(){var o,e;null===(o=this.obsInvalidated)||void 0===o||o.off(),null!==(e=this.data.assessment)&&void 0!==e&&e.feedbackattachmentfiles&&d.CoreFileUploader.clearTmpFiles(this.data.assessment.feedbackattachmentfiles)}}return(o=AddonModWorkshopAssessmentStrategyComponent).ɵfac=function AddonModWorkshopAssessmentStrategyComponent_Factory(e){return new(e||o)},o.ɵcmp=C.VBU({type:o,selectors:[["addon-mod-workshop-assessment-strategy"]],viewQuery:function AddonModWorkshopAssessmentStrategyComponent_Query(o,e){if(1&o&&C.GBs(j,5),2&o){let o;C.mGM(o=C.lsd())&&(e.formElement=o.first)}},inputs:{workshop:"workshop",access:"access",assessmentId:"assessmentId",userId:"userId",strategy:"strategy",edit:[C.Mj6.HasDecoratorInputTransform,"edit","edit",A.G]},features:[C.GFd],decls:9,vars:7,consts:[["assessmentForm",""],[1,"ion-padding"],["name","mma-mod_workshop-assessment-form"],[3,"hideUntil"],[4,"ngIf"],["class","core-info-card",4,"ngIf"],[3,"component","data"],[1,"core-info-card"],[1,"ion-text-wrap"],[1,"item-heading"],[3,"files","maxSize","maxSubmissions","component","componentId","allowOffline","courseId",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["position","stacked"],[3,"core-mark-required"],["contextLevel","module","elementId","feedbackauthor_editor",3,"contentChanged","control","component","componentId","autoSave","contextInstanceId","draftExtraParams"],[3,"errorText",4,"ngIf"],[3,"errorText"],[3,"files","maxSize","maxSubmissions","component","componentId","allowOffline","courseId"],["labelPlacement","stacked","interface","action-sheet","name","weight",3,"ngModelChange","ngModel","cancelText","interfaceOptions"],["slot","label",3,"core-mark-required"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[3,"files","component","componentId"]],template:function AddonModWorkshopAssessmentStrategyComponent_Template(o,e){1&o&&(C.j41(0,"h2",1),C.EFF(1),C.nI1(2,"translate"),C.k0s(),C.j41(3,"form",2,0)(5,"core-loading",3),C.DNE(6,AddonModWorkshopAssessmentStrategyComponent_ng_container_6_Template,2,2,"ng-container",4)(7,AddonModWorkshopAssessmentStrategyComponent_ion_card_7_Template,6,6,"ion-card",5)(8,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_Template,11,8,"ion-card",4),C.k0s()()),2&o&&(C.R7$(),C.JRh(C.bMT(2,5,"addon.mod_workshop.assessmentform")),C.R7$(4),C.Y8G("hideUntil",e.assessmentStrategyLoaded),C.R7$(),C.Y8G("ngIf",e.componentClass&&e.assessmentStrategyLoaded),C.R7$(),C.Y8G("ngIf",e.notSupported),C.R7$(),C.Y8G("ngIf",e.assessmentStrategyLoaded&&e.overallFeedkback&&(e.edit||(null==e.data.assessment?null:e.data.assessment.feedbackauthor)||(null==e.data.assessment||null==e.data.assessment.feedbackattachmentfiles?null:e.data.assessment.feedbackattachmentfiles.length))))},dependencies:[W.Sq,W.bT,G.V,R.m,x.Y,y.q,$.R,F.j,E.B,i.qT,i.BC,i.cb,i.vS,i.cV,P.b_,P.uz,P.he,P.Nm,P.Ip,P.Je,Y.u,D.D9],encapsulation:2}),AddonModWorkshopAssessmentStrategyComponent})()},48049:(o,e,n)=>{n.r(e),n.d(e,{AddonModWorkshopIndexComponent:()=>Y});var s=n(10467),i=n(75629),t=n(69006),d=n(15221),a=n(15324),r=n(18022),m=n(6319),_=n(58364),l=n(49882),c=n(67193),p=n(80178),u=n(26327),h=n(36553),f=n(81552),k=n(55554),g=n(86552),b=n(54438),I=n(73465),v=n(51024),A=n(60177),w=n(69502),M=n(17388),S=n(97818),T=n(64422),C=n(13988),W=n(86198),G=n(58197),R=n(35407),x=n(66731),y=n(43570),$=n(6736),F=n(30864),E=n(61919),P=n(73955);const _c0=()=>[];function AddonModWorkshopIndexComponent_Conditional_1_Template(o,e){if(1&o){const o=b.RV6();b.j41(0,"ion-button",6),b.nI1(1,"translate"),b.bIt("click",(function AddonModWorkshopIndexComponent_Conditional_1_Template_ion_button_click_0_listener(){b.eBV(o);const e=b.XpG();return b.Njj(e.openModuleSummary())})),b.nrm(2,"ion-icon",7),b.k0s()}2&o&&b.Y8G("ariaLabel",b.bMT(1,1,"core.info"))}function AddonModWorkshopIndexComponent_Conditional_2_Template(o,e){if(1&o){const o=b.RV6();b.j41(0,"core-context-menu")(1,"core-context-menu-item",8),b.nI1(2,"translate"),b.bIt("action",(function AddonModWorkshopIndexComponent_Conditional_2_Template_core_context_menu_item_action_1_listener(){b.eBV(o);const e=b.XpG();return b.Njj(e.openModuleSummary())})),b.k0s()()}2&o&&(b.R7$(),b.Y8G("priority",5e3)("content",b.bMT(2,2,"core.info")))}function AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_ion_icon_1_Template(o,e){1&o&&(b.nrm(0,"ion-icon",20),b.nI1(1,"translate")),2&o&&b.BMQ("aria-label",b.bMT(1,1,"addon.mod_workshop.tasktodo"))}function AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_ion_icon_2_Template(o,e){1&o&&(b.nrm(0,"ion-icon",21),b.nI1(1,"translate")),2&o&&b.BMQ("aria-label",b.bMT(1,1,"addon.mod_workshop.taskfail"))}function AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_ion_icon_3_Template(o,e){1&o&&(b.nrm(0,"ion-icon",22),b.nI1(1,"translate")),2&o&&b.BMQ("aria-label",b.bMT(1,1,"addon.mod_workshop.taskinfo"))}function AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_ion_icon_4_Template(o,e){1&o&&(b.nrm(0,"ion-icon",23),b.nI1(1,"translate")),2&o&&b.BMQ("aria-label",b.bMT(1,1,"addon.mod_workshop.taskdone"))}function AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_p_8_Template(o,e){if(1&o&&b.nrm(0,"p",24),2&o){const o=b.XpG().$implicit;b.Y8G("innerHTML",o.details,b.npT)}}function AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_ion_icon_9_Template(o,e){1&o&&b.nrm(0,"ion-icon",25)}function AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_Template(o,e){if(1&o){const o=b.RV6();b.j41(0,"ion-item",12),b.bIt("click",(function AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_Template_ion_item_click_0_listener(){const e=b.eBV(o).$implicit,n=b.XpG(3);return b.Njj(n.runTask(e))})),b.DNE(1,AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_ion_icon_1_Template,2,3,"ion-icon",13)(2,AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_ion_icon_2_Template,2,3,"ion-icon",14)(3,AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_ion_icon_3_Template,2,3,"ion-icon",15)(4,AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_ion_icon_4_Template,2,3,"ion-icon",16),b.j41(5,"ion-label")(6,"p",17),b.EFF(7),b.k0s(),b.DNE(8,AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_p_8_Template,1,1,"p",18),b.k0s(),b.DNE(9,AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_ion_icon_9_Template,1,0,"ion-icon",19),b.k0s()}if(2&o){const o=e.$implicit,n=b.XpG(3);b.AVh("item-dimmed","submit"===o.code&&!n.showSubmit),b.Y8G("detail",!1),b.R7$(),b.Y8G("ngIf",null===o.completed),b.R7$(),b.Y8G("ngIf",""===o.completed),b.R7$(),b.Y8G("ngIf","info"===o.completed),b.R7$(),b.Y8G("ngIf","1"===o.completed),b.R7$(3),b.JRh(o.title),b.R7$(),b.Y8G("ngIf",o.details),b.R7$(),b.Y8G("ngIf",o.link&&"submit"!==o.code)}}function AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_Template(o,e){if(1&o&&(b.qex(0),b.DNE(1,AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_ion_item_1_Template,10,10,"ion-item",11),b.bVm()),2&o){const o=b.XpG(2);b.R7$(),b.Y8G("ngForOf",o.phases[o.workshop.phase].tasks)}}function AddonModWorkshopIndexComponent_ion_card_5_Template(o,e){if(1&o){const o=b.RV6();b.j41(0,"ion-card")(1,"ion-item",9),b.bIt("click",(function AddonModWorkshopIndexComponent_ion_card_5_Template_ion_item_click_1_listener(){b.eBV(o);const e=b.XpG();return b.Njj(e.viewPhaseInfo())})),b.j41(2,"ion-label")(3,"h2",10),b.EFF(4),b.k0s()()(),b.DNE(5,AddonModWorkshopIndexComponent_ion_card_5_ng_container_5_Template,2,1,"ng-container",4),b.k0s()}if(2&o){const o=b.XpG();b.R7$(),b.Y8G("detail",!0),b.R7$(3),b.JRh(o.phases[o.workshop.phase].title),b.R7$(),b.Y8G("ngIf",o.phases&&o.phases[o.workshop.phase]&&o.phases[o.workshop.phase].tasks&&o.phases[o.workshop.phase].tasks.length)}}function AddonModWorkshopIndexComponent_ion_card_6_Template(o,e){if(1&o&&(b.j41(0,"ion-card")(1,"ion-item",10)(2,"ion-label")(3,"h3",17),b.EFF(4),b.nI1(5,"translate"),b.k0s(),b.nrm(6,"core-format-text",26),b.k0s()()()),2&o){const o=b.XpG();b.R7$(4),b.JRh(b.bMT(5,6,"core.description")),b.R7$(2),b.Y8G("text",o.description)("component",o.component)("componentId",o.componentId)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopIndexComponent_div_7_ng_container_1_ion_card_1_Template(o,e){if(1&o&&(b.j41(0,"ion-card")(1,"ion-item",10)(2,"ion-label")(3,"h3",17),b.EFF(4),b.nI1(5,"translate"),b.k0s(),b.nrm(6,"core-format-text",27),b.k0s()()()),2&o){const o=b.XpG(3);b.R7$(4),b.JRh(b.bMT(5,6,"addon.mod_workshop.conclusion")),b.R7$(2),b.Y8G("component",o.component)("componentId",o.module.id)("text",o.workshop.conclusion)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopIndexComponent_div_7_ng_container_1_ion_card_2_ion_item_6_Template(o,e){if(1&o&&(b.j41(0,"ion-item",10)(1,"ion-label")(2,"p",17),b.EFF(3),b.nI1(4,"translate"),b.k0s(),b.j41(5,"p"),b.EFF(6),b.k0s()()()),2&o){const o=b.XpG(4);b.R7$(3),b.JRh(b.bMT(4,2,"addon.mod_workshop.submissiongrade")),b.R7$(3),b.JRh(o.userGrades.submissionlongstrgrade)}}function AddonModWorkshopIndexComponent_div_7_ng_container_1_ion_card_2_ion_item_7_Template(o,e){if(1&o&&(b.j41(0,"ion-item",10)(1,"ion-label")(2,"p",17),b.EFF(3),b.nI1(4,"translate"),b.k0s(),b.j41(5,"p"),b.EFF(6),b.k0s()()()),2&o){const o=b.XpG(4);b.R7$(3),b.JRh(b.bMT(4,2,"addon.mod_workshop.gradinggrade")),b.R7$(3),b.JRh(o.userGrades.assessmentlongstrgrade)}}function AddonModWorkshopIndexComponent_div_7_ng_container_1_ion_card_2_Template(o,e){if(1&o&&(b.j41(0,"ion-card")(1,"ion-item-divider",10)(2,"ion-label")(3,"h3",17),b.EFF(4),b.nI1(5,"translate"),b.k0s()()(),b.DNE(6,AddonModWorkshopIndexComponent_div_7_ng_container_1_ion_card_2_ion_item_6_Template,7,4,"ion-item",28)(7,AddonModWorkshopIndexComponent_div_7_ng_container_1_ion_card_2_ion_item_7_Template,7,4,"ion-item",28),b.k0s()),2&o){const o=b.XpG(3);b.R7$(4),b.JRh(b.bMT(5,3,"addon.mod_workshop.yourgrades")),b.R7$(2),b.Y8G("ngIf",o.userGrades.submissionlongstrgrade),b.R7$(),b.Y8G("ngIf",o.userGrades.assessmentlongstrgrade)}}function AddonModWorkshopIndexComponent_div_7_ng_container_1_Template(o,e){if(1&o&&(b.qex(0),b.DNE(1,AddonModWorkshopIndexComponent_div_7_ng_container_1_ion_card_1_Template,7,8,"ion-card",4)(2,AddonModWorkshopIndexComponent_div_7_ng_container_1_ion_card_2_Template,8,5,"ion-card",4),b.bVm()),2&o){const o=b.XpG(2);b.R7$(),b.Y8G("ngIf",o.workshop.conclusion),b.R7$(),b.Y8G("ngIf",o.userGrades)}}function AddonModWorkshopIndexComponent_div_7_ion_card_2_Template(o,e){if(1&o&&(b.j41(0,"ion-card")(1,"ion-item",10)(2,"ion-label")(3,"h3",17),b.EFF(4),b.nI1(5,"translate"),b.k0s(),b.nrm(6,"core-format-text",27),b.k0s()()()),2&o){const o=b.XpG(2);b.R7$(4),b.JRh(b.bMT(5,6,"addon.mod_workshop.areainstructauthors")),b.R7$(2),b.Y8G("component",o.component)("componentId",o.module.id)("text",o.workshop.instructauthors)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopIndexComponent_div_7_ion_card_3_h3_3_Template(o,e){1&o&&(b.j41(0,"h3",17),b.EFF(1),b.nI1(2,"translate"),b.k0s()),2&o&&(b.R7$(),b.SpI(" ",b.bMT(2,1,"addon.mod_workshop.yoursubmission")," "))}function AddonModWorkshopIndexComponent_div_7_ion_card_3_h3_4_Template(o,e){1&o&&(b.j41(0,"h3",17),b.EFF(1),b.nI1(2,"translate"),b.k0s()),2&o&&(b.R7$(),b.SpI(" ",b.bMT(2,1,"addon.mod_workshop.yoursubmissionwithassessments")," "))}function AddonModWorkshopIndexComponent_div_7_ion_card_3_ion_item_5_p_2_Template(o,e){1&o&&(b.j41(0,"p"),b.EFF(1),b.nI1(2,"translate"),b.k0s()),2&o&&(b.R7$(),b.JRh(b.bMT(2,1,"addon.mod_workshop.noyoursubmission")))}function AddonModWorkshopIndexComponent_div_7_ion_card_3_ion_item_5_Template(o,e){if(1&o&&(b.j41(0,"ion-item",10)(1,"ion-label"),b.DNE(2,AddonModWorkshopIndexComponent_div_7_ion_card_3_ion_item_5_p_2_Template,3,3,"p",4),b.k0s()()),2&o){const o=b.XpG(3);b.R7$(2),b.Y8G("ngIf",!o.submission)}}function AddonModWorkshopIndexComponent_div_7_ion_card_3_addon_mod_workshop_submission_6_Template(o,e){if(1&o&&b.nrm(0,"addon-mod-workshop-submission",31),2&o){const o=b.XpG(3);b.Y8G("submission",o.submission)("courseId",o.workshop.course)("module",o.module)("workshop",o.workshop)("access",o.access)}}function AddonModWorkshopIndexComponent_div_7_ion_card_3_Template(o,e){if(1&o&&(b.j41(0,"ion-card")(1,"ion-item-divider",10)(2,"ion-label"),b.DNE(3,AddonModWorkshopIndexComponent_div_7_ion_card_3_h3_3_Template,3,3,"h3",29)(4,AddonModWorkshopIndexComponent_div_7_ion_card_3_h3_4_Template,3,3,"h3",29),b.k0s()(),b.DNE(5,AddonModWorkshopIndexComponent_div_7_ion_card_3_ion_item_5_Template,3,1,"ion-item",28)(6,AddonModWorkshopIndexComponent_div_7_ion_card_3_addon_mod_workshop_submission_6_Template,1,5,"addon-mod-workshop-submission",30),b.k0s()),2&o){const o=b.XpG(2);b.R7$(3),b.Y8G("ngIf",o.workshop.phase!==o.PHASE_CLOSED||!o.submission),b.R7$(),b.Y8G("ngIf",o.workshop.phase===o.PHASE_CLOSED&&o.submission),b.R7$(),b.Y8G("ngIf",!o.submission),b.R7$(),b.Y8G("ngIf",o.submission)}}function AddonModWorkshopIndexComponent_div_7_ng_container_4_ion_card_1_ng_container_6_Template(o,e){if(1&o&&(b.qex(0),b.nrm(1,"addon-mod-workshop-submission",33),b.bVm()),2&o){const o=e.$implicit,n=b.XpG(4);b.R7$(),b.Y8G("submission",o)("courseId",n.workshop.course)("module",n.module)("workshop",n.workshop)("access",n.access)}}function AddonModWorkshopIndexComponent_div_7_ng_container_4_ion_card_1_Template(o,e){if(1&o&&(b.j41(0,"ion-card")(1,"ion-item-divider",10)(2,"ion-label")(3,"h3",17),b.EFF(4),b.nI1(5,"translate"),b.k0s()()(),b.DNE(6,AddonModWorkshopIndexComponent_div_7_ng_container_4_ion_card_1_ng_container_6_Template,2,5,"ng-container",32),b.k0s()),2&o){const o=b.XpG(3);b.R7$(4),b.JRh(b.bMT(5,2,"addon.mod_workshop.publishedsubmissions")),b.R7$(2),b.Y8G("ngForOf",o.publishedSubmissions)}}function AddonModWorkshopIndexComponent_div_7_ng_container_4_Template(o,e){if(1&o&&(b.qex(0),b.DNE(1,AddonModWorkshopIndexComponent_div_7_ng_container_4_ion_card_1_Template,7,4,"ion-card",4),b.bVm()),2&o){const o=b.XpG(2);b.R7$(),b.Y8G("ngIf",o.publishedSubmissions&&o.publishedSubmissions.length)}}function AddonModWorkshopIndexComponent_div_7_ng_container_5_ion_card_1_Template(o,e){if(1&o&&(b.j41(0,"ion-card")(1,"ion-item",10)(2,"ion-label")(3,"h3",17),b.EFF(4),b.nI1(5,"translate"),b.k0s(),b.nrm(6,"core-format-text",27),b.k0s()()()),2&o){const o=b.XpG(3);b.R7$(4),b.JRh(b.bMT(5,6,"addon.mod_workshop.areainstructreviewers")),b.R7$(2),b.Y8G("component",o.component)("componentId",o.module.id)("text",o.workshop.instructreviewers)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopIndexComponent_div_7_ng_container_5_ion_card_2_ion_item_6_Template(o,e){1&o&&(b.j41(0,"ion-item",10)(1,"ion-label")(2,"p"),b.EFF(3),b.nI1(4,"translate"),b.k0s()()()),2&o&&(b.R7$(3),b.JRh(b.bMT(4,1,"addon.mod_workshop.assignedassessmentsnone")))}function AddonModWorkshopIndexComponent_div_7_ng_container_5_ion_card_2_ng_container_7_Template(o,e){if(1&o&&(b.qex(0),b.nrm(1,"addon-mod-workshop-submission",34),b.bVm()),2&o){const o=e.$implicit,n=b.XpG(4);b.R7$(),b.Y8G("submission",o.submission)("assessment",o)("courseId",n.workshop.course)("module",n.module)("workshop",n.workshop)("access",n.access)}}function AddonModWorkshopIndexComponent_div_7_ng_container_5_ion_card_2_Template(o,e){if(1&o&&(b.j41(0,"ion-card")(1,"ion-item-divider",10)(2,"ion-label")(3,"h3",17),b.EFF(4),b.nI1(5,"translate"),b.k0s()()(),b.DNE(6,AddonModWorkshopIndexComponent_div_7_ng_container_5_ion_card_2_ion_item_6_Template,5,3,"ion-item",28)(7,AddonModWorkshopIndexComponent_div_7_ng_container_5_ion_card_2_ng_container_7_Template,2,6,"ng-container",32),b.k0s()),2&o){const o=b.XpG(3);b.R7$(4),b.JRh(b.bMT(5,3,"addon.mod_workshop.assignedassessments")),b.R7$(2),b.Y8G("ngIf",!o.assessments||!o.assessments.length),b.R7$(),b.Y8G("ngForOf",o.assessments||b.lJ4(5,_c0))}}function AddonModWorkshopIndexComponent_div_7_ng_container_5_Template(o,e){if(1&o&&(b.qex(0),b.DNE(1,AddonModWorkshopIndexComponent_div_7_ng_container_5_ion_card_1_Template,7,8,"ion-card",4)(2,AddonModWorkshopIndexComponent_div_7_ng_container_5_ion_card_2_Template,8,6,"ion-card",4),b.bVm()),2&o){const o=b.XpG(2);b.R7$(),b.Y8G("ngIf",o.workshop.phase===o.PHASE_ASSESSMENT&&o.workshop.instructreviewers),b.R7$(),b.Y8G("ngIf",o.canAssess)}}function AddonModWorkshopIndexComponent_div_7_ion_card_6_h3_3_Template(o,e){1&o&&(b.j41(0,"h3",17),b.EFF(1),b.nI1(2,"translate"),b.k0s()),2&o&&(b.R7$(),b.JRh(b.bMT(2,1,"addon.mod_workshop.submissionsreport")))}function AddonModWorkshopIndexComponent_div_7_ion_card_6_h3_4_Template(o,e){1&o&&(b.j41(0,"h3",17),b.EFF(1),b.nI1(2,"translate"),b.k0s()),2&o&&(b.R7$(),b.SpI("",b.bMT(2,1,"addon.mod_workshop.gradesreport")," "))}function AddonModWorkshopIndexComponent_div_7_ion_card_6_ng_container_6_Template(o,e){if(1&o&&(b.qex(0),b.nrm(1,"addon-mod-workshop-submission",33),b.bVm()),2&o){const o=e.$implicit,n=b.XpG(3);b.R7$(),b.Y8G("submission",o)("courseId",n.workshop.course)("module",n.module)("workshop",n.workshop)("access",n.access)}}function AddonModWorkshopIndexComponent_div_7_ion_card_6_ion_grid_7_ion_col_2_Template(o,e){if(1&o){const o=b.RV6();b.j41(0,"ion-col")(1,"ion-button",37),b.bIt("click",(function AddonModWorkshopIndexComponent_div_7_ion_card_6_ion_grid_7_ion_col_2_Template_ion_button_click_1_listener(){b.eBV(o);const e=b.XpG(4);return b.Njj(e.gotoSubmissionsPage(e.page-1))})),b.nrm(2,"ion-icon",38),b.EFF(3),b.nI1(4,"translate"),b.k0s()()}2&o&&(b.R7$(3),b.SpI(" ",b.bMT(4,1,"core.previous")," "))}function AddonModWorkshopIndexComponent_div_7_ion_card_6_ion_grid_7_ion_col_3_Template(o,e){if(1&o){const o=b.RV6();b.j41(0,"ion-col")(1,"ion-button",39),b.bIt("click",(function AddonModWorkshopIndexComponent_div_7_ion_card_6_ion_grid_7_ion_col_3_Template_ion_button_click_1_listener(){b.eBV(o);const e=b.XpG(4);return b.Njj(e.gotoSubmissionsPage(e.page+1))})),b.EFF(2),b.nI1(3,"translate"),b.nrm(4,"ion-icon",40),b.k0s()()}2&o&&(b.R7$(2),b.SpI(" ",b.bMT(3,1,"core.next")," "))}function AddonModWorkshopIndexComponent_div_7_ion_card_6_ion_grid_7_Template(o,e){if(1&o&&(b.j41(0,"ion-grid")(1,"ion-row",36),b.DNE(2,AddonModWorkshopIndexComponent_div_7_ion_card_6_ion_grid_7_ion_col_2_Template,5,3,"ion-col",4)(3,AddonModWorkshopIndexComponent_div_7_ion_card_6_ion_grid_7_ion_col_3_Template,5,3,"ion-col",4),b.k0s()()),2&o){const o=b.XpG(3);b.R7$(2),b.Y8G("ngIf",o.page>0),b.R7$(),b.Y8G("ngIf",o.hasNextPage)}}function AddonModWorkshopIndexComponent_div_7_ion_card_6_Template(o,e){if(1&o){const o=b.RV6();b.j41(0,"ion-card")(1,"ion-item-divider",10)(2,"ion-label"),b.DNE(3,AddonModWorkshopIndexComponent_div_7_ion_card_6_h3_3_Template,3,3,"h3",29)(4,AddonModWorkshopIndexComponent_div_7_ion_card_6_h3_4_Template,3,3,"h3",29),b.k0s()(),b.j41(5,"core-group-selector",35),b.mxI("selectedChange",(function AddonModWorkshopIndexComponent_div_7_ion_card_6_Template_core_group_selector_selectedChange_5_listener(e){b.eBV(o);const n=b.XpG(2);return b.DH7(n.group,e)||(n.group=e),b.Njj(e)})),b.bIt("selectedChange",(function AddonModWorkshopIndexComponent_div_7_ion_card_6_Template_core_group_selector_selectedChange_5_listener(){b.eBV(o);const e=b.XpG(2);return b.Njj(e.setGroup(e.group))})),b.k0s(),b.DNE(6,AddonModWorkshopIndexComponent_div_7_ion_card_6_ng_container_6_Template,2,5,"ng-container",32)(7,AddonModWorkshopIndexComponent_div_7_ion_card_6_ion_grid_7_Template,4,2,"ion-grid",4),b.k0s()}if(2&o){const o=b.XpG(2);b.R7$(3),b.Y8G("ngIf",o.workshop.phase===o.PHASE_SUBMISSION),b.R7$(),b.Y8G("ngIf",o.workshop.phase>o.PHASE_SUBMISSION),b.R7$(),b.Y8G("groupInfo",o.groupInfo),b.R50("selected",o.group),b.Y8G("courseId",o.courseId),b.R7$(),b.Y8G("ngForOf",o.grades),b.R7$(),b.Y8G("ngIf",o.page>0||o.hasNextPage)}}function AddonModWorkshopIndexComponent_div_7_Template(o,e){if(1&o&&(b.j41(0,"div"),b.DNE(1,AddonModWorkshopIndexComponent_div_7_ng_container_1_Template,3,2,"ng-container",4)(2,AddonModWorkshopIndexComponent_div_7_ion_card_2_Template,7,8,"ion-card",4)(3,AddonModWorkshopIndexComponent_div_7_ion_card_3_Template,7,4,"ion-card",4)(4,AddonModWorkshopIndexComponent_div_7_ng_container_4_Template,2,1,"ng-container",4)(5,AddonModWorkshopIndexComponent_div_7_ng_container_5_Template,3,2,"ng-container",4)(6,AddonModWorkshopIndexComponent_div_7_ion_card_6_Template,8,7,"ion-card",4),b.k0s()),2&o){const o=b.XpG();b.R7$(),b.Y8G("ngIf",o.workshop.phase>=o.PHASE_CLOSED),b.R7$(),b.Y8G("ngIf",o.workshop.phase===o.PHASE_SUBMISSION&&o.workshop.instructauthors),b.R7$(),b.Y8G("ngIf",o.canSubmit),b.R7$(),b.Y8G("ngIf",o.workshop.phase>=o.PHASE_CLOSED),b.R7$(),b.Y8G("ngIf",o.workshop.phase>=o.PHASE_ASSESSMENT),b.R7$(),b.Y8G("ngIf",o.access.canviewallsubmissions&&o.workshop.phase>=o.PHASE_SUBMISSION&&(o.grades&&o.grades.length||o.groupInfo&&(o.groupInfo.separateGroups||o.groupInfo.visibleGroups)))}}function AddonModWorkshopIndexComponent_div_8_div_1_ion_button_1_Template(o,e){if(1&o){const o=b.RV6();b.j41(0,"ion-button",46),b.bIt("click",(function AddonModWorkshopIndexComponent_div_8_div_1_ion_button_1_Template_ion_button_click_0_listener(){b.eBV(o);const e=b.XpG(3);return b.Njj(e.gotoSubmit())})),b.nrm(1,"ion-icon",47),b.EFF(2),b.nI1(3,"translate"),b.k0s()}2&o&&(b.R7$(2),b.SpI(" ",b.bMT(3,1,"addon.mod_workshop.createsubmission")," "))}function AddonModWorkshopIndexComponent_div_8_div_1_ion_button_2_Template(o,e){if(1&o){const o=b.RV6();b.j41(0,"ion-button",46),b.bIt("click",(function AddonModWorkshopIndexComponent_div_8_div_1_ion_button_2_Template_ion_button_click_0_listener(){b.eBV(o);const e=b.XpG(3);return b.Njj(e.gotoSubmit())})),b.nrm(1,"ion-icon",48),b.EFF(2),b.nI1(3,"translate"),b.k0s()}2&o&&(b.R7$(2),b.SpI(" ",b.bMT(3,1,"addon.mod_workshop.editsubmission")," "))}function AddonModWorkshopIndexComponent_div_8_div_1_Template(o,e){if(1&o&&(b.j41(0,"div",44),b.DNE(1,AddonModWorkshopIndexComponent_div_8_div_1_ion_button_1_Template,4,3,"ion-button",45)(2,AddonModWorkshopIndexComponent_div_8_div_1_ion_button_2_Template,4,3,"ion-button",45),b.k0s()),2&o){const o=b.XpG(2);b.R7$(),b.Y8G("ngIf",o.access.creatingsubmissionallowed&&!o.submission),b.R7$(),b.Y8G("ngIf",o.access.modifyingsubmissionallowed&&o.submission)}}function AddonModWorkshopIndexComponent_div_8_Template(o,e){if(1&o&&(b.j41(0,"div",41),b.DNE(1,AddonModWorkshopIndexComponent_div_8_div_1_Template,3,2,"div",42),b.nrm(2,"core-course-module-navigation",43),b.k0s()),2&o){const o=b.XpG();b.R7$(),b.Y8G("ngIf",o.access&&(null==o.workshop?null:o.workshop.phase)>=o.PHASE_SUBMISSION&&o.canSubmit&&o.showSubmit&&(o.access.creatingsubmissionallowed&&!o.submission||o.access.modifyingsubmissionallowed&&o.submission)),b.R7$(),b.Y8G("courseId",o.courseId)("currentModuleId",o.module.id)}}let Y=(()=>{var o;class AddonModWorkshopIndexComponent extends t.y{constructor(o,e){super("AddonModWorkshopIndexComponent",o,e),this.group=0,this.component=f.Ug,this.pluginName="workshop",this.page=0,this.grades=[],this.assessments=[],this.publishedSubmissions=[],this.groupInfo={groups:[],separateGroups:!1,visibleGroups:!1,defaultGroupId:0,canAccessAllGroups:!1},this.canSubmit=!1,this.showSubmit=!1,this.canAssess=!1,this.hasNextPage=!1,this.PHASE_SETUP=10,this.PHASE_SUBMISSION=20,this.PHASE_ASSESSMENT=30,this.PHASE_EVALUATION=40,this.PHASE_CLOSED=50,this.offlineSubmissions=[],this.syncEventName=f.N7,this.obsSubmissionChanged=l.z.on(f.AZ,(o=>{this.eventReceived(o)}),this.siteId),this.obsAssessmentSaved=l.z.on(f.Px,(o=>{this.eventReceived(o)}),this.siteId),this.appResumeSubscription=r.CorePlatform.resume.subscribe((()=>{this.showLoadingAndRefresh(!0)})),this.syncObserver=l.z.on(f.N7,(o=>{this.eventReceived(o)}),this.siteId)}ngOnInit(){var _superprop_getNgOnInit=()=>super.ngOnInit,o=this;return(0,s.A)((function*(){_superprop_getNgOnInit().call(o),yield o.loadContent(!1,!0)}))()}eventReceived(o){var e;(null===(e=this.workshop)||void 0===e?void 0:e.id)===o.workshopId&&(this.showLoadingAndRefresh(!0),this.checkCompletion())}invalidateContent(){var o=this;return(0,s.A)((function*(){const e=[];var n;(e.push(c.AddonModWorkshop.invalidateWorkshopData(o.courseId)),o.workshop)&&(e.push(c.AddonModWorkshop.invalidateWorkshopAccessInformationData(o.workshop.id)),e.push(c.AddonModWorkshop.invalidateUserPlanPhasesData(o.workshop.id)),o.canSubmit&&e.push(c.AddonModWorkshop.invalidateSubmissionsData(o.workshop.id)),null!==(n=o.access)&&void 0!==n&&n.canviewallsubmissions&&(e.push(c.AddonModWorkshop.invalidateGradeReportData(o.workshop.id)),e.push(d.CoreGroups.invalidateActivityAllowedGroups(o.workshop.coursemodule)),e.push(d.CoreGroups.invalidateActivityGroupMode(o.workshop.coursemodule))),o.canAssess&&e.push(c.AddonModWorkshop.invalidateReviewerAssesmentsData(o.workshop.id)),e.push(c.AddonModWorkshop.invalidateGradesData(o.workshop.id)),e.push(c.AddonModWorkshop.invalidateWorkshopWSData(o.workshop.id)));yield Promise.all(e)}))()}isRefreshSyncNeeded(o){var e;return!(!this.workshop||o.workshopId!=this.workshop.id)&&(null===(e=this.content)||void 0===e||e.scrollToTop(),!0)}fetchContent(o,e=!1,n=!1){var i=this;return(0,s.A)((function*(){i.workshop=yield c.AddonModWorkshop.getWorkshop(i.courseId,i.module.id),i.description=i.workshop.intro,i.dataRetrieved.emit(i.workshop),e&&(yield i.syncActivity(n)),i.access=yield c.AddonModWorkshop.getWorkshopAccessInformation(i.workshop.id,{cmId:i.module.id}),i.access.canviewallsubmissions&&(i.groupInfo=yield d.CoreGroups.getActivityGroupInfo(i.workshop.coursemodule),i.group=d.CoreGroups.validateGroupId(i.group,i.groupInfo)),i.phases=yield c.AddonModWorkshop.getUserPlanPhases(i.workshop.id,{cmId:i.module.id}),i.phases[i.workshop.phase].tasks.forEach((o=>{o.link||"examples"!=o.code&&"prepareexamples"!=o.code||(o.link=i.module.url||"")})),i.hasOffline=yield u.AddonModWorkshopOffline.hasWorkshopOfflineData(i.workshop.id),i.offlineSubmissions=i.hasOffline?yield u.AddonModWorkshopOffline.getSubmissions(i.workshop.id):[],yield i.setPhaseInfo()}))()}logActivity(){var o=this;return(0,s.A)((function*(){o.workshop&&(yield k.g.ignoreErrors(c.AddonModWorkshop.logView(o.workshop.id)),o.analyticsLogEvent("mod_workshop_view_workshop"))}))()}gotoSubmissionsPage(o){var e=this;return(0,s.A)((function*(){if(!e.workshop)return;const n=e.workshop,i=yield c.AddonModWorkshop.getGradesReport(n.id,{groupId:e.group,page:o,cmId:e.module.id}),t=i&&i.grades&&i.grades.length||0;e.page=o,e.hasNextPage=t>=f.Cy&&(e.page+1)*f.Cy<i.totalcount;const d=i.grades||[];e.grades=[],yield Promise.all(d.map(function(){var o=(0,s.A)((function*(o){const s={id:o.submissionid||0,workshopid:n.id,example:!1,authorid:o.userid,timecreated:o.submissionmodified||0,timemodified:o.submissionmodified||0,title:o.submissiontitle||"",content:"",contenttrust:0,attachment:0,grade:o.submissiongrade,gradeover:o.submissiongradeover,gradeoverby:o.submissiongradeoverby,published:!!o.submissionpublished,gradinggrade:o.gradinggrade,late:0,reviewedby:e.parseReviewer(o.reviewedby),reviewerof:e.parseReviewer(o.reviewerof)};var i,t,d,a;30==n.phase&&(s.reviewedbydone=(null===(i=o.reviewedby)||void 0===i?void 0:i.reduce(((o,e)=>o+(e.grade?1:0)),0))||0,s.reviewerofdone=(null===(t=o.reviewerof)||void 0===t?void 0:t.reduce(((o,e)=>o+(e.grade?1:0)),0))||0,s.reviewedbycount=(null===(d=o.reviewedby)||void 0===d?void 0:d.length)||0,s.reviewerofcount=(null===(a=o.reviewerof)||void 0===a?void 0:a.length)||0);const r=yield p.AddonModWorkshopHelper.applyOfflineData(s,e.offlineSubmissions);void 0!==r&&e.grades.push(r)}));return function(e){return o.apply(this,arguments)}}()))}))()}parseReviewer(o=[]){return o.map((o=>({grade:o.grade,gradinggrade:o.gradinggrade,gradinggradeover:o.gradinggradeover,id:o.assessmentid,reviewerid:o.userid,submissionid:o.submissionid,weight:o.weight,timecreated:0,timemodified:0,feedbackauthor:"",gradinggradeoverby:0,feedbackattachmentfiles:[],feedbackcontentfiles:[],feedbackauthorattachment:0})))}runTask(o){var e=this;return(0,s.A)((function*(){"submit"==o.code?e.gotoSubmit():o.link&&g.j.openInBrowser(o.link)}))()}gotoSubmit(){if(this.canSubmit&&this.access&&(this.access.creatingsubmissionallowed&&!this.submission||this.access.modifyingsubmissionallowed&&this.submission)){var o;const e=(null===(o=this.submission)||void 0===o?void 0:o.id)||0;a.CoreNavigator.navigateToSitePath(`${f.q3}/${this.courseId}/${this.module.id}/${e}/edit`,{params:{module:this.module,access:this.access}})}}viewPhaseInfo(){var o=this;return(0,s.A)((function*(){if(!o.phases||!o.workshop)return;const{AddonModWorkshopPhaseInfoModalComponent:e}=yield n.e(9489).then(n.bind(n,69489));!0===(yield m.I.openModal({component:e,componentProps:{phases:_.T.toArray(o.phases),workshopPhase:o.workshop.phase,externalUrl:o.module.url,showSubmit:o.showSubmit}}))&&o.gotoSubmit()}))()}setGroup(o){var e=this;return(0,s.A)((function*(){e.group=o,yield e.gotoSubmissionsPage(0)}))()}setPhaseInfo(){var o=this;return(0,s.A)((function*(){if(!o.phases||!o.workshop||!o.access)return;o.submission=void 0,o.canAssess=!1,o.assessments=[],o.userGrades=void 0,o.publishedSubmissions=[];const e=o.workshop;o.canSubmit=p.AddonModWorkshopHelper.canSubmit(o.workshop,o.access,o.phases[20].tasks),o.showSubmit=o.canSubmit&&(o.access.creatingsubmissionallowed&&!o.submission||o.access.modifyingsubmissionallowed&&!!o.submission);const n=[];o.canSubmit&&n.push(p.AddonModWorkshopHelper.getUserSubmission(o.workshop.id,{cmId:o.module.id}).then(function(){var e=(0,s.A)((function*(e){o.submission=yield p.AddonModWorkshopHelper.applyOfflineData(e,o.offlineSubmissions)}));return function(o){return e.apply(this,arguments)}}())),o.access.canviewallsubmissions&&o.workshop.phase>=20&&n.push(o.gotoSubmissionsPage(o.page));let i=Promise.resolve();o.workshop.phase>=30&&(o.canAssess=p.AddonModWorkshopHelper.canAssess(o.workshop,o.access),o.canAssess&&(i=p.AddonModWorkshopHelper.getReviewerAssessments(o.workshop.id,{cmId:o.module.id}).then(function(){var n=(0,s.A)((function*(n){yield Promise.all(n.map(function(){var n=(0,s.A)((function*(n){if(n.strategy=e.strategy,o.hasOffline)try{const o=yield u.AddonModWorkshopOffline.getAssessment(e.id,n.id);n.offline=!0,n.timemodified=Math.floor(o.timemodified/1e3)}catch{}}));return function(o){return n.apply(this,arguments)}}())),o.assessments=n}));return function(o){return n.apply(this,arguments)}}()))),50===o.workshop.phase&&(n.push(c.AddonModWorkshop.getGrades(o.workshop.id,{cmId:o.module.id}).then((e=>{o.userGrades=e.submissionlongstrgrade||e.assessmentlongstrgrade?e:void 0}))),o.access.canviewpublishedsubmissions&&n.push(i.then((0,s.A)((function*(){const n=yield c.AddonModWorkshop.getSubmissions(e.id,{cmId:o.module.id});o.publishedSubmissions=n.filter((n=>!!n.published&&(n.reviewedby=o.assessments.filter((o=>o.submissionid===n.id)).map((o=>p.AddonModWorkshopHelper.realGradeValue(e,o))),!0)))}))))),yield Promise.all(n)}))()}sync(){if(!this.workshop)throw new i.CoreError("Cannot sync without a workshop.");return h.AddonModWorkshopSync.syncWorkshop(this.workshop.id)}ngOnDestroy(){var o,e,n;super.ngOnDestroy(),null===(o=this.obsSubmissionChanged)||void 0===o||o.off(),null===(e=this.obsAssessmentSaved)||void 0===e||e.off(),null===(n=this.appResumeSubscription)||void 0===n||n.unsubscribe()}}return(o=AddonModWorkshopIndexComponent).ɵfac=function AddonModWorkshopIndexComponent_Factory(e){return new(e||o)(b.rXU(I.W9,8),b.rXU(v.k,8))},o.ɵcmp=b.VBU({type:o,selectors:[["addon-mod-workshop-index"]],inputs:{group:"group"},features:[b.Vt3],decls:9,vars:11,consts:[["slot","end"],["fill","clear","aria-haspopup","true",3,"ariaLabel"],[3,"hideUntil"],[3,"completionChanged","module","component","componentId","courseId","hasDataToSync"],[4,"ngIf"],["collapsible-footer","","slot","fixed",4,"ngIf"],["fill","clear","aria-haspopup","true",3,"click","ariaLabel"],["name","fas-circle-info","slot","icon-only","aria-hidden","true"],["iconAction","fas-circle-info",3,"action","priority","content"],["button","",3,"click","detail"],[1,"ion-text-wrap"],["button","","class","ion-text-wrap",3,"item-dimmed","detail","click",4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap",3,"click","detail"],["slot","start","name","far-circle",4,"ngIf"],["slot","start","name","fas-circle-xmark","color","danger",4,"ngIf"],["slot","start","name","fas-circle-info","color","info",4,"ngIf"],["slot","start","name","fas-circle-check","color","success",4,"ngIf"],[1,"item-heading"],[3,"innerHTML",4,"ngIf"],["slot","end","name","fas-up-right-from-square","aria-hidden","true",4,"ngIf"],["slot","start","name","far-circle"],["slot","start","name","fas-circle-xmark","color","danger"],["slot","start","name","fas-circle-info","color","info"],["slot","start","name","fas-circle-check","color","success"],[3,"innerHTML"],["slot","end","name","fas-up-right-from-square","aria-hidden","true"],["contextLevel","module",3,"text","component","componentId","contextInstanceId","courseId"],["collapsible-item","","contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["class","ion-text-wrap",4,"ngIf"],["class","item-heading",4,"ngIf"],[3,"submission","courseId","module","workshop","access",4,"ngIf"],[3,"submission","courseId","module","workshop","access"],[4,"ngFor","ngForOf"],["summary","true",1,"core-as-item",3,"submission","courseId","module","workshop","access"],["summary","true",1,"core-as-item",3,"submission","assessment","courseId","module","workshop","access"],[3,"selectedChange","groupInfo","selected","courseId"],[1,"ion-align-items-center"],["expand","block","fill","outline",3,"click"],["name","fas-chevron-left","slot","start","aria-hidden","true"],["expand","block",3,"click"],["name","fas-chevron-right","slot","end","aria-hidden","true"],["collapsible-footer","","slot","fixed"],["class","list-item-limited-width",4,"ngIf"],[3,"courseId","currentModuleId"],[1,"list-item-limited-width"],["expand","block","class","ion-text-wrap ion-margin",3,"click",4,"ngIf"],["expand","block",1,"ion-text-wrap","ion-margin",3,"click"],["slot","start","name","fas-plus","aria-hidden","true"],["slot","start","name","fas-pen","aria-hidden","true"]],template:function AddonModWorkshopIndexComponent_Template(o,e){1&o&&(b.j41(0,"core-navbar-buttons",0),b.DNE(1,AddonModWorkshopIndexComponent_Conditional_1_Template,3,3,"ion-button",1)(2,AddonModWorkshopIndexComponent_Conditional_2_Template,3,4),b.k0s(),b.j41(3,"core-loading",2)(4,"core-course-module-info",3),b.bIt("completionChanged",(function AddonModWorkshopIndexComponent_Template_core_course_module_info_completionChanged_4_listener(){return e.onCompletionChange()})),b.k0s(),b.DNE(5,AddonModWorkshopIndexComponent_ion_card_5_Template,6,3,"ion-card",4)(6,AddonModWorkshopIndexComponent_ion_card_6_Template,7,8,"ion-card",4)(7,AddonModWorkshopIndexComponent_div_7_Template,7,6,"div",4)(8,AddonModWorkshopIndexComponent_div_8_Template,3,3,"div",5),b.k0s()),2&o&&(b.R7$(),b.vxM(1,e.courseContentsPage?2:1),b.R7$(2),b.Y8G("hideUntil",!e.showLoading),b.R7$(),b.Y8G("module",e.module)("component",e.component)("componentId",e.componentId)("courseId",e.courseId)("hasDataToSync",e.hasOffline),b.R7$(),b.Y8G("ngIf",e.phases&&e.workshop),b.R7$(),b.Y8G("ngIf",e.description&&e.workshop&&e.workshop.phase===e.PHASE_SETUP),b.R7$(),b.Y8G("ngIf",e.access&&e.workshop&&e.workshop.phase>=e.PHASE_SUBMISSION),b.R7$(),b.Y8G("ngIf",!e.showLoading))},dependencies:[A.Sq,A.bT,w.B,M.Q,S.F,T.R,C.c,W.t,G.B,R.K,x.i,y.T,I.Jm,I.b_,I.hU,I.lO,I.iq,I.uz,I.Dg,I.he,I.ln,$.Y,F.Q,E.J,P.D9],encapsulation:2}),AddonModWorkshopIndexComponent})()},61919:(o,e,n)=>{n.d(e,{J:()=>A});var s=n(98870),i=n(15324),t=n(52749),d=n(17443),a=n(80178),r=n(26327),m=n(81552),_=n(91416),l=n(54438),c=n(60177),p=n(31498),u=n(64422),h=n(16658),f=n(86198),k=n(58197),g=n(43570),b=n(73465),I=n(2423),v=n(73955);const _c0=o=>({$a:o});function AddonModWorkshopSubmissionComponent_div_1_h2_4_Template(o,e){if(1&o&&(l.j41(0,"h2"),l.nrm(1,"core-format-text",10),l.k0s()),2&o){const o=l.XpG(2);l.R7$(),l.Y8G("text",o.submission.title)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionComponent_div_1_p_5_Template(o,e){if(1&o&&(l.j41(0,"p"),l.EFF(1),l.k0s()),2&o){const o=l.XpG(2);l.R7$(),l.JRh(o.profile.fullname)}}function AddonModWorkshopSubmissionComponent_div_1_p_6_Template(o,e){if(1&o&&(l.j41(0,"p"),l.EFF(1),l.nI1(2,"translate"),l.k0s()),2&o){const o=l.XpG(2);l.AVh("addon-has-overriden-grade",o.showGrade(o.submission.gradeover)),l.R7$(),l.Lme(" ",l.i5U(2,4,"addon.mod_workshop.submissiongradeof",l.eq3(7,_c0,o.workshop.grade)),": ",o.submission.grade," ")}}function AddonModWorkshopSubmissionComponent_div_1_p_7_Template(o,e){if(1&o&&(l.j41(0,"p",11),l.EFF(1),l.nI1(2,"translate"),l.k0s()),2&o){const o=l.XpG(2);l.R7$(),l.Lme(" ",l.bMT(2,2,"addon.mod_workshop.gradeover"),": ",o.submission.gradeover," ")}}function AddonModWorkshopSubmissionComponent_div_1_p_8_Template(o,e){if(1&o&&(l.j41(0,"p"),l.EFF(1),l.nI1(2,"translate"),l.k0s()),2&o){const o=l.XpG(2);l.R7$(),l.Lme(" ",l.i5U(2,2,"addon.mod_workshop.gradinggradeof",l.eq3(5,_c0,o.workshop.gradinggrade)),": ",o.submission.gradinggrade," ")}}function AddonModWorkshopSubmissionComponent_div_1_ion_note_9_Template(o,e){1&o&&(l.j41(0,"ion-note",12),l.nrm(1,"ion-icon",13),l.EFF(2),l.nI1(3,"translate"),l.k0s()),2&o&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"core.notsent")," "))}function AddonModWorkshopSubmissionComponent_div_1_ion_note_10_ng_container_3_Template(o,e){1&o&&(l.qex(0),l.nrm(1,"ion-icon",13),l.EFF(2),l.nI1(3,"translate"),l.bVm()),2&o&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"core.notsent")," "))}function AddonModWorkshopSubmissionComponent_div_1_ion_note_10_ng_container_4_Template(o,e){1&o&&(l.qex(0),l.nrm(1,"ion-icon",14),l.EFF(2),l.nI1(3,"translate"),l.bVm()),2&o&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"core.deletedoffline")," "))}function AddonModWorkshopSubmissionComponent_div_1_ion_note_10_Template(o,e){if(1&o&&(l.j41(0,"ion-note",12),l.EFF(1),l.nI1(2,"coreDateDayOrTime"),l.DNE(3,AddonModWorkshopSubmissionComponent_div_1_ion_note_10_ng_container_3_Template,4,3,"ng-container",1)(4,AddonModWorkshopSubmissionComponent_div_1_ion_note_10_ng_container_4_Template,4,3,"ng-container",1),l.k0s()),2&o){const o=l.XpG(2);l.R7$(),l.SpI(" ",l.bMT(2,3,o.submission.timemodified)," "),l.R7$(2),l.Y8G("ngIf",o.submission.offline),l.R7$(),l.Y8G("ngIf",o.submission.deleted)}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_11_Template(o,e){if(1&o&&(l.j41(0,"ion-item",15)(1,"ion-label"),l.nrm(2,"core-format-text",16),l.k0s()()),2&o){const o=l.XpG(2);l.R7$(2),l.Y8G("component",o.component)("componentId",o.componentId)("text",o.submission.content)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_13_core_user_avatar_1_Template(o,e){if(1&o&&l.nrm(0,"core-user-avatar",4),2&o){const o=l.XpG(3);l.Y8G("user",o.evaluateByProfile)("courseId",o.courseId)("userId",o.evaluateByProfile.id)}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_13_p_3_Template(o,e){if(1&o&&(l.j41(0,"p",19),l.EFF(1),l.nI1(2,"translate"),l.k0s()),2&o){const o=l.XpG(3);l.R7$(),l.SpI(" ",l.i5U(2,1,"addon.mod_workshop.feedbackby",l.eq3(4,_c0,o.evaluateByProfile.fullname))," ")}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_13_Template(o,e){if(1&o&&(l.j41(0,"ion-item",15),l.DNE(1,AddonModWorkshopSubmissionComponent_div_1_ion_item_13_core_user_avatar_1_Template,1,3,"core-user-avatar",17),l.j41(2,"ion-label"),l.DNE(3,AddonModWorkshopSubmissionComponent_div_1_ion_item_13_p_3_Template,3,6,"p",18),l.nrm(4,"core-format-text",10),l.k0s()()),2&o){const o=l.XpG(2);l.R7$(),l.Y8G("ngIf",o.evaluateByProfile),l.R7$(2),l.Y8G("ngIf",o.evaluateByProfile&&o.evaluateByProfile.fullname),l.R7$(),l.Y8G("text",o.submission.feedbackauthor)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_14_Template(o,e){if(1&o){const o=l.RV6();l.j41(0,"ion-item")(1,"ion-label")(2,"ion-button",20),l.bIt("click",(function AddonModWorkshopSubmissionComponent_div_1_ion_item_14_Template_ion_button_click_2_listener(){l.eBV(o);const e=l.XpG(2);return l.Njj(e.gotoSubmission())})),l.EFF(3),l.nI1(4,"translate"),l.nrm(5,"ion-icon",21),l.k0s()()()}2&o&&(l.R7$(3),l.SpI(" ",l.bMT(4,1,"core.showmore")," "))}function AddonModWorkshopSubmissionComponent_div_1_Template(o,e){if(1&o&&(l.j41(0,"div")(1,"ion-item",3),l.nrm(2,"core-user-avatar",4),l.j41(3,"ion-label"),l.DNE(4,AddonModWorkshopSubmissionComponent_div_1_h2_4_Template,2,3,"h2",1)(5,AddonModWorkshopSubmissionComponent_div_1_p_5_Template,2,1,"p",1)(6,AddonModWorkshopSubmissionComponent_div_1_p_6_Template,3,9,"p",5)(7,AddonModWorkshopSubmissionComponent_div_1_p_7_Template,3,4,"p",6)(8,AddonModWorkshopSubmissionComponent_div_1_p_8_Template,3,7,"p",1),l.k0s(),l.DNE(9,AddonModWorkshopSubmissionComponent_div_1_ion_note_9_Template,4,3,"ion-note",7)(10,AddonModWorkshopSubmissionComponent_div_1_ion_note_10_Template,5,5,"ion-note",7),l.k0s(),l.DNE(11,AddonModWorkshopSubmissionComponent_div_1_ion_item_11_Template,3,5,"ion-item",8),l.nrm(12,"core-files",9),l.DNE(13,AddonModWorkshopSubmissionComponent_div_1_ion_item_13_Template,5,5,"ion-item",8)(14,AddonModWorkshopSubmissionComponent_div_1_ion_item_14_Template,6,3,"ion-item",1),l.k0s()),2&o){const o=l.XpG();l.R7$(2),l.Y8G("user",o.profile)("courseId",o.courseId)("userId",null==o.profile?null:o.profile.id),l.R7$(2),l.Y8G("ngIf",o.submission.title),l.R7$(),l.Y8G("ngIf",o.profile&&(null==o.profile?null:o.profile.fullname)),l.R7$(),l.Y8G("ngIf",o.showGrade(o.submission.grade)),l.R7$(),l.Y8G("ngIf",o.showGrade(o.submission.gradeover)),l.R7$(),l.Y8G("ngIf",o.access.canviewallsubmissions&&o.showGrade(o.submission.gradinggrade)),l.R7$(),l.Y8G("ngIf",!o.submission.timemodified),l.R7$(),l.Y8G("ngIf",o.submission.timemodified),l.R7$(),l.Y8G("ngIf",o.submission.content),l.R7$(),l.Y8G("files",o.submission.attachmentfiles)("component",o.component)("componentId",o.componentId),l.R7$(),l.Y8G("ngIf",o.viewDetails&&o.submission.feedbackauthor),l.R7$(),l.Y8G("ngIf",o.viewDetails)}}function AddonModWorkshopSubmissionComponent_ion_item_2_h2_3_Template(o,e){if(1&o&&(l.j41(0,"h2"),l.nrm(1,"core-format-text",10),l.k0s()),2&o){const o=l.XpG(2);l.R7$(),l.Y8G("text",o.submission.title)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_4_Template(o,e){if(1&o&&(l.j41(0,"p"),l.EFF(1),l.k0s()),2&o){const o=l.XpG(2);l.R7$(),l.JRh(o.profile.fullname)}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_5_Template(o,e){if(1&o&&(l.j41(0,"p"),l.EFF(1),l.nI1(2,"translate"),l.k0s()),2&o){const o=l.XpG(2);l.R7$(),l.E5c(" ",l.bMT(2,3,"addon.mod_workshop.receivedgrades"),": ",o.submission.reviewedbydone," / ",o.submission.reviewedbycount," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_6_Template(o,e){if(1&o&&(l.j41(0,"p"),l.EFF(1),l.nI1(2,"translate"),l.k0s()),2&o){const o=l.XpG(2);l.R7$(),l.E5c(" ",l.bMT(2,3,"addon.mod_workshop.givengrades"),": ",o.submission.reviewerofdone," / ",o.submission.reviewerofcount," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_7_Template(o,e){if(1&o&&(l.j41(0,"p"),l.EFF(1),l.nI1(2,"translate"),l.k0s()),2&o){const o=l.XpG(2);l.R7$(),l.Lme(" ",l.i5U(2,2,"addon.mod_workshop.submissiongradeof",l.eq3(5,_c0,o.workshop.grade)),": ",o.submission.grade," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_8_Template(o,e){if(1&o&&(l.j41(0,"p",11),l.EFF(1),l.nI1(2,"translate"),l.k0s()),2&o){const o=l.XpG(2);l.R7$(),l.Lme(" ",l.i5U(2,2,"addon.mod_workshop.submissiongradeof",l.eq3(5,_c0,o.workshop.grade)),": ",o.submission.gradeover," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_9_Template(o,e){if(1&o&&(l.j41(0,"p"),l.EFF(1),l.nI1(2,"translate"),l.k0s()),2&o){const o=l.XpG(2);l.R7$(),l.Lme(" ",l.i5U(2,2,"addon.mod_workshop.gradinggradeof",l.eq3(5,_c0,o.workshop.gradinggrade)),": ",o.submission.gradinggrade," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_badge_10_Template(o,e){1&o&&(l.j41(0,"ion-badge",25),l.EFF(1),l.nI1(2,"translate"),l.k0s()),2&o&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"addon.mod_workshop.assessedsubmission")," "))}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_badge_11_Template(o,e){1&o&&(l.j41(0,"ion-badge",26),l.EFF(1),l.nI1(2,"translate"),l.k0s()),2&o&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"addon.mod_workshop.notassessed")," "))}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_12_div_3_Template(o,e){1&o&&(l.j41(0,"div"),l.nrm(1,"ion-icon",13),l.EFF(2),l.nI1(3,"translate"),l.k0s()),2&o&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"core.notsent")," "))}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_12_div_4_Template(o,e){1&o&&(l.j41(0,"div"),l.nrm(1,"ion-icon",14),l.EFF(2),l.nI1(3,"translate"),l.k0s()),2&o&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"core.deletedoffline")," "))}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_12_Template(o,e){if(1&o&&(l.j41(0,"ion-note",12),l.EFF(1),l.nI1(2,"coreDateDayOrTime"),l.DNE(3,AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_12_div_3_Template,4,3,"div",1)(4,AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_12_div_4_Template,4,3,"div",1),l.k0s()),2&o){const o=l.XpG(2);l.R7$(),l.SpI(" ",l.bMT(2,3,o.submission.timemodified)," "),l.R7$(2),l.Y8G("ngIf",o.offline),l.R7$(),l.Y8G("ngIf",o.submission.deleted)}}function AddonModWorkshopSubmissionComponent_ion_item_2_Template(o,e){if(1&o){const o=l.RV6();l.j41(0,"ion-item",22),l.bIt("click",(function AddonModWorkshopSubmissionComponent_ion_item_2_Template_ion_item_click_0_listener(){l.eBV(o);const e=l.XpG();return l.Njj(e.gotoSubmission())})),l.nrm(1,"core-user-avatar",4),l.j41(2,"ion-label"),l.DNE(3,AddonModWorkshopSubmissionComponent_ion_item_2_h2_3_Template,2,3,"h2",1)(4,AddonModWorkshopSubmissionComponent_ion_item_2_p_4_Template,2,1,"p",1)(5,AddonModWorkshopSubmissionComponent_ion_item_2_p_5_Template,3,5,"p",1)(6,AddonModWorkshopSubmissionComponent_ion_item_2_p_6_Template,3,5,"p",1)(7,AddonModWorkshopSubmissionComponent_ion_item_2_p_7_Template,3,7,"p",1)(8,AddonModWorkshopSubmissionComponent_ion_item_2_p_8_Template,3,7,"p",6)(9,AddonModWorkshopSubmissionComponent_ion_item_2_p_9_Template,3,7,"p",1)(10,AddonModWorkshopSubmissionComponent_ion_item_2_ion_badge_10_Template,3,3,"ion-badge",23)(11,AddonModWorkshopSubmissionComponent_ion_item_2_ion_badge_11_Template,3,3,"ion-badge",24),l.k0s(),l.DNE(12,AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_12_Template,5,5,"ion-note",7),l.k0s()}if(2&o){const o=l.XpG();l.Y8G("detail",o.submission.timemodified)("button",o.submission.timemodified),l.R7$(),l.Y8G("user",o.profile)("courseId",o.courseId)("userId",null==o.profile?null:o.profile.id),l.R7$(2),l.Y8G("ngIf",o.submission.title),l.R7$(),l.Y8G("ngIf",o.profile&&o.profile.fullname),l.R7$(),l.Y8G("ngIf",o.submission.reviewedbydone),l.R7$(),l.Y8G("ngIf",o.submission.reviewerofdone),l.R7$(),l.Y8G("ngIf",!o.showGrade(o.submission.gradeover)&&o.showGrade(o.submission.grade)),l.R7$(),l.Y8G("ngIf",o.showGrade(o.submission.gradeover)),l.R7$(),l.Y8G("ngIf",o.access.canviewallsubmissions&&o.showGrade(o.submission.gradinggrade)),l.R7$(),l.Y8G("ngIf",o.assessment&&(o.showGrade(o.assessment.grade)||o.assessment.offline)),l.R7$(),l.Y8G("ngIf",o.assessment&&!o.showGrade(o.assessment.grade)&&!o.assessment.offline),l.R7$(),l.Y8G("ngIf",o.submission.timemodified)}}let A=(()=>{var o;class AddonModWorkshopSubmissionComponent{constructor(){this.summary=!1,this.component=m.Ug,this.loaded=!1,this.offline=!1,this.viewDetails=!1,this.userId=t.CoreSites.getCurrentSiteUserId(),this.showGrade=a.AddonModWorkshopHelper.showGrade}ngOnInit(){var o,e;this.componentId=this.module.instance,this.userId=this.submission.authorid||this.userId;const n=[];this.offline=!(null===(o=this.submission)||void 0===o||!o.offline)||!(null===(e=this.assessment)||void 0===e||!e.offline),this.submission.id&&n.push(r.AddonModWorkshopOffline.getEvaluateSubmission(this.workshop.id,this.submission.id).then((o=>{this.submission.gradeover=parseInt(o.gradeover,10),this.offline=!0})).catch((()=>{}))),this.userId&&n.push(s.CoreUser.getProfile(this.userId,this.courseId,!0).then((o=>{this.profile=o}))),this.viewDetails=!this.summary&&50==this.workshop.phase&&i.CoreNavigator.getCurrentRoute().component!=d.D,this.viewDetails&&this.submission.gradeoverby&&n.push(s.CoreUser.getProfile(this.submission.gradeoverby,this.courseId,!0).then((o=>{this.evaluateByProfile=o}))),Promise.all(n).finally((()=>{this.loaded=!0}))}gotoSubmission(){if(this.submission.timemodified){i.CoreNavigator.navigateToSitePath(`${m.q3}/${this.courseId}/${this.module.id}/${this.submission.id}`,{params:{module:this.module,workshop:this.workshop,access:this.access,profile:this.profile,submission:this.submission,assessment:this.assessment}})}}}return(o=AddonModWorkshopSubmissionComponent).ɵfac=function AddonModWorkshopSubmissionComponent_Factory(e){return new(e||o)},o.ɵcmp=l.VBU({type:o,selectors:[["addon-mod-workshop-submission"]],inputs:{submission:"submission",module:"module",workshop:"workshop",access:"access",courseId:"courseId",assessment:"assessment",summary:[l.Mj6.HasDecoratorInputTransform,"summary","summary",_.G]},features:[l.GFd],decls:3,vars:3,consts:[[3,"hideUntil"],[4,"ngIf"],["class","ion-text-wrap",3,"detail","button","click",4,"ngIf"],[1,"ion-text-wrap","addon-workshop-submission-title"],["slot","start",3,"user","courseId","userId"],[3,"addon-has-overriden-grade",4,"ngIf"],["class","addon-overriden-grade",4,"ngIf"],["slot","end",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],[3,"files","component","componentId"],["contextLevel","module",3,"text","contextInstanceId","courseId"],[1,"addon-overriden-grade"],["slot","end"],["name","fas-clock","aria-hidden","true"],["name","fas-trash","aria-hidden","true"],[1,"ion-text-wrap"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["slot","start",3,"user","courseId","userId",4,"ngIf"],["class","item-heading",4,"ngIf"],[1,"item-heading"],["expand","block",3,"click"],["name","fas-chevron-right","slot","end","aria-hidden","true"],[1,"ion-text-wrap",3,"click","detail","button"],["color","success","class","ion-text-wrap",4,"ngIf"],["color","danger","class","ion-text-wrap",4,"ngIf"],["color","success",1,"ion-text-wrap"],["color","danger",1,"ion-text-wrap"]],template:function AddonModWorkshopSubmissionComponent_Template(o,e){1&o&&(l.j41(0,"core-loading",0),l.DNE(1,AddonModWorkshopSubmissionComponent_div_1_Template,15,16,"div",1)(2,AddonModWorkshopSubmissionComponent_ion_item_2_Template,13,15,"ion-item",2),l.k0s()),2&o&&(l.Y8G("hideUntil",e.loaded),l.R7$(),l.Y8G("ngIf",!e.summary),l.R7$(),l.Y8G("ngIf",e.summary))},dependencies:[c.bT,p.Y,u.R,h.T,f.t,k.B,g.T,b.In,b.Jm,b.iq,b.uz,b.he,b.JI,I.Y,v.D9],styles:["[_nghost-%COMP%]   p.addon-overriden-grade[_ngcontent-%COMP%]{color:var(--success)}[_nghost-%COMP%]   p.addon-has-overriden-grade[_ngcontent-%COMP%]{color:var(--danger);text-decoration:line-through}"]}),AddonModWorkshopSubmissionComponent})()},17443:(o,e,n)=>{n.d(e,{D:()=>C});var s=n(10467),i=n(89417),t=n(44682),d=n(97383),a=n(98870),r=n(15324),m=n(52749),_=n(48966),l=n(89911),c=n(75383),p=n(79555),u=n(49882),h=n(63153),f=n(45157),k=n(67193),g=n(80178),b=n(26327),I=n(22693),v=n(24742),A=n(81552),w=n(23780),M=n(54438),S=n(73465);o=n.hmd(o);const T=["feedbackFormEl"],_c1=o=>({$a:o}),_c2=o=>({header:o}),_c3=o=>({id:o});function AddonModWorkshopSubmissionPage_core_format_text_7_Template(o,e){if(1&o&&M.nrm(0,"core-format-text",12),2&o){const o=M.XpG();M.Y8G("text",o.title)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionPage_ion_button_9_Template(o,e){if(1&o){const o=M.RV6();M.j41(0,"ion-button",13),M.bIt("click",(function AddonModWorkshopSubmissionPage_ion_button_9_Template_ion_button_click_0_listener(){M.eBV(o);const e=M.XpG();return M.Njj(e.saveAssessment())})),M.EFF(1),M.nI1(2,"translate"),M.k0s()}2&o&&(M.R7$(),M.SpI(" ",M.bMT(2,1,"core.save")," "))}function AddonModWorkshopSubmissionPage_ion_button_10_Template(o,e){if(1&o){const o=M.RV6();M.j41(0,"ion-button",13),M.bIt("click",(function AddonModWorkshopSubmissionPage_ion_button_10_Template_ion_button_click_0_listener(){M.eBV(o);const e=M.XpG();return M.Njj(e.saveEvaluation())})),M.EFF(1),M.nI1(2,"translate"),M.k0s()}2&o&&(M.R7$(),M.SpI(" ",M.bMT(2,1,"core.save")," "))}function AddonModWorkshopSubmissionPage_ion_refresher_12_Template(o,e){if(1&o){const o=M.RV6();M.j41(0,"ion-refresher",14),M.bIt("ionRefresh",(function AddonModWorkshopSubmissionPage_ion_refresher_12_Template_ion_refresher_ionRefresh_0_listener(e){M.eBV(o);const n=M.XpG();return M.Njj(n.refreshSubmission(e.target))})),M.nrm(1,"ion-refresher-content",15),M.nI1(2,"translate"),M.k0s()}if(2&o){const o=M.XpG();M.Y8G("disabled",!o.loaded),M.R7$(),M.FS9("pullingText",M.bMT(2,2,"core.pulltorefresh"))}}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_2_Template(o,e){if(1&o){const o=M.RV6();M.j41(0,"ion-button",22),M.bIt("click",(function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_2_Template_ion_button_click_0_listener(){M.eBV(o);const e=M.XpG(3);return M.Njj(e.editSubmission())})),M.nrm(1,"ion-icon",23),M.EFF(2),M.nI1(3,"translate"),M.k0s()}2&o&&(M.R7$(2),M.SpI(" ",M.bMT(3,1,"addon.mod_workshop.editsubmission")," "))}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_3_Template(o,e){if(1&o){const o=M.RV6();M.j41(0,"ion-button",24),M.bIt("click",(function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_3_Template_ion_button_click_0_listener(){M.eBV(o);const e=M.XpG(3);return M.Njj(e.deleteSubmission())})),M.nrm(1,"ion-icon",25),M.EFF(2),M.nI1(3,"translate"),M.k0s()}2&o&&(M.R7$(2),M.SpI(" ",M.bMT(3,1,"addon.mod_workshop.deletesubmission")," "))}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_4_Template(o,e){if(1&o){const o=M.RV6();M.j41(0,"ion-button",26),M.bIt("click",(function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_4_Template_ion_button_click_0_listener(){M.eBV(o);const e=M.XpG(3);return M.Njj(e.undoDeleteSubmission())})),M.nrm(1,"ion-icon",27),M.EFF(2),M.nI1(3,"translate"),M.k0s()}2&o&&(M.R7$(2),M.SpI(" ",M.bMT(3,1,"core.restore")," "))}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_Template(o,e){if(1&o&&(M.j41(0,"ion-item",18)(1,"ion-label"),M.DNE(2,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_2_Template,4,3,"ion-button",19)(3,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_3_Template,4,3,"ion-button",20)(4,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_4_Template,4,3,"ion-button",21),M.k0s()()),2&o){const o=M.XpG(2);M.R7$(2),M.Y8G("ngIf",o.canEdit),M.R7$(),M.Y8G("ngIf",!o.submission.deleted&&o.canDelete),M.R7$(),M.Y8G("ngIf",o.submission.deleted&&o.canDelete)}}function AddonModWorkshopSubmissionPage_ion_list_14_Template(o,e){if(1&o&&(M.j41(0,"ion-list"),M.nrm(1,"addon-mod-workshop-submission",16),M.DNE(2,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_Template,5,3,"ion-item",17),M.k0s()),2&o){const o=M.XpG();M.R7$(),M.Y8G("submission",o.submission)("courseId",o.courseId)("module",o.module)("workshop",o.workshop)("access",o.access),M.R7$(),M.Y8G("ngIf",o.canEdit||o.canDelete)}}function AddonModWorkshopSubmissionPage_ion_list_15_core_user_avatar_2_Template(o,e){if(1&o&&M.nrm(0,"core-user-avatar",29),2&o){const o=M.XpG(2);M.Y8G("user",o.evaluateByProfile)("courseId",o.courseId)("userId",o.evaluateByProfile.id)}}function AddonModWorkshopSubmissionPage_ion_list_15_h2_4_Template(o,e){if(1&o&&(M.j41(0,"h2"),M.EFF(1),M.nI1(2,"translate"),M.k0s()),2&o){const o=M.XpG(2);M.R7$(),M.SpI(" ",M.i5U(2,1,"addon.mod_workshop.feedbackby",M.eq3(4,_c1,o.evaluateByProfile.fullname))," ")}}function AddonModWorkshopSubmissionPage_ion_list_15_Template(o,e){if(1&o&&(M.j41(0,"ion-list")(1,"ion-item",18),M.DNE(2,AddonModWorkshopSubmissionPage_ion_list_15_core_user_avatar_2_Template,1,3,"core-user-avatar",28),M.j41(3,"ion-label"),M.DNE(4,AddonModWorkshopSubmissionPage_ion_list_15_h2_4_Template,3,6,"h2",9),M.nrm(5,"core-format-text",12),M.k0s()()()),2&o){const o=M.XpG();M.R7$(2),M.Y8G("ngIf",o.evaluateByProfile),M.R7$(2),M.Y8G("ngIf",o.evaluateByProfile&&o.evaluateByProfile.fullname),M.R7$(),M.Y8G("text",null==o.evaluate?null:o.evaluate.text)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionPage_ion_list_16_Template(o,e){if(1&o&&(M.j41(0,"ion-list")(1,"ion-item-divider",18)(2,"ion-label")(3,"h2"),M.EFF(4),M.nI1(5,"translate"),M.k0s()()(),M.nrm(6,"addon-mod-workshop-assessment",30),M.k0s()),2&o){const o=M.XpG();M.R7$(4),M.JRh(M.bMT(5,7,"addon.mod_workshop.yourassessment")),M.R7$(2),M.Y8G("submission",o.submission)("assessment",o.ownAssessment)("courseId",o.courseId)("access",o.access)("module",o.module)("workshop",o.workshop)}}function AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_addon_mod_workshop_assessment_1_Template(o,e){if(1&o&&M.nrm(0,"addon-mod-workshop-assessment",30),2&o){const o=M.XpG().$implicit,e=M.XpG(2);M.Y8G("submission",e.submission)("assessment",o)("courseId",e.courseId)("access",e.access)("module",e.module)("workshop",e.workshop)}}function AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_Template(o,e){if(1&o&&(M.qex(0),M.DNE(1,AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_addon_mod_workshop_assessment_1_Template,1,6,"addon-mod-workshop-assessment",32),M.bVm()),2&o){const o=e.$implicit;M.R7$(),M.Y8G("ngIf",!o.ownAssessment)}}function AddonModWorkshopSubmissionPage_ion_list_17_Template(o,e){if(1&o&&(M.j41(0,"ion-list")(1,"ion-item-divider",18)(2,"ion-label")(3,"h2"),M.EFF(4),M.nI1(5,"translate"),M.k0s()()(),M.DNE(6,AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_Template,2,1,"ng-container",31),M.k0s()),2&o){const o=M.XpG();M.R7$(4),M.JRh(M.bMT(5,2,"addon.mod_workshop.receivedgrades")),M.R7$(2),M.Y8G("ngForOf",o.submissionInfo.reviewedby)}}function AddonModWorkshopSubmissionPage_ion_list_18_addon_mod_workshop_assessment_6_Template(o,e){if(1&o&&M.nrm(0,"addon-mod-workshop-assessment",34),2&o){const o=e.$implicit,n=M.XpG(2);M.Y8G("submission",n.submission)("assessment",o)("courseId",n.courseId)("module",n.module)("workshop",n.workshop)("access",n.access)}}function AddonModWorkshopSubmissionPage_ion_list_18_Template(o,e){if(1&o&&(M.j41(0,"ion-list")(1,"ion-item-divider",18)(2,"ion-label")(3,"h2"),M.EFF(4),M.nI1(5,"translate"),M.k0s()()(),M.DNE(6,AddonModWorkshopSubmissionPage_ion_list_18_addon_mod_workshop_assessment_6_Template,1,6,"addon-mod-workshop-assessment",33),M.k0s()),2&o){const o=M.XpG();M.R7$(4),M.JRh(M.bMT(5,2,"addon.mod_workshop.givengrades")),M.R7$(2),M.Y8G("ngForOf",o.submissionInfo.reviewerof)}}function AddonModWorkshopSubmissionPage_form_19_ion_item_7_Template(o,e){1&o&&(M.j41(0,"ion-item",18)(1,"ion-toggle",40)(2,"p",41),M.EFF(3),M.nI1(4,"translate"),M.k0s(),M.j41(5,"p"),M.EFF(6),M.nI1(7,"translate"),M.k0s()()()),2&o&&(M.R7$(3),M.JRh(M.bMT(4,2,"addon.mod_workshop.publishsubmission")),M.R7$(3),M.JRh(M.bMT(7,4,"addon.mod_workshop.publishsubmission_help")))}function AddonModWorkshopSubmissionPage_form_19_ion_select_option_20_Template(o,e){if(1&o&&(M.j41(0,"ion-select-option",42),M.EFF(1),M.k0s()),2&o){const o=e.$implicit;M.Y8G("value",o.value),M.R7$(),M.SpI(" ",o.label," ")}}function AddonModWorkshopSubmissionPage_form_19_Template(o,e){if(1&o&&(M.j41(0,"form",35,0)(2,"ion-item-divider",18)(3,"ion-label")(4,"h2"),M.EFF(5),M.nI1(6,"translate"),M.k0s()()(),M.DNE(7,AddonModWorkshopSubmissionPage_form_19_ion_item_7_Template,8,6,"ion-item",17),M.j41(8,"ion-item-divider",18)(9,"ion-label")(10,"h3"),M.EFF(11),M.nI1(12,"translate"),M.k0s(),M.j41(13,"p"),M.EFF(14),M.k0s()()(),M.j41(15,"ion-item",18)(16,"ion-select",36),M.nI1(17,"translate"),M.nI1(18,"translate"),M.nI1(19,"translate"),M.DNE(20,AddonModWorkshopSubmissionPage_form_19_ion_select_option_20_Template,2,2,"ion-select-option",37),M.k0s()(),M.j41(21,"ion-item")(22,"ion-label",38),M.EFF(23),M.nI1(24,"translate"),M.k0s(),M.nrm(25,"core-rich-text-editor",39),M.k0s()()),2&o){const o=M.XpG();M.Y8G("formGroup",o.feedbackForm),M.R7$(5),M.JRh(M.bMT(6,14,"addon.mod_workshop.feedbackauthor")),M.R7$(2),M.Y8G("ngIf",o.access.canpublishsubmissions),M.R7$(4),M.JRh(M.bMT(12,16,"addon.mod_workshop.gradecalculated")),M.R7$(3),M.JRh(o.submission.grade),M.R7$(2),M.Y8G("cancelText",M.bMT(17,18,"core.cancel"))("interfaceOptions",M.eq3(26,_c2,M.bMT(18,20,"addon.mod_workshop.gradeover")))("label",M.bMT(19,22,"addon.mod_workshop.gradeover")),M.R7$(4),M.Y8G("ngForOf",o.evaluationGrades),M.R7$(3),M.JRh(M.bMT(24,24,"addon.mod_workshop.feedbackauthor")),M.R7$(2),M.Y8G("control",o.feedbackForm.controls.text)("autoSave",!0)("contextInstanceId",o.module.id)("draftExtraParams",M.eq3(28,_c3,o.submissionId))}}function AddonModWorkshopSubmissionPage_addon_mod_workshop_assessment_strategy_20_Template(o,e){if(1&o&&M.nrm(0,"addon-mod-workshop-assessment-strategy",43),2&o){const o=M.XpG();M.Y8G("workshop",o.workshop)("access",o.access)("assessmentId",o.assessmentId)("userId",o.assessmentUserId)("strategy",o.strategy)("edit",o.access.assessingallowed)}}function AddonModWorkshopSubmissionPage_ion_list_21_core_user_avatar_2_Template(o,e){if(1&o&&M.nrm(0,"core-user-avatar",29),2&o){const o=M.XpG(2);M.Y8G("user",o.evaluateGradingByProfile)("courseId",o.courseId)("userId",o.evaluateGradingByProfile.id)}}function AddonModWorkshopSubmissionPage_ion_list_21_h3_4_Template(o,e){if(1&o&&(M.j41(0,"h3",41),M.EFF(1),M.nI1(2,"translate"),M.k0s()),2&o){const o=M.XpG(2);M.R7$(),M.SpI(" ",M.i5U(2,1,"addon.mod_workshop.feedbackby",M.eq3(4,_c1,o.evaluateGradingByProfile.fullname))," ")}}function AddonModWorkshopSubmissionPage_ion_list_21_Template(o,e){if(1&o&&(M.j41(0,"ion-list")(1,"ion-item",18),M.DNE(2,AddonModWorkshopSubmissionPage_ion_list_21_core_user_avatar_2_Template,1,3,"core-user-avatar",28),M.j41(3,"ion-label"),M.DNE(4,AddonModWorkshopSubmissionPage_ion_list_21_h3_4_Template,3,6,"h3",44),M.nrm(5,"core-format-text",12),M.k0s()()()),2&o){const o=M.XpG();M.R7$(2),M.Y8G("ngIf",o.evaluateGradingByProfile),M.R7$(2),M.Y8G("ngIf",o.evaluateGradingByProfile&&o.evaluateGradingByProfile.fullname),M.R7$(),M.Y8G("text",o.assessment.feedbackreviewer)("contextInstanceId",o.module.id)("courseId",o.courseId)}}let C=(()=>{var e;class AddonModWorkshopSubmissionPage{constructor(o,e){this.fb=o,this.content=e,this.loaded=!1,this.canAddFeedback=!1,this.canEdit=!1,this.canDelete=!1,this.evaluationGrades=[],this.originalEvaluation={published:!1,text:"",grade:""},this.hasOffline=!1,this.component=A.Ug,this.forceLeave=!1,this.isDestroyed=!1,this.currentUserId=m.CoreSites.getCurrentSiteUserId(),this.siteId=m.CoreSites.getCurrentSiteId(),this.feedbackForm=new i.gE({}),this.feedbackForm.addControl("published",this.fb.control("")),this.feedbackForm.addControl("grade",this.fb.control("")),this.feedbackForm.addControl("text",this.fb.control("")),this.obsAssessmentSaved=u.z.on(A.Px,(o=>{this.eventReceived(o)}),this.siteId),this.syncObserver=u.z.on(A.N7,(o=>{this.eventReceived(o)}),this.siteId),this.logView=v.j.once((()=>this.performLogView()))}ngOnInit(){var o=this;return(0,s.A)((function*(){var e,n,s;try{o.submissionId=r.CoreNavigator.getRequiredRouteNumberParam("submissionId"),o.module=r.CoreNavigator.getRequiredRouteParam("module"),o.workshop=r.CoreNavigator.getRequiredRouteParam("workshop"),o.access=r.CoreNavigator.getRequiredRouteParam("access"),o.courseId=r.CoreNavigator.getRequiredRouteNumberParam("courseId"),o.profile=r.CoreNavigator.getRouteParam("profile"),o.submissionInfo=r.CoreNavigator.getRequiredRouteParam("submission"),o.assessment=r.CoreNavigator.getRouteParam("assessment")}catch(o){return l.CoreDomUtils.showErrorModal(o),r.CoreNavigator.back(),void 0}o.title=o.module.name,o.workshopId=o.module.instance||o.workshop.id,o.userId=null===(e=o.submissionInfo)||void 0===e?void 0:e.authorid,o.strategy=o.assessment&&o.assessment.strategy||o.workshop&&o.workshop.strategy,o.assessmentId=null===(n=o.assessment)||void 0===n?void 0:n.id,o.assessmentUserId=null===(s=o.assessment)||void 0===s?void 0:s.reviewerid,yield o.fetchSubmissionData(),o.logView()}))()}canLeave(){var o=this;return(0,s.A)((function*(){var e;const n=null===(e=o.assessmentStrategy)||void 0===e?void 0:e.hasDataChanged();return o.forceLeave||!o.hasEvaluationChanged()&&!n||(yield l.CoreDomUtils.showConfirm(p.HT.instant("core.confirmcanceledit")),h.R.triggerFormCancelledEvent(o.formElement,o.siteId)),!0}))()}editSubmission(){const e={module:o,access:this.access};r.CoreNavigator.navigate(String(this.submissionId)+"/edit",e)}eventReceived(o){var e;this.workshopId===o.workshopId&&(null===(e=this.content)||void 0===e||e.scrollToTop(),this.loaded=!1,this.refreshAllData())}fetchSubmissionData(){var o=this;return(0,s.A)((function*(){try{var e,n,s;o.submission=yield g.AddonModWorkshopHelper.getSubmissionById(o.workshopId,o.submissionId,{cmId:o.module.id});const i=[];if(o.submission.grade=null===(e=o.submissionInfo)||void 0===e?void 0:e.grade,o.submission.gradinggrade=null===(n=o.submissionInfo)||void 0===n?void 0:n.gradinggrade,o.submission.gradeover=null===(s=o.submissionInfo)||void 0===s?void 0:s.gradeover,o.userId=o.submission.authorid||o.userId,o.canEdit=o.currentUserId==o.userId&&o.access.cansubmit&&o.access.modifyingsubmissionallowed,o.canDelete=o.access.candeletesubmissions,o.canAddFeedback=!o.assessmentId&&o.workshop.phase>30&&o.workshop.phase<50&&o.access.canoverridegrades,o.ownAssessment=void 0,o.access.canviewallassessments)i.push(k.AddonModWorkshop.getSubmissionAssessments(o.workshopId,o.submissionId,{cmId:o.module.id}).then((e=>{o.canDelete&&(o.canDelete=!e.length),o.submissionInfo.reviewedby=e,o.submissionInfo.reviewedby.forEach((e=>{e=g.AddonModWorkshopHelper.realGradeValue(o.workshop,e),o.currentUserId==e.reviewerid&&(o.ownAssessment=e,e.ownAssessment=!0)}))})));else if(o.currentUserId===o.userId&&o.assessmentId)i.push(k.AddonModWorkshop.getAssessment(o.workshopId,o.assessmentId,{cmId:o.module.id}).then((e=>{o.canDelete&&(o.canDelete=!e),o.submissionInfo.reviewedby=[o.parseAssessment(e)]})));else if(50===o.workshop.phase&&o.userId===o.currentUserId){const e=yield k.AddonModWorkshop.getSubmissionAssessments(o.workshopId,o.submissionId,{cmId:o.module.id});o.submissionInfo.reviewedby=e.map((e=>o.parseAssessment(e)))}(o.canAddFeedback||50===o.workshop.phase)&&(o.evaluate={published:o.submission.published,text:o.submission.feedbackauthor||""}),o.canAddFeedback?(o.isDestroyed||_.CoreSync.blockOperation(o.component,o.workshopId),i.push(o.fillEvaluationsGrades())):50===o.workshop.phase&&o.submission.gradeoverby&&o.evaluate&&o.evaluate.text&&i.push(a.CoreUser.getProfile(o.submission.gradeoverby,o.courseId,!0).then((e=>{o.evaluateByProfile=e}))),o.assessment&&!o.access.assessingallowed&&o.assessment.feedbackreviewer&&o.assessment.gradinggradeoverby&&i.push(a.CoreUser.getProfile(o.assessment.gradinggradeoverby,o.courseId,!0).then((e=>{o.evaluateGradingByProfile=e}))),yield Promise.all(i);const t=yield b.AddonModWorkshopOffline.getSubmissions(o.workshopId);o.submission=yield g.AddonModWorkshopHelper.applyOfflineData(o.submission,t)}catch(o){l.CoreDomUtils.showErrorModalDefault(o,"core.course.errorgetmodule",!0)}finally{o.loaded=!0}}))()}fillEvaluationsGrades(){var o=this;return(0,s.A)((function*(){const e=p.HT.instant("addon.mod_workshop.notoverridden");if(o.evaluationGrades=yield d.CoreGradesHelper.makeGradesMenu(o.workshop.grade||0,void 0,e,-1),o.evaluate){o.evaluate.grade={label:d.CoreGradesHelper.getGradeLabelFromValue(o.evaluationGrades,o.submissionInfo.gradeover)||e,value:o.submissionInfo.gradeover||-1};try{const n=yield b.AddonModWorkshopOffline.getEvaluateSubmission(o.workshopId,o.submissionId);o.hasOffline=!0,o.evaluate.published=n.published,o.evaluate.text=n.feedbacktext,o.evaluate.grade={label:d.CoreGradesHelper.getGradeLabelFromValue(o.evaluationGrades,parseInt(n.gradeover,10))||e,value:n.gradeover||-1}}catch{o.hasOffline=!1}finally{o.originalEvaluation.published=o.evaluate.published,o.originalEvaluation.text=o.evaluate.text,o.originalEvaluation.grade=o.evaluate.grade.value,o.feedbackForm.controls.published.setValue(o.evaluate.published),o.feedbackForm.controls.grade.setValue(o.evaluate.grade.value),o.feedbackForm.controls.text.setValue(o.evaluate.text)}}}))()}parseAssessment(o){return o=g.AddonModWorkshopHelper.realGradeValue(this.workshop,o),this.currentUserId==o.reviewerid&&(this.ownAssessment=o,o.ownAssessment=!0),o}forceLeavePage(){this.forceLeave=!0,r.CoreNavigator.back()}hasEvaluationChanged(){if(!this.loaded||!this.access.canoverridegrades)return!1;const o=this.feedbackForm.value;return this.originalEvaluation.published!=o.published||(this.originalEvaluation.text!=o.text||this.originalEvaluation.grade!=o.grade)}refreshAllData(){var o=this;return(0,s.A)((function*(){const e=[];e.push(k.AddonModWorkshop.invalidateSubmissionData(o.workshopId,o.submissionId)),e.push(k.AddonModWorkshop.invalidateSubmissionsData(o.workshopId)),e.push(k.AddonModWorkshop.invalidateSubmissionAssesmentsData(o.workshopId,o.submissionId)),o.assessmentId&&(e.push(k.AddonModWorkshop.invalidateAssessmentFormData(o.workshopId,o.assessmentId)),e.push(k.AddonModWorkshop.invalidateAssessmentData(o.workshopId,o.assessmentId))),o.assessmentUserId&&e.push(k.AddonModWorkshop.invalidateReviewerAssesmentsData(o.workshopId,o.assessmentId));try{yield Promise.all(e)}finally{u.z.trigger(A.Dl,null,o.siteId),yield o.fetchSubmissionData(),o.logView()}}))()}refreshSubmission(o){this.loaded&&this.refreshAllData().finally((()=>{null==o||o.complete()}))}saveAssessment(){var o=this;return(0,s.A)((function*(){var e;if(null!==(e=o.assessmentStrategy)&&void 0!==e&&e.hasDataChanged())try{yield o.assessmentStrategy.saveAssessment(),o.forceLeavePage()}catch{}else o.forceLeavePage()}))()}saveEvaluation(){var o=this;return(0,s.A)((function*(){o.hasEvaluationChanged()?(yield o.sendEvaluation(),o.forceLeavePage()):o.forceLeavePage()}))()}sendEvaluation(){var o=this;return(0,s.A)((function*(){const e=yield w.CoreLoadings.show("core.sending",!0),n=o.feedbackForm.value;n.grade=Number(n.grade)>=0?n.grade:"",n.text=c.Ni.formatHtmlLines(n.text);try{const e=yield k.AddonModWorkshop.evaluateSubmission(o.workshopId,o.submissionId,o.courseId,n.text,n.published,String(n.grade));h.R.triggerFormSubmittedEvent(o.formElement,!!e,o.siteId),yield k.AddonModWorkshop.invalidateSubmissionData(o.workshopId,o.submissionId).finally((()=>{u.z.trigger(A.AZ,{workshopId:o.workshopId,submissionId:o.submissionId},o.siteId)}))}catch(o){l.CoreDomUtils.showErrorModalDefault(o,"Cannot save submission evaluation")}finally{e.dismiss()}}))()}deleteSubmission(){var o=this;return(0,s.A)((function*(){try{yield l.CoreDomUtils.showDeleteConfirm("addon.mod_workshop.submissiondeleteconfirm")}catch{return}const e=yield w.CoreLoadings.show("core.deleting",!0);let n=!1;try{yield k.AddonModWorkshop.deleteSubmission(o.workshopId,o.submissionId,o.courseId),n=!0,yield k.AddonModWorkshop.invalidateSubmissionData(o.workshopId,o.submissionId)}catch(o){l.CoreDomUtils.showErrorModalDefault(o,"Cannot delete submission")}finally{if(e.dismiss(),n){u.z.trigger(A.AZ,{workshopId:o.workshopId,submissionId:o.submissionId},o.siteId),o.forceLeavePage()}}}))()}undoDeleteSubmission(){var o=this;return(0,s.A)((function*(){yield b.AddonModWorkshopOffline.deleteSubmissionAction(o.workshopId,"delete").finally((0,s.A)((function*(){u.z.trigger(A.AZ,{workshopId:o.workshopId,submissionId:o.submissionId},o.siteId),yield o.refreshAllData()})))}))()}performLogView(){var o=this;return(0,s.A)((function*(){try{yield k.AddonModWorkshop.logViewSubmission(o.submissionId,o.workshopId),t.CoreCourse.checkModuleCompletion(o.courseId,o.module.completiondata)}catch{}I.OF.logEvent({type:I.qr.VIEW_ITEM,ws:"mod_workshop_view_submission",name:o.workshop.name,data:{id:o.workshop.id,submissionid:o.submissionId,category:"workshop"},url:`/mod/workshop/submission.php?cmid=${o.module.id}&id=${o.submissionId}`})}))()}ngOnDestroy(){var o,e;this.isDestroyed=!0,null===(o=this.syncObserver)||void 0===o||o.off(),null===(e=this.obsAssessmentSaved)||void 0===e||e.off(),_.CoreSync.unblockOperation(this.component,this.workshopId)}}return(e=AddonModWorkshopSubmissionPage).ɵfac=function AddonModWorkshopSubmissionPage_Factory(o){return new(o||e)(M.rXU(i.ok),M.rXU(S.W9,8))},e.ɵcmp=M.VBU({type:e,selectors:[["page-addon-mod-workshop-submission-page"]],viewQuery:function AddonModWorkshopSubmissionPage_Query(o,e){if(1&o&&(M.GBs(f.o,5),M.GBs(T,5)),2&o){let o;M.mGM(o=M.lsd())&&(e.assessmentStrategy=o.first),M.mGM(o=M.lsd())&&(e.formElement=o.first)}},decls:22,vars:17,consts:[["feedbackFormEl",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId",4,"ngIf"],["slot","end",3,"hidden"],["fill","clear",3,"click",4,"ngIf"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh",4,"ngIf"],[3,"hideUntil"],[4,"ngIf"],[3,"formGroup",4,"ngIf"],[3,"workshop","access","assessmentId","userId","strategy","edit",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["fill","clear",3,"click"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"submission","courseId","module","workshop","access"],["class","ion-text-wrap",4,"ngIf"],[1,"ion-text-wrap"],["expand","block",3,"click",4,"ngIf"],["expand","block","color","danger",3,"click",4,"ngIf"],["expand","block","fill","outline","color","danger",3,"click",4,"ngIf"],["expand","block",3,"click"],["name","fas-pen","slot","start","aria-hidden","true"],["expand","block","color","danger",3,"click"],["name","fas-trash","slot","start","aria-hidden","true"],["expand","block","fill","outline","color","danger",3,"click"],["name","fas-rotate-left","slot","start","aria-hidden","true"],["slot","start",3,"user","courseId","userId",4,"ngIf"],["slot","start",3,"user","courseId","userId"],[3,"submission","assessment","courseId","access","module","workshop"],[4,"ngFor","ngForOf"],[3,"submission","assessment","courseId","access","module","workshop",4,"ngIf"],[3,"submission","assessment","courseId","module","workshop","access",4,"ngFor","ngForOf"],[3,"submission","assessment","courseId","module","workshop","access"],[3,"formGroup"],["labelPlacement","stacked","formControlName","grade","interface","action-sheet",3,"cancelText","interfaceOptions","label"],[3,"value",4,"ngFor","ngForOf"],["position","stacked"],["name","text","contextLevel","module","elementId","feedbackauthor_editor",3,"control","autoSave","contextInstanceId","draftExtraParams"],["formControlName","published"],[1,"item-heading"],[3,"value"],[3,"workshop","access","assessmentId","userId","strategy","edit"],["class","item-heading",4,"ngIf"]],template:function AddonModWorkshopSubmissionPage_Template(o,e){1&o&&(M.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),M.nrm(3,"ion-back-button",2),M.nI1(4,"translate"),M.k0s(),M.j41(5,"ion-title")(6,"h1"),M.DNE(7,AddonModWorkshopSubmissionPage_core_format_text_7_Template,1,3,"core-format-text",3),M.k0s()(),M.j41(8,"ion-buttons",4),M.DNE(9,AddonModWorkshopSubmissionPage_ion_button_9_Template,3,3,"ion-button",5)(10,AddonModWorkshopSubmissionPage_ion_button_10_Template,3,3,"ion-button",5),M.k0s()()(),M.j41(11,"ion-content",6),M.DNE(12,AddonModWorkshopSubmissionPage_ion_refresher_12_Template,3,4,"ion-refresher",7),M.j41(13,"core-loading",8),M.DNE(14,AddonModWorkshopSubmissionPage_ion_list_14_Template,3,6,"ion-list",9)(15,AddonModWorkshopSubmissionPage_ion_list_15_Template,6,5,"ion-list",9)(16,AddonModWorkshopSubmissionPage_ion_list_16_Template,7,9,"ion-list",9)(17,AddonModWorkshopSubmissionPage_ion_list_17_Template,7,4,"ion-list",9)(18,AddonModWorkshopSubmissionPage_ion_list_18_Template,7,4,"ion-list",9)(19,AddonModWorkshopSubmissionPage_form_19_Template,26,30,"form",10)(20,AddonModWorkshopSubmissionPage_addon_mod_workshop_assessment_strategy_20_Template,1,6,"addon-mod-workshop-assessment-strategy",11)(21,AddonModWorkshopSubmissionPage_ion_list_21_Template,6,5,"ion-list",9),M.k0s()()),2&o&&(M.R7$(3),M.Y8G("text",M.bMT(4,15,"core.back")),M.R7$(4),M.Y8G("ngIf",e.title),M.R7$(),M.Y8G("hidden",!e.loaded),M.R7$(),M.Y8G("ngIf",e.assessmentId&&e.access.assessingallowed),M.R7$(),M.Y8G("ngIf",e.canAddFeedback),M.R7$(2),M.Y8G("ngIf",!(e.assessmentId&&e.access.assessingallowed||e.canAddFeedback)),M.R7$(),M.Y8G("hideUntil",e.loaded),M.R7$(),M.Y8G("ngIf",e.submission),M.R7$(),M.Y8G("ngIf",!e.canAddFeedback&&(null==e.evaluate?null:e.evaluate.text)),M.R7$(),M.Y8G("ngIf",e.ownAssessment&&!e.assessment),M.R7$(),M.Y8G("ngIf",e.submissionInfo&&e.submissionInfo.reviewedby&&e.submissionInfo.reviewedby.length&&!e.assessment),M.R7$(),M.Y8G("ngIf",e.submissionInfo&&e.submissionInfo.reviewerof&&e.submissionInfo.reviewerof.length&&!e.assessment),M.R7$(),M.Y8G("ngIf",e.canAddFeedback&&e.submission),M.R7$(),M.Y8G("ngIf",e.assessmentId),M.R7$(),M.Y8G("ngIf",e.assessmentId&&!e.access.assessingallowed&&(null==e.assessment?null:e.assessment.feedbackreviewer)))},encapsulation:2}),AddonModWorkshopSubmissionPage})()}}]);