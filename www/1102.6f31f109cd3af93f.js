"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1102],{32379:(e,t,r)=>{r.d(t,{u:()=>CoreUserParticipantsSource});var i=r(10467),n=r(99522),a=r(98870);class CoreUserParticipantsSource extends n.F{static getSourceId(e,t=null){var r;return`participants-${e}-${t=null!==(r=t)&&void 0!==r?r:"__empty__"}`}constructor(e,t=null){super(),this.COURSE_ID=e,this.SEARCH_QUERY=t}getItemPath(e){return e.id.toString()}getItemQueryParams(){return{search:this.SEARCH_QUERY}}loadPageItems(e){var t=this;return(0,i.A)((function*(){if(t.SEARCH_QUERY){const{participants:r,canLoadMore:i}=yield a.CoreUser.searchParticipants(t.COURSE_ID,t.SEARCH_QUERY,!0,e,a.CoreUserProvider.PARTICIPANTS_LIST_LIMIT);return{items:r,hasMoreItems:i}}const{participants:r,canLoadMore:i}=yield a.CoreUser.getParticipants(t.COURSE_ID,e*a.CoreUserProvider.PARTICIPANTS_LIST_LIMIT,a.CoreUserProvider.PARTICIPANTS_LIST_LIMIT);return{items:r,hasMoreItems:i}}))()}getPageLength(){return a.CoreUserProvider.PARTICIPANTS_LIST_LIMIT}}},1102:(e,t,r)=>{r.d(t,{G:()=>o});var i=r(3353),n=r(8785),a=r(51734),s=r(54438);let o=(()=>{var e;class CoreUserParticipantsPageModule{}return(e=CoreUserParticipantsPageModule).ɵfac=function CoreUserParticipantsPageModule_Factory(t){return new(t||e)},e.ɵmod=s.$C({type:e}),e.ɵinj=s.G2t({imports:[i.n,a._]}),CoreUserParticipantsPageModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&s.Obh(o,{declarations:[n.k],imports:[i.n,a._]}))},8785:(e,t,r)=>{r.d(t,{k:()=>E});var i=r(10467),n=r(89911),a=r(15324),s=r(2401),o=r(29492),c=r(98870),_=r(55554),l=r(32379),p=r(83696),g=r(22693),u=r(79555),P=r(44426),m=r(54438),f=r(60177),h=r(16986),d=r(66198),I=r(64422),C=r(16658),U=r(58197),T=r(88246),R=r(73465),y=r(75357),b=r(93453),S=r(73955);function CoreUserParticipantsPage_core_empty_box_7_Template(e,t){1&e&&(m.nrm(0,"core-empty-box",8),m.nI1(1,"translate")),2&e&&m.Y8G("message",m.bMT(1,1,"core.user.noparticipants"))}function CoreUserParticipantsPage_core_empty_box_8_Template(e,t){if(1&e&&(m.nrm(0,"core-empty-box",9),m.nI1(1,"translate")),2&e){const e=m.XpG();m.Y8G("message",m.bMT(1,2,"core.noresults")),m.BMQ("role",e.searchQuery?"alert":null)}}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_3_ng_container_4_Template(e,t){if(1&e&&(m.qex(0),m.EFF(1),m.nI1(2,"coreTimeAgo"),m.bVm()),2&e){const e=m.XpG(3).$implicit;m.R7$(),m.SpI("",m.bMT(2,1,e.lastcourseaccess)," ")}}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_3_ng_container_5_Template(e,t){1&e&&(m.qex(0),m.EFF(1),m.nI1(2,"translate"),m.bVm()),2&e&&(m.R7$(),m.JRh(m.bMT(2,1,"core.never")))}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_3_Template(e,t){if(1&e&&(m.j41(0,"p")(1,"strong"),m.EFF(2),m.nI1(3,"translate"),m.k0s(),m.DNE(4,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_3_ng_container_4_Template,3,3,"ng-container",6)(5,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_3_ng_container_5_Template,3,3,"ng-container",6),m.k0s()),2&e){const e=m.XpG(2).$implicit;m.R7$(2),m.SpI("",m.bMT(3,3,"core.user.lastcourseaccess"),": "),m.R7$(2),m.Y8G("ngIf",e.lastcourseaccess),m.R7$(),m.Y8G("ngIf",!e.lastcourseaccess)}}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_4_ng_container_4_Template(e,t){if(1&e&&(m.qex(0),m.EFF(1),m.nI1(2,"coreTimeAgo"),m.bVm()),2&e){const e=m.XpG(3).$implicit;m.R7$(),m.JRh(m.bMT(2,1,e.lastaccess))}}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_4_ng_container_5_Template(e,t){1&e&&(m.qex(0),m.EFF(1),m.nI1(2,"translate"),m.bVm()),2&e&&(m.R7$(),m.JRh(m.bMT(2,1,"core.never")))}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_4_Template(e,t){if(1&e&&(m.j41(0,"p")(1,"strong"),m.EFF(2),m.nI1(3,"translate"),m.k0s(),m.DNE(4,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_4_ng_container_4_Template,3,3,"ng-container",6)(5,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_4_ng_container_5_Template,3,3,"ng-container",6),m.k0s()),2&e){const e=m.XpG(2).$implicit;m.R7$(2),m.SpI("",m.bMT(3,3,"core.lastaccess"),": "),m.R7$(2),m.Y8G("ngIf",e.lastaccess),m.R7$(),m.Y8G("ngIf",!e.lastaccess)}}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_Template(e,t){if(1&e&&(m.qex(0),m.j41(1,"p",13),m.EFF(2),m.k0s(),m.DNE(3,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_3_Template,6,5,"p",6)(4,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_p_4_Template,6,5,"p",6),m.bVm()),2&e){const e=m.XpG().$implicit;m.R7$(2),m.JRh(e.fullname),m.R7$(),m.Y8G("ngIf",void 0!==e.lastcourseaccess),m.R7$(),m.Y8G("ngIf",void 0===e.lastcourseaccess&&void 0!==e.lastaccess)}}function CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_4_Template(e,t){if(1&e&&(m.qex(0),m.j41(1,"p",13),m.nrm(2,"core-format-text",14),m.k0s(),m.bVm()),2&e){const e=m.XpG().$implicit,t=m.XpG(2);m.R7$(2),m.Y8G("text",e.fullname)("highlight",t.searchQuery)("filter",!1)}}function CoreUserParticipantsPage_ion_list_9_ion_item_1_Template(e,t){if(1&e){const e=m.RV6();m.j41(0,"ion-item",11),m.bIt("click",(function CoreUserParticipantsPage_ion_list_9_ion_item_1_Template_ion_item_click_0_listener(){const t=m.eBV(e).$implicit,r=m.XpG(2);return m.Njj(r.participants.select(t))})),m.nrm(1,"core-user-avatar",12),m.j41(2,"ion-label"),m.DNE(3,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_3_Template,5,3,"ng-container",6)(4,CoreUserParticipantsPage_ion_list_9_ion_item_1_ng_container_4_Template,3,3,"ng-container",6),m.k0s()()}if(2&e){const e=t.$implicit,r=m.XpG(2);m.Y8G("detail",!0),m.BMQ("aria-current",r.participants.getItemAriaCurrent(e))("aria-label",e.fullname),m.R7$(),m.Y8G("user",e)("linkProfile",!1)("checkOnline",!0),m.R7$(2),m.Y8G("ngIf",!r.searchQuery),m.R7$(),m.Y8G("ngIf",r.searchQuery)}}function CoreUserParticipantsPage_ion_list_9_Template(e,t){if(1&e&&(m.j41(0,"ion-list"),m.DNE(1,CoreUserParticipantsPage_ion_list_9_ion_item_1_Template,5,8,"ion-item",10),m.k0s()),2&e){const e=m.XpG();m.R7$(),m.Y8G("ngForOf",e.participants.items)}}let E=(()=>{var e;class CoreUserParticipantsPage{constructor(){this.searchQuery=null,this.searchInProgress=!1,this.searchEnabled=!1,this.fetchMoreParticipantsFailed=!1;try{this.courseId=a.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.participants=new CoreUserParticipantsManager(p.u.getOrCreateSource(l.u,[this.courseId]),CoreUserParticipantsPage)}catch(e){return n.CoreDomUtils.showErrorModal(e),a.CoreNavigator.back(),void 0}}ngOnInit(){var e=this;return(0,i.A)((function*(){e.searchEnabled=yield c.CoreUser.canSearchParticipantsInSite()}))()}ngAfterViewInit(){var e=this;return(0,i.A)((function*(){yield e.fetchInitialParticipants(),yield e.participants.start(e.splitView)}))()}ionViewDidEnter(){var e=this;return(0,i.A)((function*(){yield e.participants.start()}))()}ngOnDestroy(){this.participants.destroy()}clearSearch(){var e=this;return(0,i.A)((function*(){if(null===e.searchQuery)return;const t=p.u.getOrCreateSource(l.u,[e.courseId]);e.searchQuery=null,e.searchInProgress=!1,e.participants.setSource(t),yield e.fetchInitialParticipants()}))()}search(e){var t=this;return(0,i.A)((function*(){P.p.close();const r=p.u.getOrCreateSource(l.u,[t.courseId,e]);t.searchInProgress=!0,t.searchQuery=e,t.participants.setSource(r),yield t.fetchInitialParticipants(),t.searchInProgress=!1}))()}refreshParticipants(e){var t=this;return(0,i.A)((function*(){yield _.g.ignoreErrors(c.CoreUser.invalidateParticipantsList(t.courseId)),yield _.g.ignoreErrors(t.fetchParticipants(!0)),null==e||e.complete()}))()}fetchMoreParticipants(e){var t=this;return(0,i.A)((function*(){try{yield t.fetchParticipants(!1)}catch(e){n.CoreDomUtils.showErrorModalDefault(e,"Error loading more participants"),t.fetchMoreParticipantsFailed=!0}e()}))()}fetchInitialParticipants(){var e=this;return(0,i.A)((function*(){try{yield e.fetchParticipants(!0)}catch(t){n.CoreDomUtils.showErrorModalDefault(t,"Error loading participants"),e.participants.reset()}}))()}fetchParticipants(e){var t=this;return(0,i.A)((function*(){e?yield t.participants.reload():yield t.participants.load(),t.fetchMoreParticipantsFailed=!1}))()}}return(e=CoreUserParticipantsPage).ɵfac=function CoreUserParticipantsPage_Factory(t){return new(t||e)},e.ɵcmp=m.VBU({type:e,selectors:[["page-core-user-participants"]],viewQuery:function CoreUserParticipantsPage_Query(e,t){if(1&e&&m.GBs(o.M,5),2&e){let e;m.mGM(e=m.lsd())&&(t.splitView=e.first)}},decls:11,vars:13,consts:[["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],["autocorrect","off","searchArea","CoreUserParticipants",3,"onSubmit","onClear","disabled","spellcheck","lengthCheck"],[3,"hideUntil"],["icon","far-user",3,"message",4,"ngIf"],["icon","fas-magnifying-glass",3,"message",4,"ngIf"],[4,"ngIf"],[3,"action","enabled","error"],["icon","far-user",3,"message"],["icon","fas-magnifying-glass",3,"message"],["class","ion-text-wrap","button","",3,"detail","click",4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap",3,"click","detail"],["slot","start",3,"user","linkProfile","checkOnline"],[1,"item-heading"],[3,"text","highlight","filter"]],template:function CoreUserParticipantsPage_Template(e,t){1&e&&(m.j41(0,"ion-content")(1,"core-split-view")(2,"ion-refresher",0),m.bIt("ionRefresh",(function CoreUserParticipantsPage_Template_ion_refresher_ionRefresh_2_listener(e){return t.refreshParticipants(e.target)})),m.nrm(3,"ion-refresher-content",1),m.nI1(4,"translate"),m.k0s(),m.j41(5,"core-search-box",2),m.bIt("onSubmit",(function CoreUserParticipantsPage_Template_core_search_box_onSubmit_5_listener(e){return t.search(e)}))("onClear",(function CoreUserParticipantsPage_Template_core_search_box_onClear_5_listener(){return t.clearSearch()})),m.k0s(),m.j41(6,"core-loading",3),m.DNE(7,CoreUserParticipantsPage_core_empty_box_7_Template,2,3,"core-empty-box",4)(8,CoreUserParticipantsPage_core_empty_box_8_Template,2,4,"core-empty-box",5)(9,CoreUserParticipantsPage_ion_list_9_Template,2,1,"ion-list",6),m.j41(10,"core-infinite-loading",7),m.bIt("action",(function CoreUserParticipantsPage_Template_core_infinite_loading_action_10_listener(e){return t.fetchMoreParticipants(e)})),m.k0s()()()()),2&e&&(m.R7$(2),m.Y8G("disabled",!t.participants.loaded||t.searchInProgress),m.R7$(),m.FS9("pullingText",m.bMT(4,11,"core.pulltorefresh")),m.R7$(2),m.Y8G("disabled",t.searchInProgress)("spellcheck",!1)("lengthCheck",1),m.R7$(),m.Y8G("hideUntil",t.participants.loaded),m.R7$(),m.Y8G("ngIf",t.participants.empty&&!t.searchInProgress&&!t.searchQuery),m.R7$(),m.Y8G("ngIf",t.participants.empty&&!t.searchInProgress&&t.searchQuery),m.R7$(),m.Y8G("ngIf",!t.participants.empty),m.R7$(),m.Y8G("enabled",t.participants.loaded&&!t.participants.completed)("error",t.fetchMoreParticipantsFailed))},dependencies:[f.Sq,f.bT,h.h,d.b,I.R,o.M,C.T,U.B,T.i,R.W9,R.uz,R.he,R.nf,R.To,R.Ki,y.M,b.A,S.D9],encapsulation:2}),CoreUserParticipantsPage})();class CoreUserParticipantsManager extends s.R{logActivity(){var e=this;return(0,i.A)((function*(){yield _.g.ignoreErrors(c.CoreUser.logParticipantsView(e.getSource().COURSE_ID)),g.OF.logEvent({type:g.qr.VIEW_ITEM_LIST,ws:"core_user_view_user_list",name:u.HT.instant("core.user.participants"),data:{courseid:e.getSource().COURSE_ID,category:"user"},url:`/user/index.php?id=${e.getSource().COURSE_ID}`})}))()}}}}]);