"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1505],{71505:(e,n,t)=>{t.r(n),t.d(n,{default:()=>J});var o=t(21182),c=t(3353),i=t(10467),a=t(52749),l=t(89911),r=t(37775),_=t(15324),s=t(49882),p=t(22693),g=t(79555),m=t(65614),P=t(89417),y=t(8014),u=t(73465),f=t(93417),d=t(82907),C=t(53794),b=t(6319),h=t(23780),T=t(55554),I=t(54438),R=t(60177),M=t(7476),v=t(25880),O=t(64422),A=t(17778),G=t(86198),k=t(58197),F=t(23007),$=t(35407),x=t(88246),S=t(43570),E=t(73955);const _c0=e=>({$a:e}),_c1=e=>({policyname:e}),_c2=e=>({policy:e});function CorePolicySitePolicyPage_ion_title_5_Template(e,n){if(1&e&&(I.j41(0,"ion-title")(1,"h1"),I.nrm(2,"core-format-text",10),I.k0s()()),2&e){const e=I.XpG();I.R7$(2),I.Y8G("text",e.siteName)("contextInstanceId",0)}}function CorePolicySitePolicyPage_form_12_ion_item_1_Template(e,n){if(1&e&&(I.j41(0,"ion-item",17)(1,"ion-label")(2,"p"),I.EFF(3),I.nI1(4,"translate"),I.k0s()()()),2&e){const e=I.XpG(2);I.R7$(3),I.JRh(I.i5U(4,1,"core.policy.steppolicies",I.eq3(4,_c0,e.stepData)))}}function CorePolicySitePolicyPage_form_12_ion_item_2_p_4_Template(e,n){if(1&e&&(I.j41(0,"p"),I.EFF(1),I.k0s()),2&e){const e=I.XpG(3);I.R7$(),I.JRh(e.subTitle)}}function CorePolicySitePolicyPage_form_12_ion_item_2_Template(e,n){if(1&e&&(I.j41(0,"ion-item",18)(1,"ion-label")(2,"h2"),I.EFF(3),I.k0s(),I.DNE(4,CorePolicySitePolicyPage_form_12_ion_item_2_p_4_Template,2,1,"p",3),I.k0s()()),2&e){const e=I.XpG(2);I.R7$(3),I.JRh(e.title),I.R7$(),I.Y8G("ngIf",e.subTitle)}}function CorePolicySitePolicyPage_form_12_ng_container_4_core_iframe_16_Template(e,n){if(1&e&&I.nrm(0,"core-iframe",28),2&e){const e=I.XpG(3);I.Y8G("src",e.sitePoliciesURL)}}function CorePolicySitePolicyPage_form_12_ng_container_4_p_19_Template(e,n){1&e&&(I.j41(0,"p",29),I.EFF(1),I.nI1(2,"translate"),I.nI1(3,"translate"),I.k0s()),2&e&&(I.Y8G("core-mark-required",!0),I.R7$(),I.SpI(" ",I.i5U(3,4,"core.policy.havereadandagreepolicy",I.eq3(7,_c1,I.bMT(2,2,"core.policy.policyagreement")))," "))}function CorePolicySitePolicyPage_form_12_ng_container_4_p_20_Template(e,n){1&e&&(I.j41(0,"p",29),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.Y8G("core-mark-required",!0),I.R7$(),I.SpI(" ",I.bMT(2,2,"core.policy.policyacceptmandatory")," "))}function CorePolicySitePolicyPage_form_12_ng_container_4_Template(e,n){if(1&e&&(I.qex(0),I.j41(1,"ion-card",19)(2,"ion-item",18),I.nrm(3,"ion-icon",20),I.j41(4,"ion-label")(5,"p"),I.EFF(6),I.nI1(7,"translate"),I.k0s()()()(),I.j41(8,"ion-item",21)(9,"ion-label")(10,"p")(11,"a",22),I.EFF(12),I.nI1(13,"translate"),I.nrm(14,"ion-icon",23),I.k0s()()()(),I.j41(15,"div",24),I.DNE(16,CorePolicySitePolicyPage_form_12_ng_container_4_core_iframe_16_Template,1,1,"core-iframe",25),I.k0s(),I.j41(17,"ion-item",18)(18,"ion-checkbox",26),I.DNE(19,CorePolicySitePolicyPage_form_12_ng_container_4_p_19_Template,4,9,"p",27)(20,CorePolicySitePolicyPage_form_12_ng_container_4_p_20_Template,3,4,"p",27),I.k0s()(),I.bVm()),2&e){const e=I.XpG(2);I.R7$(6),I.JRh(I.bMT(7,9,"core.policy.policyagree")),I.R7$(5),I.Y8G("href",e.sitePoliciesURL,I.B4B)("capture",!1),I.R7$(),I.SpI(" ",I.bMT(13,11,"core.policy.policyagreementclick"),""),I.R7$(3),I.AVh("core-policy-has-iframe",e.showInline),I.R7$(),I.Y8G("ngIf",e.showInline),I.R7$(3),I.Y8G("ngIf",e.isManageAcceptancesAvailable),I.R7$(),I.Y8G("ngIf",!e.isManageAcceptancesAvailable)}}function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_1_Template(e,n){if(1&e){const e=I.RV6();I.qex(0),I.j41(1,"ion-item",31)(2,"ion-label")(3,"core-format-text",32),I.bIt("afterRender",(function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_1_Template_core_format_text_afterRender_3_listener(){I.eBV(e);const n=I.XpG(3);return I.Njj(n.checkScroll())})),I.k0s()()(),I.j41(4,"ion-item",33)(5,"ion-label")(6,"core-format-text",32),I.bIt("afterRender",(function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_1_Template_core_format_text_afterRender_6_listener(){I.eBV(e);const n=I.XpG(3);return I.Njj(n.checkScroll())})),I.k0s()()(),I.bVm()}if(2&e){const e=I.XpG(3);I.R7$(3),I.Y8G("text",e.currentPolicy.summary)("contextInstanceId",0),I.R7$(3),I.Y8G("text",e.currentPolicy.content)("contextInstanceId",0)}}function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_ion_item_7_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"ion-item",38),I.bIt("click",(function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_ion_item_7_Template_ion_item_click_0_listener(){I.eBV(e);const n=I.XpG().$implicit,t=I.XpG(4);return I.Njj(t.viewFullPolicy(n))})),I.j41(1,"ion-label"),I.nrm(2,"p",39),I.k0s()()}if(2&e){const e=I.XpG().$implicit;I.R7$(2),I.Y8G("innerHTML",e.referToFullPolicyText,I.npT)}}function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_ng_container_8_Template(e,n){1&e&&I.eu8(0)}function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_Template(e,n){if(1&e){const e=I.RV6();I.qex(0),I.j41(1,"ion-item",18)(2,"ion-label")(3,"h2"),I.EFF(4),I.k0s(),I.j41(5,"div",35)(6,"core-format-text",32),I.bIt("afterRender",(function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_Template_core_format_text_afterRender_6_listener(){I.eBV(e);const n=I.XpG(4);return I.Njj(n.checkScroll())})),I.k0s()()()(),I.DNE(7,CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_ion_item_7_Template,3,1,"ion-item",36)(8,CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_ng_container_8_Template,1,0,"ng-container",37),I.bVm()}if(2&e){const e=n.$implicit;I.XpG(4);const t=I.sdS(14);I.R7$(4),I.JRh(e.name),I.R7$(),I.Y8G("collapsible-item",64),I.R7$(),I.Y8G("text",e.summary)("contextInstanceId",0),I.R7$(),I.Y8G("ngIf",e.referToFullPolicyText),I.R7$(),I.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",I.eq3(7,_c2,e))}}function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_Template(e,n){if(1&e&&(I.qex(0),I.DNE(1,CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_ng_container_1_Template,9,9,"ng-container",34),I.bVm()),2&e){const e=I.XpG(3);I.R7$(),I.Y8G("ngForOf",e.pendingPolicies)}}function CorePolicySitePolicyPage_form_12_ng_container_5_ion_item_3_p_2_Template(e,n){if(1&e&&(I.j41(0,"p"),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e){const e=I.XpG(4);I.R7$(),I.JRh(I.i5U(2,1,"core.policy.steppolicies",I.eq3(4,_c0,e.stepData)))}}function CorePolicySitePolicyPage_form_12_ng_container_5_ion_item_3_ion_button_3_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"ion-button",42),I.nI1(1,"translate"),I.bIt("click",(function CorePolicySitePolicyPage_form_12_ng_container_5_ion_item_3_ion_button_3_Template_ion_button_click_0_listener(n){I.eBV(e);const t=I.XpG(4);return I.Njj(t.scrollTop(n))})),I.nrm(2,"ion-icon",43),I.k0s()}2&e&&I.Y8G("ariaLabel",I.bMT(1,1,"core.policy.backtotop"))}function CorePolicySitePolicyPage_form_12_ng_container_5_ion_item_3_Template(e,n){if(1&e&&(I.j41(0,"ion-item",40)(1,"ion-label"),I.DNE(2,CorePolicySitePolicyPage_form_12_ng_container_5_ion_item_3_p_2_Template,3,6,"p",3),I.k0s(),I.DNE(3,CorePolicySitePolicyPage_form_12_ng_container_5_ion_item_3_ion_button_3_Template,3,3,"ion-button",41),I.k0s()),2&e){const e=I.XpG(3);I.R7$(2),I.Y8G("ngIf",e.stepData),I.R7$(),I.Y8G("ngIf",e.hasScroll)}}function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_4_ng_container_1_Template(e,n){1&e&&I.eu8(0)}function CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_4_Template(e,n){if(1&e&&(I.qex(0),I.DNE(1,CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_4_ng_container_1_Template,1,0,"ng-container",37),I.bVm()),2&e){const e=I.XpG(3),n=I.sdS(14);I.R7$(),I.Y8G("ngTemplateOutlet",n)("ngTemplateOutletContext",I.eq3(2,_c2,e.currentPolicy))}}function CorePolicySitePolicyPage_form_12_ng_container_5_Template(e,n){if(1&e&&(I.qex(0),I.DNE(1,CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_1_Template,7,4,"ng-container",3)(2,CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_2_Template,2,1,"ng-container",3)(3,CorePolicySitePolicyPage_form_12_ng_container_5_ion_item_3_Template,4,2,"ion-item",30)(4,CorePolicySitePolicyPage_form_12_ng_container_5_ng_container_4_Template,2,4,"ng-container",3),I.bVm()),2&e){const e=I.XpG(2);I.R7$(),I.Y8G("ngIf",e.currentPolicy),I.R7$(),I.Y8G("ngIf",e.showConsentForm),I.R7$(),I.Y8G("ngIf",e.stepData||e.hasScroll),I.R7$(),I.Y8G("ngIf",e.agreeInOwnPage)}}function CorePolicySitePolicyPage_form_12_ion_button_7_Template(e,n){if(1&e&&(I.j41(0,"ion-button",44),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e){const e=I.XpG(2);I.Y8G("expand",e.isTablet?null:"block")("disabled",(e.isPoliciesURL||e.agreeInOwnPage)&&!e.policiesForm.valid),I.R7$(),I.SpI(" ",I.bMT(2,3,"core.continue")," ")}}function CorePolicySitePolicyPage_form_12_ion_button_8_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"ion-button",45),I.bIt("click",(function CorePolicySitePolicyPage_form_12_ion_button_8_Template_ion_button_click_0_listener(n){I.eBV(e);const t=I.XpG(2);return I.Njj(t.nextPolicy(n))})),I.EFF(1),I.nI1(2,"translate"),I.k0s()}if(2&e){const e=I.XpG(2);I.Y8G("expand",e.isTablet?null:"block"),I.R7$(),I.SpI(" ",I.bMT(2,2,"core.next")," ")}}function CorePolicySitePolicyPage_form_12_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"form",11),I.bIt("ngSubmit",(function CorePolicySitePolicyPage_form_12_Template_form_ngSubmit_0_listener(n){I.eBV(e);const t=I.XpG();return I.Njj(t.submitAcceptances(n))})),I.DNE(1,CorePolicySitePolicyPage_form_12_ion_item_1_Template,5,6,"ion-item",12)(2,CorePolicySitePolicyPage_form_12_ion_item_2_Template,5,2,"ion-item",13),I.nrm(3,"hr"),I.DNE(4,CorePolicySitePolicyPage_form_12_ng_container_4_Template,21,13,"ng-container",3)(5,CorePolicySitePolicyPage_form_12_ng_container_5_Template,5,4,"ng-container",3),I.j41(6,"div",14),I.DNE(7,CorePolicySitePolicyPage_form_12_ion_button_7_Template,3,5,"ion-button",15)(8,CorePolicySitePolicyPage_form_12_ion_button_8_Template,3,4,"ion-button",16),I.k0s()()}if(2&e){const e=I.XpG();I.Y8G("formGroup",e.policiesForm),I.R7$(),I.Y8G("ngIf",e.stepData),I.R7$(),I.Y8G("ngIf",e.title),I.R7$(2),I.Y8G("ngIf",e.isPoliciesURL&&e.sitePoliciesURL),I.R7$(),I.Y8G("ngIf",!e.isPoliciesURL&&(e.currentPolicy||e.showConsentForm)),I.R7$(2),I.Y8G("ngIf",e.isPoliciesURL&&e.sitePoliciesURL||e.showConsentForm||e.agreeInOwnPage),I.R7$(),I.Y8G("ngIf",!e.isPoliciesURL&&e.currentPolicy&&!e.agreeInOwnPage)}}function CorePolicySitePolicyPage_ng_template_13_ion_item_0_Template(e,n){if(1&e&&(I.j41(0,"ion-item",18)(1,"ion-checkbox",47)(2,"p",29),I.EFF(3),I.nI1(4,"translate"),I.k0s()(),I.nrm(5,"core-input-errors",48),I.k0s()),2&e){const e=I.XpG().policy,n=I.XpG();I.R7$(),I.Y8G("formControl",n.policiesForm.controls["agreepolicy"+e.versionid]),I.R7$(),I.Y8G("core-mark-required",!0),I.R7$(),I.SpI(" ",I.i5U(4,5,"core.policy.havereadandagreepolicy",I.eq3(8,_c1,e.name))," "),I.R7$(2),I.Y8G("control",n.policiesForm.controls["agreepolicy"+e.versionid])("errorMessages",n.policiesErrors)}}function CorePolicySitePolicyPage_ng_template_13_ion_radio_group_1_Template(e,n){if(1&e&&(I.j41(0,"ion-radio-group",47)(1,"ion-item",18)(2,"ion-radio",49)(3,"p"),I.EFF(4),I.nI1(5,"translate"),I.k0s()()(),I.j41(6,"ion-item",18)(7,"ion-radio",49)(8,"p"),I.EFF(9),I.nI1(10,"translate"),I.k0s()(),I.nrm(11,"core-input-errors",48),I.k0s()()),2&e){const e=I.XpG().policy,n=I.XpG();I.Y8G("formControl",n.policiesForm.controls["agreepolicy"+e.versionid]),I.R7$(2),I.Y8G("value",1),I.R7$(2),I.JRh(I.i5U(5,7,"core.policy.havereadandagreepolicy",I.eq3(13,_c1,e.name))),I.R7$(3),I.Y8G("value",0),I.R7$(2),I.JRh(I.i5U(10,10,"core.policy.idontagree",I.eq3(15,_c0,e.name))),I.R7$(2),I.Y8G("control",n.policiesForm.controls["agreepolicy"+e.versionid])("errorMessages",n.policiesErrors)}}function CorePolicySitePolicyPage_ng_template_13_Template(e,n){if(1&e&&I.DNE(0,CorePolicySitePolicyPage_ng_template_13_ion_item_0_Template,6,10,"ion-item",13)(1,CorePolicySitePolicyPage_ng_template_13_ion_radio_group_1_Template,12,17,"ion-radio-group",46),2&e){const e=n.policy,t=I.XpG();I.Y8G("ngIf",!e.optional&&t.policiesForm),I.R7$(),I.Y8G("ngIf",e.optional&&t.policiesForm)}}let j=(()=>{var e;class CorePolicySitePolicyPage{constructor(e,n){this.elementRef=e,this.changeDetector=n,this.isManageAcceptancesAvailable=!1,this.isPoliciesURL=!1,this.title="",this.hasScroll=!1,this.isTablet=!1,this.agreeInOwnPage=!1,this.numPolicy=1,this.showConsentForm=!1,this.policiesErrors={required:g.HT.instant("core.policy.mustagreetocontinue")}}ngOnInit(){var e=this;return(0,i.A)((function*(){e.siteId=_.CoreNavigator.getRouteParam("siteId");try{e.currentSite=a.CoreSites.getRequiredCurrentSite(),e.siteName=(yield T.g.ignoreErrors(e.currentSite.getSiteName(),""))||""}catch{return e.cancel(),void 0}const n=e.currentSite.id;if(e.siteId=e.siteId||n,e.siteId!=n)return e.cancel(),void 0;e.isTablet=f.CoreScreen.isTablet,e.layoutSubscription=f.CoreScreen.layoutObservable.subscribe((()=>{e.isTablet=f.CoreScreen.isTablet})),e.isManageAcceptancesAvailable=yield m.CorePolicy.isManageAcceptancesAvailable(e.siteId),e.isPoliciesURL=!e.isManageAcceptancesAvailable||"tool_policy"!==(yield e.currentSite.getConfig("sitepolicyhandler")),e.isPoliciesURL?(yield e.fetchSitePoliciesURL(),e.initFormForPoliciesURL()):yield e.fetchNextPoliciesToAccept()}))()}fetchSitePoliciesURL(){var e=this;return(0,i.A)((function*(){e.title=g.HT.instant("core.policy.policyagreement"),e.subTitle=void 0;try{e.sitePoliciesURL=yield m.CorePolicy.getSitePoliciesURL(e.siteId)}catch(n){return l.CoreDomUtils.showErrorModalDefault(n,"Error getting site policy."),e.cancel(),void 0}try{const n=yield r.CoreMimetypeUtils.getMimeTypeFromUrl(e.sitePoliciesURL),t=r.CoreMimetypeUtils.getExtension(n,e.sitePoliciesURL);e.showInline="html"==t||"htm"==t}catch{e.showInline=!1}finally{e.policyLoaded=!0}p.OF.logEvent({type:p.qr.VIEW_ITEM,ws:"auth_email_get_signup_settings",name:g.HT.instant("core.policy.policyagreement"),data:{category:"policy"},url:"/user/policy.php"})}))()}fetchNextPoliciesToAccept(){var e=this;return(0,i.A)((function*(){try{e.scrollTop();const n=yield m.CorePolicy.getNextPendingPolicies({readingStrategy:2,siteId:e.siteId});e.pendingPolicies=n.map((e=>(e.referToFullPolicyText=g.HT.instant("core.policy.refertofullpolicytext",{$a:`<span class="core-site-policy-full-policy-link">${e.name}</span>`}),e)));const t=e.pendingPolicies[0];if(!t)return yield e.finishAcceptingPolicies(),void 0;e.initFormForPendingPolicies(),e.agreeInOwnPage=t.agreementstyle===m.CorePolicyAgreementStyle.OwnPage,e.showConsentForm=!1,e.numPolicy=1,e.setCurrentPolicy(t),e.policyLoaded=!0}catch(n){l.CoreDomUtils.showErrorModalDefault(n,"Error getting site policy."),e.cancel()}}))()}logAnalyticsPolicyView(){if(!this.currentPolicy)return;const e={versionid:this.currentPolicy.versionid};var n,t;this.agreeInOwnPage||(e.numpolicy=this.numPolicy,e.totalpolicies=null!==(n=null===(t=this.pendingPolicies)||void 0===t?void 0:t.length)&&void 0!==n?n:this.numPolicy);p.OF.logEvent({type:p.qr.VIEW_ITEM,ws:"tool_policy_get_user_acceptances",name:this.currentPolicy.name,data:e,url:y.F.addParamsToUrl("/admin/tool/policy/view.php",e)})}logAnalyticsConsentFormView(){p.OF.logEvent({type:p.qr.VIEW_ITEM,ws:"tool_policy_get_user_acceptances",name:g.HT.instant("core.policy.consentpagetitle"),data:{},url:y.F.addParamsToUrl("/admin/tool/policy/index.php")})}initFormForPoliciesURL(){this.policiesForm=new P.gE({agreepolicy:new P.MJ(!1,{validators:P.k0.requiredTrue,nonNullable:!0})})}initFormForPendingPolicies(){var e;this.policiesForm=new P.gE({}),null===(e=this.pendingPolicies)||void 0===e||e.forEach((e=>{var n,t;e.optional?null===(n=this.policiesForm)||void 0===n||n.addControl("agreepolicy"+e.versionid,new P.MJ(void 0,{validators:P.k0.required})):null===(t=this.policiesForm)||void 0===t||t.addControl("agreepolicy"+e.versionid,new P.MJ(!1,{validators:P.k0.requiredTrue,nonNullable:!0}))}))}cancel(){return(0,i.A)((function*(){yield a.CoreSites.logout()}))()}nextPolicy(e){if(e.preventDefault(),e.stopPropagation(),this.pendingPolicies){if(this.scrollTop(),this.numPolicy<this.pendingPolicies.length)return this.numPolicy++,this.setCurrentPolicy(this.pendingPolicies[this.numPolicy-1]),void 0;this.currentPolicy=void 0,this.stepData=void 0,this.showConsentForm=!0,this.title=g.HT.instant("core.policy.consentpagetitle"),this.subTitle=g.HT.instant("core.policy.agreepolicies"),this.logAnalyticsConsentFormView()}}setCurrentPolicy(e){var n,t;e&&(this.hasScroll=!1,this.currentPolicy=e,this.title=e.name||"",this.subTitle=void 0,this.stepData=this.agreeInOwnPage?void 0:{numpolicy:this.numPolicy,totalpolicies:null!==(n=null===(t=this.pendingPolicies)||void 0===t?void 0:t.length)&&void 0!==n?n:this.numPolicy},this.logAnalyticsPolicyView())}checkScroll(){var e=this;return(0,i.A)((function*(){var n;yield C.H.wait(400);const t=yield null===(n=e.content)||void 0===n?void 0:n.getScrollElement();e.hasScroll=!!t&&t.scrollHeight>t.clientHeight+2}))()}submitAcceptances(e){var n=this;return(0,i.A)((function*(){var t;if(e.preventDefault(),e.stopPropagation(),null===(t=n.policiesForm)||void 0===t||!t.valid){for(const e in null===(o=n.policiesForm)||void 0===o?void 0:o.controls){var o;n.policiesForm.controls[e].markAsDirty()}n.changeDetector.detectChanges();return(yield d.y.scrollToInputError(n.elementRef.nativeElement))||l.CoreDomUtils.showErrorModal("core.policy.mustagreetocontinue",!0),void 0}const c=yield h.CoreLoadings.show("core.sending",!0);try{if(!n.isPoliciesURL)return yield n.acceptPendingPolicies(),void 0;yield m.CorePolicy.acceptMandatorySitePolicies(n.siteId),yield n.finishAcceptingPolicies()}catch(e){l.CoreDomUtils.showErrorModalDefault(e,"Error accepting site policies.")}finally{c.dismiss()}}))()}acceptPendingPolicies(){var e=this;return(0,i.A)((function*(){var n;if(!e.pendingPolicies)return;const t={};null===(n=e.pendingPolicies)||void 0===n||n.forEach((n=>{var o;const c=null===(o=e.policiesForm)||void 0===o?void 0:o.controls["agreepolicy"+n.versionid];if(c)if(n.optional){if(null==c.value)return l.CoreDomUtils.showErrorModal("core.policy.mustagreetocontinue",!0),void 0;t[n.versionid]=c.value}else{if(!c.value)return l.CoreDomUtils.showErrorModal("core.policy.mustagreetocontinue",!0),void 0;t[n.versionid]=1}})),yield m.CorePolicy.setUserAcceptances(t,e.siteId),yield e.fetchNextPoliciesToAccept()}))()}finishAcceptingPolicies(){var e=this;return(0,i.A)((function*(){yield T.g.ignoreErrors(e.currentSite.invalidateWsCache()),s.z.trigger(s.z.SITE_POLICY_AGREED,{},e.siteId),yield _.CoreNavigator.navigateToSiteHome()}))()}scrollTop(e){var n;null==e||e.preventDefault(),null==e||e.stopPropagation(),null===(n=this.content)||void 0===n||n.scrollToTop(400)}viewFullPolicy(e){return(0,i.A)((function*(){const{CorePolicyViewPolicyModalComponent:n}=yield t.e(4619).then(t.bind(t,54619));b.I.openModal({component:n,componentProps:{policy:e}})}))()}ngOnDestroy(){var e;null===(e=this.layoutSubscription)||void 0===e||e.unsubscribe()}}return(e=CorePolicySitePolicyPage).ɵfac=function CorePolicySitePolicyPage_Factory(n){return new(n||e)(I.rXU(I.aKT),I.rXU(I.gRc))},e.ɵcmp=I.VBU({type:e,selectors:[["page-core-policy-site-policy"]],viewQuery:function CorePolicySitePolicyPage_Query(e,n){if(1&e&&I.GBs(u.W9,5),2&e){let e;I.mGM(e=I.lsd())&&(n.content=e.first)}},decls:15,vars:9,consts:[["policyForm",""],["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],["fill","clear",3,"click","ariaLabel"],["name","fas-xmark","slot","icon-only","aria-hidden","true"],[1,"limited-width"],[3,"hideUntil"],[3,"formGroup","ngSubmit",4,"ngIf"],["contextLevel","system",3,"text","contextInstanceId"],[3,"ngSubmit","formGroup"],["class","core-site-policy-top-bar",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],[1,"core-site-policy-buttons","ion-margin-horizontal"],["type","submit","class","ion-text-wrap",3,"expand","disabled",4,"ngIf"],["class","ion-text-wrap",3,"expand","click",4,"ngIf"],[1,"core-site-policy-top-bar"],[1,"ion-text-wrap"],[1,"core-info-card"],["name","fas-circle-info","slot","start","aria-hidden","true"],[1,"ion-text-wrap","core-site-policy-link"],["core-link","",3,"href","capture"],["name","fas-up-right-from-square","aria-hidden","true"],[1,"core-site-policy-iframe-container"],[3,"src",4,"ngIf"],["name","agreepolicy","formControlName","agreepolicy"],[3,"core-mark-required",4,"ngIf"],[3,"src"],[3,"core-mark-required"],["class","core-site-policy-bottom-bar",4,"ngIf"],[1,"ion-text-wrap","core-site-policy-summary"],["contextLevel","system",3,"afterRender","text","contextInstanceId"],[1,"ion-text-wrap","core-site-policy-content"],[4,"ngFor","ngForOf"],[3,"collapsible-item"],["class","ion-text-wrap","button","","detail","false",3,"click",4,"ngIf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["button","","detail","false",1,"ion-text-wrap",3,"click"],[3,"innerHTML"],[1,"core-site-policy-bottom-bar"],["class","core-site-policy-go-top-button","color","secondary","slot","end",3,"ariaLabel","click",4,"ngIf"],["color","secondary","slot","end",1,"core-site-policy-go-top-button",3,"click","ariaLabel"],["name","fas-chevron-up","slot","icon-only","aria-hidden","true"],["type","submit",1,"ion-text-wrap",3,"expand","disabled"],[1,"ion-text-wrap",3,"click","expand"],[3,"formControl",4,"ngIf"],[3,"formControl"],[3,"control","errorMessages"],[3,"value"]],template:function CorePolicySitePolicyPage_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),I.nrm(3,"ion-back-button",2),I.nI1(4,"translate"),I.k0s(),I.DNE(5,CorePolicySitePolicyPage_ion_title_5_Template,3,2,"ion-title",3),I.j41(6,"ion-buttons",4)(7,"ion-button",5),I.nI1(8,"translate"),I.bIt("click",(function CorePolicySitePolicyPage_Template_ion_button_click_7_listener(){return I.eBV(e),I.Njj(n.cancel())})),I.nrm(9,"ion-icon",6),I.k0s()()()(),I.j41(10,"ion-content",7)(11,"core-loading",8),I.DNE(12,CorePolicySitePolicyPage_form_12_Template,9,7,"form",9),I.k0s()(),I.DNE(13,CorePolicySitePolicyPage_ng_template_13_Template,2,2,"ng-template",null,0,I.C5r)}2&e&&(I.R7$(3),I.Y8G("text",I.bMT(4,5,"core.back")),I.R7$(2),I.Y8G("ngIf",n.siteName),I.R7$(2),I.Y8G("ariaLabel",I.bMT(8,7,"core.cancel")),I.R7$(4),I.Y8G("hideUntil",n.policyLoaded),I.R7$(),I.Y8G("ngIf",n.policiesForm))},dependencies:[R.Sq,R.bT,R.T3,M.l,v.q,O.R,A.j,G.t,k.B,F.j,$.K,x.i,S.T,P.qT,P.BC,P.cb,u.Jm,u.QW,u.b_,u.eY,u.W9,u.eU,u.iq,u.uz,u.he,u.KO,u.f0,u.BC,u.ai,u.hB,u.Je,u.el,P.l_,P.j4,P.JD,E.D9],styles:["[_nghost-%COMP%]   hr[_ngcontent-%COMP%]{background:var(--black);margin:0 16px}[_nghost-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-grow:1;height:100%}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%], [_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-info-card[_ngcontent-%COMP%]{flex-shrink:0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--inner-border-width: 0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-top-bar[_ngcontent-%COMP%], [_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-bottom-bar[_ngcontent-%COMP%]{font-size:.875rem}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-top-bar[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-bottom-bar[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-link[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-decoration:underline;font-size:1rem}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-link[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:.875rem;margin-inline-start:4px;margin-inline-end:0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-iframe-container[_ngcontent-%COMP%]{margin:8px;display:flex;flex-grow:1}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-content[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-go-top-button[_ngcontent-%COMP%]{--border-radius: 50%;--box-shadow: 0 3px 5px -1px rgba(0, 0, 0, .2), 0 6px 10px 0 rgba(0, 0, 0, .14), 0 1px 18px 0 rgba(0, 0, 0, .12);margin-bottom:8px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-buttons[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .core-site-policy-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-left:0;margin-right:0;margin-bottom:12px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]     ion-label .core-site-policy-full-policy-link{color:var(--core-link-color)}"]}),CorePolicySitePolicyPage})();var Y=t(78908),w=t(24742),D=t(16340),V=t(8398),X=t(16986),N=t(37557),U=t(8199),q=t(59528);const acceptances_c0=e=>({policy:e,isPreviousVersion:!1,hidden:!1}),acceptances_c1=e=>({policy:e,isPreviousVersion:!1}),acceptances_c2=e=>({$a:e}),_c3=e=>({policy:e,isPreviousVersion:!0}),_c4=e=>({policyname:e});function CorePolicyAcceptancesPage_div_22_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"div",16)(1,"ion-button",17),I.bIt("click",(function CorePolicyAcceptancesPage_div_22_Template_ion_button_click_1_listener(n){I.eBV(e);const t=I.XpG();return I.Njj(t.openContactDPO(n))})),I.EFF(2),I.nI1(3,"translate"),I.k0s()()}2&e&&(I.R7$(2),I.JRh(I.bMT(3,1,"core.contactverb")))}function CorePolicyAcceptancesPage_table_24_ng_container_15_Template(e,n){1&e&&(I.qex(0),I.j41(1,"th"),I.EFF(2),I.nI1(3,"translate"),I.k0s(),I.j41(4,"th"),I.EFF(5),I.nI1(6,"translate"),I.k0s(),I.bVm()),2&e&&(I.R7$(2),I.JRh(I.bMT(3,2,"core.policy.responseby")),I.R7$(3),I.JRh(I.bMT(6,4,"core.policy.acceptancenote")))}function CorePolicyAcceptancesPage_table_24_ng_container_17_ng_container_1_Template(e,n){1&e&&I.eu8(0)}function CorePolicyAcceptancesPage_table_24_ng_container_17_Template(e,n){if(1&e&&(I.qex(0),I.DNE(1,CorePolicyAcceptancesPage_table_24_ng_container_17_ng_container_1_Template,1,0,"ng-container",22),I.bVm()),2&e){const e=n.$implicit;I.XpG(2);const t=I.sdS(28);I.R7$(),I.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",I.eq3(2,acceptances_c0,e))}}function CorePolicyAcceptancesPage_table_24_Template(e,n){if(1&e&&(I.j41(0,"table",18)(1,"thead")(2,"tr")(3,"th"),I.EFF(4),I.nI1(5,"translate"),I.k0s(),I.j41(6,"th"),I.EFF(7),I.nI1(8,"translate"),I.k0s(),I.j41(9,"th"),I.EFF(10),I.nI1(11,"translate"),I.k0s(),I.j41(12,"th"),I.EFF(13),I.nI1(14,"translate"),I.k0s(),I.DNE(15,CorePolicyAcceptancesPage_table_24_ng_container_15_Template,7,6,"ng-container",19),I.k0s()(),I.j41(16,"tbody",20),I.DNE(17,CorePolicyAcceptancesPage_table_24_ng_container_17_Template,2,4,"ng-container",21),I.k0s()()),2&e){const e=I.XpG();I.R7$(4),I.JRh(I.bMT(5,6,"core.policy.policydocname")),I.R7$(3),I.JRh(I.bMT(8,8,"core.policy.policydocrevision")),I.R7$(3),I.JRh(I.bMT(11,10,"core.policy.response")),I.R7$(3),I.JRh(I.bMT(14,12,"core.policy.responseon")),I.R7$(2),I.Y8G("ngIf",e.hasOnBehalf),I.R7$(2),I.Y8G("ngForOf",e.policies)}}function CorePolicyAcceptancesPage_div_25_ng_container_1_ng_container_1_Template(e,n){1&e&&I.eu8(0)}function CorePolicyAcceptancesPage_div_25_ng_container_1_Template(e,n){if(1&e&&(I.qex(0),I.DNE(1,CorePolicyAcceptancesPage_div_25_ng_container_1_ng_container_1_Template,1,0,"ng-container",22),I.bVm()),2&e){const e=n.$implicit;I.XpG(2);const t=I.sdS(30);I.R7$(),I.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",I.eq3(2,acceptances_c1,e))}}function CorePolicyAcceptancesPage_div_25_Template(e,n){if(1&e&&(I.j41(0,"div",23),I.DNE(1,CorePolicyAcceptancesPage_div_25_ng_container_1_Template,2,4,"ng-container",21),I.k0s()),2&e){const e=I.XpG();I.R7$(),I.Y8G("ngForOf",e.policies)}}function CorePolicyAcceptancesPage_core_empty_box_26_Template(e,n){1&e&&(I.nrm(0,"core-empty-box",24),I.nI1(1,"translate")),2&e&&I.Y8G("message",I.bMT(1,1,"core.policy.nopoliciesyet"))}function CorePolicyAcceptancesPage_ng_template_27_ion_icon_2_Template(e,n){1&e&&I.nrm(0,"ion-icon",37)}function CorePolicyAcceptancesPage_ng_template_27_ion_icon_3_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"ion-icon",38),I.nI1(1,"translate"),I.bIt("ariaButtonClick",(function CorePolicyAcceptancesPage_ng_template_27_ion_icon_3_Template_ion_icon_ariaButtonClick_0_listener(n){I.eBV(e);const t=I.XpG().policy,o=I.XpG();return I.Njj(o.toggle(n,t))})),I.k0s()}if(2&e){const e=I.XpG().policy;I.AVh("expandable-status-icon-expanded",e.expanded),I.BMQ("aria-expanded",e.expanded)("aria-label",I.bMT(1,4,e.expanded?"core.collapse":"core.expand"))}}function CorePolicyAcceptancesPage_ng_template_27_ion_icon_4_Template(e,n){1&e&&I.nrm(0,"ion-icon",39)}function CorePolicyAcceptancesPage_ng_template_27_ion_badge_10_Template(e,n){1&e&&(I.j41(0,"ion-badge",40),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.R7$(),I.SpI(" ",I.bMT(2,1,"core.policy.status1")," "))}function CorePolicyAcceptancesPage_ng_template_27_ion_badge_11_Template(e,n){1&e&&(I.j41(0,"ion-badge",41),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.R7$(),I.SpI(" ",I.bMT(2,1,"core.policy.status2")," "))}function CorePolicyAcceptancesPage_ng_template_27_ion_badge_12_Template(e,n){1&e&&(I.j41(0,"ion-badge",42),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.R7$(),I.SpI(" ",I.bMT(2,1,"core.policy.policydocoptionalyes")," "))}function CorePolicyAcceptancesPage_ng_template_27_ng_container_15_span_2_Template(e,n){1&e&&(I.j41(0,"span",46),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.R7$(),I.SpI(" ",I.bMT(2,1,"core.policy.acceptancestatusacceptedbehalf")," "))}function CorePolicyAcceptancesPage_ng_template_27_ng_container_15_span_3_Template(e,n){1&e&&(I.j41(0,"span",46),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.R7$(),I.SpI(" ",I.bMT(2,1,"core.policy.acceptancestatusaccepted")," "))}function CorePolicyAcceptancesPage_ng_template_27_ng_container_15_span_4_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"span",47)(1,"ion-button",48),I.nI1(2,"translate"),I.bIt("click",(function CorePolicyAcceptancesPage_ng_template_27_ng_container_15_span_4_Template_ion_button_click_1_listener(n){I.eBV(e);const t=I.XpG(2).policy,o=I.XpG();return I.Njj(o.setAcceptance(n,t,!1))})),I.EFF(3),I.nI1(4,"translate"),I.k0s()()}if(2&e){const e=I.XpG(2).policy;I.R7$(),I.Y8G("ariaLabel",I.i5U(2,2,"core.policy.useracceptanceactionrevokeone",I.eq3(7,acceptances_c2,e.name))),I.R7$(2),I.SpI(" ",I.bMT(4,5,"core.policy.useracceptanceactionrevoke")," ")}}function CorePolicyAcceptancesPage_ng_template_27_ng_container_15_Template(e,n){if(1&e&&(I.qex(0),I.nrm(1,"ion-icon",43),I.DNE(2,CorePolicyAcceptancesPage_ng_template_27_ng_container_15_span_2_Template,3,3,"span",44)(3,CorePolicyAcceptancesPage_ng_template_27_ng_container_15_span_3_Template,3,3,"span",44)(4,CorePolicyAcceptancesPage_ng_template_27_ng_container_15_span_4_Template,5,9,"span",45),I.bVm()),2&e){const e=I.XpG().policy;I.R7$(2),I.Y8G("ngIf",e.onBehalf),I.R7$(),I.Y8G("ngIf",!e.onBehalf),I.R7$(),I.Y8G("ngIf",e.canrevoke)}}function CorePolicyAcceptancesPage_ng_template_27_ng_container_16_span_2_Template(e,n){1&e&&(I.j41(0,"span",46),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.R7$(),I.SpI(" ",I.bMT(2,1,"core.policy.acceptancestatusdeclinedbehalf")," "))}function CorePolicyAcceptancesPage_ng_template_27_ng_container_16_span_3_Template(e,n){1&e&&(I.j41(0,"span",46),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.R7$(),I.SpI(" ",I.bMT(2,1,"core.policy.acceptancestatusdeclined")," "))}function CorePolicyAcceptancesPage_ng_template_27_ng_container_16_span_4_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"span",47)(1,"ion-button",48),I.nI1(2,"translate"),I.bIt("click",(function CorePolicyAcceptancesPage_ng_template_27_ng_container_16_span_4_Template_ion_button_click_1_listener(n){I.eBV(e);const t=I.XpG(2).policy,o=I.XpG();return I.Njj(o.setAcceptance(n,t,!0))})),I.EFF(3),I.nI1(4,"translate"),I.k0s()()}if(2&e){const e=I.XpG(2).policy;I.R7$(),I.Y8G("ariaLabel",I.i5U(2,2,"core.policy.useracceptanceactionacceptone",I.eq3(7,acceptances_c2,e.name))),I.R7$(2),I.SpI(" ",I.bMT(4,5,"core.policy.useracceptanceactionaccept")," ")}}function CorePolicyAcceptancesPage_ng_template_27_ng_container_16_Template(e,n){if(1&e&&(I.qex(0),I.nrm(1,"ion-icon",49),I.DNE(2,CorePolicyAcceptancesPage_ng_template_27_ng_container_16_span_2_Template,3,3,"span",44)(3,CorePolicyAcceptancesPage_ng_template_27_ng_container_16_span_3_Template,3,3,"span",44)(4,CorePolicyAcceptancesPage_ng_template_27_ng_container_16_span_4_Template,5,9,"span",45),I.bVm()),2&e){const e=I.XpG().policy;I.R7$(2),I.Y8G("ngIf",e.onBehalf),I.R7$(),I.Y8G("ngIf",!e.onBehalf),I.R7$(),I.Y8G("ngIf",e.canaccept)}}function CorePolicyAcceptancesPage_ng_template_27_ng_container_17_span_5_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"span",47)(1,"ion-button",48),I.nI1(2,"translate"),I.bIt("click",(function CorePolicyAcceptancesPage_ng_template_27_ng_container_17_span_5_Template_ion_button_click_1_listener(n){I.eBV(e);const t=I.XpG(2).policy,o=I.XpG();return I.Njj(o.setAcceptance(n,t,!0))})),I.EFF(3),I.nI1(4,"translate"),I.k0s(),I.j41(5,"ion-button",48),I.nI1(6,"translate"),I.bIt("click",(function CorePolicyAcceptancesPage_ng_template_27_ng_container_17_span_5_Template_ion_button_click_5_listener(n){I.eBV(e);const t=I.XpG(2).policy,o=I.XpG();return I.Njj(o.setAcceptance(n,t,!1))})),I.EFF(7),I.nI1(8,"translate"),I.k0s()()}if(2&e){const e=I.XpG(2).policy;I.R7$(),I.Y8G("ariaLabel",I.i5U(2,4,"core.policy.useracceptanceactionacceptone",I.eq3(14,acceptances_c2,e.name))),I.R7$(2),I.SpI(" ",I.bMT(4,7,"core.policy.useracceptanceactionaccept")," "),I.R7$(2),I.Y8G("ariaLabel",I.i5U(6,9,"core.policy.useracceptanceactiondeclineone",I.eq3(16,acceptances_c2,e.name))),I.R7$(2),I.SpI(" ",I.bMT(8,12,"core.policy.useracceptanceactiondecline")," ")}}function CorePolicyAcceptancesPage_ng_template_27_ng_container_17_Template(e,n){if(1&e&&(I.qex(0),I.nrm(1,"ion-icon",50),I.j41(2,"span",46),I.EFF(3),I.nI1(4,"translate"),I.k0s(),I.DNE(5,CorePolicyAcceptancesPage_ng_template_27_ng_container_17_span_5_Template,9,18,"span",45),I.bVm()),2&e){const e=I.XpG().policy;I.R7$(3),I.JRh(I.bMT(4,2,"core.policy.acceptancestatuspending")),I.R7$(2),I.Y8G("ngIf",e.canaccept)}}function CorePolicyAcceptancesPage_ng_template_27_p_19_Template(e,n){if(1&e&&(I.j41(0,"p"),I.EFF(1),I.nI1(2,"coreFormatDate"),I.k0s()),2&e){const e=I.XpG().policy;I.R7$(),I.SpI(" ",I.i5U(2,1,1e3*e.acceptance.timemodified,"strftimedatetime")," ")}}function CorePolicyAcceptancesPage_ng_template_27_p_20_Template(e,n){1&e&&(I.j41(0,"p"),I.EFF(1,"-"),I.k0s())}function CorePolicyAcceptancesPage_ng_template_27_ng_container_21_p_2_Template(e,n){if(1&e&&(I.j41(0,"p")(1,"a",53),I.EFF(2),I.k0s()()),2&e){const e=I.XpG(2).policy;I.R7$(),I.Y8G("userId",e.acceptance.usermodified),I.R7$(),I.JRh(e.acceptance.modfullname)}}function CorePolicyAcceptancesPage_ng_template_27_ng_container_21_p_3_Template(e,n){1&e&&(I.j41(0,"p"),I.EFF(1,"-"),I.k0s())}function CorePolicyAcceptancesPage_ng_template_27_ng_container_21_p_5_Template(e,n){if(1&e&&(I.j41(0,"p"),I.nrm(1,"core-format-text",54),I.k0s()),2&e){const e=I.XpG(2).policy;I.R7$(),I.Y8G("text",e.acceptance.note)("contextInstanceId",0)}}function CorePolicyAcceptancesPage_ng_template_27_ng_container_21_p_6_Template(e,n){1&e&&(I.j41(0,"p"),I.EFF(1,"-"),I.k0s())}function CorePolicyAcceptancesPage_ng_template_27_ng_container_21_Template(e,n){if(1&e&&(I.qex(0),I.j41(1,"td",51),I.DNE(2,CorePolicyAcceptancesPage_ng_template_27_ng_container_21_p_2_Template,3,2,"p",19)(3,CorePolicyAcceptancesPage_ng_template_27_ng_container_21_p_3_Template,2,0,"p",19),I.k0s(),I.j41(4,"td",52),I.DNE(5,CorePolicyAcceptancesPage_ng_template_27_ng_container_21_p_5_Template,2,2,"p",19)(6,CorePolicyAcceptancesPage_ng_template_27_ng_container_21_p_6_Template,2,0,"p",19),I.k0s(),I.bVm()),2&e){const e=I.XpG().policy;I.R7$(2),I.Y8G("ngIf",e.onBehalf),I.R7$(),I.Y8G("ngIf",!e.onBehalf),I.R7$(2),I.Y8G("ngIf",null==e.acceptance?null:e.acceptance.note),I.R7$(),I.Y8G("ngIf",!(null!=e.acceptance&&e.acceptance.note))}}function CorePolicyAcceptancesPage_ng_template_27_ng_container_22_ng_container_1_ng_container_1_Template(e,n){1&e&&I.eu8(0)}function CorePolicyAcceptancesPage_ng_template_27_ng_container_22_ng_container_1_Template(e,n){if(1&e&&(I.qex(0),I.DNE(1,CorePolicyAcceptancesPage_ng_template_27_ng_container_22_ng_container_1_ng_container_1_Template,1,0,"ng-container",22),I.bVm()),2&e){const e=n.$implicit;I.XpG(3);const t=I.sdS(28);I.R7$(),I.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",I.eq3(2,_c3,e))}}function CorePolicyAcceptancesPage_ng_template_27_ng_container_22_Template(e,n){if(1&e&&(I.qex(0),I.DNE(1,CorePolicyAcceptancesPage_ng_template_27_ng_container_22_ng_container_1_Template,2,4,"ng-container",21),I.bVm()),2&e){const e=I.XpG().policy;I.R7$(),I.Y8G("ngForOf",e.previousVersions)}}function CorePolicyAcceptancesPage_ng_template_27_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"tr")(1,"td",25),I.DNE(2,CorePolicyAcceptancesPage_ng_template_27_ion_icon_2_Template,1,0,"ion-icon",26)(3,CorePolicyAcceptancesPage_ng_template_27_ion_icon_3_Template,2,6,"ion-icon",27)(4,CorePolicyAcceptancesPage_ng_template_27_ion_icon_4_Template,1,0,"ion-icon",28),I.j41(5,"a",29),I.bIt("click",(function CorePolicyAcceptancesPage_ng_template_27_Template_a_click_5_listener(n){const t=I.eBV(e).policy,o=I.XpG();return I.Njj(o.viewFullPolicy(n,t))})),I.EFF(6),I.k0s()(),I.j41(7,"td",30)(8,"p"),I.EFF(9),I.k0s(),I.DNE(10,CorePolicyAcceptancesPage_ng_template_27_ion_badge_10_Template,3,3,"ion-badge",31)(11,CorePolicyAcceptancesPage_ng_template_27_ion_badge_11_Template,3,3,"ion-badge",32)(12,CorePolicyAcceptancesPage_ng_template_27_ion_badge_12_Template,3,3,"ion-badge",33),I.k0s(),I.j41(13,"td",34)(14,"p",35),I.DNE(15,CorePolicyAcceptancesPage_ng_template_27_ng_container_15_Template,5,3,"ng-container",19)(16,CorePolicyAcceptancesPage_ng_template_27_ng_container_16_Template,5,3,"ng-container",19)(17,CorePolicyAcceptancesPage_ng_template_27_ng_container_17_Template,6,4,"ng-container",19),I.k0s()(),I.j41(18,"td",36),I.DNE(19,CorePolicyAcceptancesPage_ng_template_27_p_19_Template,3,4,"p",19)(20,CorePolicyAcceptancesPage_ng_template_27_p_20_Template,2,0,"p",19),I.k0s(),I.DNE(21,CorePolicyAcceptancesPage_ng_template_27_ng_container_21_Template,7,4,"ng-container",19),I.k0s(),I.DNE(22,CorePolicyAcceptancesPage_ng_template_27_ng_container_22_Template,2,1,"ng-container",19)}if(2&e){const e=n.policy,t=n.isPreviousVersion,o=I.XpG();I.AVh("core-policy-previous-version",t),I.R7$(2),I.Y8G("ngIf",t),I.R7$(),I.Y8G("ngIf",!t&&e.previousVersions.length),I.R7$(),I.Y8G("ngIf",!t&&!e.previousVersions.length),I.R7$(2),I.JRh(e.name),I.R7$(3),I.JRh(e.revision),I.R7$(),I.Y8G("ngIf",e.status===o.activeStatus),I.R7$(),I.Y8G("ngIf",!t&&e.status===o.inactiveStatus),I.R7$(),I.Y8G("ngIf",e.optional),I.R7$(3),I.Y8G("ngIf",e.hasAccepted),I.R7$(),I.Y8G("ngIf",e.hasDeclined),I.R7$(),I.Y8G("ngIf",!e.hasAccepted&&!e.hasDeclined),I.R7$(2),I.Y8G("ngIf",e.acceptance),I.R7$(),I.Y8G("ngIf",!e.acceptance),I.R7$(),I.Y8G("ngIf",o.hasOnBehalf),I.R7$(),I.Y8G("ngIf",!t&&e.previousVersions.length&&e.expanded)}}function CorePolicyAcceptancesPage_ng_template_29_ion_icon_2_Template(e,n){1&e&&I.nrm(0,"ion-icon",37)}function CorePolicyAcceptancesPage_ng_template_29_p_6_Template(e,n){if(1&e&&(I.j41(0,"p"),I.EFF(1),I.k0s()),2&e){const e=I.XpG().policy;I.R7$(),I.JRh(e.revision)}}function CorePolicyAcceptancesPage_ng_template_29_p_7_Template(e,n){if(1&e&&(I.j41(0,"p"),I.EFF(1),I.k0s()),2&e){const e=I.XpG().policy;I.R7$(),I.JRh(e.name)}}function CorePolicyAcceptancesPage_ng_template_29_ng_container_14_Template(e,n){if(1&e&&(I.qex(0),I.j41(1,"p",61),I.EFF(2),I.nI1(3,"translate"),I.k0s(),I.j41(4,"p"),I.EFF(5),I.k0s(),I.bVm()),2&e){const e=I.XpG().policy;I.R7$(2),I.JRh(I.bMT(3,2,"core.policy.policydocname")),I.R7$(3),I.JRh(e.name)}}function CorePolicyAcceptancesPage_ng_template_29_ng_container_15_Template(e,n){if(1&e&&(I.qex(0),I.j41(1,"p",61),I.EFF(2),I.nI1(3,"translate"),I.k0s(),I.j41(4,"p"),I.EFF(5),I.k0s(),I.bVm()),2&e){const e=I.XpG().policy;I.R7$(2),I.JRh(I.bMT(3,2,"core.policy.policydocrevision")),I.R7$(3),I.JRh(e.revision)}}function CorePolicyAcceptancesPage_ng_template_29_ion_badge_16_Template(e,n){1&e&&(I.j41(0,"ion-badge",40),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.R7$(),I.SpI(" ",I.bMT(2,1,"core.policy.status1")," "))}function CorePolicyAcceptancesPage_ng_template_29_ion_badge_17_Template(e,n){1&e&&(I.j41(0,"ion-badge",41),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.R7$(),I.SpI(" ",I.bMT(2,1,"core.policy.status2")," "))}function CorePolicyAcceptancesPage_ng_template_29_ion_badge_18_Template(e,n){1&e&&(I.j41(0,"ion-badge",42),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.R7$(),I.SpI(" ",I.bMT(2,1,"core.policy.policydocoptionalyes")," "))}function CorePolicyAcceptancesPage_ng_template_29_ng_container_25_span_2_Template(e,n){1&e&&(I.j41(0,"span",46),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.R7$(),I.SpI(" ",I.bMT(2,1,"core.policy.acceptancestatusacceptedbehalf")," "))}function CorePolicyAcceptancesPage_ng_template_29_ng_container_25_span_3_Template(e,n){1&e&&(I.j41(0,"span",46),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.R7$(),I.SpI(" ",I.bMT(2,1,"core.policy.acceptancestatusaccepted")," "))}function CorePolicyAcceptancesPage_ng_template_29_ng_container_25_span_4_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"span",47)(1,"ion-button",48),I.nI1(2,"translate"),I.bIt("click",(function CorePolicyAcceptancesPage_ng_template_29_ng_container_25_span_4_Template_ion_button_click_1_listener(n){I.eBV(e);const t=I.XpG(2).policy,o=I.XpG();return I.Njj(o.setAcceptance(n,t,!1))})),I.EFF(3),I.nI1(4,"translate"),I.k0s()()}if(2&e){const e=I.XpG(2).policy;I.R7$(),I.Y8G("ariaLabel",I.i5U(2,2,"core.policy.useracceptanceactionrevokeone",I.eq3(7,acceptances_c2,e.name))),I.R7$(2),I.SpI(" ",I.bMT(4,5,"core.policy.useracceptanceactionrevoke")," ")}}function CorePolicyAcceptancesPage_ng_template_29_ng_container_25_Template(e,n){if(1&e&&(I.qex(0),I.nrm(1,"ion-icon",43),I.DNE(2,CorePolicyAcceptancesPage_ng_template_29_ng_container_25_span_2_Template,3,3,"span",44)(3,CorePolicyAcceptancesPage_ng_template_29_ng_container_25_span_3_Template,3,3,"span",44)(4,CorePolicyAcceptancesPage_ng_template_29_ng_container_25_span_4_Template,5,9,"span",45),I.bVm()),2&e){const e=I.XpG().policy;I.R7$(2),I.Y8G("ngIf",e.onBehalf),I.R7$(),I.Y8G("ngIf",!e.onBehalf),I.R7$(),I.Y8G("ngIf",e.canrevoke)}}function CorePolicyAcceptancesPage_ng_template_29_ng_container_26_span_2_Template(e,n){1&e&&(I.j41(0,"span",46),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.R7$(),I.SpI(" ",I.bMT(2,1,"core.policy.acceptancestatusdeclinedbehalf")," "))}function CorePolicyAcceptancesPage_ng_template_29_ng_container_26_span_3_Template(e,n){1&e&&(I.j41(0,"span",46),I.EFF(1),I.nI1(2,"translate"),I.k0s()),2&e&&(I.R7$(),I.SpI(" ",I.bMT(2,1,"core.policy.acceptancestatusdeclined")," "))}function CorePolicyAcceptancesPage_ng_template_29_ng_container_26_span_4_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"span",47)(1,"ion-button",48),I.nI1(2,"translate"),I.bIt("click",(function CorePolicyAcceptancesPage_ng_template_29_ng_container_26_span_4_Template_ion_button_click_1_listener(n){I.eBV(e);const t=I.XpG(2).policy,o=I.XpG();return I.Njj(o.setAcceptance(n,t,!0))})),I.EFF(3),I.nI1(4,"translate"),I.k0s()()}if(2&e){const e=I.XpG(2).policy;I.R7$(),I.Y8G("ariaLabel",I.i5U(2,2,"core.policy.useracceptanceactionacceptone",I.eq3(7,acceptances_c2,e.name))),I.R7$(2),I.SpI(" ",I.bMT(4,5,"core.policy.useracceptanceactionaccept")," ")}}function CorePolicyAcceptancesPage_ng_template_29_ng_container_26_Template(e,n){if(1&e&&(I.qex(0),I.nrm(1,"ion-icon",49),I.DNE(2,CorePolicyAcceptancesPage_ng_template_29_ng_container_26_span_2_Template,3,3,"span",44)(3,CorePolicyAcceptancesPage_ng_template_29_ng_container_26_span_3_Template,3,3,"span",44)(4,CorePolicyAcceptancesPage_ng_template_29_ng_container_26_span_4_Template,5,9,"span",45),I.bVm()),2&e){const e=I.XpG().policy;I.R7$(2),I.Y8G("ngIf",e.onBehalf),I.R7$(),I.Y8G("ngIf",!e.onBehalf),I.R7$(),I.Y8G("ngIf",e.canaccept)}}function CorePolicyAcceptancesPage_ng_template_29_ng_container_27_span_5_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"span",47)(1,"ion-button",48),I.nI1(2,"translate"),I.bIt("click",(function CorePolicyAcceptancesPage_ng_template_29_ng_container_27_span_5_Template_ion_button_click_1_listener(n){I.eBV(e);const t=I.XpG(2).policy,o=I.XpG();return I.Njj(o.setAcceptance(n,t,!0))})),I.EFF(3),I.nI1(4,"translate"),I.k0s(),I.j41(5,"ion-button",48),I.nI1(6,"translate"),I.bIt("click",(function CorePolicyAcceptancesPage_ng_template_29_ng_container_27_span_5_Template_ion_button_click_5_listener(n){I.eBV(e);const t=I.XpG(2).policy,o=I.XpG();return I.Njj(o.setAcceptance(n,t,!1))})),I.EFF(7),I.nI1(8,"translate"),I.k0s()()}if(2&e){const e=I.XpG(2).policy;I.R7$(),I.Y8G("ariaLabel",I.i5U(2,4,"core.policy.useracceptanceactionacceptone",I.eq3(14,acceptances_c2,e.name))),I.R7$(2),I.SpI(" ",I.bMT(4,7,"core.policy.useracceptanceactionaccept")," "),I.R7$(2),I.Y8G("ariaLabel",I.i5U(6,9,"core.policy.useracceptanceactiondeclineone",I.eq3(16,acceptances_c2,e.name))),I.R7$(2),I.SpI(" ",I.bMT(8,12,"core.policy.useracceptanceactiondecline")," ")}}function CorePolicyAcceptancesPage_ng_template_29_ng_container_27_Template(e,n){if(1&e&&(I.qex(0),I.nrm(1,"ion-icon",50),I.j41(2,"span",46),I.EFF(3),I.nI1(4,"translate"),I.k0s(),I.DNE(5,CorePolicyAcceptancesPage_ng_template_29_ng_container_27_span_5_Template,9,18,"span",45),I.bVm()),2&e){const e=I.XpG().policy;I.R7$(3),I.JRh(I.bMT(4,2,"core.policy.acceptancestatuspending")),I.R7$(2),I.Y8G("ngIf",e.canaccept)}}function CorePolicyAcceptancesPage_ng_template_29_p_33_Template(e,n){if(1&e&&(I.j41(0,"p"),I.EFF(1),I.nI1(2,"coreFormatDate"),I.k0s()),2&e){const e=I.XpG().policy;I.R7$(),I.SpI(" ",I.i5U(2,1,1e3*e.acceptance.timemodified,"strftimedatetime")," ")}}function CorePolicyAcceptancesPage_ng_template_29_p_34_Template(e,n){1&e&&(I.j41(0,"p"),I.EFF(1,"-"),I.k0s())}function CorePolicyAcceptancesPage_ng_template_29_ng_container_35_p_13_Template(e,n){if(1&e&&(I.j41(0,"p"),I.nrm(1,"core-format-text",54),I.k0s()),2&e){const e=I.XpG(2).policy;I.R7$(),I.Y8G("text",e.acceptance.note)("contextInstanceId",0)}}function CorePolicyAcceptancesPage_ng_template_29_ng_container_35_p_14_Template(e,n){1&e&&(I.j41(0,"p"),I.EFF(1,"-"),I.k0s())}function CorePolicyAcceptancesPage_ng_template_29_ng_container_35_Template(e,n){if(1&e&&(I.qex(0),I.j41(1,"ion-item",64)(2,"ion-label")(3,"p",61),I.EFF(4),I.nI1(5,"translate"),I.k0s(),I.j41(6,"p",65),I.EFF(7),I.k0s()()(),I.j41(8,"ion-item",66)(9,"ion-label")(10,"p",61),I.EFF(11),I.nI1(12,"translate"),I.k0s(),I.DNE(13,CorePolicyAcceptancesPage_ng_template_29_ng_container_35_p_13_Template,2,2,"p",19)(14,CorePolicyAcceptancesPage_ng_template_29_ng_container_35_p_14_Template,2,0,"p",19),I.k0s()(),I.bVm()),2&e){const e=I.XpG().policy;I.R7$(),I.Y8G("userId",e.acceptance.usermodified),I.R7$(3),I.JRh(I.bMT(5,6,"core.policy.responseby")),I.R7$(3),I.JRh(e.acceptance.modfullname),I.R7$(4),I.JRh(I.bMT(12,8,"core.policy.acceptancenote")),I.R7$(2),I.Y8G("ngIf",e.acceptance.note),I.R7$(),I.Y8G("ngIf",!e.acceptance.note)}}function CorePolicyAcceptancesPage_ng_template_29_div_36_ng_container_1_ng_container_1_Template(e,n){1&e&&I.eu8(0)}function CorePolicyAcceptancesPage_ng_template_29_div_36_ng_container_1_Template(e,n){if(1&e&&(I.qex(0),I.DNE(1,CorePolicyAcceptancesPage_ng_template_29_div_36_ng_container_1_ng_container_1_Template,1,0,"ng-container",22),I.bVm()),2&e){const e=n.$implicit;I.XpG(3);const t=I.sdS(30);I.R7$(),I.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",I.eq3(2,_c3,e))}}function CorePolicyAcceptancesPage_ng_template_29_div_36_Template(e,n){if(1&e&&(I.j41(0,"div",67),I.DNE(1,CorePolicyAcceptancesPage_ng_template_29_div_36_ng_container_1_Template,2,4,"ng-container",21),I.k0s()),2&e){const e=I.XpG().policy;I.R7$(),I.Y8G("ngForOf",e.previousVersions)}}function CorePolicyAcceptancesPage_ng_template_29_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"ion-item",55)(1,"div",2),I.DNE(2,CorePolicyAcceptancesPage_ng_template_29_ion_icon_2_Template,1,0,"ion-icon",26),I.j41(3,"ion-icon",38),I.nI1(4,"translate"),I.bIt("ariaButtonClick",(function CorePolicyAcceptancesPage_ng_template_29_Template_ion_icon_ariaButtonClick_3_listener(n){const t=I.eBV(e).policy,o=I.XpG();return I.Njj(o.toggle(n,t))})),I.k0s()(),I.j41(5,"ion-label"),I.DNE(6,CorePolicyAcceptancesPage_ng_template_29_p_6_Template,2,1,"p",19)(7,CorePolicyAcceptancesPage_ng_template_29_p_7_Template,2,1,"p",19),I.k0s(),I.j41(8,"ion-button",56),I.nI1(9,"translate"),I.bIt("click",(function CorePolicyAcceptancesPage_ng_template_29_Template_ion_button_click_8_listener(n){const t=I.eBV(e).policy,o=I.XpG();return I.Njj(o.viewFullPolicy(n,t))})),I.nrm(10,"ion-icon",57),I.k0s()(),I.j41(11,"div",58)(12,"ion-item",59)(13,"ion-label"),I.DNE(14,CorePolicyAcceptancesPage_ng_template_29_ng_container_14_Template,6,4,"ng-container",19)(15,CorePolicyAcceptancesPage_ng_template_29_ng_container_15_Template,6,4,"ng-container",19)(16,CorePolicyAcceptancesPage_ng_template_29_ion_badge_16_Template,3,3,"ion-badge",31)(17,CorePolicyAcceptancesPage_ng_template_29_ion_badge_17_Template,3,3,"ion-badge",32)(18,CorePolicyAcceptancesPage_ng_template_29_ion_badge_18_Template,3,3,"ion-badge",33),I.k0s()(),I.j41(19,"ion-item",60)(20,"ion-label")(21,"p",61),I.EFF(22),I.nI1(23,"translate"),I.k0s(),I.j41(24,"p",35),I.DNE(25,CorePolicyAcceptancesPage_ng_template_29_ng_container_25_Template,5,3,"ng-container",19)(26,CorePolicyAcceptancesPage_ng_template_29_ng_container_26_Template,5,3,"ng-container",19)(27,CorePolicyAcceptancesPage_ng_template_29_ng_container_27_Template,6,4,"ng-container",19),I.k0s()()(),I.j41(28,"ion-item",62)(29,"ion-label")(30,"p",61),I.EFF(31),I.nI1(32,"translate"),I.k0s(),I.DNE(33,CorePolicyAcceptancesPage_ng_template_29_p_33_Template,3,4,"p",19)(34,CorePolicyAcceptancesPage_ng_template_29_p_34_Template,2,0,"p",19),I.k0s()(),I.DNE(35,CorePolicyAcceptancesPage_ng_template_29_ng_container_35_Template,15,10,"ng-container",19)(36,CorePolicyAcceptancesPage_ng_template_29_div_36_Template,2,1,"div",63),I.k0s()}if(2&e){const e=n.policy,t=n.isPreviousVersion,o=I.XpG();I.R7$(2),I.Y8G("ngIf",t),I.R7$(),I.AVh("expandable-status-icon-expanded",e.expanded),I.BMQ("aria-expanded",e.expanded)("aria-label",I.bMT(4,28,e.expanded?"core.collapse":"core.expand"))("aria-controls","core-policy-details-"+e.versionid),I.R7$(3),I.Y8G("ngIf",t),I.R7$(),I.Y8G("ngIf",!t),I.R7$(),I.Y8G("ariaLabel",I.i5U(9,30,"core.policy.viewpolicy",I.eq3(37,_c4,e.name))),I.R7$(3),I.Mz_("id","core-policy-details-",e.versionid,""),I.Y8G("hidden",!e.expanded),I.R7$(3),I.Y8G("ngIf",t),I.R7$(),I.Y8G("ngIf",!t),I.R7$(),I.Y8G("ngIf",e.status===o.activeStatus),I.R7$(),I.Y8G("ngIf",!t&&e.status===o.inactiveStatus),I.R7$(),I.Y8G("ngIf",e.optional),I.R7$(),I.AVh("core-policy-agreement-has-actions",e.hasActions),I.R7$(3),I.JRh(I.bMT(23,33,"core.policy.response")),I.R7$(3),I.Y8G("ngIf",e.hasAccepted),I.R7$(),I.Y8G("ngIf",e.hasDeclined),I.R7$(),I.Y8G("ngIf",!e.hasAccepted&&!e.hasDeclined),I.R7$(4),I.JRh(I.bMT(32,35,"core.policy.responseon")),I.R7$(2),I.Y8G("ngIf",e.acceptance),I.R7$(),I.Y8G("ngIf",!e.acceptance),I.R7$(),I.Y8G("ngIf",e.onBehalf),I.R7$(),I.Y8G("ngIf",!t&&e.previousVersions.length)}}let B=(()=>{var e;class CorePolicyAcceptancesPage{constructor(){this.dataLoaded=!1,this.policies=[],this.activeStatus=m.CorePolicyStatus.Active,this.inactiveStatus=m.CorePolicyStatus.Archived,this.isTablet=!1,this.hasOnBehalf=!1,this.canContactDPO=!1,this.logView=w.j.once((()=>{const e=a.CoreSites.getCurrentSiteUserId();p.OF.logEvent({type:p.qr.VIEW_ITEM_LIST,ws:"tool_policy_get_user_acceptances",name:g.HT.instant("core.policy.policiesagreements"),data:{userid:e},url:`/admin/tool/policy/user.php?userid=${e}`})}))}ngOnInit(){this.isTablet=f.CoreScreen.isTablet,this.layoutSubscription=f.CoreScreen.layoutObservable.subscribe((()=>{this.isTablet=f.CoreScreen.isTablet})),this.fetchCanContactDPO(),this.fetchAcceptances().finally((()=>{this.dataLoaded=!0}))}fetchCanContactDPO(){var e=this;return(0,i.A)((function*(){const n=a.CoreSites.getCurrentSite();if(!n||n.isFeatureDisabled(D.Q))return e.canContactDPO=!1,void 0;e.canContactDPO=yield T.g.ignoreErrors(V.CP.isEnabled(),!1)}))()}fetchAcceptances(){var e=this;return(0,i.A)((function*(){try{const n=yield m.CorePolicy.getUserAcceptances();e.hasOnBehalf=!1;const t=n.reduce(((n,t)=>{const o=e.formatSitePolicy(t);return e.hasOnBehalf=e.hasOnBehalf||o.onBehalf,n[t.policyid]=n[t.policyid]||[],n[t.policyid].push(o),n}),{});e.policies=[];for(const n in t){const o=t[n];let c=o.find((e=>e.status===m.CorePolicyStatus.Active));c||(o.sort(((e,n)=>n.versionid-e.versionid)),c=o[0]),c.previousVersions=o.filter((e=>e!==c)),e.policies.push(c)}e.logView()}catch(e){l.CoreDomUtils.showErrorModalDefault(e,"Error getting policies.")}}))()}formatSitePolicy(e,n=!1){var t,o;const c=1===(null===(t=e.acceptance)||void 0===t?void 0:t.status),i=0===(null===(o=e.acceptance)||void 0===o?void 0:o.status),l=!!e.acceptance&&e.acceptance.usermodified!==a.CoreSites.getCurrentSiteUserId();return{...e,expanded:n,hasAccepted:c,hasDeclined:i,onBehalf:l,hasActions:i||!c||!!e.optional}}refreshAcceptances(e){var n=this;return(0,i.A)((function*(){yield T.g.ignoreErrors(m.CorePolicy.invalidateAcceptances()),yield T.g.ignoreErrors(n.fetchAcceptances()),null==e||e.complete()}))()}toggle(e,n){e.preventDefault(),e.stopPropagation(),n.expanded=!n.expanded}viewFullPolicy(e,n){return(0,i.A)((function*(){e.preventDefault(),e.stopPropagation();const{CorePolicyViewPolicyModalComponent:o}=yield t.e(4619).then(t.bind(t,54619));b.I.openModal({component:o,componentProps:{policy:n}})}))()}setAcceptance(e,n,t){var o=this;return(0,i.A)((function*(){e.preventDefault(),e.stopPropagation();const c=yield h.CoreLoadings.show("core.sending",!0);try{yield m.CorePolicy.setUserAcceptances({[n.versionid]:t?1:0}),yield o.updatePolicyAcceptance(n,t)}catch(e){l.CoreDomUtils.showErrorModalDefault(e,"Error changing policy status.")}finally{c.dismiss()}}))()}updatePolicyAcceptance(e,n){var t=this;return(0,i.A)((function*(){try{const n=(yield m.CorePolicy.getUserAcceptances({readingStrategy:2})).find((n=>n.versionid===e.versionid));if(!n)throw new Error("Policy not found.");e.acceptance=n.acceptance}catch(t){var o,c;e.acceptance={status:n?1:0,lang:null!==(o=null===(c=e.acceptance)||void 0===c?void 0:c.lang)&&void 0!==o?o:"en",timemodified:Date.now(),usermodified:a.CoreSites.getCurrentSiteUserId()}}Object.assign(e,t.formatSitePolicy(e,e.expanded))}))()}openContactDPO(e){e.preventDefault(),e.stopPropagation(),_.CoreNavigator.navigateToSitePath(D.Z)}ngOnDestroy(){var e;null===(e=this.layoutSubscription)||void 0===e||e.unsubscribe()}}return(e=CorePolicyAcceptancesPage).ɵfac=function CorePolicyAcceptancesPage_Factory(n){return new(n||e)},e.ɵcmp=I.VBU({type:e,selectors:[["page-core-policy-acceptances"]],decls:31,vars:18,consts:[["policyTabletTemplate",""],["policyMobileTemplate",""],["slot","start"],[3,"text"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[1,"list-item-limited-width"],[1,"core-info-card"],[1,"ion-text-wrap"],["name","fas-circle-info","slot","start","aria-hidden","true"],["class","core-card-buttons",4,"ngIf"],[1,"x-scrollable","core-policy-tablet-container"],["class","core-table",4,"ngIf"],["class","core-policy-mobile-container",4,"ngIf"],["icon","fas-file-shield",3,"message",4,"ngIf"],[1,"core-card-buttons"],["fill","outline",3,"click"],[1,"core-table"],[4,"ngIf"],[1,"auto-striped"],[4,"ngFor","ngForOf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"core-policy-mobile-container"],["icon","fas-file-shield",3,"message"],[1,"core-policy-title"],["name","fam-arrow-turn-down-right","aria-hidden","true",4,"ngIf"],["name","fas-chevron-right","flip-rtl","","class","expandable-status-icon",3,"expandable-status-icon-expanded","ariaButtonClick",4,"ngIf"],["name","fas-circle","color","secondary","class","core-policy-icon-bullet","aria-hidden","true",4,"ngIf"],["href","#",3,"click"],[1,"core-policy-revision"],["color","success",4,"ngIf"],["color","danger",4,"ngIf"],["color","info",4,"ngIf"],[1,"core-policy-user-agreement"],[1,"core-policy-user-agreement-info"],[1,"core-policy-responseon"],["name","fam-arrow-turn-down-right","aria-hidden","true"],["name","fas-chevron-right","flip-rtl","",1,"expandable-status-icon",3,"ariaButtonClick"],["name","fas-circle","color","secondary","aria-hidden","true",1,"core-policy-icon-bullet"],["color","success"],["color","danger"],["color","info"],["name","fas-check","color","success","aria-hidden","true"],["class","core-policy-user-agreement-status",4,"ngIf"],["class","core-policy-user-agreement-actions",4,"ngIf"],[1,"core-policy-user-agreement-status"],[1,"core-policy-user-agreement-actions"],["fill","none",3,"click","ariaLabel"],["name","fas-xmark","color","danger","aria-hidden","true"],["name","fas-clock","color","warning","aria-hidden","true"],[1,"core-policy-responseby"],[1,"core-policy-acceptance-note"],["href","#","core-user-link","",3,"userId"],["contextLevel","system",3,"text","contextInstanceId"],[1,"ion-text-wrap","core-policy-title"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","fas-eye","aria-hidden","true"],[1,"core-policy-details",3,"hidden","id"],["lines","full",1,"ion-text-wrap","core-policy-revision"],["lines","full",1,"ion-text-wrap","core-policy-user-agreement"],[1,"item-heading"],["lines","full",1,"ion-text-wrap","core-policy-responseon"],["class","core-policy-previous-versions",4,"ngIf"],["button","","core-user-link","","lines","full","detail","false",1,"ion-text-wrap","core-policy-responseby",3,"userId"],[1,"core-policy-responseby-name"],["lines","full",1,"ion-text-wrap","core-policy-acceptance-note"],[1,"core-policy-previous-versions"]],template:function CorePolicyAcceptancesPage_Template(e,n){if(1&e){const e=I.RV6();I.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),I.nrm(3,"ion-back-button",3),I.nI1(4,"translate"),I.k0s(),I.j41(5,"ion-title")(6,"h1"),I.EFF(7),I.nI1(8,"translate"),I.k0s()()()(),I.j41(9,"ion-content")(10,"ion-refresher",4),I.bIt("ionRefresh",(function CorePolicyAcceptancesPage_Template_ion_refresher_ionRefresh_10_listener(t){return I.eBV(e),I.Njj(n.refreshAcceptances(t.target))})),I.nrm(11,"ion-refresher-content",5),I.nI1(12,"translate"),I.k0s(),I.j41(13,"core-loading",6)(14,"div",7)(15,"ion-card",8)(16,"ion-item",9),I.nrm(17,"ion-icon",10),I.j41(18,"ion-label")(19,"p"),I.EFF(20),I.nI1(21,"translate"),I.k0s()()(),I.DNE(22,CorePolicyAcceptancesPage_div_22_Template,4,3,"div",11),I.k0s()(),I.j41(23,"div",12),I.DNE(24,CorePolicyAcceptancesPage_table_24_Template,18,14,"table",13),I.k0s(),I.DNE(25,CorePolicyAcceptancesPage_div_25_Template,2,1,"div",14)(26,CorePolicyAcceptancesPage_core_empty_box_26_Template,2,3,"core-empty-box",15),I.k0s()(),I.DNE(27,CorePolicyAcceptancesPage_ng_template_27_Template,23,17,"ng-template",null,0,I.C5r)(29,CorePolicyAcceptancesPage_ng_template_29_Template,37,39,"ng-template",null,1,I.C5r)}2&e&&(I.R7$(3),I.Y8G("text",I.bMT(4,10,"core.back")),I.R7$(4),I.JRh(I.bMT(8,12,"core.policy.policiesagreements")),I.R7$(3),I.Y8G("disabled",!n.dataLoaded),I.R7$(),I.FS9("pullingText",I.bMT(12,14,"core.pulltorefresh")),I.R7$(2),I.Y8G("hideUntil",n.dataLoaded),I.R7$(7),I.JRh(I.bMT(21,16,"core.policy.contactdpo")),I.R7$(2),I.Y8G("ngIf",n.canContactDPO),I.R7$(2),I.Y8G("ngIf",n.isTablet&&n.policies.length),I.R7$(),I.Y8G("ngIf",!n.isTablet&&n.policies.length),I.R7$(),I.Y8G("ngIf",!n.policies.length))},dependencies:[R.Sq,R.bT,R.T3,X.h,O.R,G.t,k.B,N.O,U.a,x.i,S.T,u.In,u.Jm,u.QW,u.b_,u.W9,u.eU,u.iq,u.uz,u.he,u.To,u.Ki,u.BC,u.ai,u.el,q.f,E.D9],styles:["[_nghost-%COMP%]   .core-policy-revision[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-inline-start:0px;margin-inline-end:4px}[_nghost-%COMP%]   .core-policy-responseby-name[_ngcontent-%COMP%]{color:var(--core-link-color);text-decoration:none}[_nghost-%COMP%]   .core-policy-user-agreement-info[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;align-items:center;justify-content:flex-start}[_nghost-%COMP%]   .core-policy-user-agreement-info[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-start:0px;margin-inline-end:8px;font-size:1rem}[_nghost-%COMP%]   .core-policy-user-agreement-info[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: transparent;color:var(--ion-color-primary);margin-top:0;margin-bottom:0;text-transform:none}[_nghost-%COMP%]   .core-policy-user-agreement-info[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:first-child:not(:last-child){margin-inline-end:0px}[_nghost-%COMP%]   .core-policy-user-agreement-info[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:not(:first-child){margin-inline-start:0px}[_nghost-%COMP%]   .core-policy-mobile-container[_ngcontent-%COMP%]   .core-policy-title[_ngcontent-%COMP%]   div[slot=start][_ngcontent-%COMP%]{display:flex;align-items:center;margin:0}[_nghost-%COMP%]   .core-policy-mobile-container[_ngcontent-%COMP%]   .core-policy-title[_ngcontent-%COMP%]   div[slot=start][_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.125rem;margin:0}[_nghost-%COMP%]   .core-policy-mobile-container[_ngcontent-%COMP%]   .core-policy-details[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]:not(.core-policy-title){--background: var(--gray-100)}[_nghost-%COMP%]   .core-policy-mobile-container[_ngcontent-%COMP%]   .core-policy-details[_ngcontent-%COMP%]   .core-policy-user-agreement.core-policy-agreement-has-actions[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:0}[_nghost-%COMP%]   .core-policy-mobile-container[_ngcontent-%COMP%]   .core-policy-details[_ngcontent-%COMP%]   .core-policy-user-agreement.core-policy-agreement-has-actions[_ngcontent-%COMP%]   .core-policy-user-agreement-status[_ngcontent-%COMP%]{line-height:44px}[_nghost-%COMP%]   .core-policy-mobile-container[_ngcontent-%COMP%]   .core-policy-details[_ngcontent-%COMP%]   .core-policy-user-agreement-info[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:flex-end}[_nghost-%COMP%]   .core-policy-mobile-container[_ngcontent-%COMP%]   .core-policy-details[_ngcontent-%COMP%]   .core-policy-user-agreement-info[_ngcontent-%COMP%]   .core-policy-user-agreement-status[_ngcontent-%COMP%]{flex-grow:1}[_nghost-%COMP%]   .core-policy-tablet-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-child{padding-inline-start:24px;padding-inline-end:0px}[_nghost-%COMP%]   .core-policy-tablet-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-policy-tablet-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{white-space:nowrap}[_nghost-%COMP%]   .core-policy-tablet-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .core-policy-tablet-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .core-policy-title[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .core-policy-tablet-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .core-policy-title[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{white-space:normal;width:304px}[_nghost-%COMP%]   .core-policy-tablet-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .core-policy-title[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.125rem;padding:13px;margin:3px}[_nghost-%COMP%]   .core-policy-tablet-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .core-policy-title[_ngcontent-%COMP%]   ion-icon.core-policy-icon-bullet[_ngcontent-%COMP%]{font-size:.375rem;width:18px}[_nghost-%COMP%]   .core-policy-tablet-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .core-policy-revision[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:4px}[_nghost-%COMP%]   .core-policy-mobile-container[_ngcontent-%COMP%]   .core-policy-title[_ngcontent-%COMP%]   .expandable-status-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-policy-tablet-container[_ngcontent-%COMP%]   .core-policy-title[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{min-height:auto;min-width:auto;font-size:1.125rem;padding:13px}[_nghost-%COMP%]   .core-policy-title[_ngcontent-%COMP%]   .expandable-status-icon[_ngcontent-%COMP%]{border-radius:50%}[_nghost-%COMP%]   .core-policy-title[_ngcontent-%COMP%]   .expandable-status-icon[_ngcontent-%COMP%]:hover{background:var(--secondary)}"]}),CorePolicyAcceptancesPage})();const L=[{path:Y.TF,component:j},{path:Y.XC,component:B}];let J=(()=>{var e;class CorePolicyLazyModule{}return(e=CorePolicyLazyModule).ɵfac=function CorePolicyLazyModule_Factory(n){return new(n||e)},e.ɵmod=I.$C({type:e}),e.ɵinj=I.G2t({imports:[c.n,o.iI.forChild(L)]}),CorePolicyLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&I.Obh(J,{declarations:[j,B],imports:[c.n,o.iI]}))}}]);