"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6856],{56856:(e,n,o)=>{o.r(n),o.d(n,{default:()=>le});var t=o(21182),a=o(3353),i=o(31249),s=o(10190),r=o(54438);let d=(()=>{var e;class AddonModLessonComponentsModule{}return(e=AddonModLessonComponentsModule).ɵfac=function AddonModLessonComponentsModule_Factory(n){return new(n||e)},e.ɵmod=r.$C({type:e}),e.ɵinj=r.G2t({imports:[a.n,i.r]}),AddonModLessonComponentsModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&r.Obh(d,{declarations:[s.AddonModLessonIndexComponent],imports:[a.n,i.r],exports:[s.AddonModLessonIndexComponent]}));var _=o(2138),l=o(15324),c=o(58197),m=o(68273),u=o(88246),g=o(73465),p=o(73955);let f=(()=>{var e;class AddonModLessonIndexPage extends _._{ngOnInit(){super.ngOnInit(),this.group=l.CoreNavigator.getRouteNumberParam("group"),this.action=l.CoreNavigator.getRouteParam("action")}}return(e=AddonModLessonIndexPage).ɵfac=(()=>{let n;return function AddonModLessonIndexPage_Factory(o){return(n||(n=r.xGo(e)))(o||e)}})(),e.ɵcmp=r.VBU({type:e,selectors:[["page-addon-mod-lesson-index"]],viewQuery:function AddonModLessonIndexPage_Query(e,n){if(1&e&&r.GBs(s.AddonModLessonIndexComponent,5),2&e){let e;r.mGM(e=r.lsd())&&(n.activityComponent=e.first)}},features:[r.Vt3],decls:14,vars:14,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"dataRetrieved","module","courseId","group","action"]],template:function AddonModLessonIndexPage_Template(e,n){1&e&&(r.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),r.nrm(3,"ion-back-button",2),r.nI1(4,"translate"),r.k0s(),r.j41(5,"ion-title")(6,"h1"),r.nrm(7,"core-format-text",3),r.k0s()(),r.nrm(8,"ion-buttons",4),r.k0s()(),r.j41(9,"ion-content",5)(10,"ion-refresher",6),r.bIt("ionRefresh",(function AddonModLessonIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==n.activityComponent?null:n.activityComponent.doRefresh(e.target)})),r.nrm(11,"ion-refresher-content",7),r.nI1(12,"translate"),r.k0s(),r.j41(13,"addon-mod-lesson-index",8),r.bIt("dataRetrieved",(function AddonModLessonIndexPage_Template_addon_mod_lesson_index_dataRetrieved_13_listener(e){return n.updateData(e)})),r.k0s()()),2&e&&(r.R7$(3),r.Y8G("text",r.bMT(4,10,"core.back")),r.R7$(4),r.Y8G("text",n.title)("contextInstanceId",n.module.id)("courseId",n.courseId),r.R7$(3),r.Y8G("disabled",null==n.activityComponent?null:n.activityComponent.showLoading),r.R7$(),r.FS9("pullingText",r.bMT(12,12,"core.pulltorefresh")),r.R7$(2),r.Y8G("module",n.module)("courseId",n.courseId)("group",n.group)("action",n.action))},dependencies:[c.B,m.M,u.i,g.QW,g.W9,g.eU,g.To,g.Ki,g.BC,g.ai,g.el,s.AddonModLessonIndexComponent,p.D9],encapsulation:2}),AddonModLessonIndexPage})();var v=o(98833),h=o(10467),I=o(75629),P=o(94455),R=o(52749),b=o(48966),y=o(89911),k=o(8014),M=o(58364),T=o(79555),L=o(49882),w=o(21509),A=o(75383),G=o(16474),x=o(24742),$=o(81690),D=o(35161),F=o(89417);let C=(()=>{var e;class AddonModLessonHelperProvider{constructor(e){this.formBuilder=e}formatActivityLink(e){const n=(0,D.B)(e).querySelector("a");return n?{formatted:!0,label:n.innerHTML,href:n.href}:{formatted:!1,label:e,href:""}}getContentPageAnswerDataFromHtml(e){const n={buttonText:"",content:""},o=(0,D.B)(e),t=o.querySelector('input[type="button"]');return t&&(n.buttonText=t.value,t.remove()),n.content=o.innerHTML.trim(),n}getPageButtonsFromHtml(e){const n=[],o=(0,D.B)(e);let t=o.querySelector(".branchbuttoncontainer");if(!t){if(!o.querySelector('form input[type="submit"]'))return n;t=o}return Array.from(t.querySelectorAll("form")).forEach((e=>{const o=e.querySelector('input[type="submit"], button[type="submit"]'),t=Array.from(e.querySelectorAll("input"));if(!o||!t||!t.length)return;const a={id:o.id,title:o.title||o.value,content:"INPUT"==o.tagName?o.value:o.innerHTML.trim(),data:{}};t.forEach((e=>{"submit"!=e.type&&(a.data[e.name]=e.value)})),n.push(a)})),n}getPageContentsFromPageData(e){var n,o;const t=(0,D.B)(e.pagecontent||"").querySelector(".contents");return t?t.innerHTML.trim():w.N.isQuestionPage((null===(n=e.page)||void 0===n?void 0:n.type)||-1)||20==(null===(o=e.page)||void 0===o?void 0:o.qtype)?(null===(a=e.page)||void 0===a?void 0:a.contents)||"":e.pagecontent||"";var a}getQuestionFromPageData(e,n){var o;const t=(0,D.B)(n.pagecontent||""),a=t.querySelector(".fcontainer");Array.from(t.querySelectorAll('input[type="hidden"]')).forEach((n=>{e.addControl(n.name,this.formBuilder.control(n.value))}));const i=t.querySelector('input[type="submit"]'),s={template:"",submitLabel:i?i.value:T.HT.instant("addon.mod_lesson.submit")};if(!a)return s;switch(null===(o=n.page)||void 0===o?void 0:o.qtype){case 2:case 3:return this.getMultiChoiceQuestionData(e,s,a);case 8:case 1:return this.getInputQuestionData(e,s,a,n.page.qtype);case 10:return this.getEssayQuestionData(e,s,a);case 5:return this.getMatchingQuestionData(e,s,a)}return s}getMultiChoiceQuestionData(e,n,o){const t={...n,template:"multichoice",options:[],multi:!1};let a=Array.from(o.querySelectorAll('input[type="radio"]'));if(!(a&&a.length||(t.multi=!0,a=Array.from(o.querySelectorAll('input[type="checkbox"]')),a&&a.length)))return t;let i=!1;return a.forEach((n=>{const o=n.parentElement,a={id:n.id,name:n.name,value:n.value,checked:!!n.checked,disabled:!!n.disabled,text:""};(a.checked||t.multi)&&(e.addControl(a.name,this.formBuilder.control(t.multi?{value:a.checked,disabled:a.disabled}:a.value)),i=!0),n.remove(),a.text=(null==o?void 0:o.innerHTML.trim())||"",t.options.push(a)})),t.multi||(t.controlName=a[0].name,i||e.addControl(t.controlName,this.formBuilder.control(""))),t}getInputQuestionData(e,n,o,t){const a=n;a.template="shortanswer";const i=o.querySelector('input[type="text"], input[type="number"]');return i?(a.input={id:i.id,name:i.name,maxlength:i.maxLength,type:"text"},e.addControl(i.name,this.formBuilder.control({value:8===t?$.j.formatFloat(i.value):i.value,disabled:i.readOnly})),a):a}getEssayQuestionData(e,n,o){const t=n;t.template="essay";const a=o.querySelector("textarea");if(a)t.textarea={id:a.id,name:a.name||"answer[text]"},t.control=this.formBuilder.control("",{nonNullable:!0}),e.addControl(t.textarea.name,t.control);else{const e=o.querySelector(".reviewessay");if(!e)return t;t.useranswer=e.innerHTML}return t}getMatchingQuestionData(e,n,o){const t={...n,template:"matching",rows:[]};return Array.from(o.querySelectorAll(".answeroption")).forEach((n=>{const o=n.querySelector("label"),a=n.querySelector("select"),i=Array.from(n.querySelectorAll("option"));if(!(o&&a&&i&&i.length))return;const s={text:o.innerHTML.trim(),id:a.id,name:a.name,options:[]};let r=!1;i.forEach((n=>{if(void 0===n.value)return;const o={value:n.value,label:n.innerHTML.trim(),selected:n.selected};o.selected&&(r=!0,e.addControl(s.name,this.formBuilder.control({value:o.value,disabled:!!a.disabled}))),s.options.push(o)})),r||e.addControl(s.name,this.formBuilder.control({value:"",disabled:!!a.disabled})),t.rows.push(s)})),t}getQuestionPageAnswerDataFromHtml(e){const n=(0,D.B)(e);let o=n.querySelector('input[type="checkbox"][name*="answer"]');if(o){const e=n.querySelector(".badge.bg-success, .badge.badge-success"),t={isCheckbox:!0,checked:!!o.checked,name:o.name,highlight:!!n.querySelector(".highlight"),content:"",successBadge:null==e?void 0:e.innerText};return o.remove(),null==e||e.remove(),t.content=n.innerHTML.trim(),t}if(o=n.querySelector('input[type="number"],input[type="text"]'),o)return{isText:!0,value:o.value};const t=n.querySelector("select");if(null!=t&&t.options){const e=t.options[t.selectedIndex],o={isSelect:!0,id:t.id,value:e?e.value:"",content:""};return t.remove(),o.content=n.innerHTML.trim(),o}return e}getRetakeLabel(e,n){const o={retake:e.try+1,grade:"",timestart:"",duration:""},t=null!=e.grade;return t||e.end?(t&&(o.grade=T.HT.instant("core.percentagenumber",{$a:e.grade})),o.timestart=G.CoreTimeUtils.userDate(1e3*e.timestart),n&&(o.duration=x.j.formatTime(e.timeend-e.timestart))):(o.grade=T.HT.instant("addon.mod_lesson.notcompleted"),e.timestart&&(o.timestart=G.CoreTimeUtils.userDate(1e3*e.timestart))),T.HT.instant("addon.mod_lesson.retakelabel"+(n?"full":"short"),o)}prepareQuestionData(e,n){if("essay"==e.template){const o=e.textarea;o&&(n[o.name]=A.Ni.formatHtmlLines(n[o.name]||""))}else if("multichoice"==e.template&&e.multi)for(const e in n)e.match(/answer\[\d+\]/)&&0==n[e]&&delete n[e];return n}removeQuestionFromFeedback(e){const n=(0,D.B)(e);return y.CoreDomUtils.removeElement(n,".generalbox:not(.feedback):not(.correctanswer)"),n.innerHTML.trim()}}return(e=AddonModLessonHelperProvider).ɵfac=function AddonModLessonHelperProvider_Factory(n){return new(n||e)(r.KVO(F.ok))},e.ɵprov=r.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),AddonModLessonHelperProvider})();const E=(0,T.Qd)(C);var j=o(2907),Y=o(35661),N=o(63153),U=o(22693),S=o(55101),q=o(6319),X=o(55554),O=o(43411),B=o(60177),J=o(64422),V=o(49234),H=o(34198),Q=o(86198),z=o(23007),W=o(43570),K=o(41450);const Z=["questionFormEl"],_c1=e=>({"addon-mod_lesson-slideshow":e}),_c2=(e,n)=>({width:e,height:n}),_c3=e=>({$a:e});function AddonModLessonPlayerPage_ion_button_9_Template(e,n){if(1&e){const e=r.RV6();r.j41(0,"ion-button",10),r.nI1(1,"translate"),r.bIt("click",(function AddonModLessonPlayerPage_ion_button_9_Template_ion_button_click_0_listener(){r.eBV(e);const n=r.XpG();return r.Njj(n.showMenu())})),r.nrm(2,"ion-icon",11),r.k0s()}2&e&&r.Y8G("ariaLabel",r.bMT(1,1,"addon.mod_lesson.lessonmenu"))}function AddonModLessonPlayerPage_ion_card_12_Template(e,n){if(1&e&&(r.j41(0,"ion-card",12)(1,"ion-item",13),r.nrm(2,"ion-icon",14),r.j41(3,"ion-label"),r.EFF(4),r.k0s()()()),2&e){const e=r.XpG();r.R7$(4),r.JRh(e.messages[0].message)}}function AddonModLessonPlayerPage_div_13_core_timer_1_Template(e,n){if(1&e){const e=r.RV6();r.j41(0,"core-timer",21),r.nI1(1,"translate"),r.bIt("finished",(function AddonModLessonPlayerPage_div_13_core_timer_1_Template_core_timer_finished_0_listener(){r.eBV(e);const n=r.XpG(2);return r.Njj(n.timeUp())})),r.k0s()}if(2&e){const e=r.XpG(2);r.Y8G("endTime",e.endTime)("timeLeftClassThreshold",-1)("timerText",r.bMT(1,3,"addon.mod_lesson.timeremaining"))}}function AddonModLessonPlayerPage_div_13_ion_item_2_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label")(2,"p"),r.EFF(3),r.nI1(4,"translate"),r.k0s()()()),2&e){const e=r.XpG(2);r.R7$(3),r.JRh(r.i5U(4,1,"addon.mod_lesson.attempt",r.eq3(4,_c3,e.retake)))}}function AddonModLessonPlayerPage_div_13_ion_item_3_Template(e,n){if(1&e&&(r.j41(0,"ion-item",22)(1,"ion-label"),r.EFF(2),r.k0s()()),2&e){const e=r.XpG(2);r.R7$(2),r.JRh(e.pageData.ongoingscore)}}function AddonModLessonPlayerPage_div_13_ion_card_4_ion_item_1_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.nrm(2,"core-format-text",24),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.Y8G("component",e.component)("componentId",e.lesson.coursemodule)("text",e.pageContent)("contextInstanceId",e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ion_item_divider_2_Template(e,n){if(1&e&&(r.j41(0,"ion-item-divider",13)(1,"ion-label")(2,"h2"),r.nrm(3,"core-format-text",24),r.k0s()()()),2&e){const e=r.XpG(4);r.R7$(3),r.Y8G("component",e.component)("componentId",e.lesson.coursemodule)("text",e.pageContent)("contextInstanceId",e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ion_item_4_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13),r.nrm(1,"ion-input",31),r.nI1(2,"translate"),r.nI1(3,"translate"),r.k0s()),2&e){const e=r.XpG(4);r.R7$(),r.FS9("placeholder",r.bMT(2,6,"addon.mod_lesson.youranswer")),r.Y8G("type",e.question.input.type)("ariaLabel",r.bMT(3,8,"addon.mod_lesson.youranswer"))("id",e.question.input.id)("formControlName",e.question.input.name)("maxlength",e.question.input.maxlength)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_ion_item_1_Template(e,n){if(1&e&&(r.j41(0,"ion-item")(1,"ion-label",32),r.EFF(2),r.nI1(3,"translate"),r.k0s(),r.nrm(4,"core-rich-text-editor",33),r.nI1(5,"translate"),r.k0s()),2&e){const e=r.XpG(5);r.R7$(2),r.JRh(r.bMT(3,7,"core.content")),r.R7$(2),r.FS9("placeholder",r.bMT(5,9,"addon.mod_lesson.youranswer")),r.Y8G("control",e.question.control)("component",e.component)("componentId",e.lesson.coursemodule)("autoSave",!0)("contextInstanceId",e.lesson.coursemodule)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_ion_item_2_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label")(2,"p",34),r.EFF(3),r.nI1(4,"translate"),r.k0s(),r.j41(5,"p"),r.nrm(6,"core-format-text",24),r.k0s()()()),2&e){const e=r.XpG(5);r.R7$(3),r.JRh(r.bMT(4,6,"addon.mod_lesson.youranswer")),r.R7$(3),r.Y8G("component",e.component)("componentId",e.lesson.coursemodule)("text",e.question.useranswer)("contextInstanceId",e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_Template(e,n){if(1&e&&(r.qex(0),r.DNE(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_ion_item_1_Template,6,11,"ion-item",19)(2,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_ion_item_2_Template,7,8,"ion-item",17),r.bVm()),2&e){const e=r.XpG(4);r.R7$(),r.Y8G("ngIf",e.question.textarea),r.R7$(),r.Y8G("ngIf",!e.question.textarea&&e.question.useranswer)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ion_radio_group_1_ion_item_1_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-radio",38),r.nrm(2,"core-format-text",24),r.k0s()()),2&e){const e=n.$implicit,o=r.XpG(6);r.R7$(),r.Y8G("id",e.id)("value",e.value)("disabled",e.disabled),r.R7$(),r.Y8G("component",o.component)("componentId",o.lesson.coursemodule)("text",e.text)("contextInstanceId",o.lesson.coursemodule)("courseId",o.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ion_radio_group_1_Template(e,n){if(1&e&&(r.j41(0,"ion-radio-group",36),r.DNE(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ion_radio_group_1_ion_item_1_Template,3,8,"ion-item",37),r.k0s()),2&e){const e=r.XpG(5);r.Y8G("formControlName",e.question.controlName),r.R7$(),r.Y8G("ngForOf",e.question.options)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ng_container_2_ion_item_1_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-checkbox",39),r.nrm(2,"core-format-text",24),r.k0s()()),2&e){const e=n.$implicit,o=r.XpG(6);r.R7$(),r.Y8G("id",e.id)("formControlName",e.name),r.R7$(),r.Y8G("component",o.component)("componentId",o.lesson.coursemodule)("text",e.text)("contextInstanceId",o.lesson.coursemodule)("courseId",o.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ng_container_2_Template(e,n){if(1&e&&(r.qex(0),r.DNE(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ng_container_2_ion_item_1_Template,3,7,"ion-item",37),r.bVm()),2&e){const e=r.XpG(5);r.R7$(),r.Y8G("ngForOf",e.question.options)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_Template(e,n){if(1&e&&(r.qex(0),r.DNE(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ion_radio_group_1_Template,2,2,"ion-radio-group",35)(2,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ng_container_2_Template,2,1,"ng-container",19),r.bVm()),2&e){const e=r.XpG(4);r.R7$(),r.Y8G("ngIf",!e.question.multi),r.R7$(),r.Y8G("ngIf",e.question.multi)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_ion_item_1_ion_select_option_4_Template(e,n){if(1&e&&(r.j41(0,"ion-select-option",43),r.EFF(1),r.k0s()),2&e){const e=n.$implicit;r.Y8G("value",e.value),r.R7$(),r.SpI(" ",e.label," ")}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_ion_item_1_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-select",40),r.nI1(2,"translate"),r.nrm(3,"core-format-text",41),r.DNE(4,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_ion_item_1_ion_select_option_4_Template,2,2,"ion-select-option",42),r.k0s()()),2&e){const e=n.$implicit,o=r.XpG(5);r.R7$(),r.Y8G("id",e.id)("formControlName",e.name)("cancelText",r.bMT(2,9,"core.cancel")),r.R7$(2),r.Y8G("component",o.component)("componentId",o.lesson.coursemodule)("text",e.text)("contextInstanceId",o.lesson.coursemodule)("courseId",o.courseId),r.R7$(),r.Y8G("ngForOf",e.options)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_Template(e,n){if(1&e&&(r.qex(0),r.DNE(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_ion_item_1_Template,5,11,"ion-item",37),r.bVm()),2&e){const e=r.XpG(4);r.R7$(),r.Y8G("ngForOf",e.question.rows)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_Template(e,n){if(1&e){const e=r.RV6();r.j41(0,"form",25,0),r.bIt("ngSubmit",(function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_Template_form_ngSubmit_0_listener(n){r.eBV(e);const o=r.XpG(3);return r.Njj(o.submitQuestion(n))})),r.DNE(2,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ion_item_divider_2_Template,4,5,"ion-item-divider",17),r.qex(3,26),r.DNE(4,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ion_item_4_Template,4,10,"ion-item",27)(5,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_Template,3,2,"ng-container",28)(6,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_Template,3,2,"ng-container",28)(7,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_Template,2,1,"ng-container",28),r.bVm(),r.j41(8,"ion-button",29),r.EFF(9),r.k0s(),r.nrm(10,"input",30),r.k0s()}if(2&e){const e=r.XpG(3);r.Y8G("formGroup",e.questionForm),r.R7$(2),r.Y8G("ngIf",e.pageContent),r.R7$(),r.Y8G("ngSwitch",e.question.template),r.R7$(),r.Y8G("ngSwitchCase","shortanswer"),r.R7$(),r.Y8G("ngSwitchCase","essay"),r.R7$(),r.Y8G("ngSwitchCase","multichoice"),r.R7$(),r.Y8G("ngSwitchCase","matching"),r.R7$(2),r.SpI(" ",e.question.submitLabel," ")}}function AddonModLessonPlayerPage_div_13_ion_card_4_Template(e,n){if(1&e&&(r.j41(0,"ion-card"),r.DNE(1,AddonModLessonPlayerPage_div_13_ion_card_4_ion_item_1_Template,3,5,"ion-item",17)(2,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_Template,11,8,"form",23),r.k0s()),2&e){const e=r.XpG(2);r.R7$(),r.Y8G("ngIf",!e.question&&e.pageContent),r.R7$(),r.Y8G("ngIf",e.question&&e.loaded)}}function AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_ion_col_2_Template(e,n){if(1&e){const e=r.RV6();r.j41(0,"ion-col",48)(1,"ion-button",49),r.bIt("click",(function AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_ion_col_2_Template_ion_button_click_1_listener(){const n=r.eBV(e).$implicit,o=r.XpG(4);return r.Njj(o.buttonClicked(n.data))})),r.EFF(2),r.k0s()()}if(2&e){const e=n.$implicit;r.R7$(),r.Y8G("id",e.id),r.R7$(),r.SpI(" ",e.content," ")}}function AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_Template(e,n){if(1&e&&(r.j41(0,"ion-grid",45)(1,"ion-row",46),r.DNE(2,AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_ion_col_2_Template,3,2,"ion-col",47),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.Y8G("ngForOf",e.pageButtons)}}function AddonModLessonPlayerPage_div_13_ion_list_5_ion_item_2_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label")(2,"span",50),r.EFF(3),r.nI1(4,"translate"),r.k0s(),r.nrm(5,"core-progress-bar",51),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.Mz_("id","addon-mod_lesson-",e.cmId,"-progress"),r.R7$(),r.SpI(" ",r.i5U(4,6,"addon.mod_lesson.progresscompleted",r.eq3(9,_c3,e.pageData.progress))," "),r.R7$(2),r.Mz_("ariaDescribedBy","addon-mod_lesson-",e.cmId,"-progress"),r.Y8G("progress",e.pageData.progress)}}function AddonModLessonPlayerPage_div_13_ion_list_5_ion_card_3_Template(e,n){1&e&&(r.j41(0,"ion-card",12)(1,"ion-item",13),r.nrm(2,"ion-icon",14),r.j41(3,"ion-label"),r.EFF(4),r.nI1(5,"translate"),r.k0s()()()),2&e&&(r.R7$(4),r.JRh(r.bMT(5,1,"addon.mod_lesson.progressbarteacherwarning2")))}function AddonModLessonPlayerPage_div_13_ion_list_5_Template(e,n){if(1&e&&(r.j41(0,"ion-list"),r.DNE(1,AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_Template,3,1,"ion-grid",44)(2,AddonModLessonPlayerPage_div_13_ion_list_5_ion_item_2_Template,6,11,"ion-item",17)(3,AddonModLessonPlayerPage_div_13_ion_list_5_ion_card_3_Template,6,3,"ion-card",8),r.k0s()),2&e){const e=r.XpG(2);r.R7$(),r.Y8G("ngIf",null==e.pageButtons?null:e.pageButtons.length),r.R7$(),r.Y8G("ngIf",e.lesson.progressbar&&!e.canManage&&e.pageData),r.R7$(),r.Y8G("ngIf",e.lesson.progressbar&&e.canManage)}}function AddonModLessonPlayerPage_div_13_ion_card_6_Template(e,n){1&e&&(r.j41(0,"ion-card",52)(1,"ion-item"),r.nrm(2,"ion-icon",53),r.j41(3,"ion-label"),r.EFF(4),r.nI1(5,"translate"),r.k0s()()()),2&e&&(r.R7$(4),r.JRh(r.bMT(5,1,"addon.mod_lesson.finishretakeoffline")))}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_card_header_1_Template(e,n){1&e&&(r.j41(0,"ion-card-header",13)(1,"ion-card-title"),r.EFF(2),r.nI1(3,"translate"),r.k0s()()),2&e&&(r.R7$(2),r.JRh(r.bMT(3,1,"addon.mod_lesson.congratulations")))}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_2_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.EFF(2),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.JRh(e.eolData.notenoughtimespent.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_3_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.EFF(2),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.JRh(e.eolData.numberofpagesviewed.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_4_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.EFF(2),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.JRh(e.eolData.youshouldview.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_5_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.EFF(2),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.JRh(e.eolData.numberofcorrectanswers.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_6_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13),r.nrm(1,"ion-label",56),r.k0s()),2&e){const e=r.XpG(3);r.R7$(),r.Y8G("innerHTML",e.eolData.displayscorewithessays.message,r.npT)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_7_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.EFF(2),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.JRh(e.eolData.displayscorewithoutessays.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_8_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.EFF(2),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.JRh(e.eolData.yourcurrentgradeisoutof.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_9_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.EFF(2),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.JRh(e.eolData.eolstudentoutoftimenoanswers.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_10_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.EFF(2),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.JRh(e.eolData.welldone.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_11_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label")(2,"span",50),r.EFF(3),r.nI1(4,"translate"),r.k0s(),r.nrm(5,"core-progress-bar",51),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.Mz_("id","addon-mod_lesson-",e.cmId,"-progress-end"),r.R7$(),r.SpI(" ",r.i5U(4,6,"addon.mod_lesson.progresscompleted",r.eq3(9,_c3,e.eolData.progresscompleted.value))," "),r.R7$(2),r.Mz_("ariaDescribedBy","addon-mod_lesson-",e.cmId,"-progress-end"),r.Y8G("progress",e.eolData.progresscompleted.value)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_12_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.EFF(2),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.JRh(e.eolData.displayofgrade.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_13_Template(e,n){if(1&e){const e=r.RV6();r.j41(0,"ion-button",57),r.bIt("click",(function AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_13_Template_ion_button_click_0_listener(){r.eBV(e);const n=r.XpG(3);return r.Njj(n.reviewLesson(n.reviewPageId))})),r.EFF(1),r.nI1(2,"translate"),r.k0s()}2&e&&(r.R7$(),r.SpI(" ",r.bMT(2,1,"addon.mod_lesson.reviewlesson")," "))}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_14_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.EFF(2),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.JRh(e.eolData.modattemptsnoteacher.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_15_Template(e,n){if(1&e&&(r.j41(0,"ion-button",58),r.nrm(1,"core-format-text",3),r.k0s()),2&e){const e=r.XpG(3);r.Y8G("href",e.activityLink.href)("capture",!0),r.R7$(),r.Y8G("text",e.activityLink.label)("contextInstanceId",e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_16_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.nrm(2,"core-format-text",3),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.Y8G("text",e.activityLink.label)("contextInstanceId",e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_7_Template(e,n){if(1&e&&(r.j41(0,"ion-card"),r.DNE(1,AddonModLessonPlayerPage_div_13_ion_card_7_ion_card_header_1_Template,4,3,"ion-card-header",17)(2,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_2_Template,3,1,"ion-item",17)(3,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_3_Template,3,1,"ion-item",17)(4,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_4_Template,3,1,"ion-item",17)(5,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_5_Template,3,1,"ion-item",17)(6,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_6_Template,2,1,"ion-item",17)(7,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_7_Template,3,1,"ion-item",17)(8,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_8_Template,3,1,"ion-item",17)(9,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_9_Template,3,1,"ion-item",17)(10,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_10_Template,3,1,"ion-item",17)(11,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_11_Template,6,11,"ion-item",17)(12,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_12_Template,3,1,"ion-item",17)(13,AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_13_Template,3,3,"ion-button",54)(14,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_14_Template,3,1,"ion-item",17)(15,AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_15_Template,2,5,"ion-button",55)(16,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_16_Template,3,3,"ion-item",17),r.k0s()),2&e){const e=r.XpG(2);r.R7$(),r.Y8G("ngIf",e.eolData.gradelesson),r.R7$(),r.Y8G("ngIf",e.eolData.notenoughtimespent),r.R7$(),r.Y8G("ngIf",e.eolData.numberofpagesviewed),r.R7$(),r.Y8G("ngIf",e.eolData.youshouldview),r.R7$(),r.Y8G("ngIf",e.eolData.numberofcorrectanswers),r.R7$(),r.Y8G("ngIf",e.eolData.displayscorewithessays),r.R7$(),r.Y8G("ngIf",!e.eolData.displayscorewithessays&&e.eolData.displayscorewithoutessays),r.R7$(),r.Y8G("ngIf",e.eolData.yourcurrentgradeisoutof),r.R7$(),r.Y8G("ngIf",e.eolData.eolstudentoutoftimenoanswers),r.R7$(),r.Y8G("ngIf",e.eolData.welldone),r.R7$(),r.Y8G("ngIf",e.lesson.progressbar&&e.eolData.progresscompleted),r.R7$(),r.Y8G("ngIf",e.eolData.displayofgrade),r.R7$(),r.Y8G("ngIf",e.eolData.reviewlesson),r.R7$(),r.Y8G("ngIf",e.eolData.modattemptsnoteacher),r.R7$(),r.Y8G("ngIf",e.activityLink&&e.activityLink.formatted),r.R7$(),r.Y8G("ngIf",e.activityLink&&!e.activityLink.formatted)}}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_1_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.EFF(2),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.JRh(e.processData.ongoingscore)}}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_div_2_Template(e,n){if(1&e&&(r.j41(0,"div"),r.nrm(1,"core-format-text",24),r.k0s()),2&e){const e=r.XpG(4);r.R7$(),r.Y8G("component",e.component)("componentId",e.lesson.coursemodule)("text",e.processData.feedback)("contextInstanceId",e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_div_3_Template(e,n){1&e&&(r.j41(0,"div")(1,"p"),r.EFF(2),r.nI1(3,"translate"),r.k0s(),r.j41(4,"p"),r.EFF(5),r.nI1(6,"translate"),r.k0s(),r.j41(7,"p"),r.EFF(8),r.nI1(9,"translate"),r.k0s()()),2&e&&(r.R7$(2),r.JRh(r.bMT(3,3,"addon.mod_lesson.gotoendoflesson")),r.R7$(3),r.JRh(r.bMT(6,5,"addon.mod_lesson.or")),r.R7$(3),r.JRh(r.bMT(9,7,"addon.mod_lesson.continuetonextpage")))}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_Template(e,n){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.DNE(2,AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_div_2_Template,2,5,"div",19)(3,AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_div_3_Template,10,9,"div",19),r.k0s()()),2&e){const e=r.XpG(3);r.R7$(2),r.Y8G("ngIf",!e.processData.reviewmode),r.R7$(),r.Y8G("ngIf",e.review)}}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_3_Template(e,n){if(1&e){const e=r.RV6();r.j41(0,"ion-button",57),r.bIt("click",(function AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_3_Template_ion_button_click_0_listener(){r.eBV(e);const n=r.XpG(3);return r.Njj(n.changePage(n.LESSON_EOL))})),r.EFF(1),r.nI1(2,"translate"),r.k0s()}2&e&&(r.R7$(),r.SpI(" ",r.bMT(2,1,"addon.mod_lesson.finish")," "))}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_4_Template(e,n){if(1&e){const e=r.RV6();r.j41(0,"ion-button",60),r.bIt("click",(function AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_4_Template_ion_button_click_0_listener(){const n=r.eBV(e).$implicit,o=r.XpG(3);return r.Njj(o.changePage(n.pageId,!0))})),r.EFF(1),r.nI1(2,"translate"),r.k0s()}if(2&e){const e=n.$implicit;r.R7$(),r.SpI(" ",r.bMT(2,1,e.label)," ")}}function AddonModLessonPlayerPage_div_13_ion_list_8_Template(e,n){if(1&e&&(r.j41(0,"ion-list"),r.DNE(1,AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_1_Template,3,1,"ion-item",17)(2,AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_Template,4,2,"ion-item",17)(3,AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_3_Template,3,3,"ion-button",54)(4,AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_4_Template,3,3,"ion-button",59),r.k0s()),2&e){const e=r.XpG(2);r.R7$(),r.Y8G("ngIf",e.processData.ongoingscore&&!e.processData.reviewmode),r.R7$(),r.Y8G("ngIf",!e.processData.reviewmode||e.review),r.R7$(),r.Y8G("ngIf",e.review),r.R7$(),r.Y8G("ngForOf",e.processDataButtons)}}function AddonModLessonPlayerPage_div_13_Template(e,n){if(1&e&&(r.j41(0,"div",15),r.DNE(1,AddonModLessonPlayerPage_div_13_core_timer_1_Template,2,5,"core-timer",16)(2,AddonModLessonPlayerPage_div_13_ion_item_2_Template,5,6,"ion-item",17)(3,AddonModLessonPlayerPage_div_13_ion_item_3_Template,3,1,"ion-item",18)(4,AddonModLessonPlayerPage_div_13_ion_card_4_Template,3,2,"ion-card",19)(5,AddonModLessonPlayerPage_div_13_ion_list_5_Template,4,3,"ion-list",19)(6,AddonModLessonPlayerPage_div_13_ion_card_6_Template,6,3,"ion-card",20)(7,AddonModLessonPlayerPage_div_13_ion_card_7_Template,17,16,"ion-card",19)(8,AddonModLessonPlayerPage_div_13_ion_list_8_Template,5,4,"ion-list",19),r.k0s()),2&e){const e=r.XpG();r.Y8G("ngClass",r.eq3(10,_c1,e.lesson.slideshow))("ngStyle",r.l_i(12,_c2,e.lessonWidth,e.lessonHeight)),r.R7$(),r.Y8G("ngIf",e.endTime),r.R7$(),r.Y8G("ngIf",e.showRetake&&!e.eolData&&!e.processData),r.R7$(),r.Y8G("ngIf",e.pageData&&e.pageData.ongoingscore&&!e.eolData&&!e.processData),r.R7$(),r.Y8G("ngIf",!e.eolData&&!e.processData),r.R7$(),r.Y8G("ngIf",!e.eolData&&!e.processData),r.R7$(),r.Y8G("ngIf",e.eolData&&!e.processData&&(null==e.eolData.offline?null:e.eolData.offline.value)),r.R7$(),r.Y8G("ngIf",e.eolData&&!e.processData),r.R7$(),r.Y8G("ngIf",e.processData)}}let ee=(()=>{var e;class AddonModLessonPlayerPage{constructor(e,n){this.changeDetector=e,this.formBuilder=n,this.component=S.JL,this.LESSON_EOL=-9,this.messages=[],this.processDataButtons=[],this.forceLeave=!1,this.menuShown=!1}ngOnInit(){var e=this;return(0,h.A)((function*(){try{e.cmId=l.CoreNavigator.getRequiredRouteNumberParam("cmId"),e.courseId=l.CoreNavigator.getRequiredRouteNumberParam("courseId"),e.password=l.CoreNavigator.getRouteParam("password"),e.review=!!l.CoreNavigator.getRouteBooleanParam("review"),e.currentPage=l.CoreNavigator.getRouteNumberParam("pageId"),e.retakeToReview=l.CoreNavigator.getRouteNumberParam("retake")}catch(e){return y.CoreDomUtils.showErrorModal(e),l.CoreNavigator.back(),void 0}try{(yield e.fetchLessonData())&&Y._.deleteRetakeFinishedInSync(e.lesson.id)}finally{e.loaded=!0}}))()}ngOnDestroy(){this.lesson&&b.CoreSync.unblockOperation(this.component,this.lesson.id)}canLeave(){var e=this;return(0,h.A)((function*(){return e.forceLeave||!e.questionForm||(e.question&&!e.eolData&&!e.processData&&e.originalData&&(M.T.basicLeftCompare(e.questionForm.getRawValue(),e.originalData,3)||(yield y.CoreDomUtils.showConfirm(T.HT.instant("core.confirmcanceledit")))),N.R.triggerFormCancelledEvent(e.formElement,R.CoreSites.getCurrentSiteId())),!0}))()}ionViewWillLeave(){this.menuShown&&T.W3.dismiss()}buttonClicked(e){this.processPage(e)}callFunction(e,n){var o=this;return(0,h.A)((function*(){try{return yield e()}catch(t){if(o.offline||o.review||!w.N.isLessonOffline(o.lesson))throw t;if(O.CoreWSError.isWebServiceError(t))throw t;return o.offline=!0,o.jumps=yield w.N.getPagesPossibleJumps(o.lesson.id,{cmId:o.cmId,readingStrategy:1}),n.readingStrategy=1,n.jumps=o.jumps,n.offline=!0,e()}}))()}changePage(e,n){var o=this;return(0,h.A)((function*(){if(n||o.eolData||o.currentPage!=e){o.loaded=!0,o.messages=[];try{yield o.loadPage(e)}catch(e){y.CoreDomUtils.showErrorModalDefault(e,"Error loading page")}finally{o.loaded=!0}}}))()}fetchLessonData(){var e=this;return(0,h.A)((function*(){try{var n;e.lesson=yield w.N.getLesson(e.courseId,e.cmId),e.title=e.lesson.name,b.CoreSync.blockOperation(e.component,e.lesson.id),yield Y._.waitForSync(e.lesson.id),e.offline=yield j.c.hasOfflineData(e.lesson.id),e.offline||P.WE.isOnline()||!w.N.isLessonOffline(e.lesson)||e.review||(e.offline=!0);const o=e.lesson.id,t={cmId:e.cmId,readingStrategy:e.offline?1:2};e.accessInfo=yield e.callFunction((()=>w.N.getAccessInformation(o,t)),t);const a=[];if(e.canManage=e.accessInfo.canmanage,e.retake=e.accessInfo.attemptscount,e.showRetake=!e.currentPage&&e.retake>0,e.accessInfo.preventaccessreasons.length){const n=w.N.getPreventAccessReason(e.accessInfo,!!e.password,e.review);if(n)throw new I.CoreError(n.message)}if(e.review&&e.retakeToReview!=e.accessInfo.attemptscount-1)throw new I.CoreError(T.HT.instant("addon.mod_lesson.errorreviewretakenotlast"));if(e.password){const n={password:e.password,cmId:e.cmId,readingStrategy:e.offline?1:2};a.push(e.callFunction((()=>w.N.getLessonWithPassword(o,n)),n).then((n=>{e.lesson=n})))}return e.offline&&a.push(w.N.getPagesPossibleJumps(e.lesson.id,{cmId:e.cmId,readingStrategy:1}).then((n=>{e.jumps=n}))),yield Promise.all(a),e.mediaFile=null===(n=e.lesson.mediafiles)||void 0===n?void 0:n[0],e.lessonWidth=e.lesson.slideshow?y.CoreDomUtils.formatPixelsSize(e.lesson.mediawidth):"",e.lessonHeight=e.lesson.slideshow?y.CoreDomUtils.formatPixelsSize(e.lesson.mediaheight):"",yield e.launchRetake(e.currentPage),!0}catch(n){return e.review&&e.retakeToReview&&O.CoreWSError.isWebServiceError(n)&&(yield Y._.deleteRetakeFinishedInSync(e.lesson.id)),y.CoreDomUtils.showErrorModalDefault(n,"core.course.errorgetmodule",!0),e.forceLeave=!0,l.CoreNavigator.back(),!1}}))()}finishRetake(e){var n=this;return(0,h.A)((function*(){if(!n.lesson)return;const o=n.lesson;if(n.messages=[],n.offline&&P.WE.isOnline()){var t;const e=yield X.g.ignoreErrors(Y._.syncLesson(o.id,!0,!0));if(null!=e&&null!==(t=e.warnings)&&void 0!==t&&t.length){if((yield w.N.getAccessInformation(o.id,{cmId:n.cmId})).attemptscount!=n.accessInfo.attemptscount)throw n.forceLeave=!0,l.CoreNavigator.back(),new I.CoreError(e.warnings[0]);y.CoreDomUtils.showAlert(void 0,e.warnings[0])}n.offline=!1}const a={password:n.password,outOfTime:e,review:n.review,offline:n.offline,accessInfo:n.accessInfo},i=yield n.callFunction((()=>w.N.finishRetake(o,n.courseId,a)),a);if(n.title=o.name,n.eolData=i.data,n.messages=n.messages.concat(i.messages),n.processData=void 0,n.endTime=void 0,L.z.trigger(L.z.ACTIVITY_DATA_SENT,{module:"lesson"}),n.activityLink=n.eolData.activitylink?E.formatActivityLink(n.eolData.activitylink.value):void 0,n.eolData.reviewlesson){const e=k.F.extractUrlParams(n.eolData.reviewlesson.value);e&&e.pageid?n.reviewPageId=Number(e.pageid):delete n.eolData.reviewlesson}n.logPageLoaded(-9,T.HT.instant("addon.mod_lesson.congratulations"))}))()}jumpToPage(e){var n=this;return(0,h.A)((function*(){return 0===e?(n.forceLeave=!0,l.CoreNavigator.back(),void 0):-9==e?n.finishRetake():(n.messages=[],n.loadPage(e))}))()}launchRetake(e){var n=this;return(0,h.A)((function*(){var o;let t;if(n.review);else if(n.offline){(yield j.c.hasFinishedRetake(n.lesson.id))&&(e=-9)}else t=yield w.N.launchRetake(n.lesson.id,n.password,e);if(n.currentPage=e||n.accessInfo.firstpageid,n.messages=(null===(o=t)||void 0===o?void 0:o.messages)||[],n.lesson.timelimit&&!n.accessInfo.canmanage){const e=yield w.N.getTimers(n.lesson.id,{cmId:n.cmId,readingStrategy:2});n.endTime=e[e.length-1].starttime+n.lesson.timelimit}return n.loadPage(n.currentPage)}))()}loadMenu(){var e=this;return(0,h.A)((function*(){if(!e.loadingMenu&&e.lesson)try{e.loadingMenu=!0;const n=e.lesson.id,o={password:e.password,cmId:e.cmId,readingStrategy:e.offline?1:2},t=yield e.callFunction((()=>w.N.getPages(n,o)),o);e.lessonPages=t.map((e=>e.page))}catch(e){y.CoreDomUtils.showErrorModalDefault(e,"Error loading menu.")}finally{e.loadingMenu=!1}}))()}loadPage(e){var n=this;return(0,h.A)((function*(){var o,t;if(-9==e)return n.finishRetake();if(!n.lesson)return;const a=n.lesson,i={password:n.password,review:n.review,includeContents:!0,cmId:n.cmId,readingStrategy:n.offline?1:2,accessInfo:n.accessInfo,jumps:n.jumps,includeOfflineData:!0},s=yield n.callFunction((()=>w.N.getPageData(a,e,i)),i);if(-9==s.newpageid)return n.finishRetake();n.pageData=s,n.title=s.page.title,n.pageContent=E.getPageContentsFromPageData(s),n.loaded=!0,n.currentPage=e,n.messages=n.messages.concat(s.messages),n.eolData=n.processData=void 0,w.N.isQuestionPage(s.page.type)?(n.questionForm=n.formBuilder.group({}),n.pageButtons=[],n.question=E.getQuestionFromPageData(n.questionForm,s),n.originalData=n.questionForm.getRawValue()):(n.pageButtons=E.getPageButtonsFromHtml(s.pagecontent||""),n.question=void 0,n.originalData=void 0),!s.displaymenu||n.displayMenu||n.review||n.loadMenu(),n.displayMenu=!n.review&&!!s.displaymenu,n.firstPageLoaded?n.showRetake=!1:n.firstPageLoaded=!0,n.logPageLoaded(e,null!==(o=null===(t=s.page)||void 0===t?void 0:t.title)&&void 0!==o?o:"")}))()}logPageLoaded(e,n){this.lesson&&U.OF.logEvent({type:U.qr.VIEW_ITEM,ws:"mod_lesson_get_page_data",name:this.lesson.name+": "+n,data:{id:this.lesson.id,pageid:e,category:"lesson"},url:`/mod/lesson/view.php?id=${this.lesson.id}&pageid=${e}`})}logContinuePageLoaded(){this.lesson&&U.OF.logEvent({type:U.qr.VIEW_ITEM,ws:"mod_lesson_process_page",name:this.lesson.name+": "+T.HT.instant("addon.mod_lesson.continue"),data:{id:this.lesson.id,category:"lesson"},url:"/mod/lesson/continue.php"})}processPage(e,n){var o=this;return(0,h.A)((function*(){if(!o.lesson||!o.pageData)return;o.loaded=!1;const t=o.lesson,a=o.pageData,i={password:o.password,review:o.review,offline:o.offline,accessInfo:o.accessInfo,jumps:o.jumps};try{const d=yield o.callFunction((()=>w.N.processPage(t,o.courseId,a,e,i)),i);if(n&&N.R.triggerFormSubmittedEvent(o.formElement,d.sent,R.CoreSites.getCurrentSiteId()),!o.offline&&!o.review&&w.N.isLessonOffline(t)){var s;const e=o.accessInfo.attemptscount,n={cmId:o.cmId,readingStrategy:2};w.N.isQuestionPage((null===(s=o.pageData)||void 0===s||null===(s=s.page)||void 0===s?void 0:s.type)||-1)?w.N.getQuestionsAttemptsOnline(t.id,e,n):w.N.getContentPagesViewedOnline(t.id,e,n)}if(d.nodefaultresponse||d.inmediatejump)return yield o.jumpToPage(d.newpageid);var r;if(d.feedback=E.removeQuestionFromFeedback(d.feedback),o.messages=d.messages,o.processData=d,o.processDataButtons=[],!t.review||d.correctanswer||d.noanswer||d.isessayquestion||d.maxattemptsreached||d.reviewmode||o.processDataButtons.push({label:"addon.mod_lesson.reviewquestionback",pageId:o.currentPage}),!t.review||d.correctanswer||d.noanswer||d.isessayquestion||d.maxattemptsreached)o.processDataButtons.push({label:"addon.mod_lesson.continue",pageId:d.newpageid});else(null===(r=a.page)||void 0===r?void 0:r.id)!=d.newpageid&&o.processDataButtons.push({label:"addon.mod_lesson.reviewquestioncontinue",pageId:d.newpageid});o.logContinuePageLoaded()}catch(e){y.CoreDomUtils.showErrorModalDefault(e,"Error processing page")}finally{o.loaded=!0}}))()}reviewLesson(e){var n=this;return(0,h.A)((function*(){n.loaded=!1,n.review=!0,n.offline=!1;try{yield n.loadPage(e)}catch(e){y.CoreDomUtils.showErrorModalDefault(e,"Error loading page")}finally{n.loaded=!0}}))()}submitQuestion(e){e.preventDefault(),e.stopPropagation(),this.loaded=!1;const n=E.prepareQuestionData(this.question,this.questionForm.getRawValue());this.processPage(n,!0).finally((()=>{this.loaded=!0}))}timeUp(){var e=this;return(0,h.A)((function*(){e.endTime=void 0,e.loaded=!1;try{yield e.finishRetake(!0)}catch(e){y.CoreDomUtils.showErrorModalDefault(e,"Error finishing attempt")}finally{e.loaded=!0}}))()}showMenu(){var e=this;return(0,h.A)((function*(){e.menuShown=!0;const{AddonModLessonMenuModalPage:n}=yield o.e(1790).then(o.bind(o,81790));yield q.I.openSideModal({component:n,componentProps:{pageInstance:e}}),e.menuShown=!1}))()}}return(e=AddonModLessonPlayerPage).ɵfac=function AddonModLessonPlayerPage_Factory(n){return new(n||e)(r.rXU(r.gRc),r.rXU(F.ok))},e.ɵcmp=r.VBU({type:e,selectors:[["page-addon-mod-lesson-player"]],viewQuery:function AddonModLessonPlayerPage_Query(e,n){if(1&e&&(r.GBs(g.W9,5),r.GBs(Z,5)),2&e){let e;r.mGM(e=r.lsd())&&(n.content=e.first),r.mGM(e=r.lsd())&&(n.formElement=e.first)}},decls:14,vars:10,consts:[["questionFormEl",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["fill","clear",3,"ariaLabel","click",4,"ngIf"],[1,"limited-width"],[3,"hideUntil"],["class","core-info-card",4,"ngIf"],[3,"ngClass","ngStyle",4,"ngIf"],["fill","clear",3,"click","ariaLabel"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],[1,"core-info-card"],[1,"ion-text-wrap"],["name","fas-circle-info","slot","start","aria-hidden","true"],[3,"ngClass","ngStyle"],[3,"endTime","timeLeftClassThreshold","timerText","finished",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["class","addon-mod_lesson-ongoingscore ion-text-wrap",4,"ngIf"],[4,"ngIf"],["class","core-warning-card",4,"ngIf"],[3,"finished","endTime","timeLeftClassThreshold","timerText"],[1,"addon-mod_lesson-ongoingscore","ion-text-wrap"],[3,"formGroup","ngSubmit",4,"ngIf"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[3,"ngSubmit","formGroup"],[3,"ngSwitch"],["class","ion-text-wrap",4,"ngSwitchCase"],[4,"ngSwitchCase"],["expand","block","type","submit",1,"ion-text-wrap","ion-margin"],["type","submit",1,"core-submit-hidden-enter"],["autocorrect","off",3,"type","placeholder","ariaLabel","id","formControlName","maxlength"],[1,"sr-only"],["contextLevel","module","elementId","answer_editor",3,"placeholder","control","component","componentId","autoSave","contextInstanceId"],[1,"item-heading"],[3,"formControlName",4,"ngIf"],[3,"formControlName"],["class","ion-text-wrap",4,"ngFor","ngForOf"],[3,"id","value","disabled"],[3,"id","formControlName"],["interface","action-sheet",3,"id","formControlName","cancelText"],["slot","label","contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["class","ion-text-wrap addon-mod_lesson-pagebuttons",4,"ngIf"],[1,"ion-text-wrap","addon-mod_lesson-pagebuttons"],[1,"ion-align-items-center"],["size","12","size-md","6","size-lg","3","col-xl","",4,"ngFor","ngForOf"],["size","12","size-md","6","size-lg","3","col-xl",""],["expand","block","fill","outline",1,"ion-text-wrap",3,"click","id"],[3,"id"],[3,"progress","ariaDescribedBy"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["expand","block","class","ion-text-wrap ion-margin",3,"click",4,"ngIf"],["expand","block","fill","outline","core-link","","class","ion-text-wrap ion-margin",3,"href","capture",4,"ngIf"],[3,"innerHTML"],["expand","block",1,"ion-text-wrap","ion-margin",3,"click"],["expand","block","fill","outline","core-link","",1,"ion-text-wrap","ion-margin",3,"href","capture"],["expand","block","class","ion-text-wrap ion-margin","fill","outline",3,"click",4,"ngFor","ngForOf"],["expand","block","fill","outline",1,"ion-text-wrap","ion-margin",3,"click"]],template:function AddonModLessonPlayerPage_Template(e,n){1&e&&(r.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),r.nrm(3,"ion-back-button",2),r.nI1(4,"translate"),r.k0s(),r.j41(5,"ion-title")(6,"h1"),r.nrm(7,"core-format-text",3),r.k0s()(),r.j41(8,"ion-buttons",4),r.DNE(9,AddonModLessonPlayerPage_ion_button_9_Template,3,3,"ion-button",5),r.k0s()()(),r.j41(10,"ion-content",6)(11,"core-loading",7),r.DNE(12,AddonModLessonPlayerPage_ion_card_12_Template,5,1,"ion-card",8)(13,AddonModLessonPlayerPage_div_13_Template,9,15,"div",9),r.k0s()()),2&e&&(r.R7$(3),r.Y8G("text",r.bMT(4,8,"core.back")),r.R7$(4),r.Y8G("text",n.title)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),r.R7$(2),r.Y8G("ngIf",n.displayMenu||n.mediaFile),r.R7$(2),r.Y8G("hideUntil",n.loaded),r.R7$(),r.Y8G("ngIf",n.lesson&&(null==n.messages?null:n.messages.length)),r.R7$(),r.Y8G("ngIf",n.lesson))},dependencies:[B.YU,B.Sq,B.bT,B.B3,B.ux,B.e1,J.R,V.z,H.G,Q.t,c.B,z.j,u.i,W.T,F.qT,F.BC,F.cb,F.tU,g.Jm,g.QW,g.b_,g.ME,g.tN,g.eY,g.hU,g.W9,g.lO,g.eU,g.iq,g.$w,g.uz,g.Dg,g.he,g.nf,g.KO,g.f0,g.ln,g.Nm,g.Ip,g.BC,g.ai,g.hB,g.Je,g.Gw,g.el,F.j4,F.JD,K.u,p.D9],styles:["[_nghost-%COMP%]{--background-odd: var(--light)}:root.dark[_nghost-%COMP%], :root.dark   [_nghost-%COMP%]{--background-odd: var(--medium)}[_nghost-%COMP%]     .addon-mod_lesson-slideshow{max-width:100%;max-height:100%;margin:0 auto}[_nghost-%COMP%]     .studentanswer{padding-inline-start:8px}[_nghost-%COMP%]     table{width:100%;margin-top:1.5rem}[_nghost-%COMP%]     table tr:nth-child(odd){background-color:var(--background-odd)}[_nghost-%COMP%]     table tr:last-child td{border-bottom:0}[_nghost-%COMP%]     table td{padding:5px;line-height:1.5;border-bottom:1px solid var(--stroke)}"]}),AddonModLessonPlayerPage})();var ne=o(6007),oe=o(98870),te=o(49588),ae=o(16658),ie=o(37557),se=o(35407),re=o(59528);const user_retake_c0=e=>({header:e}),user_retake_c1=e=>({$a:e}),user_retake_c2=e=>({"text-dimmed":e}),user_retake_c3=e=>({"addon-mod_lesson-highlight":e});function AddonModLessonUserRetakePage_div_14_ion_item_7_ion_select_option_7_Template(e,n){if(1&e&&(r.j41(0,"ion-select-option",16),r.EFF(1),r.k0s()),2&e){const e=n.$implicit;r.Y8G("value",e.try),r.R7$(),r.SpI(" ",e.label," ")}}function AddonModLessonUserRetakePage_div_14_ion_item_7_Template(e,n){if(1&e){const e=r.RV6();r.j41(0,"ion-item",12)(1,"ion-select",13),r.nI1(2,"translate"),r.nI1(3,"translate"),r.mxI("ngModelChange",(function AddonModLessonUserRetakePage_div_14_ion_item_7_Template_ion_select_ngModelChange_1_listener(n){r.eBV(e);const o=r.XpG(2);return r.DH7(o.selectedRetake,n)||(o.selectedRetake=n),r.Njj(n)})),r.bIt("ionChange",(function AddonModLessonUserRetakePage_div_14_ion_item_7_Template_ion_select_ionChange_1_listener(){r.eBV(e);const n=r.XpG(2);return r.Njj(n.changeRetake(n.selectedRetake))})),r.j41(4,"p",14),r.EFF(5),r.nI1(6,"translate"),r.k0s(),r.DNE(7,AddonModLessonUserRetakePage_div_14_ion_item_7_ion_select_option_7_Template,2,2,"ion-select-option",15),r.k0s()()}if(2&e){const e=r.XpG(2);r.R7$(),r.R50("ngModel",e.selectedRetake),r.Y8G("cancelText",r.bMT(2,5,"core.cancel"))("interfaceOptions",r.eq3(11,user_retake_c0,r.bMT(3,7,"addon.mod_lesson.attemptheader"))),r.R7$(4),r.JRh(r.bMT(6,9,"addon.mod_lesson.attemptheader")),r.R7$(2),r.Y8G("ngForOf",e.student.attempts)}}function AddonModLessonUserRetakePage_div_14_ion_list_8_Template(e,n){if(1&e&&(r.j41(0,"ion-list",17)(1,"ion-item")(2,"ion-label",12)(3,"ion-grid",18)(4,"ion-row")(5,"ion-col")(6,"p",19),r.EFF(7),r.nI1(8,"translate"),r.k0s(),r.j41(9,"p"),r.EFF(10),r.nI1(11,"translate"),r.k0s()(),r.j41(12,"ion-col")(13,"p",19),r.EFF(14),r.nI1(15,"translate"),r.k0s(),r.j41(16,"p"),r.EFF(17),r.k0s()()()()()(),r.j41(18,"ion-item",12)(19,"ion-label")(20,"p",19),r.EFF(21),r.nI1(22,"translate"),r.k0s(),r.j41(23,"p"),r.EFF(24),r.k0s()()(),r.j41(25,"ion-item",12)(26,"ion-label")(27,"p",19),r.EFF(28),r.nI1(29,"translate"),r.k0s(),r.j41(30,"p"),r.EFF(31),r.nI1(32,"coreFormatDate"),r.k0s()()()()),2&e){const e=r.XpG(2);r.R7$(7),r.JRh(r.bMT(8,9,"addon.mod_lesson.grade")),r.R7$(3),r.JRh(r.i5U(11,11,"core.percentagenumber",r.eq3(22,user_retake_c1,e.retake.userstats.grade))),r.R7$(4),r.JRh(r.bMT(15,14,"addon.mod_lesson.rawgrade")),r.R7$(3),r.Lme("",e.retake.userstats.gradeinfo.earned," / ",e.retake.userstats.gradeinfo.total,""),r.R7$(4),r.JRh(r.bMT(22,16,"addon.mod_lesson.timetaken")),r.R7$(3),r.JRh(e.timeTakenReadable),r.R7$(4),r.JRh(r.bMT(29,18,"addon.mod_lesson.completed")),r.R7$(3),r.JRh(r.bMT(32,20,1e3*e.retake.userstats.completed))}}function AddonModLessonUserRetakePage_div_14_ion_item_9_Template(e,n){1&e&&(r.j41(0,"ion-item",12)(1,"ion-label"),r.EFF(2),r.nI1(3,"translate"),r.k0s()()),2&e&&(r.R7$(2),r.JRh(r.bMT(3,1,"addon.mod_lesson.notcompleted")))}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_ion_item_16_Template(e,n){1&e&&(r.j41(0,"ion-item",12)(1,"ion-label")(2,"p"),r.EFF(3),r.nI1(4,"translate"),r.k0s()()()),2&e&&(r.R7$(3),r.JRh(r.bMT(4,1,"addon.mod_lesson.didnotanswerquestion")))}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_1_Template(e,n){if(1&e&&(r.j41(0,"ion-item")(1,"ion-label",12)(2,"ion-grid",18)(3,"ion-row")(4,"ion-col")(5,"ion-button",26),r.EFF(6),r.k0s()(),r.j41(7,"ion-col"),r.nrm(8,"p",27),r.k0s()()()()()),2&e){const e=r.XpG().$implicit;r.R7$(5),r.Y8G("disabled",!0),r.R7$(),r.SpI(" ",e[0].buttonText," "),r.R7$(2),r.Y8G("innerHTML",e[0].content,r.npT)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_4_Template(e,n){if(1&e&&(r.j41(0,"ion-badge",34),r.nrm(1,"core-format-text",31),r.k0s()),2&e){const e=r.XpG(3).$implicit,n=r.XpG(5);r.R7$(),r.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_5_Template(e,n){if(1&e&&(r.j41(0,"ion-badge",35),r.EFF(1),r.k0s()),2&e){const e=r.XpG(3).$implicit;r.R7$(),r.SpI(" ",e[0].successBadge," ")}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_Template(e,n){if(1&e&&(r.j41(0,"ion-item",29)(1,"ion-checkbox",30)(2,"p"),r.nrm(3,"core-format-text",31),r.k0s(),r.DNE(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_4_Template,2,5,"ion-badge",32)(5,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_5_Template,2,1,"ion-badge",33),r.k0s()()),2&e){const e=r.XpG(2).$implicit,n=r.XpG(5);r.Y8G("ngClass",r.eq3(11,user_retake_c3,e[0].highlight)),r.R7$(),r.Y8G("ngModel",e[0].checked)("disabled",!0),r.BMQ("name",e[0].name),r.R7$(2),r.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0].content)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),r.R7$(),r.Y8G("ngIf",e[1]),r.R7$(),r.Y8G("ngIf",e[0].successBadge)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_ion_badge_4_Template(e,n){if(1&e&&(r.j41(0,"ion-badge",37),r.nrm(1,"core-format-text",31),r.k0s()),2&e){const e=r.XpG(3).$implicit,n=r.XpG(5);r.R7$(),r.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_Template(e,n){if(1&e&&(r.j41(0,"ion-item",12)(1,"ion-label")(2,"p"),r.EFF(3),r.k0s(),r.DNE(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_ion_badge_4_Template,2,5,"ion-badge",36),r.k0s()()),2&e){const e=r.XpG(2).$implicit;r.R7$(3),r.JRh(e[0].value),r.R7$(),r.Y8G("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_ion_badge_10_Template(e,n){if(1&e&&(r.j41(0,"ion-badge",37),r.nrm(1,"core-format-text",31),r.k0s()),2&e){const e=r.XpG(3).$implicit,n=r.XpG(5);r.R7$(),r.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_Template(e,n){if(1&e&&(r.j41(0,"ion-item")(1,"ion-label",12)(2,"ion-grid",18)(3,"ion-row")(4,"ion-col")(5,"p"),r.nrm(6,"core-format-text",31),r.k0s()(),r.j41(7,"ion-col")(8,"p"),r.EFF(9),r.k0s(),r.DNE(10,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_ion_badge_10_Template,2,5,"ion-badge",36),r.k0s()()()()()),2&e){const e=r.XpG(2).$implicit,n=r.XpG(5);r.R7$(6),r.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0].content)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),r.R7$(3),r.JRh(e[0].value),r.R7$(),r.Y8G("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_ion_badge_4_Template(e,n){if(1&e&&(r.j41(0,"ion-badge",37),r.nrm(1,"core-format-text",31),r.k0s()),2&e){const e=r.XpG(3).$implicit,n=r.XpG(5);r.R7$(),r.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_Template(e,n){if(1&e&&(r.j41(0,"ion-item",12)(1,"ion-label")(2,"p"),r.nrm(3,"core-format-text",31),r.k0s(),r.DNE(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_ion_badge_4_Template,2,5,"ion-badge",36),r.k0s()()),2&e){const e=r.XpG(2).$implicit,n=r.XpG(5);r.R7$(3),r.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),r.R7$(),r.Y8G("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_Template(e,n){if(1&e&&(r.qex(0),r.DNE(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_Template,6,13,"ion-item",28)(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_Template,5,2,"ion-item",10)(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_Template,11,7,"ion-item",6)(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_Template,5,6,"ion-item",10),r.bVm()),2&e){const e=r.XpG().$implicit;r.R7$(),r.Y8G("ngIf",e[0].isCheckbox),r.R7$(),r.Y8G("ngIf",e[0].isText),r.R7$(),r.Y8G("ngIf",e[0].isSelect),r.R7$(),r.Y8G("ngIf",!e[0].isCheckbox&&!e[0].isText&&!e[0].isSelect)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_ion_badge_4_Template(e,n){if(1&e&&(r.j41(0,"ion-badge",37),r.nrm(1,"core-format-text",31),r.k0s()),2&e){const e=r.XpG(2).$implicit,n=r.XpG(5);r.R7$(),r.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[1])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_Template(e,n){if(1&e&&(r.j41(0,"ion-item",12)(1,"ion-label")(2,"p"),r.nrm(3,"core-format-text",31),r.k0s(),r.DNE(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_ion_badge_4_Template,2,5,"ion-badge",36),r.k0s()()),2&e){const e=r.XpG().$implicit,n=r.XpG(5);r.R7$(3),r.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e[0])("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),r.R7$(),r.Y8G("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_Template(e,n){if(1&e&&(r.qex(0),r.DNE(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_1_Template,9,3,"ion-item",6)(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_Template,5,4,"ng-container",6)(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_Template,5,6,"ion-item",10),r.bVm()),2&e){const e=r.XpG(2).$implicit;r.R7$(),r.Y8G("ngIf",e.isContent),r.R7$(),r.Y8G("ngIf",e.isQuestion),r.R7$(),r.Y8G("ngIf",!e.isContent&&!e.isQuestion)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_2_Template(e,n){if(1&e&&(r.j41(0,"ion-item",12)(1,"ion-label")(2,"p",19),r.EFF(3),r.nI1(4,"translate"),r.k0s(),r.j41(5,"p"),r.nrm(6,"core-format-text",31),r.k0s()()()),2&e){const e=r.XpG(2).$implicit,n=r.XpG(3);r.R7$(3),r.JRh(r.bMT(4,6,"addon.mod_lesson.response")),r.R7$(3),r.Y8G("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e.answerdata.response)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_3_Template(e,n){if(1&e&&(r.j41(0,"ion-item",12)(1,"ion-label")(2,"p"),r.EFF(3),r.k0s()()()),2&e){const e=r.XpG(2).$implicit;r.R7$(3),r.JRh(e.answerdata.score)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_Template(e,n){if(1&e&&(r.j41(0,"div",24),r.DNE(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_Template,4,3,"ng-container",25)(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_2_Template,7,8,"ion-item",10)(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_3_Template,4,1,"ion-item",10),r.k0s()),2&e){const e=r.XpG().$implicit;r.R7$(),r.Y8G("ngForOf",e.answerdata.answers),r.R7$(),r.Y8G("ngIf",e.answerdata.response),r.R7$(),r.Y8G("ngIf",e.answerdata.score)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_Template(e,n){if(1&e&&(r.j41(0,"ion-card",21)(1,"ion-card-header",12)(2,"ion-card-title"),r.EFF(3),r.k0s()(),r.j41(4,"ion-item",12)(5,"ion-label")(6,"p",19),r.EFF(7),r.nI1(8,"translate"),r.k0s(),r.j41(9,"p"),r.nrm(10,"core-format-text",22),r.k0s()()(),r.j41(11,"ion-item",12)(12,"ion-label")(13,"p",19),r.EFF(14),r.nI1(15,"translate"),r.k0s()()(),r.DNE(16,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_ion_item_16_Template,5,3,"ion-item",10)(17,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_Template,4,3,"div",23),r.k0s()),2&e){const e=n.$implicit,o=r.XpG(3);r.Y8G("ngClass",r.eq3(16,user_retake_c2,e.grayout)),r.R7$(3),r.Lme("",e.qtype,": ",e.title,""),r.R7$(4),r.JRh(r.bMT(8,12,"addon.mod_lesson.question")),r.R7$(3),r.Y8G("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e.contents)("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId),r.R7$(4),r.JRh(r.bMT(15,14,"addon.mod_lesson.answer")),r.R7$(2),r.Y8G("ngIf",!e.answerdata||!e.answerdata.answers||!e.answerdata.answers.length),r.R7$(),r.Y8G("ngIf",e.answerdata&&e.answerdata.answers&&e.answerdata.answers.length)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_Template(e,n){if(1&e&&(r.qex(0),r.DNE(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_Template,18,18,"ion-card",20),r.bVm()),2&e){const e=r.XpG(2);r.R7$(),r.Y8G("ngForOf",e.retake.answerpages)}}function AddonModLessonUserRetakePage_div_14_Template(e,n){if(1&e&&(r.j41(0,"div")(1,"ion-item",7),r.nrm(2,"core-user-avatar",8),r.j41(3,"ion-label")(4,"h2"),r.EFF(5),r.k0s(),r.nrm(6,"core-progress-bar",9),r.k0s()(),r.DNE(7,AddonModLessonUserRetakePage_div_14_ion_item_7_Template,8,13,"ion-item",10)(8,AddonModLessonUserRetakePage_div_14_ion_list_8_Template,33,24,"ion-list",11)(9,AddonModLessonUserRetakePage_div_14_ion_item_9_Template,4,3,"ion-item",10)(10,AddonModLessonUserRetakePage_div_14_ng_container_10_Template,2,1,"ng-container",6),r.k0s()),2&e){const e=r.XpG();r.R7$(),r.Y8G("userId",e.student.id)("courseId",e.courseId),r.BMQ("aria-label",e.student.fullname),r.R7$(),r.Y8G("user",e.student)("userId",e.student.id)("courseId",e.courseId)("linkProfile",!1),r.R7$(3),r.JRh(e.student.fullname),r.R7$(),r.Y8G("progress",e.student.bestgrade),r.R7$(),r.Y8G("ngIf",e.student.attempts&&e.student.attempts.length>1),r.R7$(),r.Y8G("ngIf",e.retake&&e.retake.userstats&&e.retake.userstats.gradeinfo),r.R7$(),r.Y8G("ngIf",e.retake&&(!e.retake.userstats||!e.retake.userstats.gradeinfo)),r.R7$(),r.Y8G("ngIf",e.retake)}}let de=(()=>{var e;class AddonModLessonUserRetakePage{constructor(){this.component=S.JL,this.logView=x.j.once((()=>this.performLogView()))}ngOnInit(){try{this.cmId=l.CoreNavigator.getRequiredRouteNumberParam("cmId"),this.courseId=l.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.userId=l.CoreNavigator.getRouteNumberParam("userId")||R.CoreSites.getCurrentSiteUserId(),this.retakeNumber=l.CoreNavigator.getRouteNumberParam("retake")}catch(e){return y.CoreDomUtils.showErrorModal(e),l.CoreNavigator.back(),void 0}this.fetchData().finally((()=>{this.loaded=!0}))}changeRetake(e){var n=this;return(0,h.A)((function*(){n.loaded=!1;try{yield n.setRetake(e),n.performLogView()}catch(e){var o;n.selectedRetake=null!==(o=n.previousSelectedRetake)&&void 0!==o?o:n.selectedRetake,y.CoreDomUtils.showErrorModal(te.CoreErrorHelper.addDataNotDownloadedError(e,"Error getting attempt."))}finally{n.loaded=!0}}))()}doRefresh(e){this.refreshData().finally((()=>{null==e||e.complete()}))}fetchData(){var e=this;return(0,h.A)((function*(){try{var n;e.lesson=yield w.N.getLesson(e.courseId,e.cmId);const o=yield w.N.getRetakesOverview(e.lesson.id,{cmId:e.cmId}),t=null==o||null===(n=o.students)||void 0===n?void 0:n.find((n=>n.id==e.userId));if(!t)throw new I.CoreError(T.HT.instant("addon.mod_lesson.cannotfinduser"));if(!t.attempts.length)throw new I.CoreError(T.HT.instant("addon.mod_lesson.cannotfindattempt"));t.bestgrade=A.Ni.roundToDecimals(t.bestgrade,2),t.attempts.forEach((n=>{e.selectedRetake||e.retakeNumber!=n.try||(e.selectedRetake=e.retakeNumber),n.label=E.getRetakeLabel(n)})),e.selectedRetake||(e.selectedRetake=t.attempts[t.attempts.length-1].try);const a=yield X.g.ignoreErrors(oe.CoreUser.getProfile(t.id,e.courseId,!0));e.student=t,e.student.profileimageurl=null==a?void 0:a.profileimageurl,yield e.setRetake(e.selectedRetake),e.logView()}catch(e){y.CoreDomUtils.showErrorModalDefault(e,"Error getting data.",!0)}}))()}refreshData(){var e=this;return(0,h.A)((function*(){const n=[];n.push(w.N.invalidateLessonData(e.courseId)),e.lesson&&(n.push(w.N.invalidateRetakesOverview(e.lesson.id)),n.push(w.N.invalidateUserRetakesForUser(e.lesson.id,e.userId))),yield X.g.ignoreErrors(Promise.all(n)),yield e.fetchData()}))()}setRetake(e){var n=this;return(0,h.A)((function*(){n.selectedRetake=e;const o=yield w.N.getUserRetake(n.lesson.id,e,{cmId:n.cmId,userId:n.userId});n.retake=n.formatRetake(o),n.previousSelectedRetake=n.selectedRetake}))()}formatRetake(e){const n=e;return n.userstats.gradeinfo&&(n.userstats.grade=A.Ni.roundToDecimals(n.userstats.grade,2),this.timeTakenReadable=x.j.formatTime(n.userstats.timetotake)),n.answerpages.forEach((e=>{if(w.N.answerPageIsContent(e)){var n;const o=e;o.isContent=!0,null!==(n=o.answerdata)&&void 0!==n&&n.answers&&o.answerdata.answers.forEach((e=>{e[0]=E.getContentPageAnswerDataFromHtml(e[0])}))}else if(w.N.answerPageIsQuestion(e)){var o;const n=e;n.isQuestion=!0,null!==(o=n.answerdata)&&void 0!==o&&o.answers&&n.answerdata.answers.forEach((e=>{e[0]=E.getQuestionPageAnswerDataFromHtml(e[0])}))}})),n}performLogView(){this.lesson&&U.OF.logEvent({type:U.qr.VIEW_ITEM,ws:"mod_lesson_get_user_attempt",name:this.lesson.name+": "+T.HT.instant("addon.mod_lesson.detailedstats"),data:{id:this.lesson.id,userid:this.userId,try:this.selectedRetake,category:"lesson"},url:`/mod/lesson/report.php?id=${this.cmId}&action=reportdetail&userid=${this.userId}&try=${this.selectedRetake}`})}}return(e=AddonModLessonUserRetakePage).ɵfac=function AddonModLessonUserRetakePage_Factory(n){return new(n||e)},e.ɵcmp=r.VBU({type:e,selectors:[["page-addon-mod-lesson-user-retake"]],decls:15,vars:12,consts:[["slot","start"],[3,"text"],[1,"limited-width"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["core-user-link","",1,"ion-text-wrap",3,"userId","courseId"],["slot","start",3,"user","userId","courseId","linkProfile"],["a11yText","addon.mod_lesson.grade",3,"progress"],["class","ion-text-wrap",4,"ngIf"],["class","addon-mod_lesson-userstats",4,"ngIf"],[1,"ion-text-wrap"],["interface","action-sheet",3,"ngModelChange","ionChange","ngModel","cancelText","interfaceOptions"],["slot","label",1,"item-heading"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"addon-mod_lesson-userstats"],[1,"ion-no-padding"],[1,"item-heading"],["class","addon-mod_lesson-answerpage",3,"ngClass",4,"ngFor","ngForOf"],[1,"addon-mod_lesson-answerpage",3,"ngClass"],["collapsible-item","","contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["class","addon-mod_lesson-answer",4,"ngIf"],[1,"addon-mod_lesson-answer"],[4,"ngFor","ngForOf"],["expand","block","fill","outline",1,"ion-text-wrap",3,"disabled"],[3,"innerHTML"],["class","ion-text-wrap",3,"ngClass",4,"ngIf"],[1,"ion-text-wrap",3,"ngClass"],[3,"ngModel","disabled"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["color","dark","class","addon-mod_lesson-answer-stats",4,"ngIf"],["color","success","class","addon-mod_lesson-answer-success",4,"ngIf"],["color","dark",1,"addon-mod_lesson-answer-stats"],["color","success",1,"addon-mod_lesson-answer-success"],["color","dark",4,"ngIf"],["color","dark"]],template:function AddonModLessonUserRetakePage_Template(e,n){1&e&&(r.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),r.nrm(3,"ion-back-button",1),r.nI1(4,"translate"),r.k0s(),r.j41(5,"ion-title")(6,"h1"),r.EFF(7),r.nI1(8,"translate"),r.k0s()()()(),r.j41(9,"ion-content",2)(10,"ion-refresher",3),r.bIt("ionRefresh",(function AddonModLessonUserRetakePage_Template_ion_refresher_ionRefresh_10_listener(e){return n.doRefresh(e.target)})),r.nrm(11,"ion-refresher-content",4),r.nI1(12,"translate"),r.k0s(),r.j41(13,"core-loading",5),r.DNE(14,AddonModLessonUserRetakePage_div_14_Template,11,13,"div",6),r.k0s()()),2&e&&(r.R7$(3),r.Y8G("text",r.bMT(4,6,"core.back")),r.R7$(4),r.JRh(r.bMT(8,8,"addon.mod_lesson.detailedstats")),r.R7$(3),r.Y8G("disabled",!n.loaded),r.R7$(),r.FS9("pullingText",r.bMT(12,10,"core.pulltorefresh")),r.R7$(2),r.Y8G("hideUntil",n.loaded),r.R7$(),r.Y8G("ngIf",n.student))},dependencies:[B.YU,B.Sq,B.bT,J.R,V.z,ae.T,c.B,ie.O,se.K,u.i,W.T,F.BC,F.vS,g.In,g.Jm,g.QW,g.b_,g.ME,g.tN,g.eY,g.hU,g.W9,g.lO,g.eU,g.uz,g.he,g.nf,g.To,g.Ki,g.ln,g.Nm,g.Ip,g.BC,g.ai,g.hB,g.Je,g.el,re.f,p.D9],styles:["[_nghost-%COMP%]   .button-disabled[_ngcontent-%COMP%]{opacity:.4}[_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]{--background: var(--primary-tint)}[_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--primary-shade)}[_nghost-%COMP%]   .item-interactive-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{opacity:.5}[_nghost-%COMP%]   .addon-mod_lesson-answer-stats[_ngcontent-%COMP%]{margin-inline-end:4px}"]}),AddonModLessonUserRetakePage})();const _e=[{path:":courseId/:cmId",component:f},{path:":courseId/:cmId/player",component:ee,canDeactivate:[ne.V]},{path:":courseId/:cmId/user-retake/:userId",component:de}];let le=(()=>{var e;class AddonModLessonLazyModule{}return(e=AddonModLessonLazyModule).ɵfac=function AddonModLessonLazyModule_Factory(n){return new(n||e)},e.ɵmod=r.$C({type:e}),e.ɵinj=r.G2t({imports:[t.iI.forChild(_e),a.n,v.d,d]}),AddonModLessonLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&r.Obh(le,{declarations:[f,ee,de],imports:[t.iI,a.n,v.d,d]}))}}]);