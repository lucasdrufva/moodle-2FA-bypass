"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5301],{95301:(e,o,t)=>{t.r(o),t.d(o,{default:()=>j});var n=t(21182),a=t(3353),r=t(10467),i=t(74431),s=t(47423),d=t(86123),l=t(44682),c=t(94247),_=t(66110),g=t(87455),u=t(70526),p=t(23780),m=t(15324),C=t(52749),S=t(89911),f=t(79555),h=t(24502),M=t(49882),b=t(54438),D=t(60177),I=t(64422),w=t(86198),P=t(58197),T=t(88246),A=t(43570),v=t(73465),y=t(78913),R=t(73955);const _c0=e=>({name:e});function AddonStorageManagerCoursesStoragePage_div_11_Template(e,o){1&e&&(b.j41(0,"div",6)(1,"h2"),b.EFF(2),b.nI1(3,"translate"),b.k0s()()),2&e&&(b.R7$(2),b.JRh(b.bMT(3,1,"addon.storagemanager.alldata")))}function AddonStorageManagerCoursesStoragePage_ion_card_12_ion_badge_6_Template(e,o){if(1&e&&(b.j41(0,"ion-badge",9),b.EFF(1),b.nI1(2,"coreBytesToSize"),b.k0s()),2&e){const e=b.XpG(2);b.R7$(),b.JRh(b.bMT(2,1,e.spaceUsage.spaceUsage))}}function AddonStorageManagerCoursesStoragePage_ion_card_12_Template(e,o){if(1&e){const e=b.RV6();b.j41(0,"ion-card")(1,"ion-item",13)(2,"ion-label")(3,"p",14),b.EFF(4),b.nI1(5,"translate"),b.k0s(),b.DNE(6,AddonStorageManagerCoursesStoragePage_ion_card_12_ion_badge_6_Template,3,3,"ion-badge",15),b.k0s(),b.j41(7,"ion-button",16),b.nI1(8,"translate"),b.bIt("click",(function AddonStorageManagerCoursesStoragePage_ion_card_12_Template_ion_button_click_7_listener(o){b.eBV(e);const t=b.XpG();return b.Njj(t.deleteSiteStorage(o))})),b.nrm(9,"ion-icon",11),b.k0s()()()}if(2&e){const e=b.XpG();b.R7$(4),b.JRh(b.bMT(5,4,"addon.storagemanager.totalspaceusage")),b.R7$(2),b.Y8G("ngIf",e.spaceUsage.spaceUsage),b.R7$(),b.Y8G("hidden",e.spaceUsage.spaceUsage+e.spaceUsage.cacheEntries<=0),b.BMQ("aria-label",b.bMT(8,6,"addon.storagemanager.deleteallsitedata"))}}function AddonStorageManagerCoursesStoragePage_ion_item_29_p_4_Template(e,o){1&e&&(b.j41(0,"p",22),b.EFF(1),b.nI1(2,"translate"),b.k0s()),2&e&&(b.R7$(),b.SpI(" ",b.bMT(2,1,"core.downloading")," "))}function AddonStorageManagerCoursesStoragePage_ion_item_29_Template(e,o){if(1&e){const e=b.RV6();b.j41(0,"ion-item",17),b.bIt("click",(function AddonStorageManagerCoursesStoragePage_ion_item_29_Template_ion_item_click_0_listener(){const o=b.eBV(e).$implicit,t=b.XpG();return b.Njj(t.openCourse(o.id,o.title))})),b.j41(1,"ion-label",18)(2,"p",8),b.nrm(3,"core-format-text",19),b.k0s(),b.DNE(4,AddonStorageManagerCoursesStoragePage_ion_item_29_p_4_Template,3,3,"p",20),b.j41(5,"ion-badge",9),b.EFF(6),b.nI1(7,"coreBytesToSize"),b.k0s()(),b.j41(8,"ion-button",21),b.nI1(9,"translate"),b.bIt("click",(function AddonStorageManagerCoursesStoragePage_ion_item_29_Template_ion_button_click_8_listener(o){const t=b.eBV(e).$implicit,n=b.XpG();return b.Njj(n.deleteCourse(o,t))})),b.nrm(10,"ion-icon",11),b.k0s()()}if(2&e){const e=o.$implicit;b.Y8G("detail",!0),b.R7$(3),b.Y8G("text",e.title)("contextInstanceId",e.id)("adaptImg",!1),b.R7$(),b.Y8G("ngIf",e.isDownloading),b.R7$(2),b.SpI(" ",b.bMT(7,8,e.totalSize)," "),b.R7$(2),b.Y8G("disabled",e.isDownloading)("ariaLabel",b.i5U(9,10,"addon.storagemanager.deletedatafrom",b.eq3(13,_c0,e.title)))}}let k=(()=>{var e;class AddonStorageManagerCoursesStoragePage{constructor(){this.userCourses=[],this.downloadedCourses=[],this.completelyDownloadedCourses=[],this.totalSize=0,this.loaded=!1,this.spaceUsage={cacheEntries:0,spaceUsage:0},this.downloadedCoursesQueue=new s.r,this.siteId=C.CoreSites.getCurrentSiteId()}ngOnInit(){var e=this;return(0,r.A)((function*(){e.userCourses=yield _.CoreCourses.getUserCourses(),e.courseStatusObserver=M.z.on(M.z.COURSE_STATUS_CHANGED,(({courseId:o,status:t})=>e.onCourseUpdated(o,t)));const o=yield l.CoreCourse.getDownloadedCourseIds(),t=yield Promise.all(e.userCourses.filter((e=>-1!==o.indexOf(e.id))).map((o=>e.getDownloadedCourse(o))));if(yield u.CoreSiteHome.isAvailable(e.siteId)){const o=C.CoreSites.getCurrentSiteHomeId(),n=yield e.calculateDownloadedCourseSize(o);if(n>0){const e=yield l.CoreCourse.getCourseStatus(o);t.push({id:o,title:f.HT.instant("core.sitehome.sitehome"),totalSize:n,isDownloading:e===i.DownloadStatus.DOWNLOADING})}}yield e.downloadedCoursesQueue.run((()=>e.setDownloadedCourses(t))),e.loaded=!0}))()}ngOnDestroy(){var e;null===(e=this.courseStatusObserver)||void 0===e||e.off()}deleteCompletelyDownloadedCourses(e){var o=this;return(0,r.A)((function*(){e.preventDefault(),e.stopPropagation();try{yield S.CoreDomUtils.showDeleteConfirm("addon.storagemanager.confirmdeletecourses")}catch(e){if(!S.CoreDomUtils.isCanceledError(e))throw e;return}const t=yield p.CoreLoadings.show("core.deleting",!0),n=o.completelyDownloadedCourses.map((e=>e.id));try{yield Promise.all(n.map((e=>c.CoreCourseHelper.deleteCourseFiles(e)))),yield o.downloadedCoursesQueue.run((0,r.A)((function*(){yield o.setDownloadedCourses(o.downloadedCourses.filter((e=>!n.includes(e.id))))})))}catch(e){S.CoreDomUtils.showErrorModalDefault(e,f.HT.instant("core.errordeletefile"))}finally{t.dismiss()}}))()}deleteCourse(e,o){var t=this;return(0,r.A)((function*(){e.preventDefault(),e.stopPropagation();try{yield S.CoreDomUtils.showDeleteConfirm("addon.storagemanager.confirmdeletedatafrom",{name:o.title})}catch(e){if(!S.CoreDomUtils.isCanceledError(e))throw e;return}const n=yield p.CoreLoadings.show("core.deleting",!0);try{yield c.CoreCourseHelper.deleteCourseFiles(o.id),yield t.downloadedCoursesQueue.run((0,r.A)((function*(){yield t.setDownloadedCourses(h.R.withoutItem(t.downloadedCourses,o))})))}catch(e){S.CoreDomUtils.showErrorModalDefault(e,f.HT.instant("core.errordeletefile"))}finally{n.dismiss()}}))()}onCourseUpdated(e,o){var t=this;return(0,r.A)((function*(){if(e==d.CORE_COURSE_ALL_COURSES_CLEARED)return yield t.downloadedCoursesQueue.run((()=>t.setDownloadedCourses([]))),void 0;const n=t.downloadedCourses.find((o=>o.id===e));n&&(n.isDownloading=o===i.DownloadStatus.DOWNLOADING,n.totalSize=yield t.calculateDownloadedCourseSize(n.id),yield t.downloadedCoursesQueue.run((()=>t.setDownloadedCourses(t.downloadedCourses))))}))()}setDownloadedCourses(e){var o=this;return(0,r.A)((function*(){o.spaceUsage=yield g.CoreSettingsHelper.getSiteSpaceUsage(o.siteId),o.downloadedCourses=e.sort(((e,o)=>o.totalSize-e.totalSize)),o.completelyDownloadedCourses=e.filter((e=>!e.isDownloading)),o.totalSize=o.downloadedCourses.reduce(((e,o)=>e+o.totalSize),0)}))()}getDownloadedCourse(e){var o=this;return(0,r.A)((function*(){const t=yield o.calculateDownloadedCourseSize(e.id),n=yield l.CoreCourse.getCourseStatus(e.id);return{id:e.id,title:e.displayname||e.fullname,totalSize:t,isDownloading:n===i.DownloadStatus.DOWNLOADING}}))()}calculateDownloadedCourseSize(e){return(0,r.A)((function*(){const o=yield l.CoreCourse.getSections(e),t=l.CoreCourse.getSectionsModules(o);return c.CoreCourseHelper.getModulesDownloadedSize(t,e)}))()}openCourse(e,o){m.CoreNavigator.navigateToSitePath("/storage/"+e,{params:{title:o}})}deleteSiteStorage(e){var o=this;return(0,r.A)((function*(){e.preventDefault(),e.stopPropagation();try{const e=C.CoreSites.getRequiredCurrentSite(),t=yield e.getSiteName();o.spaceUsage=yield g.CoreSettingsHelper.deleteSiteStorage(t,o.siteId)}catch{}}))()}}return(e=AddonStorageManagerCoursesStoragePage).ɵfac=function AddonStorageManagerCoursesStoragePage_Factory(o){return new(o||e)},e.ɵcmp=b.VBU({type:e,selectors:[["page-addon-storagemanager-courses-storage"]],decls:30,vars:23,consts:[["slot","start"],[3,"text"],[1,"limited-width"],[3,"hideUntil"],["class","ion-padding-horizontal ion-text-wrap",4,"ngIf"],[4,"ngIf"],[1,"ion-padding-horizontal","ion-text-wrap"],["lines","full",1,"size","courses","ion-text-wrap"],[1,"item-heading"],["color","light"],["slot","end","color","danger","fill","clear",3,"click","disabled"],["name","fas-trash","slot","icon-only","aria-hidden","true"],["class","course","button","",3,"detail","click",4,"ngFor","ngForOf"],[1,"ion-text-wrap","total"],[1,"item-heading","ion-text-wrap"],["color","light",4,"ngIf"],["fill","clear","color","danger","slot","end",3,"click","hidden"],["button","",1,"course",3,"click","detail"],[1,"ion-text-wrap"],["contextLevel","course",3,"text","contextInstanceId","adaptImg"],["class","item-heading item-heading-secondary",4,"ngIf"],["slot","end","color","danger","fill","clear",3,"click","disabled","ariaLabel"],[1,"item-heading","item-heading-secondary"]],template:function AddonStorageManagerCoursesStoragePage_Template(e,o){1&e&&(b.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),b.nrm(3,"ion-back-button",1),b.nI1(4,"translate"),b.k0s(),b.j41(5,"ion-title")(6,"h1"),b.EFF(7),b.nI1(8,"translate"),b.k0s()()()(),b.j41(9,"ion-content",2)(10,"core-loading",3),b.DNE(11,AddonStorageManagerCoursesStoragePage_div_11_Template,4,3,"div",4)(12,AddonStorageManagerCoursesStoragePage_ion_card_12_Template,10,8,"ion-card",5),b.j41(13,"div",6)(14,"h2"),b.EFF(15),b.nI1(16,"translate"),b.k0s()(),b.j41(17,"ion-card")(18,"ion-item",7)(19,"ion-label")(20,"p",8),b.EFF(21),b.nI1(22,"translate"),b.k0s(),b.j41(23,"ion-badge",9),b.EFF(24),b.nI1(25,"coreBytesToSize"),b.k0s()(),b.j41(26,"ion-button",10),b.nI1(27,"translate"),b.bIt("click",(function AddonStorageManagerCoursesStoragePage_Template_ion_button_click_26_listener(e){return o.deleteCompletelyDownloadedCourses(e)})),b.nrm(28,"ion-icon",11),b.k0s()(),b.DNE(29,AddonStorageManagerCoursesStoragePage_ion_item_29_Template,11,15,"ion-item",12),b.k0s()()()),2&e&&(b.R7$(3),b.Y8G("text",b.bMT(4,11,"core.back")),b.R7$(4),b.JRh(b.bMT(8,13,"addon.storagemanager.managedownloads")),b.R7$(3),b.Y8G("hideUntil",o.loaded),b.R7$(),b.Y8G("ngIf",o.spaceUsage),b.R7$(),b.Y8G("ngIf",o.spaceUsage),b.R7$(3),b.JRh(b.bMT(16,15,"addon.storagemanager.downloadedcourses")),b.R7$(6),b.JRh(b.bMT(22,17,"addon.storagemanager.totalspaceusage")),b.R7$(3),b.JRh(b.bMT(25,19,o.totalSize)),b.R7$(2),b.Y8G("disabled",0===o.completelyDownloadedCourses.length),b.BMQ("aria-label",b.bMT(27,21,"addon.storagemanager.deletecourses")),b.R7$(3),b.Y8G("ngForOf",o.downloadedCourses))},dependencies:[D.Sq,D.bT,I.R,w.t,P.B,T.i,A.T,v.In,v.Jm,v.QW,v.b_,v.W9,v.eU,v.iq,v.uz,v.he,v.BC,v.ai,v.el,y.b,R.D9],styles:["ion-item.courses[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%], ion-item.total[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{font-weight:700}"]}),AddonStorageManagerCoursesStoragePage})();var G=t(8979),E=t(82907),z=t(15060),O=t(32572),$=t(49234);const course_storage_c0=e=>({name:e}),_c1=e=>({section:e}),_c2=()=>({notdownloaded:"addon.storagemanager.downloaddatafrom"});function AddonStorageManagerCourseStoragePage_ion_item_11_Template(e,o){1&e&&(b.j41(0,"ion-item",17)(1,"ion-label")(2,"p"),b.EFF(3),b.nI1(4,"translate"),b.k0s()()()),2&e&&(b.R7$(3),b.JRh(b.bMT(4,1,"addon.storagemanager.courseinfo")))}function AddonStorageManagerCourseStoragePage_ng_container_22_Template(e,o){if(1&e&&(b.qex(0),b.EFF(1),b.nI1(2,"coreBytesToSize"),b.bVm()),2&e){const e=b.XpG();b.R7$(),b.JRh(b.bMT(2,1,e.totalSize))}}function AddonStorageManagerCourseStoragePage_ng_container_23_Template(e,o){1&e&&(b.qex(0),b.EFF(1),b.nI1(2,"translate"),b.bVm()),2&e&&(b.R7$(),b.JRh(b.bMT(2,1,"core.calculating")))}function AddonStorageManagerCourseStoragePage_ion_button_24_ion_icon_1_Template(e,o){if(1&e&&b.nrm(0,"ion-icon",21),2&e){const e=b.XpG(2);b.Y8G("name",e.prefetchCourseData.icon)}}function AddonStorageManagerCourseStoragePage_ion_button_24_ion_spinner_2_Template(e,o){1&e&&b.nrm(0,"ion-spinner",1)}function AddonStorageManagerCourseStoragePage_ion_button_24_Template(e,o){if(1&e){const e=b.RV6();b.j41(0,"ion-button",18),b.bIt("click",(function AddonStorageManagerCourseStoragePage_ion_button_24_Template_ion_button_click_0_listener(o){b.eBV(e);const t=b.XpG();return b.Njj(t.prefetchCourse(o))})),b.DNE(1,AddonStorageManagerCourseStoragePage_ion_button_24_ion_icon_1_Template,1,1,"ion-icon",19)(2,AddonStorageManagerCourseStoragePage_ion_button_24_ion_spinner_2_Template,1,0,"ion-spinner",20),b.EFF(3),b.nI1(4,"translate"),b.k0s()}if(2&e){const e=b.XpG();b.Y8G("disabled",e.prefetchCourseData.loading),b.R7$(),b.Y8G("ngIf",!e.prefetchCourseData.loading),b.R7$(),b.Y8G("ngIf",e.prefetchCourseData.loading),b.R7$(),b.SpI(" ",b.bMT(4,4,e.prefetchCourseData.statusTranslatable)," ")}}function AddonStorageManagerCourseStoragePage_ng_container_31_ng_container_1_Template(e,o){1&e&&b.eu8(0)}function AddonStorageManagerCourseStoragePage_ng_container_31_Template(e,o){if(1&e&&(b.qex(0),b.DNE(1,AddonStorageManagerCourseStoragePage_ng_container_31_ng_container_1_Template,1,0,"ng-container",22),b.bVm()),2&e){const e=o.$implicit;b.XpG();const t=b.sdS(33);b.R7$(),b.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",b.eq3(2,_c1,e))}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ion_badge_6_ion_icon_1_Template(e,o){1&e&&(b.nrm(0,"ion-icon",33),b.nI1(1,"translate")),2&e&&b.BMQ("aria-label",b.bMT(1,1,"core.downloaded"))}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ion_badge_6_Template(e,o){if(1&e&&(b.j41(0,"ion-badge",31),b.DNE(1,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ion_badge_6_ion_icon_1_Template,2,3,"ion-icon",32),b.EFF(2),b.nI1(3,"coreBytesToSize"),b.k0s()),2&e){const e=b.XpG(2).section,o=b.XpG();b.Y8G("color",e.downloadStatus===o.statusDownloaded?"success":"light"),b.R7$(),b.Y8G("ngIf",e.downloadStatus===o.statusDownloaded),b.R7$(),b.SpI("",b.bMT(3,3,e.totalSize)," ")}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ion_badge_7_Template(e,o){1&e&&(b.j41(0,"ion-badge",34),b.EFF(1),b.nI1(2,"translate"),b.k0s()),2&e&&(b.R7$(),b.SpI(" ",b.bMT(2,1,"core.calculating")," "))}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_p_8_Template(e,o){if(1&e&&(b.j41(0,"p"),b.nrm(1,"core-progress-bar",35),b.k0s()),2&e){const e=b.XpG(2).section;b.R7$(),b.Y8G("progress",void 0===e.total||0===e.total?-1:e.count/e.total*100)}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_div_9_div_1_core_download_refresh_1_Template(e,o){if(1&e){const e=b.RV6();b.j41(0,"core-download-refresh",42),b.bIt("action",(function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_div_9_div_1_core_download_refresh_1_Template_core_download_refresh_action_0_listener(){b.eBV(e);const o=b.XpG(4).section,t=b.XpG();return b.Njj(t.prefetchSection(o))})),b.k0s()}if(2&e){const e=b.XpG(4).section;b.Y8G("status",e.downloadStatus)("enabled",!0)("loading",e.isDownloading||e.isCalculating)("canTrustDownload",!0)("statusesTranslatable",b.lJ4(6,_c2))("statusSubject",e.name)}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_div_9_div_1_ion_badge_2_Template(e,o){if(1&e&&(b.j41(0,"ion-badge",43),b.nI1(1,"translate"),b.EFF(2),b.k0s()),2&e){const e=b.XpG(4).section;b.BMQ("aria-valuemax",e.total)("aria-valuenow",e.count)("aria-valuetext",b.i5U(1,5,"core.course.downloadsectionprogressdescription",e)),b.R7$(2),b.Lme(" ",e.count," / ",e.total," ")}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_div_9_div_1_Template(e,o){if(1&e&&(b.j41(0,"div",39),b.DNE(1,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_div_9_div_1_core_download_refresh_1_Template,1,7,"core-download-refresh",40)(2,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_div_9_div_1_ion_badge_2_Template,3,8,"ion-badge",41),b.k0s()),2&e){const e=b.XpG(3).section,o=b.XpG();b.R7$(),b.Y8G("ngIf",!e.isDownloading&&e.downloadStatus!==o.statusDownloaded),b.R7$(),b.Y8G("ngIf",e.isDownloading&&void 0!==e.total&&e.count<e.total)}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_div_9_ion_button_2_Template(e,o){if(1&e){const e=b.RV6();b.j41(0,"ion-button",44),b.bIt("click",(function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_div_9_ion_button_2_Template_ion_button_click_0_listener(o){b.eBV(e);const t=b.XpG(3).section,n=b.XpG();return b.Njj(n.deleteForSection(o,t))})),b.nrm(1,"ion-icon",45),b.nI1(2,"translate"),b.k0s()}if(2&e){const e=b.XpG(3).section;b.R7$(),b.BMQ("aria-label",b.i5U(2,1,"addon.storagemanager.deletedatafrom",b.eq3(4,course_storage_c0,e.name)))}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_div_9_Template(e,o){if(1&e&&(b.j41(0,"div",36),b.DNE(1,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_div_9_div_1_Template,3,2,"div",37)(2,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_div_9_ion_button_2_Template,3,6,"ion-button",38),b.k0s()),2&e){const e=b.XpG(2).section,o=b.XpG();b.R7$(),b.Y8G("ngIf",o.downloadEnabled),b.R7$(),b.Y8G("ngIf",!e.calculatingSize&&e.totalSize>0)}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_1_ng_container_0_Template(e,o){1&e&&b.eu8(0)}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_1_Template(e,o){if(1&e&&b.DNE(0,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_1_ng_container_0_Template,1,0,"ng-container",22),2&e){const e=b.XpG().$implicit;b.XpG(4);const o=b.sdS(33);b.Y8G("ngTemplateOutlet",o)("ngTemplateOutletContext",b.eq3(2,_c1,e))}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_core_mod_icon_1_Template(e,o){if(1&e&&b.nrm(0,"core-mod-icon",53),2&e){const e=b.XpG(3).$implicit;b.Y8G("modicon",e.handlerData.icon)("modname",e.modname)("componentId",e.instance)("fallbackTranslation",e.modplural)("isBranded",e.branded)}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_ion_badge_5_ion_icon_1_Template(e,o){1&e&&(b.nrm(0,"ion-icon",33),b.nI1(1,"translate")),2&e&&b.BMQ("aria-label",b.bMT(1,1,"core.downloaded"))}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_ion_badge_5_Template(e,o){if(1&e&&(b.j41(0,"ion-badge",31),b.DNE(1,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_ion_badge_5_ion_icon_1_Template,2,3,"ion-icon",32),b.EFF(2),b.nI1(3,"coreBytesToSize"),b.k0s()),2&e){const e=b.XpG(3).$implicit,o=b.XpG(4);b.Y8G("color",e.downloadStatus===o.statusDownloaded?"success":"light"),b.R7$(),b.Y8G("ngIf",e.downloadStatus===o.statusDownloaded),b.R7$(),b.SpI("",b.bMT(3,3,e.totalSize)," ")}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_ion_badge_6_Template(e,o){1&e&&(b.j41(0,"ion-badge",34),b.EFF(1),b.nI1(2,"translate"),b.k0s()),2&e&&(b.R7$(),b.SpI(" ",b.bMT(2,1,"core.calculating")," "))}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_core_download_refresh_8_Template(e,o){if(1&e){const e=b.RV6();b.j41(0,"core-download-refresh",54),b.bIt("action",(function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_core_download_refresh_8_Template_core_download_refresh_action_0_listener(){b.eBV(e);const o=b.XpG(3).$implicit,t=b.XpG(4);return b.Njj(t.prefetchModule(o))})),b.k0s()}if(2&e){const e=b.XpG(3).$implicit;b.Y8G("status",e.downloadStatus)("enabled",!0)("canTrustDownload",!0)("loading",e.spinner||e.handlerData.spinner)("statusesTranslatable",b.lJ4(6,_c2))("statusSubject",e.name)}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_ion_button_9_Template(e,o){if(1&e){const e=b.RV6();b.j41(0,"ion-button",55),b.bIt("click",(function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_ion_button_9_Template_ion_button_click_0_listener(o){b.eBV(e);const t=b.XpG(3).$implicit,n=b.XpG(4);return b.Njj(n.deleteForModule(o,t))})),b.nrm(1,"ion-icon",45),b.nI1(2,"translate"),b.k0s()}if(2&e){const e=b.XpG(3).$implicit;b.R7$(),b.BMQ("aria-label",b.i5U(2,1,"addon.storagemanager.deletedatafrom",b.eq3(4,course_storage_c0,e.name)))}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_p_10_Template(e,o){1&e&&(b.j41(0,"p",56),b.EFF(1),b.nI1(2,"translate"),b.k0s()),2&e&&(b.R7$(),b.SpI(" ",b.bMT(2,1,"core.notdownloadable")," "))}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_Template(e,o){if(1&e&&(b.j41(0,"ion-item",47),b.DNE(1,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_core_mod_icon_1_Template,1,5,"core-mod-icon",48),b.j41(2,"ion-label",17)(3,"p"),b.nrm(4,"core-format-text",49),b.k0s(),b.DNE(5,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_ion_badge_5_Template,4,5,"ion-badge",27)(6,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_ion_badge_6_Template,3,3,"ion-badge",28),b.k0s(),b.j41(7,"div",36),b.DNE(8,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_core_download_refresh_8_Template,1,7,"core-download-refresh",50)(9,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_ion_button_9_Template,3,6,"ion-button",51)(10,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_p_10_Template,3,3,"p",52),b.k0s()()),2&e){const e=b.XpG(2).$implicit,o=b.XpG(3).section,t=b.XpG();b.R7$(),b.Y8G("ngIf",e.handlerData.icon),b.R7$(2),b.ZvI("item-heading ",e.handlerData.class," addon-storagemanager-module-size"),b.R7$(),b.Y8G("text",e.handlerData.title)("courseId",e.course)("contextInstanceId",e.id)("adaptImg",!1),b.R7$(),b.Y8G("ngIf",!e.calculatingSize&&e.totalSize>0),b.R7$(),b.Y8G("ngIf",e.calculatingSize||o.isDownloading&&e.downloadStatus===t.statusDownloaded),b.R7$(2),b.Y8G("ngIf",t.downloadEnabled&&(null==e.handlerData?null:e.handlerData.showDownloadButton)&&e.downloadStatus!==t.statusDownloaded),b.R7$(),b.Y8G("ngIf",!e.calculatingSize&&e.totalSize>0),b.R7$(),b.Y8G("ngIf",!t.downloadEnabled||!(null!=e.handlerData&&e.handlerData.showDownloadButton))}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_Template(e,o){if(1&e&&b.DNE(0,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_ion_item_0_Template,11,13,"ion-item",46),2&e){const e=b.XpG().$implicit,o=b.XpG(4);b.Y8G("ngIf",o.downloadEnabled||!e.calculatingSize&&e.totalSize>0)}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Template(e,o){if(1&e&&(b.qex(0),b.DNE(1,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_1_Template,1,4,"ng-container")(2,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Conditional_2_Template,1,1),b.bVm()),2&e){const e=o.$implicit,t=b.XpG(4);b.R7$(),b.vxM(1,t.isModule(e)?2:1)}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_Template(e,o){if(1&e&&(b.qex(0),b.DNE(1,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_ng_container_1_Template,3,1,"ng-container",16),b.bVm()),2&e){const e=b.XpG(2).section;b.R7$(),b.Y8G("ngForOf",e.contents)}}function AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_Template(e,o){if(1&e&&(b.j41(0,"ion-card",24)(1,"ion-accordion",25)(2,"ion-item",26)(3,"ion-label")(4,"p",9),b.nrm(5,"core-format-text",7),b.k0s(),b.DNE(6,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ion_badge_6_Template,4,5,"ion-badge",27)(7,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ion_badge_7_Template,3,3,"ion-badge",28)(8,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_p_8_Template,2,1,"p",11),b.k0s(),b.DNE(9,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_div_9_Template,3,2,"div",29),b.k0s(),b.j41(10,"ion-card-content",30),b.DNE(11,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_ng_container_11_Template,2,1,"ng-container",11),b.k0s()()()),2&e){const e=b.XpG().section,o=b.XpG();b.Y8G("id","addons-course-storage-"+e.id),b.R7$(),b.Y8G("value",e.id),b.R7$(),b.Y8G("detail",!1),b.R7$(3),b.Y8G("text",e.name)("contextInstanceId",e.course)("adaptImg",!1),b.R7$(),b.Y8G("ngIf",!e.calculatingSize&&e.totalSize>0),b.R7$(),b.Y8G("ngIf",e.calculatingSize),b.R7$(),b.Y8G("ngIf",o.downloadEnabled&&e.isDownloading),b.R7$(),b.Y8G("ngIf",!e.calculatingSize&&e.totalSize>0||o.downloadEnabled),b.R7$(2),b.Y8G("ngIf",e.expanded)}}function AddonStorageManagerCourseStoragePage_ng_template_32_Template(e,o){if(1&e&&b.DNE(0,AddonStorageManagerCourseStoragePage_ng_template_32_ion_card_0_Template,12,11,"ion-card",23),2&e){b.Y8G("ngIf",o.section.contents.length>0)}}let F=(()=>{var e;class AddonStorageManagerCourseStoragePage{constructor(e,o){this.elementRef=e,this.changeDetectorRef=o,this.title="",this.loaded=!1,this.sections=[],this.totalSize=0,this.calculatingSize=!0,this.accordionMultipleValue=[],this.downloadEnabled=!1,this.downloadCourseEnabled=!1,this.prefetchCourseData={icon:i.CoreConstants.ICON_LOADING,statusTranslatable:"core.course.downloadcourse",status:i.DownloadStatus.DOWNLOADABLE_NOT_DOWNLOADED,loading:!0},this.statusDownloaded=i.DownloadStatus.DOWNLOADED,this.isModule=l.sectionContentIsModule,this.isDestroyed=!1,this.isGuest=!1,this.siteUpdatedObserver=M.z.on(M.z.SITE_UPDATED,(()=>{this.downloadCourseEnabled=!_.CoreCourses.isDownloadCourseDisabledInSite(),this.downloadEnabled=!C.CoreSites.getRequiredCurrentSite().isOfflineDisabled(),this.initCoursePrefetch(),this.initModulePrefetch(),this.changeDetectorRef.markForCheck()}),C.CoreSites.getCurrentSiteId())}ngOnInit(){var e=this;return(0,r.A)((function*(){var o;try{e.courseId=m.CoreNavigator.getRequiredRouteParam("courseId")}catch(e){return S.CoreDomUtils.showErrorModal(e),m.CoreNavigator.back(),void 0}e.title=m.CoreNavigator.getRouteParam("title")||"",e.title||e.courseId!=C.CoreSites.getCurrentSiteHomeId()||(e.title=f.HT.instant("core.sitehome.sitehome")),e.isGuest=null!==(o=m.CoreNavigator.getRouteBooleanParam("isGuest"))&&void 0!==o?o:(yield c.CoreCourseHelper.courseUsesGuestAccessInfo(e.courseId)).guestAccess;const t=m.CoreNavigator.getRouteNumberParam("sectionId");e.downloadCourseEnabled=!_.CoreCourses.isDownloadCourseDisabledInSite(),e.downloadEnabled=!C.CoreSites.getRequiredCurrentSite().isOfflineDisabled();const n=(yield l.CoreCourse.getSections(e.courseId,!1,!0)).filter((e=>!c.CoreCourseHelper.isSectionStealth(e)));e.sections=(yield c.CoreCourseHelper.addHandlerDataForModules(n,e.courseId)).sections.map((o=>e.formatSection(o))),e.loaded=!0,void 0!==t&&t>0?(e.accordionMultipleValue.push(t.toString()),e.accordionGroupChange(),E.y.scrollToElement(e.elementRef.nativeElement,`#addons-course-storage-${t}`,{addYAxis:-10})):(e.accordionMultipleValue.push(e.sections[0].id.toString()),e.accordionGroupChange()),yield Promise.all([e.initSizes(),e.initCoursePrefetch(),e.initModulePrefetch()]),e.changeDetectorRef.markForCheck()}))()}formatSection(e,o=!1){return{...e,totalSize:0,calculatingSize:!0,expanded:o,contents:e.contents.map((e=>(0,l.sectionContentIsModule)(e)?{...e,totalSize:0,calculatingSize:!1}:this.formatSection(e,o)))}}initCoursePrefetch(){var e=this;return(0,r.A)((function*(){if(!e.downloadCourseEnabled||e.courseStatusObserver)return;if(e.courseStatusObserver=M.z.on(M.z.COURSE_STATUS_CHANGED,(o=>{o.courseId!==e.courseId&&o.courseId!==d.CORE_COURSE_ALL_COURSES_CLEARED||e.updateCourseStatus(o.status)}),C.CoreSites.getCurrentSiteId()),yield e.determineCoursePrefetchIcon(),e.prefetchCourseData.icon!==i.CoreConstants.ICON_LOADING)return;const o=c.CoreCourseHelper.getCourseDownloadPromise(e.courseId);if(o)o.catch((o=>{e.isDestroyed||S.CoreDomUtils.showErrorModalDefault(o,"core.course.errordownloadingcourse",!0)}));else{const o=yield l.CoreCourse.setCoursePreviousStatus(e.courseId);e.updateCourseStatus(o)}}))()}initModulePrefetch(){var e=this;return(0,r.A)((function*(){e.downloadEnabled&&!e.sectionStatusObserver&&(e.sectionStatusObserver=M.z.on(M.z.SECTION_STATUS_CHANGED,function(){var o=(0,r.A)((function*(o){if(!e.downloadEnabled||!e.sections.length||!o.sectionId||o.courseId!=e.courseId)return;const{section:t}=c.CoreCourseHelper.findSection(e.sections,{id:o.sectionId});if(!t)return;const n=c.CoreCourseHelper.getSectionDownloadId({id:t.id});G.CoreCourseModulePrefetchDelegate.isBeingDownloaded(n)||(yield e.updateSizes([t]),t.isDownloading&&!G.CoreCourseModulePrefetchDelegate.isBeingDownloaded(n)&&e.prefetchSection(t))}));return function(e){return o.apply(this,arguments)}}(),C.CoreSites.getCurrentSiteId()),e.moduleStatusObserver=M.z.on(M.z.PACKAGE_STATUS_CHANGED,(o=>{const t=l.CoreCourse.getSectionsModules(e.sections).find((e=>{var t;return e.id===o.componentId&&e.prefetchHandler&&o.component===(null===(t=e.prefetchHandler)||void 0===t?void 0:t.component)}));if(!t)return;const n=G.CoreCourseModulePrefetchDelegate.determineModuleStatus(t,o.status);e.updateModuleStatus(t,n)}),C.CoreSites.getCurrentSiteId()),e.updateSizes(e.sections))}))()}initSizes(){var e=this;return(0,r.A)((function*(){yield e.updateSizes(e.sections)}))()}updateSizes(e){var o=this;return(0,r.A)((function*(){o.calculatingSize=!0,c.CoreCourseHelper.flattenSections(e).forEach((e=>{e.calculatingSize=!0})),o.changeDetectorRef.markForCheck();const t=l.CoreCourse.getSectionsModules(e);yield Promise.all(t.map(function(){var e=(0,r.A)((function*(e){yield o.calculateModuleSize(e)}));return function(o){return e.apply(this,arguments)}}()));const updateSectionSize=e=>{e.totalSize=0,e.calculatingSize=!0,o.changeDetectorRef.markForCheck(),e.contents.forEach((t=>{var n;(0,l.sectionContentIsModule)(t)||updateSectionSize(t),e.totalSize+=null!==(n=t.totalSize)&&void 0!==n?n:0,o.changeDetectorRef.markForCheck()})),e.calculatingSize=!1,o.changeDetectorRef.markForCheck()};o.totalSize=0,o.sections.forEach((e=>{updateSectionSize(e),o.totalSize+=e.totalSize})),o.calculatingSize=!1,0===o.totalSize&&o.markCourseAsNotDownloaded(),o.changeDetectorRef.markForCheck(),yield o.calculateSectionsStatus(e),o.changeDetectorRef.markForCheck()}))()}deleteForCourse(e){var o=this;return(0,r.A)((function*(){e.stopPropagation(),e.preventDefault();try{yield S.CoreDomUtils.showDeleteConfirm("addon.storagemanager.confirmdeletedatafrom",{name:o.title})}catch(e){if(!S.CoreDomUtils.isCanceledError(e))throw e;return}const t=l.CoreCourse.getSectionsModules(o.sections).filter((e=>e.totalSize&&e.totalSize>0));yield o.deleteModules(t)}))()}deleteForSection(e,o){var t=this;return(0,r.A)((function*(){e.stopPropagation(),e.preventDefault();try{yield S.CoreDomUtils.showDeleteConfirm("addon.storagemanager.confirmdeletedatafrom",{name:o.name})}catch(e){if(!S.CoreDomUtils.isCanceledError(e))throw e;return}const n=l.CoreCourse.getSectionsModules([o]).filter((e=>e.totalSize&&e.totalSize>0));yield t.deleteModules(n)}))()}deleteForModule(e,o){var t=this;return(0,r.A)((function*(){if(e.stopPropagation(),e.preventDefault(),0!==o.totalSize){try{yield S.CoreDomUtils.showDeleteConfirm("addon.storagemanager.confirmdeletedatafrom",{name:o.name})}catch(e){if(!S.CoreDomUtils.isCanceledError(e))throw e;return}yield t.deleteModules([o])}}))()}deleteModules(e){var o=this;return(0,r.A)((function*(){const t=yield p.CoreLoadings.show("core.deleting",!0),n=new Set,a=e.map(function(){var e=(0,r.A)((function*(e){var t;yield c.CoreCourseHelper.removeModuleStoredData(e,o.courseId),e.totalSize=0;const{section:a,parents:r}=c.CoreCourseHelper.findSection(o.sections,{id:e.section}),i=null!==(t=r[0])&&void 0!==t?t:a;i&&!n.has(i)&&n.add(i)}));return function(o){return e.apply(this,arguments)}}());try{yield Promise.all(a)}catch(e){S.CoreDomUtils.showErrorModalDefault(e,f.HT.instant("core.errordeletefile"))}finally{t.dismiss(),yield o.updateSizes(Array.from(n)),o.changeDetectorRef.markForCheck()}}))()}markCourseAsNotDownloaded(){l.CoreCourse.setCourseStatus(this.courseId,i.DownloadStatus.DOWNLOADABLE_NOT_DOWNLOADED)}prefetchSection(e){var o=this;return(0,r.A)((function*(){e.isCalculating=!0,o.changeDetectorRef.markForCheck();try{yield c.CoreCourseHelper.confirmDownloadSizeSection(o.courseId,[e]);try{yield c.CoreCourseHelper.prefetchSections([e],o.courseId)}catch(e){o.isDestroyed||S.CoreDomUtils.showErrorModalDefault(e,"core.course.errordownloadingsection",!0)}finally{yield o.updateSizes([e])}}catch(e){if(!o.isDestroyed&&e)return S.CoreDomUtils.showErrorModal(e),o.changeDetectorRef.markForCheck(),void 0}finally{e.isCalculating=!1,o.changeDetectorRef.markForCheck()}}))()}prefetchModule(e,o=!1){var t=this;return(0,r.A)((function*(){if(e.prefetchHandler){e.spinner=!0;try{const t=yield e.prefetchHandler.getDownloadSize(e,e.course,!0);yield c.CoreCourseHelper.prefetchModule(e.prefetchHandler,e,t,e.course,o)}catch(e){t.isDestroyed||S.CoreDomUtils.showErrorModalDefault(e,"core.errordownloading",!0)}finally{var n;e.spinner=!1;const{section:o,parents:a}=c.CoreCourseHelper.findSection(t.sections,{id:e.section}),r=null!==(n=a[0])&&void 0!==n?n:o;r&&(yield t.updateSizes([r]))}}}))()}updateModuleStatus(e,o){var t,n;o&&(e.spinner=!1,e.downloadStatus=o,null===(t=e.handlerData)||void 0===t||null===(n=t.updateStatus)||void 0===n||n.call(t,o),this.changeDetectorRef.markForCheck())}calculateModulesStatusOnSection(e){var o=this;return(0,r.A)((function*(){yield Promise.all(e.contents.map(function(){var e=(0,r.A)((function*(e){var t;if(!(0,l.sectionContentIsModule)(e))return yield o.calculateModulesStatusOnSection(e),void 0;if(null!==(t=e.handlerData)&&void 0!==t&&t.showDownloadButton){e.spinner=!0,e.prefetchHandler=G.CoreCourseModulePrefetchDelegate.getPrefetchHandlerFor(e.modname);const t=yield G.CoreCourseModulePrefetchDelegate.getModuleStatus(e,o.courseId);o.updateModuleStatus(e,t)}}));return function(o){return e.apply(this,arguments)}}()))}))()}determineCoursePrefetchIcon(){var e=this;return(0,r.A)((function*(){e.prefetchCourseData=yield c.CoreCourseHelper.getCourseStatusIconAndTitle(e.courseId)}))()}updateCourseStatus(e){const o=c.CoreCourseHelper.getCoursePrefetchStatusInfo(e);this.prefetchCourseData.status=o.status,this.prefetchCourseData.icon=o.icon,this.prefetchCourseData.statusTranslatable=o.statusTranslatable,this.prefetchCourseData.loading=o.loading,this.changeDetectorRef.markForCheck()}prefetchCourse(e){var o=this;return(0,r.A)((function*(){e.stopPropagation(),e.preventDefault();const t=yield c.CoreCourseHelper.getCourseInfo(o.courseId);if(!t)return S.CoreDomUtils.showErrorModal("core.course.errordownloadingcourse",!0),void 0;try{o.changeDetectorRef.markForCheck(),yield c.CoreCourseHelper.confirmAndPrefetchCourse(o.prefetchCourseData,t,{sections:o.sections,isGuest:o.isGuest}),yield o.updateSizes(o.sections)}catch(e){if(o.isDestroyed)return;S.CoreDomUtils.showErrorModalDefault(e,"core.course.errordownloadingcourse",!0)}}))()}calculateModuleSize(e){var o=this;return(0,r.A)((function*(){e.calculatingSize||(e.calculatingSize=!0,o.changeDetectorRef.markForCheck(),e.totalSize=yield G.CoreCourseModulePrefetchDelegate.getModuleStoredSize(e,o.courseId),e.calculatingSize=!1,o.changeDetectorRef.markForCheck())}))()}accordionGroupChange(e){var o;const t=null!==(o=null==e?void 0:e.value)&&void 0!==o?o:this.accordionMultipleValue,n=c.CoreCourseHelper.flattenSections(this.sections);n.forEach((e=>{e.expanded=!1})),t.forEach((e=>{const o=n.find((o=>o.id===Number(e)));o&&(o.expanded=!0)}))}ngOnDestroy(){var e,o,t,n;null===(e=this.courseStatusObserver)||void 0===e||e.off(),null===(o=this.sectionStatusObserver)||void 0===o||o.off(),null===(t=this.moduleStatusObserver)||void 0===t||t.off(),null===(n=this.siteUpdatedObserver)||void 0===n||n.off(),l.CoreCourse.getSectionsModules(this.sections).forEach((e=>{var o,t;null===(o=e.handlerData)||void 0===o||null===(t=o.onDestroy)||void 0===t||t.call(o)})),this.isDestroyed=!0}calculateSectionsStatus(e){var o=this;return(0,r.A)((function*(){e&&(yield Promise.all(e.map(function(){var e=(0,r.A)((function*(e){if(e.id!==d.CORE_COURSE_ALL_SECTIONS_ID)try{e.isCalculating=!0,yield o.calculateModulesStatusOnSection(e),yield c.CoreCourseHelper.calculateSectionStatus(e,o.courseId,!1,!1)}finally{e.isCalculating=!1}}));return function(o){return e.apply(this,arguments)}}())))}))()}}return(e=AddonStorageManagerCourseStoragePage).ɵfac=function AddonStorageManagerCourseStoragePage_Factory(o){return new(o||e)(b.rXU(b.aKT),b.rXU(b.gRc))},e.ɵcmp=b.VBU({type:e,selectors:[["page-addon-storagemanager-course-storage"]],decls:34,vars:30,consts:[["sectionCard",""],["slot","start"],[3,"text"],[1,"limited-width"],[3,"hideUntil"],["class","ion-text-wrap",4,"ngIf"],[1,"wholecourse"],["contextLevel","course",3,"text","contextInstanceId","adaptImg"],[1,"size","ion-text-wrap","ion-no-padding"],[1,"item-heading","ion-text-wrap"],["color","light","slot","end"],[4,"ngIf"],["expand","block","fill","outline","class","ion-no-margin",3,"disabled","click",4,"ngIf"],["expand","block","color","danger",1,"ion-no-margin","ion-margin-top",3,"click","disabled"],["name","fas-trash","slot","start"],[3,"ionChange","multiple","value"],[4,"ngFor","ngForOf"],[1,"ion-text-wrap"],["expand","block","fill","outline",1,"ion-no-margin",3,"click","disabled"],["slot","start","aria-hidden","true",3,"name",4,"ngIf"],["slot","start",4,"ngIf"],["slot","start","aria-hidden","true",3,"name"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","section",3,"id",4,"ngIf"],[1,"section",3,"id"],["toggleIconSlot","start",3,"value"],["slot","header",1,"card-header",3,"detail"],[3,"color",4,"ngIf"],["color","light",4,"ngIf"],["class","storage-buttons","slot","end",4,"ngIf"],["slot","content"],[3,"color"],["name","fam-cloud-done",4,"ngIf"],["name","fam-cloud-done"],["color","light"],[3,"progress"],["slot","end",1,"storage-buttons"],["slot","end","class","core-button-spinner",4,"ngIf"],["color","danger","fill","clear",3,"click",4,"ngIf"],["slot","end",1,"core-button-spinner"],[3,"status","enabled","loading","canTrustDownload","statusesTranslatable","statusSubject","action",4,"ngIf"],["class","core-course-download-section-progress","role","progressbar",4,"ngIf"],[3,"action","status","enabled","loading","canTrustDownload","statusesTranslatable","statusSubject"],["role","progressbar",1,"core-course-download-section-progress"],["color","danger","fill","clear",3,"click"],["name","fas-trash","slot","icon-only"],["class","core-course-storage-activity",4,"ngIf"],[1,"core-course-storage-activity"],["slot","start",3,"modicon","modname","componentId","fallbackTranslation","isBranded",4,"ngIf"],["contextLevel","module",3,"text","courseId","contextInstanceId","adaptImg"],[3,"status","enabled","canTrustDownload","loading","statusesTranslatable","statusSubject","action",4,"ngIf"],["fill","clear","color","danger",3,"click",4,"ngIf"],["class","sr-only",4,"ngIf"],["slot","start",3,"modicon","modname","componentId","fallbackTranslation","isBranded"],[3,"action","status","enabled","canTrustDownload","loading","statusesTranslatable","statusSubject"],["fill","clear","color","danger",3,"click"],[1,"sr-only"]],template:function AddonStorageManagerCourseStoragePage_Template(e,o){if(1&e){const e=b.RV6();b.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),b.nrm(3,"ion-back-button",2),b.nI1(4,"translate"),b.k0s(),b.j41(5,"ion-title")(6,"h1"),b.EFF(7),b.nI1(8,"translate"),b.k0s()()()(),b.j41(9,"ion-content",3)(10,"core-loading",4),b.DNE(11,AddonStorageManagerCourseStoragePage_ion_item_11_Template,5,3,"ion-item",5),b.j41(12,"ion-card",6)(13,"ion-card-header")(14,"ion-card-title"),b.nrm(15,"core-format-text",7),b.k0s(),b.j41(16,"ion-item",8)(17,"ion-label")(18,"p",9),b.EFF(19),b.nI1(20,"translate"),b.k0s()(),b.j41(21,"ion-badge",10),b.DNE(22,AddonStorageManagerCourseStoragePage_ng_container_22_Template,3,3,"ng-container",11)(23,AddonStorageManagerCourseStoragePage_ng_container_23_Template,3,3,"ng-container",11),b.k0s()(),b.DNE(24,AddonStorageManagerCourseStoragePage_ion_button_24_Template,5,6,"ion-button",12),b.j41(25,"ion-button",13),b.bIt("click",(function AddonStorageManagerCourseStoragePage_Template_ion_button_click_25_listener(t){return b.eBV(e),b.Njj(o.deleteForCourse(t))})),b.nrm(26,"ion-icon",14),b.nI1(27,"translate"),b.EFF(28),b.nI1(29,"translate"),b.k0s()()(),b.j41(30,"ion-accordion-group",15),b.bIt("ionChange",(function AddonStorageManagerCourseStoragePage_Template_ion_accordion_group_ionChange_30_listener(t){return b.eBV(e),b.Njj(o.accordionGroupChange(t.detail))})),b.DNE(31,AddonStorageManagerCourseStoragePage_ng_container_31_Template,2,4,"ng-container",16),b.k0s()()(),b.DNE(32,AddonStorageManagerCourseStoragePage_ng_template_32_Template,1,1,"ng-template",null,0,b.C5r)}2&e&&(b.R7$(3),b.Y8G("text",b.bMT(4,17,"core.back")),b.R7$(4),b.JRh(b.bMT(8,19,"addon.storagemanager.coursedownloads")),b.R7$(3),b.Y8G("hideUntil",o.loaded),b.R7$(),b.Y8G("ngIf",o.downloadCourseEnabled),b.R7$(4),b.Y8G("text",o.title)("contextInstanceId",o.courseId)("adaptImg",!1),b.R7$(4),b.JRh(b.bMT(20,21,"addon.storagemanager.totaldownloads")),b.R7$(3),b.Y8G("ngIf",!o.calculatingSize),b.R7$(),b.Y8G("ngIf",o.calculatingSize),b.R7$(),b.Y8G("ngIf",o.downloadCourseEnabled),b.R7$(),b.Y8G("disabled",o.calculatingSize||o.totalSize<=0),b.R7$(),b.BMQ("aria-label",b.i5U(27,23,"addon.storagemanager.deletedatafrom",b.eq3(28,course_storage_c0,o.title))),b.R7$(2),b.SpI(" ",b.bMT(29,26,"addon.storagemanager.deleteall")," "),b.R7$(2),b.Y8G("multiple",!0)("value",o.accordionMultipleValue),b.R7$(),b.Y8G("ngForOf",o.sections))},dependencies:[D.Sq,D.bT,D.T3,z.Y,I.R,O.I,$.z,w.t,P.B,T.i,A.T,v.xk,v.YH,v.In,v.Jm,v.QW,v.b_,v.I9,v.ME,v.tN,v.W9,v.eU,v.iq,v.uz,v.he,v.w2,v.BC,v.ai,v.el,y.b,R.D9],styles:['[_nghost-%COMP%]{--course-storage-max-activity-height: 120px}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-item.size[_ngcontent-%COMP%]{--inner-padding-end: 0px}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-item.card-header[_ngcontent-%COMP%]{padding:0;--border-width: 0px}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-item.card-header[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{font:var(--mdl-typography-heading4-font)}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:0}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .core-course-storage-activity[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p.item-heading[_ngcontent-%COMP%]{position:relative;max-height:var(--course-storage-max-activity-height);overflow:hidden}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .core-course-storage-activity[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p.item-heading[_ngcontent-%COMP%]     *{pointer-events:none!important}[_nghost-%COMP%]   ion-card.section[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .core-course-storage-activity[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p.item-heading[_ngcontent-%COMP%]:before{content:"";height:var(--course-storage-max-activity-height);position:absolute;left:0;right:0;top:0;background:linear-gradient(to bottom,rgba(var(--background-gradient-rgb),0) calc(100% - 30px),rgba(var(--background-gradient-rgb),1) calc(100% - 20px));z-index:6;pointer-events:none}ion-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-end:8px}ion-item[_ngcontent-%COMP%]   core-mod-icon[_ngcontent-%COMP%]{--module-icon-size: 24px;--module-legacy-icon-size: 16px;--margin-vertical: 8px;--margin-end: 8px}.storage-buttons[_ngcontent-%COMP%]{display:flex;align-items:center}'],changeDetection:0}),AddonStorageManagerCourseStoragePage})();const x=[{path:"storage",component:k},{path:"storage/:courseId",component:F}];let j=(()=>{var e;class AddonStorageManagerLazyModule{}return(e=AddonStorageManagerLazyModule).ɵfac=function AddonStorageManagerLazyModule_Factory(o){return new(o||e)},e.ɵmod=b.$C({type:e}),e.ɵinj=b.G2t({imports:[n.iI.forChild(x),a.n]}),AddonStorageManagerLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&b.Obh(j,{declarations:[k,F],imports:[n.iI,a.n]}))}}]);