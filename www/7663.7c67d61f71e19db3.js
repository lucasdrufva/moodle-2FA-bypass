"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7663,9522,7141],{57663:(e,n,t)=>{t.r(n),t.d(n,{default:()=>$e});var o=t(3353),a=t(28446),r=t(10467),i=t(94455),d=t(49882),l=t(52749),s=t(89911),c=t(16474),m=t(8224),u=t(57186),_=t(68581),f=t(13462),g=t(66110),v=t(83219),p=t(96508),h=t.n(p),C=t(79555),I=t(15324),b=t(24502),E=t(74431),y=t(47514),T=t(55306),A=t(94398),R=t(83696),P=t(99522);class AddonCalendarEventsSource extends P.F{constructor(e){super(),this.events=[],this.DATE=e}setEvents(e){this.events=e}loadPageItems(){var e=this;return(0,r.A)((function*(){return{items:e.events.slice(0)}}))()}getItemPath(e){return e.id.toString()}getItemQueryParams(){return{date:this.DATE}}}var k=t(22693),x=t(8014),D=t(24742),M=t(6319),O=t(99234),G=t(58364),S=t(54438),$=t(60177),F=t(69502),w=t(17388),j=t(16986),N=t(64422),Y=t(32572),U=t(19858),L=t(86198),V=t(58197),B=t(88246),X=t(43570),z=t(73465),J=t(73955);const _c0=e=>({$a:e}),_c1=e=>[e];function AddonCalendarDayPage_core_context_menu_item_14_Template(e,n){if(1&e){const e=S.RV6();S.j41(0,"core-context-menu-item",20),S.nI1(1,"translate"),S.bIt("action",(function AddonCalendarDayPage_core_context_menu_item_14_Template_core_context_menu_item_action_0_listener(){S.eBV(e);const n=S.XpG();return S.Njj(n.goToCurrentDay())})),S.k0s()}2&e&&S.Y8G("priority",900)("content",S.bMT(1,2,"addon.calendar.today"))}function AddonCalendarDayPage_ng_template_37_ion_card_1_Template(e,n){1&e&&(S.j41(0,"ion-card",24)(1,"ion-item"),S.nrm(2,"ion-icon",25),S.j41(3,"ion-label"),S.EFF(4),S.nI1(5,"translate"),S.nI1(6,"translate"),S.k0s()()()),2&e&&(S.R7$(4),S.JRh(S.i5U(6,3,"core.hasdatatosync",S.eq3(6,_c0,S.bMT(5,1,"core.day")))))}function AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template(e,n){1&e&&(S.nrm(0,"core-empty-box",26),S.nI1(1,"translate")),2&e&&S.Y8G("message",S.bMT(1,1,"addon.calendar.noevents"))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template(e,n){if(1&e&&S.nrm(0,"core-mod-icon",38),2&e){const e=S.XpG().$implicit;S.Y8G("modicon",e.moduleIcon)("showAlt",!1)("modname",e.modulename)("componentId",e.instance)("purpose",e.purpose)("isBranded",e.branded)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template(e,n){if(1&e&&S.nrm(0,"ion-icon",39),2&e){const e=S.XpG().$implicit;S.Y8G("name",e.eventIcon)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template(e,n){if(1&e&&(S.j41(0,"span",32),S.EFF(1),S.k0s()),2&e){const e=S.XpG().$implicit;S.R7$(),S.JRh(e.iconTitle)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template(e,n){1&e&&(S.j41(0,"ion-note",2),S.nrm(1,"ion-icon",40),S.j41(2,"span",41),S.EFF(3),S.nI1(4,"translate"),S.k0s()()),2&e&&(S.R7$(3),S.JRh(S.bMT(4,1,"core.notsent")))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_15_Template(e,n){1&e&&(S.j41(0,"ion-note",2),S.nrm(1,"ion-icon",42),S.j41(2,"span",41),S.EFF(3),S.nI1(4,"translate"),S.k0s()()),2&e&&(S.R7$(3),S.JRh(S.bMT(4,1,"core.deletedoffline")))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template(e,n){if(1&e){const e=S.RV6();S.qex(0),S.j41(1,"ion-card")(2,"ion-item",29),S.bIt("click",(function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template_ion_item_click_2_listener(){const n=S.eBV(e).$implicit,t=S.XpG(2).item,o=S.XpG();return S.Njj(o.gotoEvent(n.id,t))})),S.DNE(3,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template,1,6,"core-mod-icon",30)(4,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template,1,1,"ion-icon",31),S.j41(5,"ion-label")(6,"span",32),S.EFF(7),S.nI1(8,"translate"),S.DNE(9,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template,2,1,"span",33),S.k0s(),S.j41(10,"p",34),S.nrm(11,"core-format-text",35),S.k0s(),S.j41(12,"p"),S.nrm(13,"core-format-text",36),S.k0s()(),S.DNE(14,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template,5,3,"ion-note",37)(15,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_15_Template,5,3,"ion-note",37),S.k0s()(),S.bVm()}if(2&e){const e=n.$implicit;S.R7$(2),S.AVh("item-dimmed",e.ispast),S.Y8G("ngClass",S.eq3(18,_c1,"addon-calendar-eventtype-"+e.eventtype))("detail",!1),S.BMQ("aria-label",e.name),S.R7$(),S.Y8G("ngIf",e.moduleIcon),S.R7$(),S.Y8G("ngIf",e.eventIcon&&!e.moduleIcon),S.R7$(3),S.SpI(" ",S.bMT(8,16,"addon.calendar.type"+e.formattedType)," "),S.R7$(2),S.Y8G("ngIf",e.moduleIcon&&e.iconTitle),S.R7$(2),S.Y8G("text",e.name)("contextLevel",e.contextLevel)("contextInstanceId",e.contextInstanceId),S.R7$(2),S.Y8G("text",e.formattedtime)("filter",!1),S.R7$(),S.Y8G("ngIf",e.offline&&!e.deleted),S.R7$(),S.Y8G("ngIf",e.deleted)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_Template(e,n){if(1&e&&(S.j41(0,"ion-list",27),S.DNE(1,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template,16,20,"ng-container",28),S.k0s()),2&e){const e=S.XpG().item;S.R7$(),S.Y8G("ngForOf",e.filteredEvents)}}function AddonCalendarDayPage_ng_template_37_Template(e,n){if(1&e&&(S.j41(0,"core-loading",9),S.DNE(1,AddonCalendarDayPage_ng_template_37_ion_card_1_Template,7,8,"ion-card",21)(2,AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template,2,3,"core-empty-box",22)(3,AddonCalendarDayPage_ng_template_37_ion_list_3_Template,2,1,"ion-list",23),S.k0s()),2&e){const e=n.item;S.Y8G("hideUntil",e.loaded),S.R7$(),S.Y8G("ngIf",e.hasOffline),S.R7$(),S.Y8G("ngIf",!e.filteredEvents||!e.filteredEvents.length),S.R7$(),S.Y8G("ngIf",e.filteredEvents&&e.filteredEvents.length)}}function AddonCalendarDayPage_ion_fab_38_Template(e,n){if(1&e){const e=S.RV6();S.j41(0,"ion-fab",43)(1,"ion-fab-button",44),S.nI1(2,"translate"),S.bIt("click",(function AddonCalendarDayPage_ion_fab_38_Template_ion_fab_button_click_1_listener(){S.eBV(e);const n=S.XpG();return S.Njj(n.openEdit())})),S.nrm(3,"ion-icon",45),S.j41(4,"span",32),S.EFF(5),S.nI1(6,"translate"),S.k0s()()()}2&e&&(S.R7$(),S.BMQ("aria-label",S.bMT(2,2,"addon.calendar.newevent")),S.R7$(4),S.JRh(S.bMT(6,4,"addon.calendar.newevent")))}let q=(()=>{var e;class AddonCalendarDayPage{constructor(){var e=this;this.eventObservers=[],this.loaded=!1,this.isOnline=!1,this.syncIcon=E.CoreConstants.ICON_LOADING,this.filter={filtered:!1,courseId:void 0,categoryId:void 0,course:!0,group:!0,site:!0,user:!0,category:!0},this.currentSiteId=l.CoreSites.getCurrentSiteId(),this.eventObservers.push(d.z.on(O.zl,(e=>{var n;e&&e.eventId&&(null===(n=this.manager)||void 0===n||n.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0))}),this.currentSiteId)),this.eventObservers.push(d.z.on(O.D1,(()=>{var e;null===(e=this.manager)||void 0===e||e.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0)}),this.currentSiteId)),this.eventObservers.push(d.z.on(O.bp,(e=>{var n;e&&e.eventId&&(null===(n=this.manager)||void 0===n||n.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0))}),this.currentSiteId)),this.eventObservers.push(d.z.on(O.FK,(()=>{var e;null===(e=this.manager)||void 0===e||e.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0)}),this.currentSiteId)),this.eventObservers.push(d.z.on(O.y$,(e=>{var n;const t=null===(n=this.manager)||void 0===n?void 0:n.getSelectedItem();var o;!e||"day"==e.source&&t&&e.moment&&t.moment.isSame(e.moment,"day")||(null===(o=this.manager)||void 0===o||o.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0))}),this.currentSiteId)),this.eventObservers.push(d.z.on(O.Mq,(e=>{var n,t;e&&!e.sent?null===(n=this.manager)||void 0===n||n.getSource().markAsDeleted(e.eventId,!0):(null===(t=this.manager)||void 0===t||t.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0))}),this.currentSiteId)),this.eventObservers.push(d.z.on(O.hZ,(e=>{var n;e&&e.eventId&&(null===(n=this.manager)||void 0===n||n.getSource().markAsDeleted(e.eventId,!1))}),this.currentSiteId)),this.eventObservers.push(d.z.on(O.Jj,function(){var n=(0,r.A)((function*(n){var t,o;e.filter=n,yield null===(t=e.manager)||void 0===t?void 0:t.getSource().loadCanCreate(e.filter.courseId),null===(o=e.manager)||void 0===o||o.getSource().filterAllDayEvents(e.filter)}));return function(e){return n.apply(this,arguments)}}())),this.onlineObserver=i.WE.onChange().subscribe((()=>{C.SK.run((()=>{this.isOnline=i.WE.isOnline()}))})),this.logView=D.j.once((()=>{var e;const n=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem();if(!n)return;const t={course:this.filter.courseId,time:n.moment.unix()};k.OF.logEvent({type:k.qr.VIEW_ITEM_LIST,ws:"core_calendar_get_calendar_day_view",name:C.HT.instant("addon.calendar.dayviewtitle",{$a:this.periodName}),data:{...t,category:"calendar"},url:x.F.addParamsToUrl("/calendar/view.php?view=day",t)})}))}ngOnInit(){const e=[];G.T.enumKeys(O.rz).forEach((n=>{var t;const o=O.rz[n];this.filter[n]=null===(t=I.CoreNavigator.getRouteBooleanParam(n))||void 0===t||t,e.push(o)})),this.filter.courseId=I.CoreNavigator.getRouteNumberParam("courseId"),this.filter.categoryId=I.CoreNavigator.getRouteNumberParam("categoryId"),this.filter.filtered=void 0!==this.filter.courseId||e.some((e=>!this.filter[e]));const n=I.CoreNavigator.getRouteNumberParam("month"),t=new AddonCalendarDaySlidesItemsManagerSource(this,h()({year:I.CoreNavigator.getRouteNumberParam("year"),month:n?n-1:void 0,date:I.CoreNavigator.getRouteNumberParam("day")}).startOf("day"));this.manager=new y.E(t),this.managerUnsubscribe=this.manager.addListener({onSelectedItemUpdated:e=>{this.onDayViewed(e)}}),this.fetchData(!0)}get canCreate(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().canCreate)||!1}get timeFormat(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().timeFormat)||"core.strftimetime"}fetchData(e){var n=this;return(0,r.A)((function*(){n.syncIcon=E.CoreConstants.ICON_LOADING,n.isOnline=i.WE.isOnline(),e&&(yield n.sync());try{var t,o,a;yield null===(t=n.manager)||void 0===t?void 0:t.getSource().fetchData(n.filter.courseId),yield null===(o=n.manager)||void 0===o?void 0:o.getSource().load(null===(a=n.manager)||void 0===a?void 0:a.getSelectedItem()),n.logView()}catch(e){s.CoreDomUtils.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}n.loaded=!0,n.syncIcon=E.CoreConstants.ICON_SYNC}))()}onDayViewed(e){this.periodName=c.CoreTimeUtils.userDate(1e3*e.moment.unix(),"core.strftimedaydate")}doRefresh(e,n){var t=this;return(0,r.A)((function*(){t.loaded&&(yield t.refreshData(!0).finally((()=>{null==e||e.complete(),n&&n()})))}))()}refreshData(e,n){var t=this;return(0,r.A)((function*(){var o,a;t.syncIcon=E.CoreConstants.ICON_LOADING;const r=(null===(o=t.manager)||void 0===o?void 0:o.getSelectedItem())||null;yield null===(a=t.manager)||void 0===a?void 0:a.getSource().invalidateContent(r,!n),yield t.fetchData(e)}))()}sync(e){var n=this;return(0,r.A)((function*(){try{const e=yield f.AddonCalendarSync.syncEvents();if(e.warnings&&e.warnings.length&&s.CoreDomUtils.showAlert(void 0,e.warnings[0]),e.updated){var t,o;const a=null===(t=n.manager)||void 0===t?void 0:t.getSelectedItem();e.source="day",e.moment=null==a?void 0:a.moment,null===(o=n.manager)||void 0===o||o.getSource().markAllItemsUnloaded(),d.z.trigger(O.y$,e,n.currentSiteId)}}catch(n){e&&s.CoreDomUtils.showErrorModalDefault(n,"core.errorsync",!0)}}))()}selectedDayIsCurrent(){var e;return!(null===(e=this.manager)||void 0===e||null===(e=e.getSelectedItem())||void 0===e||!e.isCurrentDay)}gotoEvent(e,n){I.CoreNavigator.navigateToSitePath(`/calendar/event/${e}`,{params:{date:n.moment.format("MMDDY")}})}openFilter(){var e=this;return(0,r.A)((function*(){var n;const{AddonCalendarFilterComponent:o}=yield t.e(5393).then(t.bind(t,45393));yield M.I.openSideModal({component:o,componentProps:{courses:null===(n=e.manager)||void 0===n?void 0:n.getSource().courses,filter:e.filter}})}))()}openEdit(e){const n={};if(!e){var t;e=0;const o=null===(t=this.manager)||void 0===t?void 0:t.getSelectedItem();if(o){const e=h()();n.timestamp=1e3*o.moment.clone().set({hour:e.hour(),minute:e.minute()}).unix()}}this.filter.courseId&&(n.courseId=this.filter.courseId),I.CoreNavigator.navigateToSitePath(`/calendar/edit/${e}`,{params:n})}selectedDayHasOffline(){var e;const n=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem();return!(null==n||!n.hasOffline)}goToCurrentDay(){var e=this;return(0,r.A)((function*(){const n=e.manager;if(!n||!e.swipeSlidesComponent)return;const t={moment:h()()};e.loaded=!1;try{yield n.getSource().loadItem(t),e.swipeSlidesComponent.slideToItem(t)}catch(e){s.CoreDomUtils.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}finally{e.loaded=!0}}))()}loadNext(){var e=this;return(0,r.A)((function*(){var n;null===(n=e.swipeSlidesComponent)||void 0===n||n.slideNext()}))()}loadPrevious(){var e=this;return(0,r.A)((function*(){var n;null===(n=e.swipeSlidesComponent)||void 0===n||n.slidePrev()}))()}ngOnDestroy(){var e,n,t,o;this.eventObservers.forEach((e=>e.off())),null===(e=this.onlineObserver)||void 0===e||e.unsubscribe(),null===(n=this.manager)||void 0===n||n.getSource().forgetRelatedSources(),null===(t=this.manager)||void 0===t||t.destroy(),null===(o=this.managerUnsubscribe)||void 0===o||o.call(this),delete this.manager}}return(e=AddonCalendarDayPage).ɵfac=function AddonCalendarDayPage_Factory(n){return new(n||e)},e.ɵcmp=S.VBU({type:e,selectors:[["page-addon-calendar-day"]],viewQuery:function AddonCalendarDayPage_Query(e,n){if(1&e&&S.GBs(T.N,5),2&e){let e;S.mGM(e=S.lsd())&&(n.swipeSlidesComponent=e.first)}},decls:39,vars:31,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","fas-filter","aria-hidden","true"],["iconAction","fas-calendar-day",3,"priority","content","action",4,"ngIf"],[3,"action","hidden","priority","content","iconAction","closeOnClick"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[1,"core-swipe-slides-container"],[1,"ion-no-padding","safe-area-padding"],[1,"ion-align-items-center"],[1,"ion-text-start"],["name","fas-chevron-left","slot","icon-only","aria-hidden","true"],[1,"ion-text-center","addon-calendar-period"],[1,"ion-text-end"],["name","fas-chevron-right","slot","icon-only","aria-hidden","true"],[3,"manager"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["iconAction","fas-calendar-day",3,"action","priority","content"],["class","core-warning-card list-item-limited-width",4,"ngIf"],["icon","fas-calendar",3,"message",4,"ngIf"],["class","list-item-limited-width",4,"ngIf"],[1,"core-warning-card","list-item-limited-width"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["icon","fas-calendar",3,"message"],[1,"list-item-limited-width"],[4,"ngFor","ngForOf"],["button","",1,"addon-calendar-event","ion-text-wrap",3,"click","ngClass","detail"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose","isBranded",4,"ngIf"],["slot","start","aria-hidden","true",3,"name",4,"ngIf"],[1,"sr-only"],["class","sr-only",4,"ngIf"],[1,"item-heading"],[3,"text","contextLevel","contextInstanceId"],[3,"text","filter"],["slot","end",4,"ngIf"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose","isBranded"],["slot","start","aria-hidden","true",3,"name"],["name","fas-clock","aria-hidden","true"],[1,"ion-text-wrap"],["name","fas-trash","aria-hidden","true"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"]],template:function AddonCalendarDayPage_Template(e,n){1&e&&(S.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),S.nrm(3,"ion-back-button",1),S.nI1(4,"translate"),S.k0s(),S.j41(5,"ion-title")(6,"h1"),S.EFF(7),S.nI1(8,"translate"),S.k0s()(),S.j41(9,"ion-buttons",2)(10,"ion-button",3),S.nI1(11,"translate"),S.bIt("click",(function AddonCalendarDayPage_Template_ion_button_click_10_listener(){return n.openFilter()})),S.nrm(12,"ion-icon",4),S.k0s(),S.j41(13,"core-context-menu"),S.DNE(14,AddonCalendarDayPage_core_context_menu_item_14_Template,2,4,"core-context-menu-item",5),S.j41(15,"core-context-menu-item",6),S.nI1(16,"translate"),S.bIt("action",(function AddonCalendarDayPage_Template_core_context_menu_item_action_15_listener(e){return n.doRefresh(void 0,e)})),S.k0s()()()()(),S.j41(17,"ion-content")(18,"ion-refresher",7),S.bIt("ionRefresh",(function AddonCalendarDayPage_Template_ion_refresher_ionRefresh_18_listener(e){return n.doRefresh(e.target)})),S.nrm(19,"ion-refresher-content",8),S.nI1(20,"translate"),S.k0s(),S.j41(21,"core-loading",9)(22,"div",10)(23,"ion-grid",11)(24,"ion-row",12)(25,"ion-col",13)(26,"ion-button",3),S.nI1(27,"translate"),S.bIt("click",(function AddonCalendarDayPage_Template_ion_button_click_26_listener(){return n.loadPrevious()})),S.nrm(28,"ion-icon",14),S.k0s()(),S.j41(29,"ion-col",15)(30,"h2"),S.EFF(31),S.k0s()(),S.j41(32,"ion-col",16)(33,"ion-button",3),S.nI1(34,"translate"),S.bIt("click",(function AddonCalendarDayPage_Template_ion_button_click_33_listener(){return n.loadNext()})),S.nrm(35,"ion-icon",17),S.k0s()()()(),S.j41(36,"core-swipe-slides",18),S.DNE(37,AddonCalendarDayPage_ng_template_37_Template,4,4,"ng-template"),S.k0s()()(),S.DNE(38,AddonCalendarDayPage_ion_fab_38_Template,7,6,"ion-fab",19),S.k0s()),2&e&&(S.R7$(3),S.Y8G("text",S.bMT(4,17,"core.back")),S.R7$(4),S.JRh(S.bMT(8,19,"addon.calendar.calendarevents")),S.R7$(3),S.Y8G("ariaLabel",S.bMT(11,21,"core.filter")),S.R7$(4),S.Y8G("ngIf",!n.selectedDayIsCurrent()),S.R7$(),S.Y8G("hidden",!n.loaded||!n.selectedDayHasOffline()||!n.isOnline)("priority",400)("content",S.bMT(16,23,"core.settings.synchronizenow"))("iconAction",n.syncIcon)("closeOnClick",!1),S.R7$(3),S.Y8G("disabled",!n.loaded),S.R7$(),S.FS9("pullingText",S.bMT(20,25,"core.pulltorefresh")),S.R7$(2),S.Y8G("hideUntil",n.loaded),S.R7$(5),S.Y8G("ariaLabel",S.bMT(27,27,"addon.calendar.dayprev")),S.R7$(5),S.JRh(n.periodName),S.R7$(2),S.Y8G("ariaLabel",S.bMT(34,29,"addon.calendar.daynext")),S.R7$(3),S.Y8G("manager",n.manager),S.R7$(2),S.Y8G("ngIf",n.canCreate&&n.loaded))},dependencies:[$.YU,$.Sq,$.bT,F.B,w.Q,j.h,N.R,Y.I,T.N,U.A,L.t,V.B,B.i,X.T,z.Jm,z.QW,z.b_,z.hU,z.W9,z.Q8,z.YW,z.lO,z.eU,z.iq,z.uz,z.he,z.nf,z.JI,z.To,z.Ki,z.ln,z.BC,z.ai,z.el,J.D9],styles:["[_nghost-%COMP%]{--addon-calendar-blank-day-background-color: var(--light)}[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{color:#fff;border-radius:50%;padding:.7rem;--margin-vertical: 12px;--margin-end: 12px;margin-top:var(--margin-vertical);margin-bottom:var(--margin-vertical);margin-inline-end:var(--margin-end)}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-category[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#8e24aa}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-course[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#ca3120}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-group[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#f0ad4e}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-user[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#0f6cbf}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-site[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#357a32}","[_nghost-%COMP%]   .core-swipe-slides-container[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{flex:none;width:100%}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]{flex-grow:3}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:10px;font-size:1.2rem}"]}),AddonCalendarDayPage})();class AddonCalendarDaySlidesItemsManagerSource extends A.h{constructor(e,n){super({moment:n}),this.courses=[],this.eventsSources=new Set,this.offlineEvents={},this.offlineEditedEventsIds=[],this.canCreate=!1,this.sendLog=!0,this.dayPage=e}fetchData(e){var n=this;return(0,r.A)((function*(){yield Promise.all([n.loadCourses(e),n.loadCanCreate(e),n.loadCategories(),n.loadOfflineEvents(),n.loadOfflineDeletedEvents(),n.loadTimeFormat()])}))()}filterAllDayEvents(e){var n;null===(n=this.getItems())||void 0===n||n.forEach((n=>this.filterEvents(n,e)))}filterEvents(e,n){e.filteredEvents=_.AddonCalendarHelper.getFilteredEvents(e.events||[],n,this.categories||{}),this.rememberEventsList(e)}loadCourses(e){var n=this;return(0,r.A)((function*(){const t=yield v.CoreCoursesHelper.getCoursesForPopover(e);n.courses=t.courses}))()}loadCanCreate(e){var n=this;return(0,r.A)((function*(){n.canCreate=yield _.AddonCalendarHelper.canEditEvents(e)}))()}loadCategories(){var e=this;return(0,r.A)((function*(){if(!e.categories)try{const n=yield g.CoreCourses.getCategories(0,!0);e.categories=b.R.toObject(n,"id")}catch{}}))()}loadOfflineEvents(){var e=this;return(0,r.A)((function*(){const n=yield u.AddonCalendarOffline.getAllEditedEvents();e.offlineEvents=_.AddonCalendarHelper.classifyIntoMonths(n),e.offlineEditedEventsIds=n.filter((e=>e.id>0)).map((e=>e.id))}))()}loadOfflineDeletedEvents(){var e=this;return(0,r.A)((function*(){const n=yield u.AddonCalendarOffline.getAllDeletedEventsIds();e.deletedEvents=new Set(n)}))()}loadTimeFormat(){var e=this;return(0,r.A)((function*(){e.timeFormat=yield m.AddonCalendar.getCalendarTimeFormat()}))()}getItemId(e){return _.AddonCalendarHelper.getDayId(e.moment)}getPreviousItem(e){return{moment:e.moment.clone().subtract(1,"day")}}getNextItem(e){return{moment:e.moment.clone().add(1,"day")}}loadItemData(e,n=!1){var t=this;return(0,r.A)((function*(){const o={...e,hasOffline:!1,events:[],onlineEvents:[],filteredEvents:[],isCurrentDay:e.moment.isSame(h()(),"day"),isPastDay:e.moment.isBefore(h()(),"day")};if(n)return o;let a;try{a=yield m.AddonCalendar.getDayEvents(e.moment.year(),e.moment.month()+1,e.moment.date()),o.onlineEvents=yield Promise.all(a.events.map((e=>_.AddonCalendarHelper.formatEventData(e))))}catch(e){if(i.WE.isOnline())throw e}o.events=t.mergeEvents(o),t.filterEvents(o,t.dayPage.filter);const d=1e3*e.moment.unix(),l=c.CoreTimeUtils.timestamp(),s=o.events.map(function(){var e=(0,r.A)((function*(e){e.ispast=o.isPastDay||o.isCurrentDay&&t.isEventPast(e,l),e.formattedtime=yield m.AddonCalendar.formatEventTime(e,t.dayPage.timeFormat,!0,d)}));return function(n){return e.apply(this,arguments)}}());return yield Promise.all(s),o}))()}isEventPast(e,n){return e.timestart+e.timeduration<n}mergeEvents(e){var n,t;if(e.hasOffline=!1,!(Object.keys(this.offlineEvents).length||null!==(n=this.deletedEvents)&&void 0!==n&&n.size))return e.onlineEvents||[];const o=this.offlineEvents[_.AddonCalendarHelper.getMonthId(e.moment)],a=o&&o[e.moment.date()];let r=e.onlineEvents||[];var i;(null!==(t=this.deletedEvents)&&void 0!==t&&t.size&&r.forEach((n=>{var t;n.deleted=null===(t=this.deletedEvents)||void 0===t?void 0:t.has(n.id),n.deleted&&(e.hasOffline=!0)})),this.offlineEditedEventsIds.length)&&(r=r.filter((e=>-1==this.offlineEditedEventsIds.indexOf(e.id))),r.length!=(null===(i=e.onlineEvents)||void 0===i?void 0:i.length)&&(e.hasOffline=!0));return a&&a.length&&(e.hasOffline=!0,r=_.AddonCalendarHelper.sortEvents(r.concat(a))),r}invalidateContent(e,n){var t=this;return(0,r.A)((function*(){const o=[];n&&e&&o.push(m.AddonCalendar.invalidateDayEvents(e.moment.year(),e.moment.month()+1,e.moment.date())),o.push(m.AddonCalendar.invalidateAllowedEventTypes()),o.push(g.CoreCourses.invalidateCategories(0,!0)),o.push(m.AddonCalendar.invalidateTimeFormat()),t.categories=void 0,t.sendLog=!0,e&&(e.dirty=!0),yield Promise.all(o)}))()}markAsDeleted(e,n){var t,o,a;(null===(t=this.getItems())||void 0===t||t.some((t=>{var o;const a=null===(o=t.onlineEvents)||void 0===o?void 0:o.find((n=>n.id==e));if(!a)return!1;var r,i,d;(a.deleted=n,n)?t.hasOffline=!0:t.hasOffline=(null===(r=t.events)||void 0===r?void 0:r.length)!=(null===(i=t.onlineEvents)||void 0===i?void 0:i.length)||(null===(d=t.events)||void 0===d?void 0:d.some((e=>e.deleted||e.offline)));return!0})),n)?null===(o=this.deletedEvents)||void 0===o||o.add(e):null===(a=this.deletedEvents)||void 0===a||a.delete(e)}forgetRelatedSources(){for(const e of this.eventsSources)R.u.removeReference(e,this)}rememberEventsList(e){var n=this;return(0,r.A)((function*(){var t;const o=R.u.getOrCreateSource(AddonCalendarEventsSource,[e.moment.format("MMDDY")]);n.eventsSources.has(o)||(n.eventsSources.add(o),R.u.addReference(o,n)),o.setEvents(null!==(t=e.filteredEvents)&&void 0!==t?t:[]),yield o.reload()}))()}}var H=t(89417),W=t(15221),Q=t(48966),K=t(81690),Z=t(41450),ee=t(40867),ne=t(75629),te=t(63153),oe=t(21604),ae=t(23039),re=t(23780),ie=t(43959),de=t(55554),le=t(25880),se=t(17778),ce=t(66731),me=t(9970);const ue=["editEventForm"],edit_event_c1=e=>({header:e}),_c2=e=>({$a:e});function AddonCalendarEditEventPage_form_14_ng_template_16_Template(e,n){if(1&e&&(S.j41(0,"ion-datetime",32)(1,"span",33),S.EFF(2),S.nI1(3,"translate"),S.k0s()()),2&e){const e=S.XpG(2);S.Y8G("max",e.maxDate)("min",e.minDate)("showDefaultButtons",!0),S.R7$(2),S.JRh(S.bMT(3,4,"core.date"))}}function AddonCalendarEditEventPage_form_14_ion_label_19_Template(e,n){1&e&&(S.j41(0,"ion-label")(1,"p",34),S.EFF(2),S.nI1(3,"translate"),S.k0s()()),2&e&&(S.R7$(),S.Y8G("core-mark-required",!0),S.R7$(),S.JRh(S.bMT(3,2,"addon.calendar.eventkind")))}function AddonCalendarEditEventPage_form_14_p_20_Template(e,n){if(1&e&&(S.j41(0,"p",35),S.EFF(1),S.nI1(2,"translate"),S.k0s()),2&e){const e=S.XpG(2);S.R7$(),S.JRh(S.bMT(2,1,e.eventTypes[0].name))}}function AddonCalendarEditEventPage_form_14_ion_select_21_ion_select_option_6_Template(e,n){if(1&e&&(S.j41(0,"ion-select-option",26),S.EFF(1),S.nI1(2,"translate"),S.k0s()),2&e){const e=n.$implicit;S.Y8G("value",e.value),S.R7$(),S.SpI(" ",S.bMT(2,2,e.name)," ")}}function AddonCalendarEditEventPage_form_14_ion_select_21_Template(e,n){if(1&e&&(S.j41(0,"ion-select",36),S.nI1(1,"translate"),S.nI1(2,"translate"),S.j41(3,"div",11),S.EFF(4),S.nI1(5,"translate"),S.k0s(),S.DNE(6,AddonCalendarEditEventPage_form_14_ion_select_21_ion_select_option_6_Template,3,4,"ion-select-option",37),S.k0s()),2&e){const e=S.XpG(2);S.Y8G("cancelText",S.bMT(1,5,"core.cancel"))("interfaceOptions",S.eq3(11,edit_event_c1,S.bMT(2,7,"addon.calendar.eventkind"))),S.R7$(3),S.Y8G("core-mark-required",!0),S.R7$(),S.JRh(S.bMT(5,9,"addon.calendar.eventkind")),S.R7$(2),S.Y8G("ngForOf",e.eventTypes)}}function AddonCalendarEditEventPage_form_14_ion_item_22_ion_select_option_8_Template(e,n){if(1&e&&(S.j41(0,"ion-select-option",26),S.EFF(1),S.k0s()),2&e){const e=n.$implicit;S.Y8G("value",e.id),S.R7$(),S.SpI(" ",e.name," ")}}function AddonCalendarEditEventPage_form_14_ion_item_22_Template(e,n){if(1&e&&(S.j41(0,"ion-item",9)(1,"ion-select",38),S.nI1(2,"translate"),S.nI1(3,"translate"),S.nI1(4,"translate"),S.j41(5,"p",11),S.EFF(6),S.nI1(7,"translate"),S.k0s(),S.DNE(8,AddonCalendarEditEventPage_form_14_ion_item_22_ion_select_option_8_Template,2,2,"ion-select-option",37),S.k0s()()),2&e){const e=S.XpG(2);S.R7$(),S.Y8G("placeholder",S.bMT(2,6,"core.noselection"))("cancelText",S.bMT(3,8,"core.cancel"))("interfaceOptions",S.eq3(14,edit_event_c1,S.bMT(4,10,"core.category"))),S.R7$(4),S.Y8G("core-mark-required",!0),S.R7$(),S.JRh(S.bMT(7,12,"core.category")),S.R7$(2),S.Y8G("ngForOf",e.categories)}}function AddonCalendarEditEventPage_form_14_ion_item_23_ion_select_option_8_Template(e,n){if(1&e&&(S.j41(0,"ion-select-option",26),S.EFF(1),S.k0s()),2&e){const e=n.$implicit;S.Y8G("value",e.id),S.R7$(),S.JRh(e.fullname)}}function AddonCalendarEditEventPage_form_14_ion_item_23_Template(e,n){if(1&e&&(S.j41(0,"ion-item",9)(1,"ion-select",39),S.nI1(2,"translate"),S.nI1(3,"translate"),S.nI1(4,"translate"),S.j41(5,"p",11),S.EFF(6),S.nI1(7,"translate"),S.k0s(),S.DNE(8,AddonCalendarEditEventPage_form_14_ion_item_23_ion_select_option_8_Template,2,2,"ion-select-option",37),S.k0s()()),2&e){const e=S.XpG(2);S.R7$(),S.Y8G("placeholder",S.bMT(2,6,"core.noselection"))("cancelText",S.bMT(3,8,"core.cancel"))("interfaceOptions",S.eq3(14,edit_event_c1,S.bMT(4,10,"core.course"))),S.R7$(4),S.Y8G("core-mark-required",!0),S.R7$(),S.JRh(S.bMT(7,12,"core.course")),S.R7$(2),S.Y8G("ngForOf",e.courses)}}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_select_option_9_Template(e,n){if(1&e&&(S.j41(0,"ion-select-option",26),S.EFF(1),S.k0s()),2&e){const e=n.$implicit;S.Y8G("value",e.id),S.R7$(),S.SpI(" ",e.fullname," ")}}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_10_Template(e,n){1&e&&(S.j41(0,"ion-item",43)(1,"ion-label")(2,"p"),S.EFF(3),S.nI1(4,"translate"),S.k0s()()()),2&e&&(S.R7$(3),S.JRh(S.bMT(4,1,"core.coursenogroups")))}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_11_ion_select_option_8_Template(e,n){if(1&e&&(S.j41(0,"ion-select-option",26),S.EFF(1),S.k0s()),2&e){const e=n.$implicit;S.Y8G("value",e.id),S.R7$(),S.JRh(e.name)}}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_11_Template(e,n){if(1&e&&(S.j41(0,"ion-item",44)(1,"ion-select",45),S.nI1(2,"translate"),S.nI1(3,"translate"),S.nI1(4,"translate"),S.j41(5,"p",11),S.EFF(6),S.nI1(7,"translate"),S.k0s(),S.DNE(8,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_11_ion_select_option_8_Template,2,2,"ion-select-option",37),S.k0s()()),2&e){const e=S.XpG(3);S.R7$(),S.Y8G("placeholder",S.bMT(2,6,"core.noselection"))("cancelText",S.bMT(3,8,"core.cancel"))("interfaceOptions",S.eq3(14,edit_event_c1,S.bMT(4,10,"core.group"))),S.R7$(4),S.Y8G("core-mark-required",!0),S.R7$(),S.JRh(S.bMT(7,12,"core.group")),S.R7$(2),S.Y8G("ngForOf",e.groups)}}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_12_ion_spinner_2_Template(e,n){1&e&&(S.nrm(0,"ion-spinner"),S.nI1(1,"translate")),2&e&&S.BMQ("aria-label",S.bMT(1,1,"core.loading"))}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_12_Template(e,n){if(1&e&&(S.j41(0,"ion-item",9)(1,"ion-label"),S.DNE(2,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_12_ion_spinner_2_Template,2,3,"ion-spinner",18),S.k0s()()),2&e){const e=S.XpG(3);S.R7$(2),S.Y8G("ngIf",e.loadingGroups)}}function AddonCalendarEditEventPage_form_14_ng_container_24_Template(e,n){if(1&e){const e=S.RV6();S.qex(0),S.j41(1,"ion-item",9)(2,"ion-select",40),S.nI1(3,"translate"),S.nI1(4,"translate"),S.nI1(5,"translate"),S.bIt("ionChange",(function AddonCalendarEditEventPage_form_14_ng_container_24_Template_ion_select_ionChange_2_listener(){S.eBV(e);const n=S.XpG(2);return S.Njj(n.groupCourseSelected())})),S.j41(6,"p",11),S.EFF(7),S.nI1(8,"translate"),S.k0s(),S.DNE(9,AddonCalendarEditEventPage_form_14_ng_container_24_ion_select_option_9_Template,2,2,"ion-select-option",37),S.k0s()(),S.DNE(10,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_10_Template,5,3,"ion-item",41)(11,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_11_Template,9,16,"ion-item",42)(12,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_12_Template,3,1,"ion-item",21),S.bVm()}if(2&e){const e=S.XpG(2);S.R7$(2),S.Y8G("placeholder",S.bMT(3,9,"core.noselection"))("cancelText",S.bMT(4,11,"core.cancel"))("interfaceOptions",S.eq3(17,edit_event_c1,S.bMT(5,13,"core.course"))),S.R7$(4),S.Y8G("core-mark-required",!0),S.R7$(),S.JRh(S.bMT(8,15,"core.course")),S.R7$(2),S.Y8G("ngForOf",e.courses),S.R7$(),S.Y8G("ngIf",!e.loadingGroups&&e.courseGroupSet&&!e.groups.length),S.R7$(),S.Y8G("ngIf",!e.loadingGroups&&e.groups.length>0),S.R7$(),S.Y8G("ngIf",e.loadingGroups)}}function AddonCalendarEditEventPage_form_14_ng_container_25_ion_item_9_Template(e,n){if(1&e){const e=S.RV6();S.j41(0,"ion-item",9)(1,"ion-label")(2,"p"),S.EFF(3),S.k0s()(),S.j41(4,"ion-button",47),S.nI1(5,"translate"),S.bIt("click",(function AddonCalendarEditEventPage_form_14_ng_container_25_ion_item_9_Template_ion_button_click_4_listener(){const n=S.eBV(e).$implicit,t=S.XpG(3);return S.Njj(t.removeReminder(n))})),S.nrm(6,"ion-icon",50),S.k0s()()}if(2&e){const e=n.$implicit;S.R7$(3),S.JRh(e.label),S.R7$(),S.Y8G("ariaLabel",S.bMT(5,2,"core.delete"))}}function AddonCalendarEditEventPage_form_14_ng_container_25_Template(e,n){if(1&e){const e=S.RV6();S.qex(0),S.j41(1,"ion-item-divider",46)(2,"ion-label")(3,"p",25),S.EFF(4),S.nI1(5,"translate"),S.k0s()(),S.j41(6,"ion-button",47),S.nI1(7,"translate"),S.bIt("click",(function AddonCalendarEditEventPage_form_14_ng_container_25_Template_ion_button_click_6_listener(){S.eBV(e);const n=S.XpG(2);return S.Njj(n.addReminder())})),S.nrm(8,"ion-icon",48),S.k0s()(),S.DNE(9,AddonCalendarEditEventPage_form_14_ng_container_25_ion_item_9_Template,7,4,"ion-item",49),S.bVm()}if(2&e){const e=S.XpG(2);S.R7$(4),S.JRh(S.bMT(5,3,"addon.calendar.reminders")),S.R7$(2),S.Y8G("ariaLabel",S.bMT(7,5,"addon.calendar.setnewreminder")),S.R7$(3),S.Y8G("ngForOf",e.reminders)}}function AddonCalendarEditEventPage_form_14_ion_item_42_ng_template_4_Template(e,n){if(1&e&&(S.j41(0,"ion-datetime",52)(1,"span",33),S.EFF(2),S.nI1(3,"translate"),S.k0s()()),2&e){const e=S.XpG(3);S.Y8G("max",e.maxDate)("min",e.minDate)("showDefaultButtons",!0),S.R7$(2),S.JRh(S.bMT(3,4,"addon.calendar.durationuntil"))}}function AddonCalendarEditEventPage_form_14_ion_item_42_Template(e,n){1&e&&(S.j41(0,"ion-item"),S.nrm(1,"ion-label",13)(2,"ion-datetime-button",51),S.j41(3,"ion-modal",16),S.DNE(4,AddonCalendarEditEventPage_form_14_ion_item_42_ng_template_4_Template,4,6,"ng-template"),S.k0s()()),2&e&&(S.R7$(3),S.Y8G("keepContentsMounted",!0))}function AddonCalendarEditEventPage_form_14_ion_item_48_Template(e,n){1&e&&(S.j41(0,"ion-item"),S.nrm(1,"ion-input",53),S.nI1(2,"translate"),S.k0s()),2&e&&(S.R7$(),S.Y8G("placeholder",S.bMT(2,1,"addon.calendar.durationminutes")))}function AddonCalendarEditEventPage_form_14_ng_container_49_Template(e,n){if(1&e&&(S.qex(0),S.j41(1,"ion-item",54)(2,"ion-checkbox",55)(3,"p",25),S.EFF(4),S.nI1(5,"translate"),S.k0s()()(),S.j41(6,"ion-item",9),S.nrm(7,"ion-input",56),S.nI1(8,"translate"),S.k0s(),S.bVm()),2&e){const e=S.XpG(2);S.R7$(4),S.JRh(S.bMT(5,3,"addon.calendar.repeatevent")),S.R7$(3),S.Y8G("label",S.bMT(8,5,"addon.calendar.repeatweeksl"))("disabled",!e.form.controls.repeat.value)}}function AddonCalendarEditEventPage_form_14_div_50_Template(e,n){if(1&e&&(S.j41(0,"div",22)(1,"ion-radio-group",57)(2,"ion-item-divider",24)(3,"ion-label")(4,"p",25),S.EFF(5),S.nI1(6,"translate"),S.k0s()()(),S.j41(7,"ion-item",9)(8,"ion-radio",26),S.EFF(9),S.nI1(10,"translate"),S.k0s()(),S.j41(11,"ion-item",9)(12,"ion-radio",26),S.EFF(13),S.nI1(14,"translate"),S.k0s()()()()),2&e){const e=S.XpG(2);S.R7$(5),S.JRh(S.bMT(6,5,"addon.calendar.repeatedevents")),S.R7$(3),S.Y8G("value",1),S.R7$(),S.SpI(" ",S.i5U(10,7,"addon.calendar.repeateditall",S.eq3(12,_c2,e.otherEventsCount))," "),S.R7$(3),S.Y8G("value",0),S.R7$(),S.SpI(" ",S.bMT(14,10,"addon.calendar.repeateditthis")," ")}}function AddonCalendarEditEventPage_form_14_Template(e,n){if(1&e&&(S.j41(0,"form",8,0)(2,"ion-item",9)(3,"ion-input",10),S.nI1(4,"translate"),S.j41(5,"div",11),S.EFF(6),S.nI1(7,"translate"),S.k0s()(),S.nrm(8,"core-input-errors",12),S.k0s(),S.j41(9,"ion-item",9)(10,"ion-label",13)(11,"label",14),S.EFF(12),S.nI1(13,"translate"),S.k0s()(),S.nrm(14,"ion-datetime-button",15),S.j41(15,"ion-modal",16),S.DNE(16,AddonCalendarEditEventPage_form_14_ng_template_16_Template,4,6,"ng-template"),S.k0s(),S.nrm(17,"core-input-errors",12),S.k0s(),S.j41(18,"ion-item",17),S.DNE(19,AddonCalendarEditEventPage_form_14_ion_label_19_Template,4,4,"ion-label",18)(20,AddonCalendarEditEventPage_form_14_p_20_Template,3,3,"p",19)(21,AddonCalendarEditEventPage_form_14_ion_select_21_Template,7,13,"ion-select",20),S.k0s(),S.DNE(22,AddonCalendarEditEventPage_form_14_ion_item_22_Template,9,16,"ion-item",21)(23,AddonCalendarEditEventPage_form_14_ion_item_23_Template,9,16,"ion-item",21)(24,AddonCalendarEditEventPage_form_14_ng_container_24_Template,13,19,"ng-container",18)(25,AddonCalendarEditEventPage_form_14_ng_container_25_Template,10,7,"ng-container",18),S.j41(26,"div",22)(27,"ion-radio-group",23)(28,"ion-item-divider",24)(29,"ion-label")(30,"p",25),S.EFF(31),S.nI1(32,"translate"),S.k0s()()(),S.j41(33,"ion-item")(34,"ion-radio",26),S.EFF(35),S.nI1(36,"translate"),S.k0s()(),S.j41(37,"ion-item")(38,"ion-radio",26)(39,"label",27),S.EFF(40),S.nI1(41,"translate"),S.k0s()()(),S.DNE(42,AddonCalendarEditEventPage_form_14_ion_item_42_Template,5,1,"ion-item",18),S.j41(43,"ion-item")(44,"ion-radio",26)(45,"label",28),S.EFF(46),S.nI1(47,"translate"),S.k0s()()(),S.DNE(48,AddonCalendarEditEventPage_form_14_ion_item_48_Template,3,3,"ion-item",18),S.k0s()(),S.DNE(49,AddonCalendarEditEventPage_form_14_ng_container_49_Template,9,7,"ng-container",18)(50,AddonCalendarEditEventPage_form_14_div_50_Template,15,14,"div",29),S.j41(51,"ion-item",9)(52,"ion-label",13)(53,"p",25),S.EFF(54),S.nI1(55,"translate"),S.k0s()(),S.nrm(56,"core-rich-text-editor",30),S.nI1(57,"translate"),S.nI1(58,"translate"),S.k0s(),S.j41(59,"ion-item",9),S.nrm(60,"ion-input",31),S.nI1(61,"translate"),S.nI1(62,"translate"),S.k0s()()),2&e){const e=S.XpG();S.Y8G("formGroup",e.form),S.R7$(3),S.Y8G("placeholder",S.bMT(4,36,"addon.calendar.eventname")),S.R7$(2),S.Y8G("core-mark-required",!0),S.R7$(),S.JRh(S.bMT(7,38,"addon.calendar.eventname")),S.R7$(2),S.Y8G("control",e.form.controls.name),S.R7$(3),S.Y8G("core-mark-required",!0),S.R7$(),S.JRh(S.bMT(13,40,"core.date")),S.R7$(3),S.Y8G("keepContentsMounted",!0),S.R7$(2),S.Y8G("control",e.form.controls.timestart),S.R7$(2),S.Y8G("ngIf",1===e.eventTypes.length),S.R7$(),S.Y8G("ngIf",1===e.eventTypes.length),S.R7$(),S.Y8G("ngIf",e.eventTypes.length>1),S.R7$(),S.Y8G("ngIf","category"===e.typeControl.value),S.R7$(),S.Y8G("ngIf","course"===e.typeControl.value),S.R7$(),S.Y8G("ngIf","group"===e.typeControl.value),S.R7$(),S.Y8G("ngIf",e.remindersEnabled&&!e.eventId),S.R7$(6),S.JRh(S.bMT(32,42,"addon.calendar.eventduration")),S.R7$(3),S.Y8G("value",0),S.R7$(),S.SpI(" ",S.bMT(36,44,"addon.calendar.durationnone")," "),S.R7$(3),S.Y8G("value",1),S.R7$(2),S.JRh(S.bMT(41,46,"addon.calendar.durationuntil")),S.R7$(2),S.Y8G("ngIf",1===e.form.controls.duration.value),S.R7$(2),S.Y8G("value",2),S.R7$(2),S.JRh(S.bMT(47,48,"addon.calendar.durationminutes")),S.R7$(2),S.Y8G("ngIf",2===e.form.controls.duration.value),S.R7$(),S.Y8G("ngIf",!e.eventId||e.eventId<0),S.R7$(),S.Y8G("ngIf",e.eventRepeatId),S.R7$(4),S.JRh(S.bMT(55,50,"core.description")),S.R7$(2),S.Y8G("control",e.descriptionControl)("placeholder",S.bMT(57,52,"core.description"))("component",e.component)("componentId",e.eventId)("autoSave",!1),S.BMQ("aria-label",S.bMT(58,54,"core.description")),S.R7$(4),S.Y8G("placeholder",S.bMT(61,56,"core.location"))("label",S.bMT(62,58,"core.location"))}}function AddonCalendarEditEventPage_div_15_Template(e,n){if(1&e){const e=S.RV6();S.j41(0,"div",58)(1,"div",59)(2,"ion-button",60),S.bIt("click",(function AddonCalendarEditEventPage_div_15_Template_ion_button_click_2_listener(){S.eBV(e);const n=S.XpG();return S.Njj(n.submit())})),S.EFF(3),S.nI1(4,"translate"),S.k0s()()()}if(2&e){const e=S.XpG();S.R7$(2),S.Y8G("disabled",!e.form.valid),S.R7$(),S.SpI(" ",S.bMT(4,2,"core.save")," ")}}let _e=(()=>{var e;class AddonCalendarEditEventPage{constructor(e){this.fb=e,this.title="addon.calendar.newevent",this.component=O.QX,this.loaded=!1,this.hasOffline=!1,this.eventTypes=[],this.categories=[],this.courses=[],this.groups=[],this.loadingGroups=!1,this.courseGroupSet=!1,this.error=!1,this.otherEventsCount=0,this.remindersEnabled=!1,this.reminders=[],this.types={},this.showAll=!1,this.isDestroyed=!1,this.gotEventData=!1,this.currentSite=l.CoreSites.getRequiredCurrentSite(),this.remindersEnabled=oe.X.isEnabled(),this.form=new H.gE({}),this.typeControl=this.fb.control(null,H.k0.required),this.groupControl=this.fb.control(null),this.descriptionControl=this.fb.control("",{nonNullable:!0}),this.form.addControl("name",this.fb.control("",H.k0.required)),this.form.addControl("eventtype",this.typeControl),this.form.addControl("categoryid",this.fb.control("")),this.form.addControl("groupcourseid",this.fb.control("")),this.form.addControl("groupid",this.groupControl),this.form.addControl("description",this.descriptionControl),this.form.addControl("location",this.fb.control("")),this.form.addControl("duration",this.fb.control(0)),this.form.addControl("timedurationminutes",this.fb.control("")),this.form.addControl("repeat",this.fb.control(!1)),this.form.addControl("repeats",this.fb.control({value:"1",disabled:!0})),this.form.addControl("repeateditall",this.fb.control(1)),this.maxDate=c.CoreTimeUtils.getDatetimeDefaultMax(),this.minDate=c.CoreTimeUtils.getDatetimeDefaultMin()}ngOnInit(){this.eventId=I.CoreNavigator.getRouteNumberParam("eventId")||void 0,this.courseId=I.CoreNavigator.getRouteNumberParam("courseId")||0,this.title=this.eventId?"addon.calendar.editevent":"addon.calendar.newevent";const e=I.CoreNavigator.getRouteNumberParam("timestamp"),n=c.CoreTimeUtils.toDatetimeFormat(e);this.form.addControl("timestart",this.fb.control(n,H.k0.required)),this.form.addControl("timedurationuntil",this.fb.control(n)),this.form.addControl("courseid",this.fb.control(this.courseId)),this.initReminders(),this.fetchData().finally((()=>{this.originalData=K.j.clone(this.form.value),this.loaded=!0}))}fetchData(){var e=this;return(0,r.A)((function*(){e.error=!1;try{const[n,t]=yield Promise.all([m.AddonCalendar.getAllowedEventTypes(e.courseId),de.g.ignoreErrors(m.AddonCalendar.getAccessInformation(e.courseId),{canmanageentries:!1,canmanageownentries:!1,canmanagegroupentries:!1})]);e.types=n;const o=[],a=_.AddonCalendarHelper.getEventTypeOptions(e.types);if(!a.length)throw new ne.CoreError(C.HT.instant("addon.calendar.nopermissiontoupdatecalendar"));if(e.eventId&&!e.gotEventData){const n=e.eventId;o.push(f.AddonCalendarSync.waitForSync(O.w).then((0,r.A)((function*(){let t;!e.isDestroyed&&e.eventId&&Q.CoreSync.blockOperation(O.QX,n);try{t=yield u.AddonCalendarOffline.getEvent(n),e.hasOffline=!0}catch{e.hasOffline=!1}if(n>0){const o=yield m.AddonCalendar.getEventById(n);t||(t=o),e.eventRepeatId=null==o?void 0:o.repeatid,e.eventRepeatId&&(e.otherEventsCount=o.eventcount?o.eventcount-1:0)}if(e.gotEventData=!0,t)return e.loadEventData(t,e.hasOffline)}))))}e.types.category&&o.push(e.fetchCategories()),e.showAll=K.j.isTrueOrOne(e.currentSite.getStoredConfig("calendar_adminseesall"))&&t.canmanageentries,(e.types.course||e.types.groups)&&o.push(e.fetchCourses()),yield Promise.all(o),e.typeControl.value||e.typeControl.setValue(e.types.course?O.rz.COURSE:a[0].value),e.eventTypes=a}catch(n){s.CoreDomUtils.showErrorModalDefault(n,"Error getting data."),e.error=!0}}))()}fetchCategories(){var e=this;return(0,r.A)((function*(){e.categories=yield g.CoreCourses.getCategories(0,!0)}))()}fetchCourses(){var e=this;return(0,r.A)((function*(){let n=yield e.showAll?g.CoreCourses.getCoursesByField():g.CoreCourses.getUserCourses();if(n.length<0)return e.courses=[],void 0;const t=function(){var e=(0,r.A)((function*(e){try{const n=yield ee.CoreFilterHelper.getFiltersAndFormatText(e.fullname,"course",e.id);e.fullname=n.text}catch{}}));return function courseFillFullname(n){return e.apply(this,arguments)}}();if(e.showAll){const e=l.CoreSites.getCurrentSiteHomeId();n=("contacts"in n[0],n.filter((n=>n.id!=e)))}"contacts"in n[0],yield Promise.all(n.map(t)),e.courses=n.sort(((e,n)=>{const t=e.fullname.toLowerCase(),o=n.fullname.toLowerCase();return t.localeCompare(o)}))}))()}loadEventData(e,n){var t=this;return(0,r.A)((function*(){var o;if(!e)return;const a=e,r=e,i=n?a.courseid:null===(o=r.course)||void 0===o?void 0:o.id;t.form.controls.name.setValue(e.name),t.form.controls.timestart.setValue(c.CoreTimeUtils.toDatetimeFormat(1e3*e.timestart)),t.typeControl.setValue(e.eventtype),t.form.controls.categoryid.setValue(e.categoryid||""),t.form.controls.courseid.setValue(i||""),t.form.controls.groupcourseid.setValue(i||""),t.groupControl.setValue(e.groupid||null),t.form.controls.description.setValue(e.description),t.form.controls.location.setValue(e.location),n?(t.form.controls.duration.setValue(a.duration),t.form.controls.timedurationuntil.setValue(c.CoreTimeUtils.toDatetimeFormat(1e3*(a.timedurationuntil||0)||Date.now())),t.form.controls.timedurationminutes.setValue(a.timedurationminutes||""),t.form.controls.repeat.setValue(!!a.repeat),t.form.controls.repeats.setValue(a.repeats||"1"),t.form.controls.repeateditall.setValue(a.repeateditall||1)):(r.timeduration>0?(t.form.controls.duration.setValue(1),t.form.controls.timedurationuntil.setValue(c.CoreTimeUtils.toDatetimeFormat(1e3*(r.timestart+r.timeduration)))):(t.form.controls.duration.setValue(0),t.form.controls.timedurationuntil.setValue(c.CoreTimeUtils.toDatetimeFormat())),t.form.controls.timedurationminutes.setValue(""),t.form.controls.repeat.setValue(!!r.repeatid),t.form.controls.repeats.setValue(r.eventcount||"1"),t.form.controls.repeateditall.setValue(1)),e.eventtype===O.rz.GROUP&&i&&(yield t.loadGroups(i))}))()}refreshData(e){const n=[m.AddonCalendar.invalidateAccessInformation(this.courseId),m.AddonCalendar.invalidateAllowedEventTypes(this.courseId)];this.types&&(this.types.category&&n.push(g.CoreCourses.invalidateCategories(0,!0)),(this.types.course||this.types.groups)&&n.push(this.showAll?g.CoreCourses.invalidateCoursesByField():g.CoreCourses.invalidateUserCourses())),Promise.all(n).finally((()=>{this.fetchData().finally((()=>{null==e||e.complete()}))}))}groupCourseSelected(){var e=this;return(0,r.A)((function*(){const n=e.form.controls.groupcourseid.value;if(!n)return;const t=yield re.CoreLoadings.show();try{yield e.loadGroups(n),e.groupControl.setValue(null)}catch(e){s.CoreDomUtils.showErrorModalDefault(e,"Error getting data.")}t.dismiss()}))()}loadGroups(e){var n=this;return(0,r.A)((function*(){n.loadingGroups=!0;try{n.groups=yield W.CoreGroups.getUserGroupsInCourse(e),n.courseGroupSet=!0}finally{n.loadingGroups=!1}}))()}selectDuration(e){this.form.controls.duration.setValue(e)}submit(){var e=this;return(0,r.A)((function*(){const n=e.form.value,t=h()(n.timestart).unix(),o=h()(n.timedurationuntil).unix(),a=parseInt(n.timedurationminutes||"",10);let r;if((n.eventtype!==O.rz.COURSE||n.courseid)&&(n.eventtype!==O.rz.GROUP||n.groupcourseid)?n.eventtype!==O.rz.GROUP||n.groupid?n.eventtype!==O.rz.CATEGORY||n.categoryid?1===n.duration&&t>o?r="addon.calendar.invalidtimedurationuntil":2===n.duration&&(isNaN(a)||a<1)&&(r="addon.calendar.invalidtimedurationminutes"):r="core.selectacategory":r="core.selectagroup":r="core.selectacourse",r)return s.CoreDomUtils.showErrorModal(C.HT.instant(r)),void 0;const i={name:n.name,eventtype:n.eventtype,timestart:t,description:{text:n.description||"",format:1,itemid:0},location:n.location,duration:n.duration,repeat:n.repeat};n.eventtype===O.rz.COURSE?i.courseid=n.courseid:n.eventtype===O.rz.GROUP?(i.groupcourseid=n.groupcourseid,i.groupid=n.groupid):n.eventtype===O.rz.CATEGORY&&(i.categoryid=n.categoryid),1==n.duration?i.timedurationuntil=o:2==n.duration&&(i.timedurationminutes=n.timedurationminutes),n.repeat&&(i.repeats=Number(n.repeats)),e.eventRepeatId&&(i.repeatid=e.eventRepeatId,i.repeateditall=n.repeateditall);const d=yield re.CoreLoadings.show("core.sending",!0);let l;try{const t=yield m.AddonCalendar.submitEvent(e.eventId,i,{reminders:e.eventId?[]:e.reminders});if(l=t.event,te.R.triggerFormSubmittedEvent(e.formElement,t.sent,e.currentSite.getId()),t.sent){const o=n.repeat?n.repeats:i.repeateditall&&e.otherEventsCount?e.otherEventsCount+1:1;try{yield _.AddonCalendarHelper.refreshAfterChangeEvent(t.event,o)}catch{}}e.returnToList(l)}catch(r){s.CoreDomUtils.showErrorModalDefault(r,"Error sending data.")}d.dismiss()}))()}returnToList(e){this.unblockSync(),this.eventId&&this.eventId>0?d.z.trigger(O.bp,{eventId:this.eventId},this.currentSite.getId()):d.z.trigger(O.zl,{eventId:e.id,oldEventId:this.eventId},this.currentSite.getId()),this.originalData=void 0,I.CoreNavigator.back()}canLeave(){var e=this;return(0,r.A)((function*(){return _.AddonCalendarHelper.hasEventDataChanged(e.form.value,e.originalData)&&(yield s.CoreDomUtils.showConfirm(C.HT.instant("core.confirmcanceledit"))),te.R.triggerFormCancelledEvent(e.formElement,e.currentSite.getId()),!0}))()}unblockSync(){this.eventId&&Q.CoreSync.unblockOperation(O.QX,this.eventId)}initReminders(){var e=this;return(0,r.A)((function*(){if(!e.remindersEnabled||e.eventId)return;const n=yield oe.X.getDefaultNotificationTime(e.currentSite.getId());if(n===ie.Nc)return;const t=oe.S.convertSecondsToValueAndUnit(n);e.reminders.push({value:t.value,unit:t.unit,label:oe.X.getUnitValueLabel(t.value,t.unit,!0)})}))()}addReminder(){var e=this;return(0,r.A)((function*(){const n=e.form.value,o=h()(n.timestart).unix(),{CoreRemindersSetReminderMenuComponent:a}=yield t.e(4260).then(t.bind(t,64260)),r=yield ae.CorePopovers.open({component:a,componentProps:{eventTime:o}});if(void 0===r)return;const i=oe.S.convertSecondsToValueAndUnit(r.timeBefore);e.reminders.push({time:r.timeBefore,value:i.value,unit:i.unit,label:oe.X.getUnitValueLabel(i.value,i.unit)})}))()}removeReminder(e){const n=this.reminders.indexOf(e);-1!==n&&this.reminders.splice(n,1)}ngOnDestroy(){this.unblockSync(),this.isDestroyed=!0}}return(e=AddonCalendarEditEventPage).ɵfac=function AddonCalendarEditEventPage_Factory(n){return new(n||e)(S.rXU(H.ok))},e.ɵcmp=S.VBU({type:e,selectors:[["page-addon-calendar-edit-event"]],viewQuery:function AddonCalendarEditEventPage_Query(e,n){if(1&e&&(S.GBs(Z.u,5),S.GBs(ue,5)),2&e){let e;S.mGM(e=S.lsd())&&(n.descriptionEditor=e.first),S.mGM(e=S.lsd())&&(n.formElement=e.first)}},decls:16,vars:13,consts:[["editEventForm",""],["slot","start"],[3,"text"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[3,"formGroup",4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],[3,"formGroup"],[1,"ion-text-wrap"],["labelPlacement","stacked","type","text","name","name","formControlName","name",3,"placeholder"],["slot","label",3,"core-mark-required"],[3,"control"],["position","stacked"],["for","timestart-button",1,"item-heading",3,"core-mark-required"],["datetime","timestart","id","timestart-button"],[3,"keepContentsMounted"],[1,"ion-text-wrap","addon-calendar-eventtype-container"],[4,"ngIf"],["slot","end",4,"ngIf"],["formControlName","eventtype","interface","action-sheet",3,"cancelText","interfaceOptions",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],[1,"ion-text-wrap","addon-calendar-radio-container"],["formControlName","duration"],[1,"addon-calendar-radio-title"],[1,"item-heading"],[3,"value"],["for","timedurationuntil-button"],["for","timedurationminutes"],["class","ion-text-wrap addon-calendar-radio-container",4,"ngIf"],["name","description",3,"control","placeholder","component","componentId","autoSave"],["type","text","name","location","labelPlacement","stacked","formControlName","location",3,"placeholder","label"],["id","timestart","formControlName","timestart","presentation","date-time",3,"max","min","showDefaultButtons"],["slot","title"],[1,"item-heading",3,"core-mark-required"],["slot","end"],["formControlName","eventtype","interface","action-sheet",3,"cancelText","interfaceOptions"],[3,"value",4,"ngFor","ngForOf"],["formControlName","categoryid","interface","action-sheet",3,"placeholder","cancelText","interfaceOptions"],["formControlName","courseid","interface","action-sheet",3,"placeholder","cancelText","interfaceOptions"],["formControlName","groupcourseid","interface","action-sheet",3,"ionChange","placeholder","cancelText","interfaceOptions"],["class","ion-text-wrap core-danger-item",4,"ngIf"],["class","ion-text-wrap core-edit-set-group",4,"ngIf"],[1,"ion-text-wrap","core-danger-item"],[1,"ion-text-wrap","core-edit-set-group"],["formControlName","groupid","interface","action-sheet",3,"placeholder","cancelText","interfaceOptions"],[1,"addon-calendar-reminders-title"],["fill","clear","slot","end",3,"click","ariaLabel"],["name","fas-plus","slot","icon-only","aria-hidden","true"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["name","fas-trash","color","danger","slot","icon-only","aria-hidden","true"],["datetime","timedurationuntil","id","timedurationuntil-button"],["id","timedurationuntil","formControlName","timedurationuntil","presentation","date-time",3,"max","min","showDefaultButtons"],["type","number","name","timedurationminutes","labelPlacement","start","id","timedurationminutes","formControlName","timedurationminutes",3,"placeholder"],[1,"ion-text-wrap","divider"],["labelPlacement","start","formControlName","repeat"],["labelPlacement","stacked","type","number","name","repeats","formControlName","repeats",3,"label","disabled"],["formControlName","repeateditall"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"list-item-limited-width","adaptable-buttons-row"],["expand","block","type","submit",1,"ion-margin","ion-text-wrap",3,"click","disabled"]],template:function AddonCalendarEditEventPage_Template(e,n){1&e&&(S.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),S.nrm(3,"ion-back-button",2),S.nI1(4,"translate"),S.k0s(),S.j41(5,"ion-title")(6,"h1"),S.EFF(7),S.nI1(8,"translate"),S.k0s()()()(),S.j41(9,"ion-content")(10,"ion-refresher",3),S.bIt("ionRefresh",(function AddonCalendarEditEventPage_Template_ion_refresher_ionRefresh_10_listener(e){return n.refreshData(e.target)})),S.nrm(11,"ion-refresher-content",4),S.nI1(12,"translate"),S.k0s(),S.j41(13,"core-loading",5),S.DNE(14,AddonCalendarEditEventPage_form_14_Template,63,60,"form",6)(15,AddonCalendarEditEventPage_div_15_Template,5,4,"div",7),S.k0s()()),2&e&&(S.R7$(3),S.Y8G("text",S.bMT(4,7,"core.back")),S.R7$(4),S.JRh(S.bMT(8,9,n.title)),S.R7$(3),S.Y8G("disabled",!n.loaded),S.R7$(),S.FS9("pullingText",S.bMT(12,11,"core.pulltorefresh")),S.R7$(2),S.Y8G("hideUntil",n.loaded),S.R7$(),S.Y8G("ngIf",!n.error),S.R7$(),S.Y8G("ngIf",n.loaded&&!n.error))},dependencies:[$.Sq,$.bT,le.q,N.R,se.j,L.t,ce.i,B.i,X.T,me.E,H.qT,H.BC,H.cb,z.Jm,z.QW,z.eY,z.W9,z.A9,z.K4,z.eU,z.iq,z.$w,z.uz,z.Dg,z.he,z.KO,z.f0,z.To,z.Ki,z.Nm,z.Ip,z.w2,z.BC,z.ai,z.Sb,z.hB,z.su,z.Je,z.Gw,z.el,H.j4,H.JD,Z.u,J.D9],styles:["[_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{opacity:1}[_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]::part(icon){display:none}"]}),AddonCalendarEditEventPage})();var fe=t(75383),ge=t(44682),ve=t(52266),pe=t(67935),he=t(18022),Ce=t(85190),Ie=t(45433),be=t(21182),Ee=t(23007),ye=t(68273),Te=t(28988),Ae=t(32885);const event_c0=e=>[e],event_c1=e=>({$a:e});function AddonCalendarEventPage_h1_6_Template(e,n){if(1&e&&(S.j41(0,"h1"),S.nrm(1,"core-format-text",14),S.k0s()),2&e){const e=S.XpG();S.R7$(),S.Y8G("text",e.event.name)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId)}}function AddonCalendarEventPage_ion_list_22_core_mod_icon_2_Template(e,n){if(1&e&&S.nrm(0,"core-mod-icon",28),2&e){const e=S.XpG(2);S.Y8G("modicon",e.event.moduleIcon)("showAlt",!1)("modname",e.event.modulename)("componentId",e.event.instance)("purpose",e.event.purpose)("isBranded",e.event.branded)}}function AddonCalendarEventPage_ion_list_22_ion_icon_3_Template(e,n){if(1&e&&S.nrm(0,"ion-icon",29),2&e){const e=S.XpG(2);S.Y8G("name",e.event.eventIcon)}}function AddonCalendarEventPage_ion_list_22_span_8_Template(e,n){if(1&e&&(S.j41(0,"span",18),S.EFF(1),S.k0s()),2&e){const e=S.XpG(2);S.R7$(),S.JRh(e.event.iconTitle)}}function AddonCalendarEventPage_ion_list_22_ion_card_11_Template(e,n){1&e&&(S.j41(0,"ion-card",30)(1,"ion-item"),S.nrm(2,"ion-icon",31),S.j41(3,"ion-label"),S.EFF(4),S.nI1(5,"translate"),S.nI1(6,"translate"),S.k0s()()()),2&e&&(S.R7$(4),S.JRh(S.i5U(6,3,"core.hasdatatosync",S.eq3(6,event_c1,S.bMT(5,1,"addon.calendar.calendarevent")))))}function AddonCalendarEventPage_ion_list_22_ion_note_18_Template(e,n){1&e&&(S.j41(0,"ion-note",4),S.nrm(1,"ion-icon",32),S.EFF(2),S.nI1(3,"translate"),S.k0s()),2&e&&(S.R7$(2),S.SpI(" ",S.bMT(3,1,"core.deletedoffline")," "))}function AddonCalendarEventPage_ion_list_22_ion_item_27_Template(e,n){if(1&e&&(S.j41(0,"ion-item",33)(1,"ion-label")(2,"p",22),S.EFF(3),S.nI1(4,"translate"),S.k0s(),S.j41(5,"p"),S.nrm(6,"core-format-text",34),S.k0s()()()),2&e){const e=S.XpG(2);S.Y8G("href",e.courseUrl)("detail",!0),S.R7$(3),S.JRh(S.bMT(4,5,"core.course")),S.R7$(3),S.Y8G("text",e.courseName)("contextInstanceId",e.courseId)}}function AddonCalendarEventPage_ion_list_22_ion_item_28_Template(e,n){if(1&e&&(S.j41(0,"ion-item",35)(1,"ion-label")(2,"p",22),S.EFF(3),S.nI1(4,"translate"),S.k0s(),S.j41(5,"p"),S.nrm(6,"core-format-text",34),S.k0s()()()),2&e){const e=S.XpG(2);S.R7$(3),S.JRh(S.bMT(4,3,"core.group")),S.R7$(3),S.Y8G("text",e.groupName)("contextInstanceId",e.event.courseid)}}function AddonCalendarEventPage_ion_list_22_ion_item_29_Template(e,n){if(1&e&&(S.j41(0,"ion-item",21)(1,"ion-label")(2,"p",22),S.EFF(3),S.nI1(4,"translate"),S.k0s(),S.j41(5,"p"),S.nrm(6,"core-format-text",36),S.k0s()()()),2&e){const e=S.XpG(2);S.R7$(3),S.JRh(S.bMT(4,3,"core.category")),S.R7$(3),S.Y8G("text",e.categoryPath)("contextInstanceId",e.event.categoryid)}}function AddonCalendarEventPage_ion_list_22_ion_item_30_Template(e,n){if(1&e&&(S.j41(0,"ion-item",21)(1,"ion-label")(2,"p",22),S.EFF(3),S.nI1(4,"translate"),S.k0s(),S.j41(5,"p"),S.nrm(6,"core-format-text",14),S.k0s()()()),2&e){const e=S.XpG(2);S.R7$(3),S.JRh(S.bMT(4,4,"core.description")),S.R7$(3),S.Y8G("text",e.event.description)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId)}}function AddonCalendarEventPage_ion_list_22_ion_item_31_Template(e,n){if(1&e&&(S.j41(0,"ion-item",21)(1,"ion-label")(2,"p",22),S.EFF(3),S.nI1(4,"translate"),S.k0s(),S.j41(5,"p")(6,"a",37),S.nrm(7,"core-format-text",14),S.k0s()()()()),2&e){const e=S.XpG(2);S.R7$(3),S.JRh(S.bMT(4,6,"core.location")),S.R7$(3),S.Y8G("href",e.event.encodedLocation,S.B4B)("autoLogin",!1),S.R7$(),S.Y8G("text",e.event.location)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId)}}function AddonCalendarEventPage_ion_list_22_ion_item_32_Template(e,n){if(1&e&&(S.j41(0,"ion-item")(1,"ion-label")(2,"ion-button",38),S.EFF(3),S.nI1(4,"translate"),S.k0s()()()),2&e){const e=S.XpG(2);S.R7$(2),S.Y8G("href",e.moduleUrl),S.R7$(),S.SpI(" ",S.bMT(4,2,"addon.calendar.gotoactivity")," ")}}function AddonCalendarEventPage_ion_list_22_Template(e,n){if(1&e&&(S.j41(0,"ion-list")(1,"ion-item",15),S.DNE(2,AddonCalendarEventPage_ion_list_22_core_mod_icon_2_Template,1,6,"core-mod-icon",16)(3,AddonCalendarEventPage_ion_list_22_ion_icon_3_Template,1,1,"ion-icon",17),S.j41(4,"ion-label")(5,"span",18),S.EFF(6),S.nI1(7,"translate"),S.DNE(8,AddonCalendarEventPage_ion_list_22_span_8_Template,2,1,"span",19),S.k0s(),S.j41(9,"h1"),S.nrm(10,"core-format-text",14),S.k0s()()(),S.DNE(11,AddonCalendarEventPage_ion_list_22_ion_card_11_Template,7,8,"ion-card",20),S.j41(12,"ion-item",21)(13,"ion-label")(14,"p",22),S.EFF(15),S.nI1(16,"translate"),S.k0s(),S.nrm(17,"core-format-text",23),S.k0s(),S.DNE(18,AddonCalendarEventPage_ion_list_22_ion_note_18_Template,4,3,"ion-note",24),S.k0s(),S.j41(19,"ion-item")(20,"ion-label")(21,"p",22),S.EFF(22),S.nI1(23,"translate"),S.k0s(),S.j41(24,"p"),S.EFF(25),S.nI1(26,"translate"),S.k0s()()(),S.DNE(27,AddonCalendarEventPage_ion_list_22_ion_item_27_Template,7,7,"ion-item",25)(28,AddonCalendarEventPage_ion_list_22_ion_item_28_Template,7,5,"ion-item",26)(29,AddonCalendarEventPage_ion_list_22_ion_item_29_Template,7,5,"ion-item",27)(30,AddonCalendarEventPage_ion_list_22_ion_item_30_Template,7,6,"ion-item",27)(31,AddonCalendarEventPage_ion_list_22_ion_item_31_Template,8,8,"ion-item",27)(32,AddonCalendarEventPage_ion_list_22_ion_item_32_Template,5,4,"ion-item",3),S.k0s()),2&e){const e=S.XpG();S.R7$(),S.Y8G("ngClass",S.eq3(29,event_c0,"addon-calendar-eventtype-"+e.event.eventtype)),S.R7$(),S.Y8G("ngIf",e.event.moduleIcon),S.R7$(),S.Y8G("ngIf",e.event.eventIcon&&!e.event.moduleIcon),S.R7$(3),S.SpI(" ",S.bMT(7,21,"addon.calendar.type"+e.event.formattedType)," "),S.R7$(2),S.Y8G("ngIf",e.event.moduleIcon&&e.event.iconTitle),S.R7$(2),S.Y8G("text",e.event.name)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId),S.R7$(),S.Y8G("ngIf",e.hasOffline||e.event.deleted),S.R7$(4),S.JRh(S.bMT(16,23,"addon.calendar.when")),S.R7$(2),S.Y8G("text",e.event.formattedtime)("filter",!1),S.R7$(),S.Y8G("ngIf",e.event.deleted),S.R7$(4),S.JRh(S.bMT(23,25,"addon.calendar.eventtype")),S.R7$(3),S.JRh(S.bMT(26,27,"addon.calendar.type"+e.event.formattedType)),S.R7$(2),S.Y8G("ngIf",e.courseName),S.R7$(),S.Y8G("ngIf",e.groupName),S.R7$(),S.Y8G("ngIf",e.categoryPath),S.R7$(),S.Y8G("ngIf",e.event.description),S.R7$(),S.Y8G("ngIf",e.event.location),S.R7$(),S.Y8G("ngIf",e.moduleUrl)}}function AddonCalendarEventPage_ion_card_23_Template(e,n){if(1&e){const e=S.RV6();S.j41(0,"ion-card",39)(1,"ion-item",21),S.nrm(2,"ion-icon",40),S.j41(3,"ion-label")(4,"p")(5,"strong"),S.EFF(6),S.nI1(7,"translate"),S.k0s()(),S.j41(8,"p"),S.EFF(9),S.nI1(10,"translate"),S.k0s()()(),S.j41(11,"div",41)(12,"ion-button",42),S.bIt("click",(function AddonCalendarEventPage_ion_card_23_Template_ion_button_click_12_listener(){S.eBV(e);const n=S.XpG();return S.Njj(n.hideAlarmWarning())})),S.EFF(13),S.nI1(14,"translate"),S.nI1(15,"coreNoPeriod"),S.k0s(),S.j41(16,"ion-button",43),S.bIt("click",(function AddonCalendarEventPage_ion_card_23_Template_ion_button_click_16_listener(){S.eBV(e);const n=S.XpG();return S.Njj(n.openAlarmSettings())})),S.EFF(17),S.nI1(18,"translate"),S.k0s()()()}2&e&&(S.R7$(6),S.JRh(S.bMT(7,4,"core.exactalarmsturnedoff")),S.R7$(3),S.JRh(S.bMT(10,6,"core.exactalarmsturnedoffmessage")),S.R7$(4),S.SpI(" ",S.bMT(15,10,S.bMT(14,8,"core.dontshowagain"))," "),S.R7$(4),S.JRh(S.bMT(18,12,"core.turnon")))}function AddonCalendarEventPage_ion_card_24_ng_container_6_ion_item_1_p_4_Template(e,n){if(1&e&&(S.j41(0,"p"),S.EFF(1),S.k0s()),2&e){const e=S.XpG(2).$implicit;S.R7$(),S.JRh(e.sublabel)}}function AddonCalendarEventPage_ion_card_24_ng_container_6_ion_item_1_Template(e,n){if(1&e){const e=S.RV6();S.j41(0,"ion-item",21)(1,"ion-label")(2,"p",22),S.EFF(3),S.k0s(),S.DNE(4,AddonCalendarEventPage_ion_card_24_ng_container_6_ion_item_1_p_4_Template,2,1,"p",3),S.k0s(),S.j41(5,"ion-button",46),S.nI1(6,"translate"),S.bIt("click",(function AddonCalendarEventPage_ion_card_24_ng_container_6_ion_item_1_Template_ion_button_click_5_listener(n){S.eBV(e);const t=S.XpG().$implicit,o=S.XpG(2);return S.Njj(o.deleteReminder(t.id,n))})),S.nrm(7,"ion-icon",47),S.k0s()()}if(2&e){const e=S.XpG().$implicit,n=S.XpG(2);S.AVh("item-dimmed",e.timestamp<=n.currentTime),S.R7$(3),S.JRh(e.label),S.R7$(),S.Y8G("ngIf",e.sublabel),S.R7$(),S.Y8G("ariaLabel",S.bMT(6,5,"core.delete"))}}function AddonCalendarEventPage_ion_card_24_ng_container_6_Template(e,n){if(1&e&&(S.qex(0),S.DNE(1,AddonCalendarEventPage_ion_card_24_ng_container_6_ion_item_1_Template,8,7,"ion-item",45),S.bVm()),2&e){const e=n.$implicit;S.R7$(),S.Y8G("ngIf",e.timestamp>0)}}function AddonCalendarEventPage_ion_card_24_ng_container_7_Template(e,n){if(1&e){const e=S.RV6();S.qex(0),S.j41(1,"ion-item")(2,"ion-label")(3,"ion-button",48),S.bIt("click",(function AddonCalendarEventPage_ion_card_24_ng_container_7_Template_ion_button_click_3_listener(){S.eBV(e);const n=S.XpG(2);return S.Njj(n.addReminder())})),S.EFF(4),S.nI1(5,"translate"),S.k0s()()(),S.bVm()}2&e&&(S.R7$(4),S.SpI(" ",S.bMT(5,1,"addon.calendar.setnewreminder")," "))}function AddonCalendarEventPage_ion_card_24_Template(e,n){if(1&e&&(S.j41(0,"ion-card")(1,"ion-item")(2,"ion-label")(3,"h2"),S.EFF(4),S.nI1(5,"translate"),S.k0s()()(),S.DNE(6,AddonCalendarEventPage_ion_card_24_ng_container_6_Template,2,1,"ng-container",44)(7,AddonCalendarEventPage_ion_card_24_ng_container_7_Template,6,3,"ng-container",3),S.k0s()),2&e){const e=S.XpG();S.R7$(4),S.JRh(S.bMT(5,3,"addon.calendar.reminders")),S.R7$(2),S.Y8G("ngForOf",e.reminders),S.R7$(),S.Y8G("ngIf",e.event.timestart>e.currentTime)}}let Re=(()=>{var e;class AddonCalendarEventPage{constructor(e){this.route=e,this.eventLoaded=!1,this.courseName="",this.courseUrl="",this.remindersEnabled=!1,this.moduleUrl="",this.categoryPath="",this.currentTime=-1,this.reminders=[],this.canEdit=!1,this.hasOffline=!1,this.isOnline=!1,this.syncIcon=E.CoreConstants.ICON_LOADING,this.canScheduleExactAlarms=!0,this.scheduleExactWarningHidden=!1,this.remindersEnabled=oe.X.isEnabled(),this.siteHomeId=l.CoreSites.getCurrentSiteHomeId(),this.currentSiteId=l.CoreSites.getCurrentSiteId(),this.canEdit=m.AddonCalendar.canEditEventsInSite(),this.editEventObserver=d.z.on(O.bp,(e=>{e&&e.eventId===this.eventId&&(this.eventLoaded=!1,this.refreshEvent(!0,!1))}),this.currentSiteId),this.newEventObserver=d.z.on(O.zl,(e=>{this.eventId<0&&e&&(e.eventId===this.eventId||e.oldEventId===this.eventId)&&(this.eventId=e.eventId,this.eventLoaded=!1,this.refreshEvent(!0,!1))}),this.currentSiteId),this.syncObserver=d.z.on(O.FK,(e=>this.checkSyncResult(!1,e)),this.currentSiteId),this.manualSyncObserver=d.z.on(O.y$,(e=>this.checkSyncResult(!0,e)),this.currentSiteId),this.onlineObserver=i.WE.onChange().subscribe((()=>{C.SK.run((()=>{this.isOnline=i.WE.isOnline()}))})),this.defaultTimeChangedObserver=d.z.on(ie.ny,(()=>{this.loadReminders()}),this.currentSiteId),this.currentTime=c.CoreTimeUtils.timestamp(),this.updateCurrentTime=window.setInterval((()=>{this.currentTime=c.CoreTimeUtils.timestamp()}),5e3),this.checkExactAlarms(),this.appResumeSubscription=he.CorePlatform.resume.subscribe((()=>{this.checkExactAlarms()}))}loadReminders(){var e=this;return(0,r.A)((function*(){e.remindersEnabled&&e.event&&(e.reminders=yield _.AddonCalendarHelper.getEventReminders(e.eventId,e.event.timestart,e.currentSiteId))}))()}checkExactAlarms(){var e=this;return(0,r.A)((function*(){e.scheduleExactWarningHidden=!!(yield Ce.CoreConfig.get(E.CoreConstants.DONT_SHOW_EXACT_ALARMS_WARNING,0)),e.canScheduleExactAlarms=yield pe.CoreLocalNotifications.canScheduleExactAlarms()}))()}ngOnInit(){var e=this;return(0,r.A)((function*(){try{e.eventId=I.CoreNavigator.getRequiredRouteNumberParam("id")}catch(e){return s.CoreDomUtils.showErrorModal(e),I.CoreNavigator.back(),void 0}e.syncIcon=E.CoreConstants.ICON_LOADING,yield e.initializeSwipeManager(),yield e.fetchEvent()}))()}fetchEvent(e=!1,n=!1){var t=this;return(0,r.A)((function*(){if(t.isOnline=i.WE.isOnline(),e){if(yield t.syncEvents(n))return}try{if(t.eventId>=0){const e=yield m.AddonCalendar.getEventById(t.eventId);t.event=yield _.AddonCalendarHelper.formatEventData(e)}try{const e=_.AddonCalendarHelper.formatOfflineEventData(yield u.AddonCalendarOffline.getEvent(t.eventId));t.hasOffline=!0,t.event=Object.assign(t.event||{},e)}catch{if(t.hasOffline=!1,t.eventId<0)return s.CoreDomUtils.showErrorModal("Event not found."),I.CoreNavigator.back(),void 0}if(!t.event)return;if(t.loadReminders(),t.categoryPath="",t.courseName="",t.courseUrl="",t.moduleUrl="",t.event.moduleIcon){const e=ge.CoreCourse.translateModuleName(t.event.modulename||"");-1===e.indexOf("core.mod_")&&(t.event.modulename=e),t.moduleUrl=t.event.url||""}const e=[],n=t.event,o=t.event.courseid;o!=t.siteHomeId&&t.event.course&&(t.courseId=t.event.course.id,t.courseName=t.event.course.fullname,t.courseUrl=t.event.course.viewurl),o&&t.event.groupid&&(t.groupName=n.groupname),t.event.iscategoryevent&&t.event.category&&(t.categoryPath=t.event.category.nestedname),t.event.location&&(t.event.location=fe.Ni.decodeHTML(t.event.location),t.event.encodedLocation=x.F.buildAddressURL(t.event.location)),e.push(u.AddonCalendarOffline.isEventDeleted(t.eventId).then((e=>{n.deleted=e}))),e.push(m.AddonCalendar.getCalendarTimeFormat().then(function(){var e=(0,r.A)((function*(e){n.formattedtime=yield m.AddonCalendar.formatEventTime(n,e)}));return function(n){return e.apply(this,arguments)}}())),yield Promise.all(e)}catch(e){s.CoreDomUtils.showErrorModalDefault(e,"addon.calendar.errorloadevent",!0)}t.eventLoaded=!0,t.syncIcon=E.CoreConstants.ICON_SYNC}))()}initializeSwipeManager(){var e=this;return(0,r.A)((function*(){const n=I.CoreNavigator.getRouteParam("date"),t=n&&R.u.getSource(AddonCalendarEventsSource,[n]);t&&(e.events=new AddonCalendarEventsSwipeItemsManager(t),yield e.events.start())}))()}syncEvents(e=!1){var n=this;return(0,r.A)((function*(){let t=!1;try{const e=yield f.AddonCalendarSync.syncEvents();e.warnings&&e.warnings.length&&s.CoreDomUtils.showAlert(void 0,e.warnings[0]),e.deleted&&-1!=e.deleted.indexOf(n.eventId)?t=!0:n.eventId<0&&e.offlineIdMap[n.eventId]&&(n.eventId=e.offlineIdMap[n.eventId]),e.updated&&(e.source="event",d.z.trigger(O.y$,e,n.currentSiteId))}catch(n){e&&s.CoreDomUtils.showErrorModalDefault(n,"core.errorsync",!0)}return t}))()}addReminder(){var e=this;return(0,r.A)((function*(){if(!e.event||!e.event.id)return;const{CoreRemindersSetReminderMenuComponent:n}=yield t.e(4260).then(t.bind(t,64260)),o=yield ae.CorePopovers.open({component:n,componentProps:{eventTime:e.event.timestart}});void 0!==o&&(yield m.AddonCalendar.addEventReminder(e.event,o.timeBefore,e.currentSiteId),yield e.loadReminders())}))()}deleteReminder(e,n){var t=this;return(0,r.A)((function*(){n.preventDefault(),n.stopPropagation();try{yield s.CoreDomUtils.showDeleteConfirm();const n=yield re.CoreLoadings.show("core.deleting",!0);try{yield oe.X.removeReminder(e),yield t.loadReminders()}catch(e){s.CoreDomUtils.showErrorModalDefault(e,"Error deleting reminder")}finally{n.dismiss()}}catch{}}))()}doRefresh(e,n,t=!1){var o=this;return(0,r.A)((function*(){o.eventLoaded&&(yield o.refreshEvent(!0,t).finally((()=>{null==e||e.complete(),n&&n()})))}))()}refreshEvent(e=!1,n=!1){var t=this;return(0,r.A)((function*(){t.syncIcon=E.CoreConstants.ICON_LOADING;const o=[];t.eventId>0&&o.push(m.AddonCalendar.invalidateEvent(t.eventId)),o.push(m.AddonCalendar.invalidateTimeFormat()),yield de.g.allPromisesIgnoringErrors(o),yield t.fetchEvent(e,n)}))()}openEdit(){I.CoreNavigator.navigateToSitePath(`/calendar/edit/${this.eventId}`)}deleteEvent(){var e=this;return(0,r.A)((function*(){if(!e.event)return;const n=C.HT.instant("addon.calendar.deleteevent"),t={};let o;e.event.eventcount>1?(o=C.HT.instant("addon.calendar.confirmeventseriesdelete",{$a:{name:e.event.name,count:e.event.eventcount}}),t.inputs=[{type:"radio",name:"deleteall",checked:!0,value:!1,label:C.HT.instant("addon.calendar.deleteoneevent")},{type:"radio",name:"deleteall",checked:!1,value:!0,label:C.HT.instant("addon.calendar.deleteallevents")}]):o=C.HT.instant("addon.calendar.confirmeventdelete",{$a:e.event.name});let a=!1;try{a=yield s.CoreDomUtils.showConfirm(o,n,void 0,void 0,t)}catch{return}const r=yield re.CoreLoadings.show("core.sending",!0);try{let n=!1;if(e.event.id<0?yield u.AddonCalendarOffline.deleteEvent(e.event.id):n=yield m.AddonCalendar.deleteEvent(e.event.id,e.event.name,a),n)try{yield _.AddonCalendarHelper.refreshAfterChangeEvent(e.event,a?e.event.eventcount:1)}catch{}e.event.id<0?d.z.trigger(O.D1,{},l.CoreSites.getCurrentSiteId()):d.z.trigger(O.Mq,{eventId:e.eventId,sent:n},l.CoreSites.getCurrentSiteId()),n||e.event.id<0?(Ie.CoreToasts.show({message:"addon.calendar.eventcalendareventdeleted",translateMessage:!0,duration:Ie.ToastDuration.LONG}),I.CoreNavigator.back()):e.event.deleted=!0}catch(e){s.CoreDomUtils.showErrorModalDefault(e,"Error deleting event.")}r.dismiss()}))()}undoDelete(){var e=this;return(0,r.A)((function*(){if(!e.event)return;const n=yield re.CoreLoadings.show("core.sending",!0);try{yield u.AddonCalendarOffline.unmarkDeleted(e.event.id),d.z.trigger(O.hZ,{eventId:e.eventId},l.CoreSites.getCurrentSiteId()),e.event.deleted=!1}catch(e){s.CoreDomUtils.showErrorModalDefault(e,"Error undeleting event.")}n.dismiss()}))()}checkSyncResult(e,n){if(n)if(n.deleted&&-1!=n.deleted.indexOf(this.eventId))Ie.CoreToasts.show({message:"addon.calendar.eventcalendareventdeleted",translateMessage:!0,duration:Ie.ToastDuration.LONG}),I.CoreNavigator.back();else if(n.events&&(!e||"event"!=n.source))if(this.eventId<0)n.offlineIdMap[this.eventId]&&(this.eventId=n.offlineIdMap[this.eventId],this.eventLoaded=!1,this.refreshEvent());else{n.events.find((e=>e.id==this.eventId))&&(this.eventLoaded=!1,this.refreshEvent())}}openAlarmSettings(){pe.CoreLocalNotifications.openAlarmSettings()}hideAlarmWarning(){Ce.CoreConfig.set(E.CoreConstants.DONT_SHOW_EXACT_ALARMS_WARNING,1),this.scheduleExactWarningHidden=!0}ngOnDestroy(){var e;this.editEventObserver.off(),this.syncObserver.off(),this.manualSyncObserver.off(),this.onlineObserver.unsubscribe(),this.newEventObserver.off(),null===(e=this.events)||void 0===e||e.destroy(),this.appResumeSubscription.unsubscribe(),clearInterval(this.updateCurrentTime)}}return(e=AddonCalendarEventPage).ɵfac=function AddonCalendarEventPage_Factory(n){return new(n||e)(S.rXU(be.nX))},e.ɵcmp=S.VBU({type:e,selectors:[["page-addon-calendar-event"]],decls:25,vars:35,consts:[["collapsible",""],["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],[3,"action","hidden","priority","content","iconAction","closeOnClick"],["iconAction","fas-pen",3,"action","hidden","priority","content"],["iconAction","fas-trash",3,"action","hidden","priority","content"],["iconAction","fas-rotate-left",3,"action","hidden","priority","content"],[3,"core-swipe-navigation"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],["class","core-warning-card core-card-with-buttons",4,"ngIf"],[3,"text","contextLevel","contextInstanceId"],["collapsible","",1,"ion-text-wrap","addon-calendar-event",3,"ngClass"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose","isBranded",4,"ngIf"],["aria-hidden","true","slot","start",3,"name",4,"ngIf"],[1,"sr-only"],["class","sr-only",4,"ngIf"],["class","core-warning-card",4,"ngIf"],[1,"ion-text-wrap"],[1,"item-heading"],[3,"text","filter"],["slot","end",4,"ngIf"],["class","ion-text-wrap","core-link","","capture","true",3,"href","detail",4,"ngIf"],["class","ion-text-wrap core-groupname",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose","isBranded"],["aria-hidden","true","slot","start",3,"name"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["name","fas-trash","aria-hidden","true"],["core-link","","capture","true",1,"ion-text-wrap",3,"href","detail"],["contextLevel","course",3,"text","contextInstanceId"],[1,"ion-text-wrap","core-groupname"],["contextLevel","coursecat",3,"text","contextInstanceId"],["core-link","",3,"href","autoLogin"],["expand","block","core-link","","capture","true",3,"href"],[1,"core-warning-card","core-card-with-buttons"],["name","fas-circle-info","slot","start","aria-hidden","true"],[1,"core-card-buttons"],["fill","clear",3,"click"],["fill","outline",3,"click"],[4,"ngFor","ngForOf"],["class","ion-text-wrap",3,"item-dimmed",4,"ngIf"],["fill","clear","slot","end",3,"click","ariaLabel"],["name","fas-trash","color","danger","slot","icon-only","aria-hidden","true"],["expand","block",3,"click"]],template:function AddonCalendarEventPage_Template(e,n){1&e&&(S.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),S.nrm(3,"ion-back-button",2),S.nI1(4,"translate"),S.k0s(),S.j41(5,"ion-title"),S.DNE(6,AddonCalendarEventPage_h1_6_Template,2,3,"h1",3),S.k0s(),S.j41(7,"ion-buttons",4)(8,"core-context-menu")(9,"core-context-menu-item",5),S.nI1(10,"translate"),S.bIt("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_9_listener(e){return n.doRefresh(void 0,e,!0)})),S.k0s(),S.j41(11,"core-context-menu-item",6),S.nI1(12,"translate"),S.bIt("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_11_listener(){return n.openEdit()})),S.k0s(),S.j41(13,"core-context-menu-item",7),S.nI1(14,"translate"),S.bIt("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_13_listener(){return n.deleteEvent()})),S.k0s(),S.j41(15,"core-context-menu-item",8),S.nI1(16,"translate"),S.bIt("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_15_listener(){return n.undoDelete()})),S.k0s()()()()(),S.j41(17,"ion-content",9)(18,"ion-refresher",10),S.bIt("ionRefresh",(function AddonCalendarEventPage_Template_ion_refresher_ionRefresh_18_listener(e){return n.doRefresh(e.target)})),S.nrm(19,"ion-refresher-content",11),S.nI1(20,"translate"),S.k0s(),S.j41(21,"core-loading",12),S.DNE(22,AddonCalendarEventPage_ion_list_22_Template,33,31,"ion-list",3)(23,AddonCalendarEventPage_ion_card_23_Template,19,14,"ion-card",13)(24,AddonCalendarEventPage_ion_card_24_Template,8,5,"ion-card",3),S.k0s()()),2&e&&(S.R7$(3),S.Y8G("text",S.bMT(4,23,"core.back")),S.R7$(3),S.Y8G("ngIf",n.event),S.R7$(3),S.Y8G("hidden",!n.eventLoaded||!n.hasOffline&&n.event&&!n.event.deleted||!n.isOnline)("priority",400)("content",S.bMT(10,25,"core.settings.synchronizenow"))("iconAction",n.syncIcon)("closeOnClick",!1),S.R7$(2),S.Y8G("hidden",!n.event||!n.event.canedit||n.event.deleted||!n.canEdit&&n.event.id>0)("priority",300)("content",S.bMT(12,27,"core.edit")),S.R7$(2),S.Y8G("hidden",!n.event||!n.event.candelete||n.event.deleted)("priority",200)("content",S.bMT(14,29,"core.delete")),S.R7$(2),S.Y8G("hidden",!n.event||!n.event.deleted)("priority",200)("content",S.bMT(16,31,"core.restore")),S.R7$(2),S.Y8G("core-swipe-navigation",n.events),S.R7$(),S.Y8G("disabled",!n.eventLoaded),S.R7$(),S.FS9("pullingText",S.bMT(20,33,"core.pulltorefresh")),S.R7$(2),S.Y8G("hideUntil",n.eventLoaded),S.R7$(),S.Y8G("ngIf",n.event),S.R7$(),S.Y8G("ngIf",n.remindersEnabled&&n.event&&!n.canScheduleExactAlarms&&!n.scheduleExactWarningHidden),S.R7$(),S.Y8G("ngIf",n.remindersEnabled&&n.event))},dependencies:[$.YU,$.Sq,$.bT,F.B,w.Q,N.R,Y.I,L.t,V.B,Ee.j,ye.M,Te.n,B.i,X.T,z.Jm,z.QW,z.b_,z.W9,z.eU,z.iq,z.uz,z.he,z.nf,z.JI,z.To,z.Ki,z.BC,z.ai,z.el,Ae.w,J.D9],styles:["[_nghost-%COMP%]{--addon-calendar-blank-day-background-color: var(--light)}[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{color:#fff;border-radius:50%;padding:.7rem;--margin-vertical: 12px;--margin-end: 12px;margin-top:var(--margin-vertical);margin-bottom:var(--margin-vertical);margin-inline-end:var(--margin-end)}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-category[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#8e24aa}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-course[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#ca3120}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-group[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#f0ad4e}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-user[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#0f6cbf}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-site[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#357a32}","[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:1.6rem}"]}),AddonCalendarEventPage})();class AddonCalendarEventsSwipeItemsManager extends ve.Z{getSelectedItemPathFromRoute(e){return I.CoreNavigator.getRouteParams(e).id}}var Pe=t(13901),ke=t(13995),xe=t(19547);const index_c0=e=>({$a:e});function AddonCalendarIndexPage_p_9_Template(e,n){1&e&&(S.j41(0,"p",16),S.EFF(1),S.nI1(2,"translate"),S.k0s()),2&e&&(S.R7$(),S.JRh(S.bMT(2,1,"addon.calendar.upcomingevents")))}function AddonCalendarIndexPage_core_context_menu_item_15_Template(e,n){if(1&e){const e=S.RV6();S.j41(0,"core-context-menu-item",17),S.nI1(1,"translate"),S.bIt("action",(function AddonCalendarIndexPage_core_context_menu_item_15_Template_core_context_menu_item_action_0_listener(){S.eBV(e);const n=S.XpG();return S.Njj(n.toggleDisplay())})),S.k0s()}2&e&&S.Y8G("priority",800)("content",S.bMT(1,2,"addon.calendar.upcomingevents"))}function AddonCalendarIndexPage_core_context_menu_item_16_Template(e,n){if(1&e){const e=S.RV6();S.j41(0,"core-context-menu-item",18),S.nI1(1,"translate"),S.bIt("action",(function AddonCalendarIndexPage_core_context_menu_item_16_Template_core_context_menu_item_action_0_listener(){S.eBV(e);const n=S.XpG();return S.Njj(n.toggleDisplay())})),S.k0s()}2&e&&S.Y8G("priority",800)("content",S.bMT(1,2,"addon.calendar.monthlyview"))}function AddonCalendarIndexPage_ion_card_26_Template(e,n){1&e&&(S.j41(0,"ion-card",19)(1,"ion-item"),S.nrm(2,"ion-icon",20),S.j41(3,"ion-label"),S.EFF(4),S.nI1(5,"translate"),S.nI1(6,"translate"),S.k0s()()()),2&e&&(S.R7$(4),S.JRh(S.i5U(6,3,"core.hasdatatosync",S.eq3(6,index_c0,S.bMT(5,1,"addon.calendar.calendar")))))}function AddonCalendarIndexPage_addon_calendar_upcoming_events_28_Template(e,n){if(1&e){const e=S.RV6();S.j41(0,"addon-calendar-upcoming-events",21),S.bIt("onEventClicked",(function AddonCalendarIndexPage_addon_calendar_upcoming_events_28_Template_addon_calendar_upcoming_events_onEventClicked_0_listener(n){S.eBV(e);const t=S.XpG();return S.Njj(t.gotoEvent(n))})),S.k0s()}if(2&e){const e=S.XpG();S.Y8G("hidden",e.showCalendar)("filter",e.filter)}}function AddonCalendarIndexPage_ion_fab_29_Template(e,n){if(1&e){const e=S.RV6();S.j41(0,"ion-fab",22)(1,"ion-fab-button",23),S.nI1(2,"translate"),S.bIt("click",(function AddonCalendarIndexPage_ion_fab_29_Template_ion_fab_button_click_1_listener(){S.eBV(e);const n=S.XpG();return S.Njj(n.openEdit())})),S.nrm(3,"ion-icon",24),S.j41(4,"span",25),S.EFF(5),S.nI1(6,"translate"),S.k0s()()()}2&e&&(S.R7$(),S.BMQ("aria-label",S.bMT(2,2,"addon.calendar.newevent")),S.R7$(4),S.JRh(S.bMT(6,4,"addon.calendar.newevent")))}let De=(()=>{var e;class AddonCalendarIndexPage{constructor(e){var n=this;this.route=e,this.canCreate=!1,this.courses=[],this.loaded=!1,this.hasOffline=!1,this.isOnline=!1,this.syncIcon=E.CoreConstants.ICON_LOADING,this.showCalendar=!0,this.loadUpcoming=!1,this.filter={filtered:!1,courseId:void 0,categoryId:void 0,course:!0,group:!0,site:!0,user:!0,category:!0},this.currentSiteId=l.CoreSites.getCurrentSiteId(),this.newEventObserver=d.z.on(O.zl,(e=>{e&&e.eventId&&(this.loaded=!1,this.refreshData(!0,!1,!0))}),this.currentSiteId),this.discardedObserver=d.z.on(O.D1,(()=>{this.loaded=!1,this.refreshData(!0,!1,!0)}),this.currentSiteId),this.editEventObserver=d.z.on(O.bp,(e=>{e&&e.eventId&&(this.loaded=!1,this.refreshData(!0,!1,!0))}),this.currentSiteId),this.syncObserver=d.z.on(O.FK,(()=>{this.loaded=!1,this.refreshData(!1,!1,!0)}),this.currentSiteId),this.manualSyncObserver=d.z.on(O.y$,(e=>{e&&"index"!=e.source&&(this.loaded=!1,this.refreshData(!1,!1,!0))}),this.currentSiteId),this.deleteEventObserver=d.z.on(O.Mq,(()=>{this.loaded=!1,this.refreshData(!1,!1,!0)}),this.currentSiteId),this.undeleteEventObserver=d.z.on(O.hZ,(0,r.A)((function*(){n.hasOffline=yield u.AddonCalendarOffline.hasOfflineData()})),this.currentSiteId),this.filterChangedObserver=d.z.on(O.Jj,function(){var e=(0,r.A)((function*(e){n.filter=e,n.canCreate=yield _.AddonCalendarHelper.canEditEvents(n.filter.courseId)}));return function(n){return e.apply(this,arguments)}}()),this.onlineObserver=i.WE.onChange().subscribe((()=>{C.SK.run((()=>{this.isOnline=i.WE.isOnline()}))}))}ngOnInit(){var e=this;this.loadUpcoming=!!I.CoreNavigator.getRouteBooleanParam("upcoming"),this.showCalendar=!this.loadUpcoming,this.route.queryParams.subscribe((0,r.A)((function*(){e.filter.courseId=I.CoreNavigator.getRouteNumberParam("courseId"),e.year=I.CoreNavigator.getRouteNumberParam("year"),e.month=I.CoreNavigator.getRouteNumberParam("month"),e.filter.filtered=!!e.filter.courseId,e.fetchData(!0,!1),void 0!==e.year&&void 0!==e.month&&e.calendarComponent&&e.calendarComponent.viewMonth(e.month,e.year)}))),l.CoreSites.loginNavigationFinished()}fetchData(e,n){var t=this;return(0,r.A)((function*(){if(t.syncIcon=E.CoreConstants.ICON_LOADING,t.isOnline=i.WE.isOnline(),e)try{const e=yield f.AddonCalendarSync.syncEvents();e.warnings&&e.warnings.length&&s.CoreDomUtils.showAlert(void 0,e.warnings[0]),e.updated&&(e.source="index",d.z.trigger(O.y$,e,t.currentSiteId))}catch(e){n&&s.CoreDomUtils.showErrorModalDefault(e,"core.errorsync",!0)}try{const e=[];t.hasOffline=!1,e.push(v.CoreCoursesHelper.getCoursesForPopover(t.filter.courseId).then((e=>{t.courses=e.courses}))),e.push(_.AddonCalendarHelper.canEditEvents(t.filter.courseId).then((e=>{t.canCreate=e}))),e.push(u.AddonCalendarOffline.hasOfflineData().then((e=>{t.hasOffline=e}))),yield Promise.all(e)}catch(e){s.CoreDomUtils.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}t.loaded=!0,t.syncIcon=E.CoreConstants.ICON_SYNC}))()}doRefresh(e,n,t){var o=this;return(0,r.A)((function*(){o.loaded&&(yield o.refreshData(!0,t).finally((()=>{null==e||e.complete(),n&&n()})))}))()}refreshData(e=!1,n=!1,t=!1){var o=this;return(0,r.A)((function*(){o.syncIcon=E.CoreConstants.ICON_LOADING;const a=[];a.push(m.AddonCalendar.invalidateAllowedEventTypes()),o.showCalendar&&o.calendarComponent?a.push(o.calendarComponent.refreshData(t)):!o.showCalendar&&o.upcomingEventsComponent&&a.push(o.upcomingEventsComponent.refreshData()),yield Promise.all(a).finally((()=>o.fetchData(e,n)))}))()}gotoEvent(e){I.CoreNavigator.navigateToSitePath(`/calendar/event/${e}`)}gotoDay(e){const n={day:e.day,month:e.month,year:e.year};Object.keys(this.filter).forEach((e=>{n[e]=this.filter[e]})),I.CoreNavigator.navigateToSitePath("/calendar/day",{params:n})}openFilter(){var e=this;return(0,r.A)((function*(){const{AddonCalendarFilterComponent:n}=yield t.e(5393).then(t.bind(t,45393));yield M.I.openSideModal({component:n,componentProps:{courses:e.courses,filter:e.filter}})}))()}openEdit(e){const n={};e=e||0,this.filter.courseId&&(n.courseId=this.filter.courseId),I.CoreNavigator.navigateToSitePath(`/calendar/edit/${e}`,{params:n})}openSettings(){I.CoreNavigator.navigateToSitePath("/calendar/calendar-settings")}toggleDisplay(){this.showCalendar=!this.showCalendar,this.showCalendar||(this.loadUpcoming=!0)}ngOnDestroy(){var e,n,t,o,a,r,i,d,l;null===(e=this.newEventObserver)||void 0===e||e.off(),null===(n=this.discardedObserver)||void 0===n||n.off(),null===(t=this.editEventObserver)||void 0===t||t.off(),null===(o=this.deleteEventObserver)||void 0===o||o.off(),null===(a=this.undeleteEventObserver)||void 0===a||a.off(),null===(r=this.syncObserver)||void 0===r||r.off(),null===(i=this.manualSyncObserver)||void 0===i||i.off(),null===(d=this.filterChangedObserver)||void 0===d||d.off(),null===(l=this.onlineObserver)||void 0===l||l.unsubscribe()}}return(e=AddonCalendarIndexPage).ɵfac=function AddonCalendarIndexPage_Factory(n){return new(n||e)(S.rXU(be.nX))},e.ɵcmp=S.VBU({type:e,selectors:[["page-addon-calendar-index"]],viewQuery:function AddonCalendarIndexPage_Query(e,n){if(1&e&&(S.GBs(Pe.K,5),S.GBs(ke.z,5)),2&e){let e;S.mGM(e=S.lsd())&&(n.calendarComponent=e.first),S.mGM(e=S.lsd())&&(n.upcomingEventsComponent=e.first)}},decls:30,vars:35,consts:[["slot","start"],[3,"text"],["class","subheading",4,"ngIf"],["slot","end"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","fas-filter","aria-hidden","true"],["iconAction","fas-table-list",3,"priority","content","action",4,"ngIf"],["iconAction","fas-calendar-days",3,"priority","content","action",4,"ngIf"],["iconAction","fas-gears",3,"action","priority","content"],[3,"action","hidden","priority","content","iconAction","closeOnClick"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],["class","core-warning-card",4,"ngIf"],[3,"onEventClicked","onDayClicked","hidden","initialYear","initialMonth","filter","displayNavButtons"],[3,"hidden","filter","onEventClicked",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],[1,"subheading"],["iconAction","fas-table-list",3,"action","priority","content"],["iconAction","fas-calendar-days",3,"action","priority","content"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[3,"onEventClicked","hidden","filter"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"]],template:function AddonCalendarIndexPage_Template(e,n){1&e&&(S.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),S.nrm(3,"ion-back-button",1),S.nI1(4,"translate"),S.k0s(),S.j41(5,"ion-title")(6,"h1"),S.EFF(7),S.nI1(8,"translate"),S.k0s(),S.DNE(9,AddonCalendarIndexPage_p_9_Template,3,3,"p",2),S.k0s(),S.j41(10,"ion-buttons",3)(11,"ion-button",4),S.nI1(12,"translate"),S.bIt("click",(function AddonCalendarIndexPage_Template_ion_button_click_11_listener(){return n.openFilter()})),S.nrm(13,"ion-icon",5),S.k0s(),S.j41(14,"core-context-menu"),S.DNE(15,AddonCalendarIndexPage_core_context_menu_item_15_Template,2,4,"core-context-menu-item",6)(16,AddonCalendarIndexPage_core_context_menu_item_16_Template,2,4,"core-context-menu-item",7),S.j41(17,"core-context-menu-item",8),S.nI1(18,"translate"),S.bIt("action",(function AddonCalendarIndexPage_Template_core_context_menu_item_action_17_listener(){return n.openSettings()})),S.k0s(),S.j41(19,"core-context-menu-item",9),S.nI1(20,"translate"),S.bIt("action",(function AddonCalendarIndexPage_Template_core_context_menu_item_action_19_listener(e){return n.doRefresh(void 0,e,!0)})),S.k0s()(),S.nrm(21,"core-user-menu-button"),S.k0s()()(),S.j41(22,"ion-content")(23,"ion-refresher",10),S.bIt("ionRefresh",(function AddonCalendarIndexPage_Template_ion_refresher_ionRefresh_23_listener(e){return n.doRefresh(e.target)})),S.nrm(24,"ion-refresher-content",11),S.nI1(25,"translate"),S.k0s(),S.DNE(26,AddonCalendarIndexPage_ion_card_26_Template,7,8,"ion-card",12),S.j41(27,"addon-calendar-calendar",13),S.bIt("onEventClicked",(function AddonCalendarIndexPage_Template_addon_calendar_calendar_onEventClicked_27_listener(e){return n.gotoEvent(e)}))("onDayClicked",(function AddonCalendarIndexPage_Template_addon_calendar_calendar_onDayClicked_27_listener(e){return n.gotoDay(e)})),S.k0s(),S.DNE(28,AddonCalendarIndexPage_addon_calendar_upcoming_events_28_Template,1,2,"addon-calendar-upcoming-events",14)(29,AddonCalendarIndexPage_ion_fab_29_Template,7,6,"ion-fab",15),S.k0s()),2&e&&(S.R7$(3),S.Y8G("text",S.bMT(4,23,"core.back")),S.R7$(4),S.JRh(S.bMT(8,25,"addon.calendar.calendar")),S.R7$(2),S.Y8G("ngIf",!n.showCalendar),S.R7$(2),S.Y8G("ariaLabel",S.bMT(12,27,"core.filter")),S.R7$(4),S.Y8G("ngIf",n.showCalendar),S.R7$(),S.Y8G("ngIf",!n.showCalendar),S.R7$(),S.Y8G("priority",600)("content",S.bMT(18,29,"core.settings.settings")),S.R7$(2),S.Y8G("hidden",!n.loaded||!n.hasOffline||!n.isOnline)("priority",400)("content",S.bMT(20,31,"core.settings.synchronizenow"))("iconAction",n.syncIcon)("closeOnClick",!1),S.R7$(4),S.Y8G("disabled",!n.loaded),S.R7$(),S.FS9("pullingText",S.bMT(25,33,"core.pulltorefresh")),S.R7$(2),S.Y8G("ngIf",n.hasOffline),S.R7$(),S.Y8G("hidden",!n.showCalendar)("initialYear",n.year)("initialMonth",n.month)("filter",n.filter)("displayNavButtons",n.showCalendar),S.R7$(),S.Y8G("ngIf",n.loadUpcoming),S.R7$(),S.Y8G("ngIf",n.canCreate))},dependencies:[$.bT,F.B,w.Q,U.A,L.t,B.i,X.T,z.Jm,z.QW,z.b_,z.W9,z.Q8,z.YW,z.eU,z.iq,z.uz,z.he,z.To,z.Ki,z.BC,z.ai,z.el,Pe.K,ke.z,xe.U,J.D9],encapsulation:2}),AddonCalendarIndexPage})();function AddonCalendarSettingsPage_ion_item_11_Template(e,n){if(1&e){const e=S.RV6();S.j41(0,"ion-item")(1,"ion-select",3),S.nI1(2,"translate"),S.mxI("ngModelChange",(function AddonCalendarSettingsPage_ion_item_11_Template_ion_select_ngModelChange_1_listener(n){S.eBV(e);const t=S.XpG();return S.DH7(t.defaultTimeLabel,n)||(t.defaultTimeLabel=n),S.Njj(n)})),S.bIt("click",(function AddonCalendarSettingsPage_ion_item_11_Template_ion_select_click_1_listener(n){S.eBV(e);const t=S.XpG();return S.Njj(t.changeDefaultTime(n))})),S.j41(3,"ion-select-option",4),S.EFF(4),S.k0s()()()}if(2&e){const e=S.XpG();S.R7$(),S.R50("ngModel",e.defaultTimeLabel),S.Y8G("label",S.bMT(2,4,"addon.calendar.defaultnotificationtime")),S.R7$(2),S.Y8G("value",e.defaultTimeLabel),S.R7$(),S.JRh(e.defaultTimeLabel)}}let Me=(()=>{var e;class AddonCalendarSettingsPage{constructor(){this.defaultTimeLabel=""}ngOnInit(){var e=this;return(0,r.A)((function*(){e.updateDefaultTimeLabel()}))()}changeDefaultTime(e){var n=this;return(0,r.A)((function*(){var o;e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault();const{CoreRemindersSetReminderMenuComponent:a}=yield t.e(4260).then(t.bind(t,64260)),r=yield ae.CorePopovers.open({component:a,componentProps:{initialValue:n.defaultTime,noReminderLabel:"core.settings.disabled"},event:e});void 0!==r&&(yield oe.X.setDefaultNotificationTime(null!==(o=r.timeBefore)&&void 0!==o?o:ie.Nc),n.updateDefaultTimeLabel())}))()}updateDefaultTimeLabel(){var e=this;return(0,r.A)((function*(){e.defaultTime=yield oe.X.getDefaultNotificationTime();const n=oe.S.convertSecondsToValueAndUnit(e.defaultTime);e.defaultTimeLabel=oe.X.getUnitValueLabel(n.value,n.unit)}))()}}return(e=AddonCalendarSettingsPage).ɵfac=function AddonCalendarSettingsPage_Factory(n){return new(n||e)},e.ɵcmp=S.VBU({type:e,selectors:[["page-addon-calendar-settings"]],decls:12,vars:7,consts:[["slot","start"],[3,"text"],[4,"ngIf"],[3,"ngModelChange","click","ngModel","label"],[3,"value"]],template:function AddonCalendarSettingsPage_Template(e,n){1&e&&(S.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),S.nrm(3,"ion-back-button",1),S.nI1(4,"translate"),S.k0s(),S.j41(5,"ion-title")(6,"h1"),S.EFF(7),S.nI1(8,"translate"),S.k0s()()()(),S.j41(9,"ion-content")(10,"ion-list"),S.DNE(11,AddonCalendarSettingsPage_ion_item_11_Template,5,6,"ion-item",2),S.k0s()()),2&e&&(S.R7$(3),S.Y8G("text",S.bMT(4,3,"core.back")),S.R7$(4),S.JRh(S.bMT(8,5,"core.settings.settings")),S.R7$(4),S.Y8G("ngIf",n.defaultTimeLabel))},dependencies:[$.bT,B.i,H.BC,H.vS,z.QW,z.W9,z.eU,z.uz,z.nf,z.Nm,z.Ip,z.BC,z.ai,z.Je,z.el,J.D9],encapsulation:2}),AddonCalendarSettingsPage})();var Oe=t(98833),Ge=t(47720),Se=t(42858);function buildRoutes(e){return[{path:"index",data:{mainMenuTabRoot:O.w3},component:De},{path:"calendar-settings",component:Me},{path:"day",component:q},{path:"event/:id",component:Re},{path:"edit/:eventId",component:_e},...(0,Se.B)(e,{redirectTo:"index",pathMatch:"full"})]}let $e=(()=>{var e;class AddonCalendarLazyModule{}return(e=AddonCalendarLazyModule).ɵfac=function AddonCalendarLazyModule_Factory(n){return new(n||e)},e.ɵmod=S.$C({type:e}),e.ɵinj=S.G2t({providers:[{provide:be.bw,multi:!0,deps:[S.zZn],useFactory:buildRoutes}],imports:[o.n,a.v,Ge.E,Oe.d]}),AddonCalendarLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&S.Obh($e,{declarations:[q,_e,Re,De,Me],imports:[o.n,a.v,Ge.E,Oe.d]}))},35716:(e,n,t)=>{t.d(n,{z:()=>CorePaginatedItemsManagerSource});var o=t(10467),a=t(58866);class CorePaginatedItemsManagerSource extends a.i{constructor(){super(...arguments),this.hasMoreItems=!0}isCompleted(){return!this.hasMoreItems}isEmpty(){var e;return!this.isLoaded()||0===(null!==(e=this.getItems())&&void 0!==e?e:[]).length}getPagesLoaded(){if(null===this.items)return 0;const e=this.getPageLength();return null===e?1:Math.ceil(this.items.length/e)}reset(){this.hasMoreItems=!0,super.reset()}reload(){var e=this;return(0,o.A)((function*(){e.dirty=!0,yield e.load()}))()}load(){var e=this;return(0,o.A)((function*(){var n;if(e.dirty){const{items:n,hasMoreItems:t}=yield e.loadPageItems(0);return e.dirty=!1,e.setItems(n,null!=t&&t),void 0}if(!e.hasMoreItems)return;const{items:t,hasMoreItems:o}=yield e.loadPageItems(e.getPagesLoaded());e.setItems((null!==(n=e.items)&&void 0!==n?n:[]).concat(t),null!=o&&o)}))()}getPageLength(){return null}setItems(e,n=!1){this.hasMoreItems=n,super.setItems(e)}}},99522:(e,n,t)=>{t.d(n,{F:()=>CoreRoutedItemsManagerSource});var o=t(35716);class CoreRoutedItemsManagerSource extends o.z{static getSourceId(...e){return e.map((e=>String(e))).join("-")}getItemQueryParams(e){return{}}}},83696:(e,n,t)=>{var o;t.d(n,{u:()=>CoreRoutedItemsManagerSourcesTracker});class CoreRoutedItemsManagerSourcesTracker{static getSource(e,n){var t,o;const a="string"==typeof n?n:e.getSourceId(...n);return null!==(t=null===(o=this.getConstructorInstances(e)[a])||void 0===o?void 0:o.instance)&&void 0!==t?t:null}static getOrCreateSource(e,n){var t;const o=e.getSourceId(...n);return null!==(t=this.getSource(e,o))&&void 0!==t?t:this.createInstance(o,e,n)}static addReference(e,n){const t=this.getConstructorInstances(e.constructor),o=this.instanceIds.get(e);void 0!==o&&(o in t||(t[o]={instance:e,references:[]}),t[o].references.push(n))}static removeReference(e,n){var t,o;const a=this.instances.get(e.constructor),r=this.instanceIds.get(e),i=null!==(t=null==a||null===(o=a[null!=r?r:""])||void 0===o?void 0:o.references.indexOf(n))&&void 0!==t?t:-1;a&&void 0!==r&&-1!==i&&(a[r].references.splice(i,1),0===a[r].references.length&&delete a[r])}static getConstructorInstances(e){var n;return null!==(n=this.instances.get(e))&&void 0!==n?n:this.initialiseConstructorInstances(e)}static initialiseConstructorInstances(e){const n={};return this.instances.set(e,n),n}static createInstance(e,n,t){const o=new n(...t);return this.instanceIds.set(o,e),o}}(o=CoreRoutedItemsManagerSourcesTracker).instances=new WeakMap,o.instanceIds=new WeakMap},95990:(e,n,t)=>{t.d(n,{u:()=>CoreRoutedItemsManager});var o=t(10467),a=t(15324),r=t(42022),i=t(83696);class CoreRoutedItemsManager extends r.f{setSource(e){this.source&&i.u.removeReference(this.source.instance,this),e&&i.u.addReference(e,this),super.setSource(e)}getSelectedItemPath(e){return e?this.getSelectedItemPathFromRoute(e):null}updateSelectedItem(e=null){var n,t,o,a;e=null!==(n=null!==(t=e)&&void 0!==t?t:this.getCurrentPageRoute())&&void 0!==n?n:null;const r=this.getSelectedItemPath(e),i=r&&null!==(o=null===(a=this.itemsMap)||void 0===a?void 0:a[r])&&void 0!==o?o:null;this.setSelectedItem(i)}navigateToItem(e,n={}){var t=this;return(0,o.A)((function*(){const o=t.getCurrentPageRoute();if(null===o)return;const r=t.getSource().getItemPath(e),i=t.getSelectedItemPath(o);if(i===r)return;const d=t.getSource().getItemQueryParams(e),l=i?i.split("/").fill("../").join(""):"";yield a.CoreNavigator.navigate(l+r,{params:d,...n})}))()}navigateToIndex(e={}){var n=this;return(0,o.A)((function*(){const t=n.getCurrentPageRoute();if(null===t)return;const o=n.getSelectedItemPath(t);if(null===o)return;const r=o?o.split("/").fill("../").join(""):"";yield a.CoreNavigator.navigate(r,e)}))()}onSourceItemsUpdated(e){super.onSourceItemsUpdated(e);const n=this.selectedItem;null!==n&&e.some((e=>e===n))||this.updateSelectedItem()}getItemId(e){return this.getSource().getItemPath(e)}}},52266:(e,n,t)=>{t.d(n,{Z:()=>CoreSwipeNavigationItemsManager});var o=t(10467),a=t(15324),r=t(95990);class CoreSwipeNavigationItemsManager extends r.u{start(){var e=this;return(0,o.A)((function*(){e.updateSelectedItem()}))()}navigateToNextItem(){var e=this;return(0,o.A)((function*(){yield e.navigateToItemBy(1,"forward")}))()}navigateToPreviousItem(){var e=this;return(0,o.A)((function*(){yield e.navigateToItemBy(-1,"back")}))()}hasNextItem(){var e=this;return(0,o.A)((function*(){return!!(yield e.getItemBy(1))}))()}hasPreviousItem(){var e=this;return(0,o.A)((function*(){return!!(yield e.getItemBy(-1))}))()}getCurrentPageRoute(){return a.CoreNavigator.getCurrentRoute()}getSelectedItemPathFromRoute(e){const n=[];for(;e&&(n.push(...a.CoreNavigator.getRouteUrl(e)),e.firstChild);)e=e.firstChild;return n.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(e,n){var t=this;return(0,o.A)((function*(){const o=yield t.getItemBy(e);o&&(yield t.navigateToItem(o,{animationDirection:n,replace:!0}))}))()}getItemBy(e){var n=this;return(0,o.A)((function*(){var t;const o=n.getSource().getItems(),a=null!==(t=n.selectedItem&&(null==o?void 0:o.indexOf(n.selectedItem)))&&void 0!==t?t:-1;if(-1===a||null===o)return null;const r=e>0?1:-1;let i=a,d=0;for(;d!==e;){if(i+=r,i<0)return null;if(i>=o.length)break;n.skipItemInSwipe(o[i])||(d+=r)}return d===e?o[i]:n.getSource().isCompleted()?null:(yield n.getSource().load(),n.getItemBy(e))}))()}skipItemInSwipe(e){return!1}}}}]);