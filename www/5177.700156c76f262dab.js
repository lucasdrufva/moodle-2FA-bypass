"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5177],{35716:(e,r,t)=>{t.d(r,{z:()=>CorePaginatedItemsManagerSource});var a=t(10467),o=t(58866);class CorePaginatedItemsManagerSource extends o.i{constructor(){super(...arguments),this.hasMoreItems=!0}isCompleted(){return!this.hasMoreItems}isEmpty(){var e;return!this.isLoaded()||0===(null!==(e=this.getItems())&&void 0!==e?e:[]).length}getPagesLoaded(){if(null===this.items)return 0;const e=this.getPageLength();return null===e?1:Math.ceil(this.items.length/e)}reset(){this.hasMoreItems=!0,super.reset()}reload(){var e=this;return(0,a.A)((function*(){e.dirty=!0,yield e.load()}))()}load(){var e=this;return(0,a.A)((function*(){var r;if(e.dirty){const{items:r,hasMoreItems:t}=yield e.loadPageItems(0);return e.dirty=!1,e.setItems(r,null!=t&&t),void 0}if(!e.hasMoreItems)return;const{items:t,hasMoreItems:a}=yield e.loadPageItems(e.getPagesLoaded());e.setItems((null!==(r=e.items)&&void 0!==r?r:[]).concat(t),null!=a&&a)}))()}getPageLength(){return null}setItems(e,r=!1){this.hasMoreItems=r,super.setItems(e)}}},88516:(e,r,t)=>{t.r(r),t.d(r,{default:()=>L});var a=t(3353),o=t(54438),s=t(21182),l=t(10467),n=t(89911),c=t(45155),i=t(52749),u=t(81690),h=t(22693),_=t(79555),d=t(8014),g=t(49882),m=t(89014),S=t(15324),b=t(75357),p=t(6319),f=t(55554),C=t(60177),y=t(16986),I=t(66198),G=t(19858),v=t(86198),P=t(58197),T=t(88246),M=t(73465),R=t(4193),E=t(19547),k=t(73955);const _c0=e=>({$a:e});function CoreSearchGlobalSearchPage_h1_6_Template(e,r){1&e&&(o.j41(0,"h1"),o.EFF(1),o.nI1(2,"translate"),o.k0s()),2&e&&(o.R7$(),o.JRh(o.bMT(2,1,"core.search")))}function CoreSearchGlobalSearchPage_h1_7_Template(e,r){1&e&&(o.j41(0,"h1"),o.EFF(1),o.nI1(2,"translate"),o.k0s()),2&e&&(o.R7$(),o.JRh(o.bMT(2,1,"core.search.globalsearch")))}function CoreSearchGlobalSearchPage_ion_card_12_Template(e,r){if(1&e&&(o.j41(0,"ion-card",12)(1,"ion-item"),o.nrm(2,"ion-icon",13),o.j41(3,"ion-label"),o.nrm(4,"core-format-text",1),o.k0s()()()),2&e){const e=o.XpG();o.R7$(4),o.Y8G("text",e.searchBanner)}}function CoreSearchGlobalSearchPage_ion_list_16_core_search_global_search_result_1_Template(e,r){if(1&e){const e=o.RV6();o.j41(0,"core-search-global-search-result",15),o.bIt("onClick",(function CoreSearchGlobalSearchPage_ion_list_16_core_search_global_search_result_1_Template_core_search_global_search_result_onClick_0_listener(){const r=o.eBV(e).$implicit,t=o.XpG(2);return o.Njj(t.visitResult(r))})),o.k0s()}if(2&e){o.Y8G("result",r.$implicit)}}function CoreSearchGlobalSearchPage_ion_list_16_Template(e,r){if(1&e&&(o.j41(0,"ion-list"),o.DNE(1,CoreSearchGlobalSearchPage_ion_list_16_core_search_global_search_result_1_Template,1,1,"core-search-global-search-result",14),o.k0s()),2&e){const e=o.XpG();o.R7$(),o.Y8G("ngForOf",e.resultsSource.getItems())}}function CoreSearchGlobalSearchPage_core_empty_box_18_p_1_Template(e,r){1&e&&(o.j41(0,"p",18),o.EFF(1),o.nI1(2,"translate"),o.k0s()),2&e&&(o.R7$(),o.JRh(o.bMT(2,1,"core.search.empty")))}function CoreSearchGlobalSearchPage_core_empty_box_18_ng_container_2_Template(e,r){if(1&e&&(o.qex(0),o.j41(1,"p")(2,"strong"),o.EFF(3),o.nI1(4,"translate"),o.k0s()(),o.j41(5,"p")(6,"small"),o.EFF(7),o.nI1(8,"translate"),o.k0s()(),o.bVm()),2&e){const e=o.XpG(2);o.R7$(3),o.JRh(o.i5U(4,2,"core.search.noresults",o.eq3(7,_c0,e.resultsSource.getQuery()))),o.R7$(4),o.JRh(o.bMT(8,5,"core.search.noresultshelp"))}}function CoreSearchGlobalSearchPage_core_empty_box_18_Template(e,r){if(1&e&&(o.j41(0,"core-empty-box",16),o.DNE(1,CoreSearchGlobalSearchPage_core_empty_box_18_p_1_Template,3,3,"p",17)(2,CoreSearchGlobalSearchPage_core_empty_box_18_ng_container_2_Template,9,9,"ng-container",2),o.k0s()),2&e){const e=o.XpG();o.Y8G("dimmed",!e.resultsSource.isLoaded()),o.R7$(),o.Y8G("ngIf",!e.resultsSource.isLoaded()),o.R7$(),o.Y8G("ngIf",e.resultsSource.isLoaded())}}let F=(()=>{var e;class CoreSearchGlobalSearchPage{constructor(){this.courseId=null,this.loadMoreError=!1,this.searchBanner=null,this.resultsSource=new c.u("",{})}ngOnInit(){var e,r,t;const a=i.CoreSites.getRequiredCurrentSite(),o=null!==(e=null===(r=a.config)||void 0===r||null===(r=r.searchbanner)||void 0===r?void 0:r.trim())&&void 0!==e?e:"",s=S.CoreNavigator.getRouteNumberParam("courseId");u.j.isTrueOrOne(null===(t=a.config)||void 0===t?void 0:t.searchbannerenable)&&o.length>0&&(this.searchBanner=o),s&&(this.courseId=s,this.resultsSource.setFilters({courseIds:[s]})),this.filtersObserver=g.z.on(m.CORE_SEARCH_GLOBAL_SEARCH_FILTERS_UPDATED,(e=>this.resultsSource.setFilters(e)))}ngAfterViewInit(){const e=S.CoreNavigator.getRouteParam("query");e&&(this.searchBox&&(this.searchBox.searchText=e),this.search(e))}ngOnDestroy(){var e;null===(e=this.filtersObserver)||void 0===e||e.off()}search(e){var r=this;return(0,l.A)((function*(){r.resultsSource.setQuery(e),r.resultsSource.hasEmptyQuery()||(yield n.CoreDomUtils.showOperationModals("core.searching",!0,(0,l.A)((function*(){yield r.resultsSource.reload(),yield f.g.ignoreErrors(m.CoreSearchGlobalSearch.logViewResults(r.resultsSource.getQuery(),r.resultsSource.getFilters())),h.OF.logEvent({type:h.qr.VIEW_ITEM_LIST,ws:"core_search_view_results",name:_.HT.instant("core.search.globalsearch"),data:{query:e,filters:JSON.stringify(r.resultsSource.getFilters())},url:d.F.addParamsToUrl("/search/index.php",{q:e})})}))))}))()}clearSearch(){this.loadMoreError=!1,this.resultsSource.setQuery(""),this.resultsSource.reset()}openFilters(){var e=this;return(0,l.A)((function*(){const{CoreSearchGlobalSearchFiltersComponent:r}=yield t.e(4378).then(t.bind(t,54378));yield p.I.openSideModal({component:r,componentProps:{hideCourses:!!e.courseId,filters:e.resultsSource.getFilters()}}),!e.resultsSource.hasEmptyQuery()&&e.resultsSource.isDirty()&&(yield n.CoreDomUtils.showOperationModals("core.searching",!0,(()=>e.resultsSource.reload())))}))()}visitResult(e){return(0,l.A)((function*(){yield i.CoreSites.visitLink(e.url)}))()}loadMoreResults(e){var r=this;return(0,l.A)((function*(){try{var t;yield null===(t=r.resultsSource)||void 0===t?void 0:t.load()}catch(e){r.loadMoreError=!0}finally{e()}}))()}}return(e=CoreSearchGlobalSearchPage).ɵfac=function CoreSearchGlobalSearchPage_Factory(r){return new(r||e)},e.ɵcmp=o.VBU({type:e,selectors:[["page-core-search-global-search"]],viewQuery:function CoreSearchGlobalSearchPage_Query(e,r){if(1&e&&o.GBs(b.M,5),2&e){let e;o.mGM(e=o.lsd())&&(r.searchBox=e.first)}},decls:23,vars:20,consts:[["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],[1,"limited-width"],["class","core-danger-card",4,"ngIf"],["searchArea","CoreSearchGlobalSearch",3,"onSubmit","onClear","placeholder","searchLabel","autoFocus"],[3,"action","enabled","error"],["icon","fas-magnifying-glass",3,"dimmed",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-filter","aria-hidden","true"],[1,"core-danger-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[3,"result","onClick",4,"ngFor","ngForOf"],[3,"onClick","result"],["icon","fas-magnifying-glass",3,"dimmed"],["role","alert",4,"ngIf"],["role","alert"]],template:function CoreSearchGlobalSearchPage_Template(e,r){1&e&&(o.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),o.nrm(3,"ion-back-button",1),o.nI1(4,"translate"),o.k0s(),o.j41(5,"ion-title"),o.DNE(6,CoreSearchGlobalSearchPage_h1_6_Template,3,3,"h1",2)(7,CoreSearchGlobalSearchPage_h1_7_Template,3,3,"h1",2),o.k0s(),o.j41(8,"ion-buttons",3),o.nrm(9,"core-user-menu-button"),o.k0s()()(),o.j41(10,"ion-content",4)(11,"div"),o.DNE(12,CoreSearchGlobalSearchPage_ion_card_12_Template,5,1,"ion-card",5),o.j41(13,"core-search-box",6),o.nI1(14,"translate"),o.nI1(15,"translate"),o.bIt("onSubmit",(function CoreSearchGlobalSearchPage_Template_core_search_box_onSubmit_13_listener(e){return r.search(e)}))("onClear",(function CoreSearchGlobalSearchPage_Template_core_search_box_onClear_13_listener(){return r.clearSearch()})),o.k0s(),o.DNE(16,CoreSearchGlobalSearchPage_ion_list_16_Template,2,1,"ion-list",2),o.j41(17,"core-infinite-loading",7),o.bIt("action",(function CoreSearchGlobalSearchPage_Template_core_infinite_loading_action_17_listener(e){return r.loadMoreResults(e)})),o.k0s(),o.DNE(18,CoreSearchGlobalSearchPage_core_empty_box_18_Template,3,3,"core-empty-box",8),o.j41(19,"ion-fab",9)(20,"ion-fab-button",10),o.nI1(21,"translate"),o.bIt("click",(function CoreSearchGlobalSearchPage_Template_ion_fab_button_click_20_listener(){return r.openFilters()})),o.nrm(22,"ion-icon",11),o.k0s()()()()),2&e&&(o.R7$(3),o.Y8G("text",o.bMT(4,12,"core.back")),o.R7$(3),o.Y8G("ngIf",r.courseId),o.R7$(),o.Y8G("ngIf",!r.courseId),o.R7$(5),o.Y8G("ngIf",r.searchBanner),o.R7$(),o.Y8G("placeholder",o.bMT(14,14,"core.search"))("searchLabel",o.bMT(15,16,"core.search"))("autoFocus",!0),o.R7$(3),o.Y8G("ngIf",r.resultsSource.isLoaded()),o.R7$(),o.Y8G("enabled",r.resultsSource.isLoaded()&&!r.resultsSource.isCompleted())("error",r.loadMoreError),o.R7$(),o.Y8G("ngIf",r.resultsSource.isEmpty()),o.R7$(2),o.BMQ("aria-label",o.bMT(21,18,"core.filter")))},dependencies:[C.Sq,C.bT,y.h,I.b,G.A,v.t,P.B,T.i,M.QW,M.b_,M.W9,M.Q8,M.YW,M.eU,M.iq,M.uz,M.he,M.nf,M.BC,M.ai,M.el,b.M,R.V,E.U,k.D9],encapsulation:2}),CoreSearchGlobalSearchPage})();var x=t(51734),$=t(47720),j=t(42858);function buildRoutes(e){return(0,j.B)(e,{component:F})}let L=(()=>{var e;class CoreSearchLazyModule{}return(e=CoreSearchLazyModule).ɵfac=function CoreSearchLazyModule_Factory(r){return new(r||e)},e.ɵmod=o.$C({type:e}),e.ɵinj=o.G2t({providers:[{provide:s.bw,multi:!0,deps:[o.zZn],useFactory:buildRoutes}],imports:[a.n,x._,$.E]}),CoreSearchLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&o.Obh(L,{declarations:[F],imports:[a.n,x._,$.E]}))}}]);