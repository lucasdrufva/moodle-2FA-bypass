"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3312],{13312:(o,e,t)=>{t.r(e),t.d(e,{default:()=>E});var n=t(3353),r=t(21182),i=t(91120),a=t(8444),l=t(10467),s=t(12808),d=t(98870),c=t(22693),p=t(23780),_=t(15324),m=t(52749),u=t(89911),C=t(79555),R=t(24742),g=t(54438),f=t(60177),h=t(64422),I=t(16658),T=t(86198),k=t(58197),F=t(88246),$=t(43570),b=t(73465),A=t(59528),P=t(73955);function AddonCourseCompletionReportPage_ion_item_14_Template(o,e){if(1&o&&(g.j41(0,"ion-item",8),g.nrm(1,"core-user-avatar",9),g.j41(2,"ion-label")(3,"p",10),g.EFF(4),g.k0s()()()),2&o){const o=g.XpG();g.R7$(),g.Y8G("user",o.user)("courseId",o.courseId)("linkProfile",!1),g.R7$(3),g.JRh(o.user.fullname)}}function AddonCourseCompletionReportPage_ion_card_15_p_14_Template(o,e){1&o&&(g.j41(0,"p"),g.EFF(1),g.nI1(2,"translate"),g.k0s()),2&o&&(g.R7$(),g.JRh(g.bMT(2,1,"addon.coursecompletion.criteriarequiredall")))}function AddonCourseCompletionReportPage_ion_card_15_p_15_Template(o,e){1&o&&(g.j41(0,"p"),g.EFF(1),g.nI1(2,"translate"),g.k0s()),2&o&&(g.R7$(),g.JRh(g.bMT(2,1,"addon.coursecompletion.criteriarequiredany")))}function AddonCourseCompletionReportPage_ion_card_15_Template(o,e){if(1&o&&(g.j41(0,"ion-card")(1,"ion-item",8)(2,"ion-label")(3,"p",10),g.EFF(4),g.nI1(5,"translate"),g.k0s(),g.j41(6,"p"),g.EFF(7),g.nI1(8,"translate"),g.k0s()()(),g.j41(9,"ion-item",8)(10,"ion-label")(11,"p",10),g.EFF(12),g.nI1(13,"translate"),g.k0s(),g.DNE(14,AddonCourseCompletionReportPage_ion_card_15_p_14_Template,3,3,"p",6)(15,AddonCourseCompletionReportPage_ion_card_15_p_15_Template,3,3,"p",6),g.k0s()()()),2&o){const o=g.XpG();g.R7$(4),g.JRh(g.bMT(5,5,"addon.coursecompletion.status")),g.R7$(3),g.JRh(g.bMT(8,7,o.statusText)),g.R7$(5),g.JRh(g.bMT(13,9,"addon.coursecompletion.required")),g.R7$(2),g.Y8G("ngIf",1===o.completion.aggregation),g.R7$(),g.Y8G("ngIf",2===o.completion.aggregation)}}function AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_6_Template(o,e){1&o&&(g.j41(0,"strong",17),g.EFF(1),g.nI1(2,"translate"),g.k0s()),2&o&&(g.R7$(),g.JRh(g.bMT(2,1,"core.yes")))}function AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_7_Template(o,e){1&o&&(g.j41(0,"strong",17),g.EFF(1),g.nI1(2,"translate"),g.k0s()),2&o&&(g.R7$(),g.JRh(g.bMT(2,1,"core.no")))}function AddonCourseCompletionReportPage_ion_card_16_ion_item_6_Template(o,e){if(1&o&&(g.j41(0,"ion-item",14)(1,"ion-label")(2,"p",10),g.nrm(3,"core-format-text",15),g.k0s(),g.j41(4,"p"),g.nrm(5,"core-format-text",15),g.k0s()(),g.DNE(6,AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_6_Template,3,3,"strong",16)(7,AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_7_Template,3,3,"strong",16),g.k0s()),2&o){const o=e.$implicit;g.R7$(3),g.Y8G("text",o.details.criteria)("filter",!1),g.R7$(2),g.Y8G("text",o.details.requirement)("filter",!1),g.R7$(),g.Y8G("ngIf",o.complete),g.R7$(),g.Y8G("ngIf",!o.complete)}}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_9_Template(o,e){1&o&&(g.j41(0,"ion-col"),g.EFF(1),g.nI1(2,"translate"),g.k0s()),2&o&&(g.R7$(),g.JRh(g.bMT(2,1,"core.yes")))}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_10_Template(o,e){1&o&&(g.j41(0,"ion-col"),g.EFF(1),g.nI1(2,"translate"),g.k0s()),2&o&&(g.R7$(),g.JRh(g.bMT(2,1,"core.no")))}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_11_Template(o,e){if(1&o&&(g.j41(0,"ion-col"),g.EFF(1),g.nI1(2,"coreFormatDate"),g.k0s()),2&o){const o=g.XpG().$implicit;g.R7$(),g.SpI(" ",g.i5U(2,1,1e3*o.timecompleted,"strftimedatetimeshort")," ")}}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_12_Template(o,e){1&o&&g.nrm(0,"ion-col")}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_Template(o,e){if(1&o&&(g.j41(0,"ion-row")(1,"ion-col"),g.nrm(2,"core-format-text",15),g.k0s(),g.j41(3,"ion-col"),g.nrm(4,"core-format-text",15),g.k0s(),g.j41(5,"ion-col"),g.nrm(6,"core-format-text",15),g.k0s(),g.j41(7,"ion-col"),g.nrm(8,"core-format-text",18),g.k0s(),g.DNE(9,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_9_Template,3,3,"ion-col",6)(10,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_10_Template,3,3,"ion-col",6)(11,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_11_Template,3,4,"ion-col",6)(12,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_12_Template,1,0,"ion-col",6),g.k0s()),2&o){const o=e.$implicit;g.R7$(2),g.Y8G("text",o.details.type)("filter",!1),g.R7$(2),g.Y8G("text",o.details.criteria)("filter",!1),g.R7$(2),g.Y8G("text",o.details.requirement)("filter",!1),g.R7$(2),g.Y8G("text",o.details.status)("filter",!1),g.R7$(),g.Y8G("ngIf",o.complete),g.R7$(),g.Y8G("ngIf",!o.complete),g.R7$(),g.Y8G("ngIf",o.timecompleted),g.R7$(),g.Y8G("ngIf",!o.timecompleted)}}function AddonCourseCompletionReportPage_ion_card_16_Template(o,e){if(1&o&&(g.j41(0,"ion-card")(1,"ion-item-divider")(2,"ion-label")(3,"h2"),g.EFF(4),g.nI1(5,"translate"),g.k0s()()(),g.DNE(6,AddonCourseCompletionReportPage_ion_card_16_ion_item_6_Template,8,6,"ion-item",11),g.j41(7,"ion-item",12)(8,"ion-label")(9,"ion-row")(10,"ion-col")(11,"strong"),g.EFF(12),g.nI1(13,"translate"),g.k0s()(),g.j41(14,"ion-col")(15,"strong"),g.EFF(16),g.nI1(17,"translate"),g.k0s()(),g.j41(18,"ion-col")(19,"strong"),g.EFF(20),g.nI1(21,"translate"),g.k0s()(),g.j41(22,"ion-col")(23,"strong"),g.EFF(24),g.nI1(25,"translate"),g.k0s()(),g.j41(26,"ion-col")(27,"strong"),g.EFF(28),g.nI1(29,"translate"),g.k0s()(),g.j41(30,"ion-col")(31,"strong"),g.EFF(32),g.nI1(33,"translate"),g.k0s()()(),g.DNE(34,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_Template,13,12,"ion-row",13),g.k0s()()()),2&o){const o=g.XpG();g.R7$(4),g.JRh(g.bMT(5,9,"addon.coursecompletion.requiredcriteria")),g.R7$(2),g.Y8G("ngForOf",o.completion.completions),g.R7$(6),g.JRh(g.bMT(13,11,"addon.coursecompletion.criteriagroup")),g.R7$(4),g.JRh(g.bMT(17,13,"addon.coursecompletion.criteria")),g.R7$(4),g.JRh(g.bMT(21,15,"addon.coursecompletion.requirement")),g.R7$(4),g.JRh(g.bMT(25,17,"addon.coursecompletion.status")),g.R7$(4),g.JRh(g.bMT(29,19,"addon.coursecompletion.complete")),g.R7$(4),g.JRh(g.bMT(33,21,"addon.coursecompletion.completiondate")),g.R7$(2),g.Y8G("ngForOf",o.completion.completions)}}function AddonCourseCompletionReportPage_ion_card_17_Template(o,e){if(1&o){const o=g.RV6();g.j41(0,"ion-card")(1,"ion-item-divider")(2,"ion-label")(3,"h2"),g.EFF(4),g.nI1(5,"translate"),g.k0s()()(),g.j41(6,"ion-item")(7,"ion-label")(8,"ion-button",19),g.bIt("click",(function AddonCourseCompletionReportPage_ion_card_17_Template_ion_button_click_8_listener(){g.eBV(o);const e=g.XpG();return g.Njj(e.completeCourse())})),g.EFF(9),g.nI1(10,"translate"),g.k0s()()()()}2&o&&(g.R7$(4),g.JRh(g.bMT(5,2,"addon.coursecompletion.manualselfcompletion")),g.R7$(5),g.SpI(" ",g.bMT(10,4,"addon.coursecompletion.completecourse")," "))}function AddonCourseCompletionReportPage_ion_card_18_Template(o,e){1&o&&(g.j41(0,"ion-card",20)(1,"ion-item"),g.nrm(2,"ion-icon",21),g.j41(3,"ion-label"),g.EFF(4),g.nI1(5,"translate"),g.k0s()()()),2&o&&(g.R7$(4),g.JRh(g.bMT(5,1,"addon.coursecompletion.nottracked")))}let j=(()=>{var o;class AddonCourseCompletionReportPage{constructor(){this.completionLoaded=!1,this.showSelfComplete=!1,this.tracked=!0,this.logView=R.j.once((()=>{c.OF.logEvent({type:c.qr.VIEW_ITEM,ws:"core_completion_get_course_completion_status",name:C.HT.instant("addon.coursecompletion.coursecompletion"),data:{course:this.courseId,user:this.userId},url:`/blocks/completionstatus/details.php?course=${this.courseId}&user=${this.userId}`})}))}ngOnInit(){try{this.courseId=_.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.userId=_.CoreNavigator.getRouteNumberParam("userId")||m.CoreSites.getCurrentSiteUserId()}catch(o){return u.CoreDomUtils.showErrorModal(o),_.CoreNavigator.back(),void 0}this.fetchCompletion().finally((()=>{this.completionLoaded=!0}))}fetchCompletion(){var o=this;return(0,l.A)((function*(){try{o.user=yield d.CoreUser.getProfile(o.userId,o.courseId,!0),o.completion=yield s.AddonCourseCompletion.getCompletion(o.courseId,o.userId),o.statusText=s.AddonCourseCompletion.getCompletedStatusText(o.completion),o.showSelfComplete=s.AddonCourseCompletion.canMarkSelfCompleted(o.userId,o.completion),o.tracked=!0,o.logView()}catch(e){e&&"notenroled"==e.errorcode?o.tracked=!1:u.CoreDomUtils.showErrorModalDefault(e,"addon.coursecompletion.couldnotloadreport",!0)}}))()}refreshCompletion(o){var e=this;return(0,l.A)((function*(){yield s.AddonCourseCompletion.invalidateCourseCompletion(e.courseId,e.userId).finally((()=>{e.fetchCompletion().finally((()=>{null==o||o.complete()}))}))}))()}completeCourse(){var o=this;return(0,l.A)((function*(){const e=yield p.CoreLoadings.show("core.sending",!0);try{yield s.AddonCourseCompletion.markCourseAsSelfCompleted(o.courseId),yield o.refreshCompletion()}catch(o){u.CoreDomUtils.showErrorModal(o)}finally{e.dismiss()}}))()}}return(o=AddonCourseCompletionReportPage).ɵfac=function AddonCourseCompletionReportPage_Factory(e){return new(e||o)},o.ɵcmp=g.VBU({type:o,selectors:[["page-addon-course-completion-report"]],decls:19,vars:16,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-wrap",4,"ngIf"],[4,"ngIf"],["class","core-warning-card",4,"ngIf"],[1,"ion-text-wrap"],["slot","start",3,"user","courseId","linkProfile"],[1,"item-heading"],["class","ion-hide-md-up ion-text-wrap",4,"ngFor","ngForOf"],[1,"ion-hide-md-down","ion-text-wrap"],[4,"ngFor","ngForOf"],[1,"ion-hide-md-up","ion-text-wrap"],["clean","true",3,"text","filter"],["slot","end",4,"ngIf"],["slot","end"],[3,"text","filter"],["expand","block",3,"click"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"]],template:function AddonCourseCompletionReportPage_Template(o,e){1&o&&(g.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),g.nrm(3,"ion-back-button",1),g.nI1(4,"translate"),g.k0s(),g.j41(5,"ion-title")(6,"h1"),g.EFF(7),g.nI1(8,"translate"),g.k0s()()()(),g.j41(9,"ion-content")(10,"ion-refresher",2),g.bIt("ionRefresh",(function AddonCourseCompletionReportPage_Template_ion_refresher_ionRefresh_10_listener(o){return e.refreshCompletion(o.target)})),g.nrm(11,"ion-refresher-content",3),g.nI1(12,"translate"),g.k0s(),g.j41(13,"core-loading",4),g.DNE(14,AddonCourseCompletionReportPage_ion_item_14_Template,5,4,"ion-item",5)(15,AddonCourseCompletionReportPage_ion_card_15_Template,16,11,"ion-card",6)(16,AddonCourseCompletionReportPage_ion_card_16_Template,35,23,"ion-card",6)(17,AddonCourseCompletionReportPage_ion_card_17_Template,11,6,"ion-card",6)(18,AddonCourseCompletionReportPage_ion_card_18_Template,6,3,"ion-card",7),g.k0s()()),2&o&&(g.R7$(3),g.Y8G("text",g.bMT(4,10,"core.back")),g.R7$(4),g.JRh(g.bMT(8,12,"addon.coursecompletion.coursecompletion")),g.R7$(3),g.Y8G("disabled",!e.completionLoaded),g.R7$(),g.FS9("pullingText",g.bMT(12,14,"core.pulltorefresh")),g.R7$(2),g.Y8G("hideUntil",e.completionLoaded),g.R7$(),g.Y8G("ngIf",e.user),g.R7$(),g.Y8G("ngIf",e.completion&&e.tracked),g.R7$(),g.Y8G("ngIf",e.completion&&e.tracked),g.R7$(),g.Y8G("ngIf",e.showSelfComplete&&e.tracked),g.R7$(),g.Y8G("ngIf",!e.tracked))},dependencies:[f.Sq,f.bT,h.R,I.T,T.t,k.B,F.i,$.T,b.Jm,b.QW,b.b_,b.hU,b.W9,b.eU,b.iq,b.uz,b.Dg,b.he,b.To,b.Ki,b.ln,b.BC,b.ai,b.el,A.f,P.D9],encapsulation:2}),AddonCourseCompletionReportPage})();const w=[{path:"",component:j}];let E=(()=>{var o;class AddonCourseCompletionLazyModule{}return(o=AddonCourseCompletionLazyModule).ɵfac=function AddonCourseCompletionLazyModule_Factory(e){return new(e||o)},o.ɵmod=g.$C({type:o}),o.ɵinj=g.G2t({imports:[r.iI.forChild(w),n.n,i.G,a.O]}),AddonCourseCompletionLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&g.Obh(E,{declarations:[j],imports:[r.iI,n.n,i.G,a.O]}))}}]);