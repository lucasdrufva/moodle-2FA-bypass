"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4150],{14150:(e,t,n)=>{n.r(t),n.d(t,{default:()=>z});var o=n(3353),s=n(21182),i=n(91120),r=n(8444),a=n(10467),d=n(74431),c=n(90378),l=n(8044),_=n(43496),u=n(89818),f=n(98870),p=n(73465),g=n(22693),I=n(15324),h=n(52749),m=n(89911),N=n(75383),b=n(8014),y=n(55554),A=n(79555),T=n(49882),L=n(24742),C=n(45433),G=n(6319),R=n(22542),D=n(54438),P=n(60177),k=n(69502),v=n(17388),w=n(16986),O=n(64422),$=n(13988),M=n(16658),j=n(7570),E=n(19858),F=n(86198),x=n(58197),Y=n(88246),S=n(43570),V=n(2423),U=n(73955);const _c0=e=>({$a:e});function AddonNotesListPage_ion_item_24_Template(e,t){if(1&e&&(D.j41(0,"ion-item",19),D.nrm(1,"core-user-avatar",20),D.j41(2,"ion-label")(3,"p",21),D.EFF(4),D.k0s()()()),2&e){const e=D.XpG();D.R7$(),D.Y8G("user",e.user)("courseId",e.courseId)("linkProfile",!1),D.R7$(3),D.JRh(e.user.fullname)}}function AddonNotesListPage_ion_card_35_Template(e,t){1&e&&(D.j41(0,"ion-card",22)(1,"ion-item"),D.nrm(2,"ion-icon",23),D.j41(3,"ion-label"),D.EFF(4),D.nI1(5,"translate"),D.nI1(6,"lowercase"),D.nI1(7,"translate"),D.k0s()()()),2&e&&(D.R7$(4),D.SpI(" ",D.i5U(7,5,"core.thereisdatatosync",D.eq3(8,_c0,D.bMT(6,3,D.bMT(5,1,"addon.notes.notes"))))," "))}function AddonNotesListPage_core_empty_box_36_Template(e,t){1&e&&(D.nrm(0,"core-empty-box",24),D.nI1(1,"translate")),2&e&&D.Y8G("message",D.bMT(1,1,"addon.notes.nonotes"))}function AddonNotesListPage_ng_container_37_ion_card_1_core_user_avatar_2_Template(e,t){if(1&e&&D.nrm(0,"core-user-avatar",31),2&e){const e=D.XpG().$implicit,t=D.XpG(2);D.Y8G("user",e)("courseId",t.courseId)}}function AddonNotesListPage_ng_container_37_ion_card_1_p_4_Template(e,t){if(1&e&&(D.j41(0,"p",21),D.EFF(1),D.k0s()),2&e){const e=D.XpG().$implicit;D.R7$(),D.JRh(e.userfullname)}}function AddonNotesListPage_ng_container_37_ion_card_1_p_5_Template(e,t){if(1&e&&(D.j41(0,"p",2)(1,"span",19),D.EFF(2),D.nI1(3,"coreDateDayOrTime"),D.k0s()()),2&e){const e=D.XpG().$implicit;D.R7$(2),D.JRh(D.bMT(3,1,e.lastmodified))}}function AddonNotesListPage_ng_container_37_ion_card_1_p_6_Template(e,t){1&e&&(D.j41(0,"p",2),D.nrm(1,"ion-icon",32),D.j41(2,"span",19),D.EFF(3),D.nI1(4,"translate"),D.k0s()()),2&e&&(D.R7$(3),D.SpI(" ",D.bMT(4,1,"core.notsent")," "))}function AddonNotesListPage_ng_container_37_ion_card_1_p_7_Template(e,t){1&e&&(D.j41(0,"p",2),D.nrm(1,"ion-icon",33),D.j41(2,"span",19),D.EFF(3),D.nI1(4,"translate"),D.k0s()()),2&e&&(D.R7$(3),D.SpI(" ",D.bMT(4,1,"core.deletedoffline")," "))}function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template(e,t){if(1&e){const e=D.RV6();D.j41(0,"ion-button",34),D.nI1(1,"translate"),D.bIt("click",(function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template_ion_button_click_0_listener(t){D.eBV(e);const n=D.XpG().$implicit,o=D.XpG(2);return D.Njj(o.undoDeleteNote(t,n))})),D.nrm(2,"ion-icon",35),D.k0s()}2&e&&D.Y8G("ariaLabel",D.bMT(1,1,"core.restore"))}function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template(e,t){if(1&e){const e=D.RV6();D.j41(0,"ion-button",34),D.nI1(1,"translate"),D.bIt("click",(function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template_ion_button_click_0_listener(t){D.eBV(e);const n=D.XpG().$implicit,o=D.XpG(2);return D.Njj(o.deleteNote(t,n))})),D.nrm(2,"ion-icon",36),D.k0s()}2&e&&D.Y8G("@coreSlideInOut","fromRight")("ariaLabel",D.bMT(1,2,"core.delete"))}function AddonNotesListPage_ng_container_37_ion_card_1_Template(e,t){if(1&e&&(D.j41(0,"ion-card")(1,"ion-item",19),D.DNE(2,AddonNotesListPage_ng_container_37_ion_card_1_core_user_avatar_2_Template,1,2,"core-user-avatar",26),D.j41(3,"ion-label"),D.DNE(4,AddonNotesListPage_ng_container_37_ion_card_1_p_4_Template,2,1,"p",27)(5,AddonNotesListPage_ng_container_37_ion_card_1_p_5_Template,4,3,"p",28),D.k0s(),D.DNE(6,AddonNotesListPage_ng_container_37_ion_card_1_p_6_Template,5,3,"p",28)(7,AddonNotesListPage_ng_container_37_ion_card_1_p_7_Template,5,3,"p",28)(8,AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template,3,3,"ion-button",29)(9,AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template,3,4,"ion-button",29),D.k0s(),D.j41(10,"ion-item",19)(11,"ion-label"),D.nrm(12,"core-format-text",30),D.k0s()()()),2&e){const e=t.$implicit,n=D.XpG(2);D.R7$(2),D.Y8G("ngIf",!n.userId),D.R7$(2),D.Y8G("ngIf",!n.userId),D.R7$(),D.Y8G("ngIf",!e.deleted&&!e.offline),D.R7$(),D.Y8G("ngIf",e.offline),D.R7$(),D.Y8G("ngIf",e.deleted),D.R7$(),D.Y8G("ngIf",e.deleted),D.R7$(),D.Y8G("ngIf",n.showDelete&&!e.deleted&&("personal"!==n.type||e.usermodified===n.currentUserId)),D.R7$(3),D.Y8G("text",e.content)("filter",!1)}}function AddonNotesListPage_ng_container_37_Template(e,t){if(1&e&&(D.qex(0),D.DNE(1,AddonNotesListPage_ng_container_37_ion_card_1_Template,13,9,"ion-card",25),D.bVm()),2&e){const e=D.XpG();D.R7$(),D.Y8G("ngForOf",e.notes)}}function AddonNotesListPage_ion_fab_38_Template(e,t){if(1&e){const e=D.RV6();D.j41(0,"ion-fab",37)(1,"ion-fab-button",38),D.nI1(2,"translate"),D.bIt("click",(function AddonNotesListPage_ion_fab_38_Template_ion_fab_button_click_1_listener(t){D.eBV(e);const n=D.XpG();return D.Njj(n.addNote(t))})),D.nrm(3,"ion-icon",39),D.j41(4,"span",40),D.EFF(5),D.nI1(6,"translate"),D.k0s()()()}2&e&&(D.R7$(),D.BMQ("aria-label",D.bMT(2,2,"addon.notes.addnewnote")),D.R7$(4),D.JRh(D.bMT(6,4,"addon.notes.addnewnote")))}let X=(()=>{var e;class AddonNotesListPage{constructor(){this.type="course",this.refreshIcon=d.CoreConstants.ICON_LOADING,this.syncIcon=d.CoreConstants.ICON_LOADING,this.notes=[],this.hasOffline=!1,this.notesLoaded=!1,this.showDelete=!1,this.canDeleteNotes=!1,this.logView=L.j.once((()=>this.performLogView()));try{this.courseId=I.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.userId=I.CoreNavigator.getRouteNumberParam("userId")}catch(e){return m.CoreDomUtils.showErrorModal(e),I.CoreNavigator.back(),void 0}this.syncObserver=T.z.on(R.a,(e=>{var t;e.courseId==this.courseId&&(this.showSyncWarnings(e.warnings),this.notesLoaded=!1,this.refreshIcon=d.CoreConstants.ICON_LOADING,this.syncIcon=d.CoreConstants.ICON_LOADING,null===(t=this.content)||void 0===t||t.scrollToTop(),this.fetchNotes(!1))}),h.CoreSites.getCurrentSiteId()),this.currentUserId=h.CoreSites.getCurrentSiteUserId()}ngOnInit(){var e=this;return(0,a.A)((function*(){yield e.fetchNotes(!0)}))()}fetchNotes(e=!1,t=!1){var n=this;return(0,a.A)((function*(){e&&(yield n.syncNotes(t));try{const e=(yield c.AddonNotes.getNotes(n.courseId,n.userId))[n.type+"notes"]||[];e.forEach((e=>{e.content=N.Ni.decodeHTML(e.content)})),yield c.AddonNotes.setOfflineDeletedNotes(e,n.courseId),n.hasOffline=e.some((e=>e.offline||e.deleted)),n.userId?(n.notes=e,n.user=yield f.CoreUser.getProfile(n.userId,n.courseId,!0)):n.notes=yield c.AddonNotes.getNotesUserData(e),n.logView()}catch(e){m.CoreDomUtils.showErrorModal(e)}finally{let e=n.notes&&n.notes.length>0;e&&"personal"==n.type&&(e=!!n.notes.find((e=>e.usermodified==n.currentUserId))),n.canDeleteNotes=e,n.notesLoaded=!0,n.refreshIcon=d.CoreConstants.ICON_REFRESH,n.syncIcon=d.CoreConstants.ICON_SYNC}}))()}refreshNotes(e,t){this.refreshIcon=d.CoreConstants.ICON_LOADING,this.syncIcon=d.CoreConstants.ICON_LOADING,c.AddonNotes.invalidateNotes(this.courseId,this.userId).finally((()=>{this.fetchNotes(!0,e).finally((()=>{t&&(null==t||t.complete())}))}))}typeChanged(e){var t=this;return(0,a.A)((function*(){t.type=e,t.notesLoaded=!1,t.refreshIcon=d.CoreConstants.ICON_LOADING,t.syncIcon=d.CoreConstants.ICON_LOADING,yield t.fetchNotes(!0)}))()}addNote(e){var t=this;return(0,a.A)((function*(){e.preventDefault(),e.stopPropagation(),t.logViewAdd();const{AddonNotesAddComponent:o}=yield n.e(4956).then(n.bind(n,94956)),s=yield G.I.openModal({component:o,componentProps:{userId:t.userId,courseId:t.courseId,type:t.type}});void 0!==s&&(s.sent&&s.type?(s.type!=t.type&&(t.type=s.type,t.notesLoaded=!1),t.refreshNotes(!1)):s.type&&s.type!=t.type&&t.typeChanged(s.type))}))()}deleteNote(e,t){var n=this;return(0,a.A)((function*(){e.preventDefault(),e.stopPropagation();try{n.logViewDelete(t),yield m.CoreDomUtils.showDeleteConfirm("addon.notes.deleteconfirm");try{yield c.AddonNotes.deleteNote(t,n.courseId),n.showDelete=!1,n.refreshNotes(!1),C.CoreToasts.show({message:"addon.notes.eventnotedeleted",translateMessage:!0,duration:C.ToastDuration.LONG})}catch(e){m.CoreDomUtils.showErrorModalDefault(e,"Delete note failed.")}}catch{}}))()}undoDeleteNote(e,t){var n=this;return(0,a.A)((function*(){e.preventDefault(),e.stopPropagation(),yield l.AddonNotesOffline.undoDeleteNote(t.id),n.refreshNotes(!1)}))()}toggleDelete(){this.showDelete=!this.showDelete}syncNotes(e){var t=this;return(0,a.A)((function*(){try{const e=yield _.AddonNotesSync.syncNotes(t.courseId);t.showSyncWarnings(e.warnings)}catch(t){e&&m.CoreDomUtils.showErrorModalDefault(t,"core.errorsync",!0)}}))()}showSyncWarnings(e){const t=N.Ni.buildMessage(e);t&&m.CoreDomUtils.showAlert(void 0,t)}performLogView(){var e=this;return(0,a.A)((function*(){yield y.g.ignoreErrors(c.AddonNotes.logView(e.courseId,e.userId)),g.OF.logEvent({type:g.qr.VIEW_ITEM_LIST,ws:"core_notes_view_notes",name:A.HT.instant("addon.notes.notes"),data:{courseid:e.courseId,userid:e.userId||0,category:"notes"},url:b.F.addParamsToUrl("/notes/index.php",{user:e.userId,course:e.courseId!==h.CoreSites.getCurrentSiteHomeId()?e.courseId:void 0})})}))()}logViewAdd(){var e=this;return(0,a.A)((function*(){g.OF.logEvent({type:g.qr.VIEW_ITEM,ws:"core_notes_create_notes",name:A.HT.instant("addon.notes.notes"),data:{courseid:e.courseId,userid:e.userId||0,category:"notes"},url:b.F.addParamsToUrl("/notes/edit.php",{courseid:e.courseId,userid:e.userId,publishstate:"personal"===e.type?"draft":"course"===e.type?"public":"site"})})}))()}logViewDelete(e){return(0,a.A)((function*(){e.id&&g.OF.logEvent({type:g.qr.VIEW_ITEM,ws:"core_notes_delete_notes",name:A.HT.instant("addon.notes.notes"),data:{id:e.id,category:"notes"},url:`/notes/delete.php?id=${e.id}`})}))()}ngOnDestroy(){this.syncObserver&&this.syncObserver.off()}}return(e=AddonNotesListPage).ɵfac=function AddonNotesListPage_Factory(t){return new(t||e)},e.ɵcmp=D.VBU({type:e,selectors:[["page-addon-notes-list-page"]],viewQuery:function AddonNotesListPage_Query(e,t){if(1&e&&D.GBs(p.W9,5),2&e){let e;D.mGM(e=D.lsd())&&(t.content=e.first)}},decls:39,vars:45,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","end","fill","clear",3,"click","ariaLabel"],["name","fas-pen","slot","icon-only","aria-hidden","true"],[3,"action","hidden","priority","content","iconAction","closeOnClick"],[1,"limited-width"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-wrap",4,"ngIf"],[3,"onChange","selection"],["value","site",1,"ion-text-wrap"],["value","course",1,"ion-text-wrap"],["value","personal",1,"ion-text-wrap"],["class","core-warning-card",4,"ngIf"],["icon","fas-receipt",3,"message",4,"ngIf"],[4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],[1,"ion-text-wrap"],["slot","start",3,"user","courseId","linkProfile"],[1,"item-heading"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["icon","fas-receipt",3,"message"],[4,"ngFor","ngForOf"],["slot","start",3,"user","courseId",4,"ngIf"],["class","item-heading",4,"ngIf"],["slot","end",4,"ngIf"],["slot","end","fill","clear","color","danger",3,"ariaLabel","click",4,"ngIf"],[3,"text","filter"],["slot","start",3,"user","courseId"],["name","fas-clock","aria-hidden","true"],["name","fas-trash","aria-hidden","true"],["slot","end","fill","clear","color","danger",3,"click","ariaLabel"],["name","fas-rotate-left","slot","icon-only","aria-hidden","true"],["name","fas-trash","slot","icon-only","aria-hidden","true"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"]],template:function AddonNotesListPage_Template(e,t){1&e&&(D.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),D.nrm(3,"ion-back-button",1),D.nI1(4,"translate"),D.k0s(),D.j41(5,"ion-title")(6,"h1"),D.EFF(7),D.nI1(8,"translate"),D.k0s()(),D.nrm(9,"ion-buttons",2),D.k0s()(),D.j41(10,"core-navbar-buttons",2)(11,"ion-button",3),D.nI1(12,"translate"),D.bIt("click",(function AddonNotesListPage_Template_ion_button_click_11_listener(){return t.toggleDelete()})),D.nrm(13,"ion-icon",4),D.k0s(),D.j41(14,"core-context-menu")(15,"core-context-menu-item",5),D.nI1(16,"translate"),D.bIt("action",(function AddonNotesListPage_Template_core_context_menu_item_action_15_listener(){return t.refreshNotes(!1)})),D.k0s(),D.j41(17,"core-context-menu-item",5),D.nI1(18,"translate"),D.bIt("action",(function AddonNotesListPage_Template_core_context_menu_item_action_17_listener(){return t.refreshNotes(!0)})),D.k0s()()(),D.j41(19,"ion-content",6)(20,"ion-refresher",7),D.bIt("ionRefresh",(function AddonNotesListPage_Template_ion_refresher_ionRefresh_20_listener(e){return t.refreshNotes(!1,e.target)})),D.nrm(21,"ion-refresher-content",8),D.nI1(22,"translate"),D.k0s(),D.j41(23,"core-loading",9),D.DNE(24,AddonNotesListPage_ion_item_24_Template,5,4,"ion-item",10),D.j41(25,"core-combobox",11),D.bIt("onChange",(function AddonNotesListPage_Template_core_combobox_onChange_25_listener(e){return t.typeChanged(e)})),D.j41(26,"ion-select-option",12),D.EFF(27),D.nI1(28,"translate"),D.k0s(),D.j41(29,"ion-select-option",13),D.EFF(30),D.nI1(31,"translate"),D.k0s(),D.j41(32,"ion-select-option",14),D.EFF(33),D.nI1(34,"translate"),D.k0s()(),D.DNE(35,AddonNotesListPage_ion_card_35_Template,8,10,"ion-card",15)(36,AddonNotesListPage_core_empty_box_36_Template,2,3,"core-empty-box",16)(37,AddonNotesListPage_ng_container_37_Template,2,1,"ng-container",17),D.k0s(),D.DNE(38,AddonNotesListPage_ion_fab_38_Template,7,6,"ion-fab",18),D.k0s()),2&e&&(D.R7$(3),D.Y8G("text",D.bMT(4,27,"core.back")),D.R7$(4),D.JRh(D.bMT(8,29,"addon.notes.notes")),D.R7$(4),D.AVh("hidden",!t.canDeleteNotes),D.Y8G("ariaLabel",D.bMT(12,31,"core.toggledelete")),D.R7$(4),D.Y8G("hidden",!(t.notesLoaded&&!t.hasOffline))("priority",100)("content",D.bMT(16,33,"core.refresh"))("iconAction",t.refreshIcon)("closeOnClick",!0),D.R7$(2),D.Y8G("hidden",!(t.notesLoaded&&t.hasOffline))("priority",100)("content",D.bMT(18,35,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1),D.R7$(3),D.Y8G("disabled",!t.notesLoaded),D.R7$(),D.FS9("pullingText",D.bMT(22,37,"core.pulltorefresh")),D.R7$(2),D.Y8G("hideUntil",t.notesLoaded),D.R7$(),D.Y8G("ngIf",t.user),D.R7$(),D.Y8G("selection",t.type),D.R7$(2),D.SpI(" ",D.bMT(28,39,"addon.notes.sitenotes")," "),D.R7$(3),D.SpI(" ",D.bMT(31,41,"addon.notes.coursenotes")," "),D.R7$(3),D.SpI(" ",D.bMT(34,43,"addon.notes.personalnotes")," "),D.R7$(2),D.Y8G("ngIf",t.hasOffline),D.R7$(),D.Y8G("ngIf",t.notes&&0===t.notes.length),D.R7$(),D.Y8G("ngIf",t.notes&&t.notes.length>0),D.R7$(),D.Y8G("ngIf",t.userId&&t.notesLoaded))},dependencies:[P.Sq,P.bT,k.B,v.Q,w.h,O.R,$.c,M.T,j._,E.A,F.t,x.B,Y.i,S.T,p.Jm,p.QW,p.b_,p.W9,p.Q8,p.YW,p.eU,p.iq,p.uz,p.he,p.To,p.Ki,p.Ip,p.BC,p.ai,p.el,P.GH,V.Y,U.D9],encapsulation:2,data:{animation:[u.d.SLIDE_IN_OUT]}}),AddonNotesListPage})();const W=[{path:"",component:X}];let z=(()=>{var e;class AddonNotesLazyModule{}return(e=AddonNotesLazyModule).ɵfac=function AddonNotesLazyModule_Factory(t){return new(t||e)},e.ɵmod=D.$C({type:e}),e.ɵinj=D.G2t({imports:[s.iI.forChild(W),o.n,i.G,r.O]}),AddonNotesLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&D.Obh(z,{declarations:[X],imports:[s.iI,o.n,i.G,r.O]}))}}]);