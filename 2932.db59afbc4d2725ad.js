"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2932],{52266:(e,r,t)=>{t.d(r,{Z:()=>CoreSwipeNavigationItemsManager});var i=t(10467),o=t(15324),n=t(95990);class CoreSwipeNavigationItemsManager extends n.u{start(){var e=this;return(0,i.A)((function*(){e.updateSelectedItem()}))()}navigateToNextItem(){var e=this;return(0,i.A)((function*(){yield e.navigateToItemBy(1,"forward")}))()}navigateToPreviousItem(){var e=this;return(0,i.A)((function*(){yield e.navigateToItemBy(-1,"back")}))()}hasNextItem(){var e=this;return(0,i.A)((function*(){return!!(yield e.getItemBy(1))}))()}hasPreviousItem(){var e=this;return(0,i.A)((function*(){return!!(yield e.getItemBy(-1))}))()}getCurrentPageRoute(){return o.CoreNavigator.getCurrentRoute()}getSelectedItemPathFromRoute(e){const r=[];for(;e&&(r.push(...o.CoreNavigator.getRouteUrl(e)),e.firstChild);)e=e.firstChild;return r.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(e,r){var t=this;return(0,i.A)((function*(){const i=yield t.getItemBy(e);i&&(yield t.navigateToItem(i,{animationDirection:r,replace:!0}))}))()}getItemBy(e){var r=this;return(0,i.A)((function*(){var t;const i=r.getSource().getItems(),o=null!==(t=r.selectedItem&&(null==i?void 0:i.indexOf(r.selectedItem)))&&void 0!==t?t:-1;if(-1===o||null===i)return null;const n=e>0?1:-1;let s=o,a=0;for(;a!==e;){if(s+=n,s<0)return null;if(s>=i.length)break;r.skipItemInSwipe(i[s])||(a+=n)}return a===e?i[s]:r.getSource().isCompleted()?null:(yield r.getSource().load(),r.getItemBy(e))}))()}skipItemInSwipe(e){return!1}}},52932:(e,r,t)=>{t.r(r),t.d(r,{default:()=>w});var i=t(21182),o=t(3353),n=t(10467),s=t(52749),a=t(89911),l=t(49882),_=t(98870),d=t(41131),c=t(5784),u=t(55554),g=t(15324),f=t(66110),p=t(52266),m=t(32379),I=t(83696),P=t(24742),C=t(22693),h=t(79555),b=t(54438),U=t(60177),T=t(16986),v=t(64422),R=t(16658),y=t(86198),$=t(68273),k=t(28988),G=t(88246),E=t(43570),M=t(73465),F=t(93453),x=t(73955);const _c0=e=>["core-user-profile-handler",e],_c1=e=>({$a:e});function CoreUserProfilePage_ion_list_13_p_6_Template(e,r){if(1&e&&(b.j41(0,"p"),b.nrm(1,"ion-icon",17),b.EFF(2),b.k0s()),2&e){const e=b.XpG(2);b.R7$(),b.BMQ("aria-hidden",!0),b.R7$(),b.SpI(" ",e.user.address," ")}}function CoreUserProfilePage_ion_list_13_p_7_Template(e,r){if(1&e&&(b.j41(0,"p")(1,"strong"),b.EFF(2),b.nI1(3,"translate"),b.k0s(),b.EFF(4),b.nI1(5,"translate"),b.k0s()),2&e){const e=b.XpG(2);b.R7$(2),b.JRh(b.bMT(3,3,"core.user.roles")),b.R7$(2),b.Lme("",b.bMT(5,5,"core.labelsep")," ",e.rolesFormatted," ")}}function CoreUserProfilePage_ion_list_13_p_8_span_4_Template(e,r){if(1&e&&(b.j41(0,"span"),b.EFF(1),b.nI1(2,"coreTimeAgo"),b.k0s()),2&e){const e=b.XpG(3);b.R7$(),b.JRh(b.bMT(2,1,e.user.lastaccess))}}function CoreUserProfilePage_ion_list_13_p_8_ng_container_5_Template(e,r){1&e&&(b.qex(0),b.EFF(1),b.nI1(2,"translate"),b.bVm()),2&e&&(b.R7$(),b.JRh(b.bMT(2,1,"core.never")))}function CoreUserProfilePage_ion_list_13_p_8_Template(e,r){if(1&e&&(b.j41(0,"p")(1,"strong"),b.EFF(2),b.nI1(3,"translate"),b.k0s(),b.DNE(4,CoreUserProfilePage_ion_list_13_p_8_span_4_Template,3,3,"span",7)(5,CoreUserProfilePage_ion_list_13_p_8_ng_container_5_Template,3,3,"ng-container",7),b.k0s()),2&e){const e=b.XpG(2);b.R7$(2),b.SpI("",b.bMT(3,3,"core.lastaccess"),": "),b.R7$(2),b.Y8G("ngIf",e.user.lastaccess),b.R7$(),b.Y8G("ngIf",!e.user.lastaccess)}}function CoreUserProfilePage_ion_list_13_div_9_ion_item_1_ion_button_2_ion_icon_2_Template(e,r){if(1&e&&b.nrm(0,"ion-icon",22),2&e){const e=b.XpG().$implicit;b.Y8G("name",e.icon)}}function CoreUserProfilePage_ion_list_13_div_9_ion_item_1_ion_button_2_Template(e,r){if(1&e){const e=b.RV6();b.j41(0,"ion-button",20),b.nI1(1,"translate"),b.bIt("click",(function CoreUserProfilePage_ion_list_13_div_9_ion_item_1_ion_button_2_Template_ion_button_click_0_listener(r){const t=b.eBV(e).$implicit,i=b.XpG(4);return b.Njj(i.handlerClicked(r,t))})),b.DNE(2,CoreUserProfilePage_ion_list_13_div_9_ion_item_1_ion_button_2_ion_icon_2_Template,1,1,"ion-icon",21),b.EFF(3),b.nI1(4,"translate"),b.k0s()}if(2&e){const e=r.$implicit;b.Y8G("ngClass",b.eq3(10,_c0,e.class||""))("hidden",e.hidden)("disabled",e.spinner),b.BMQ("aria-label",b.bMT(1,6,e.title)),b.R7$(2),b.Y8G("ngIf",e.icon),b.R7$(),b.SpI(" ",b.bMT(4,8,e.title)," ")}}function CoreUserProfilePage_ion_list_13_div_9_ion_item_1_Template(e,r){if(1&e&&(b.j41(0,"ion-item")(1,"ion-label"),b.DNE(2,CoreUserProfilePage_ion_list_13_div_9_ion_item_1_ion_button_2_Template,5,12,"ion-button",19),b.k0s()()),2&e){const e=b.XpG(3);b.R7$(2),b.Y8G("ngForOf",e.buttonHandlers)}}function CoreUserProfilePage_ion_list_13_div_9_div_2_Template(e,r){1&e&&(b.j41(0,"div",23),b.nrm(1,"ion-spinner"),b.nI1(2,"translate"),b.k0s()),2&e&&(b.R7$(),b.BMQ("aria-label",b.bMT(2,1,"core.loading")))}function CoreUserProfilePage_ion_list_13_div_9_Template(e,r){if(1&e&&(b.j41(0,"div",18),b.DNE(1,CoreUserProfilePage_ion_list_13_div_9_ion_item_1_Template,3,1,"ion-item",7)(2,CoreUserProfilePage_ion_list_13_div_9_div_2_Template,3,3,"div",15),b.k0s()),2&e){const e=b.XpG(2);b.R7$(),b.Y8G("ngIf",e.buttonHandlers&&e.buttonHandlers.length),b.R7$(),b.Y8G("ngIf",e.isLoadingHandlers)}}function CoreUserProfilePage_ion_list_13_ion_item_17_Template(e,r){1&e&&(b.j41(0,"ion-item",23)(1,"ion-label"),b.nrm(2,"ion-spinner"),b.nI1(3,"translate"),b.k0s()()),2&e&&(b.R7$(2),b.BMQ("aria-label",b.bMT(3,1,"core.loading")))}function CoreUserProfilePage_ion_list_13_ion_item_18_ion_icon_2_Template(e,r){if(1&e&&b.nrm(0,"ion-icon",22),2&e){const e=b.XpG().$implicit;b.Y8G("name",e.icon)}}function CoreUserProfilePage_ion_list_13_ion_item_18_ion_badge_7_Template(e,r){if(1&e&&(b.j41(0,"ion-badge",28),b.EFF(1),b.k0s()),2&e){const e=b.XpG().$implicit;b.Y8G("hidden",e.loading||!e.badge),b.R7$(),b.SpI(" ",e.badge," ")}}function CoreUserProfilePage_ion_list_13_ion_item_18_span_8_Template(e,r){if(1&e&&(b.j41(0,"span",29),b.EFF(1),b.nI1(2,"translate"),b.k0s()),2&e){const e=b.XpG().$implicit;b.R7$(),b.SpI(" ",b.i5U(2,1,e.badgeA11yText,b.eq3(4,_c1,e.badge))," ")}}function CoreUserProfilePage_ion_list_13_ion_item_18_ion_spinner_9_Template(e,r){1&e&&(b.nrm(0,"ion-spinner",30),b.nI1(1,"translate")),2&e&&b.BMQ("aria-label",b.bMT(1,1,"core.loading"))}function CoreUserProfilePage_ion_list_13_ion_item_18_Template(e,r){if(1&e){const e=b.RV6();b.j41(0,"ion-item",24),b.nI1(1,"translate"),b.bIt("click",(function CoreUserProfilePage_ion_list_13_ion_item_18_Template_ion_item_click_0_listener(r){const t=b.eBV(e).$implicit,i=b.XpG(2);return b.Njj(i.handlerClicked(r,t))})),b.DNE(2,CoreUserProfilePage_ion_list_13_ion_item_18_ion_icon_2_Template,1,1,"ion-icon",21),b.j41(3,"ion-label")(4,"p",14),b.EFF(5),b.nI1(6,"translate"),b.k0s()(),b.DNE(7,CoreUserProfilePage_ion_list_13_ion_item_18_ion_badge_7_Template,2,2,"ion-badge",25)(8,CoreUserProfilePage_ion_list_13_ion_item_18_span_8_Template,3,6,"span",26)(9,CoreUserProfilePage_ion_list_13_ion_item_18_ion_spinner_9_Template,2,3,"ion-spinner",27),b.k0s()}if(2&e){const e=r.$implicit;b.Y8G("ngClass",b.eq3(13,_c0,e.class||""))("hidden",e.hidden)("detail",!0),b.BMQ("aria-label",b.bMT(1,9,e.title)),b.R7$(2),b.Y8G("ngIf",e.icon),b.R7$(3),b.JRh(b.bMT(6,11,e.title)),b.R7$(2),b.Y8G("ngIf",e.showBadge),b.R7$(),b.Y8G("ngIf",e.showBadge&&e.badge&&e.badgeA11yText),b.R7$(),b.Y8G("ngIf",e.showBadge&&e.loading)}}function CoreUserProfilePage_ion_list_13_Template(e,r){if(1&e){const e=b.RV6();b.j41(0,"ion-list")(1,"ion-item",9),b.nrm(2,"core-user-avatar",10),b.j41(3,"ion-label")(4,"h1"),b.EFF(5),b.k0s(),b.DNE(6,CoreUserProfilePage_ion_list_13_p_6_Template,3,2,"p",7)(7,CoreUserProfilePage_ion_list_13_p_7_Template,6,7,"p",7)(8,CoreUserProfilePage_ion_list_13_p_8_Template,6,5,"p",7),b.k0s()(),b.DNE(9,CoreUserProfilePage_ion_list_13_div_9_Template,3,2,"div",11),b.j41(10,"ion-item",12),b.nI1(11,"translate"),b.bIt("click",(function CoreUserProfilePage_ion_list_13_Template_ion_item_click_10_listener(){b.eBV(e);const r=b.XpG();return b.Njj(r.openUserDetails())})),b.nrm(12,"ion-icon",13),b.j41(13,"ion-label")(14,"p",14),b.EFF(15),b.nI1(16,"translate"),b.k0s()()(),b.DNE(17,CoreUserProfilePage_ion_list_13_ion_item_17_Template,4,3,"ion-item",15)(18,CoreUserProfilePage_ion_list_13_ion_item_18_Template,10,15,"ion-item",16),b.k0s()}if(2&e){const e=b.XpG();b.R7$(2),b.Y8G("user",e.user)("userId",e.user.id)("linkProfile",!1)("checkOnline",!0),b.R7$(3),b.JRh(e.user.fullname),b.R7$(),b.Y8G("ngIf",e.user.address),b.R7$(),b.Y8G("ngIf",e.rolesFormatted),b.R7$(),b.Y8G("ngIf",void 0!==e.user.lastaccess),b.R7$(),b.Y8G("ngIf",e.buttonHandlers&&e.buttonHandlers.length||e.isLoadingHandlers),b.R7$(),b.Y8G("detail",!0),b.BMQ("aria-label",b.bMT(11,14,"core.user.details")),b.R7$(5),b.JRh(b.bMT(16,16,"core.user.details")),b.R7$(2),b.Y8G("ngIf",e.isLoadingHandlers),b.R7$(),b.Y8G("ngForOf",e.listItemHandlers)}}function CoreUserProfilePage_core_empty_box_14_Template(e,r){1&e&&(b.nrm(0,"core-empty-box",31),b.nI1(1,"translate")),2&e&&b.Y8G("message",b.bMT(1,1,"core.user.detailsnotavailable"))}function CoreUserProfilePage_core_empty_box_15_Template(e,r){1&e&&(b.nrm(0,"core-empty-box",31),b.nI1(1,"translate")),2&e&&b.Y8G("message",b.bMT(1,1,"core.userdeleted"))}function CoreUserProfilePage_core_empty_box_16_Template(e,r){1&e&&(b.nrm(0,"core-empty-box",31),b.nI1(1,"translate")),2&e&&b.Y8G("message",b.bMT(1,1,"core.usersuspended"))}function CoreUserProfilePage_core_empty_box_17_Template(e,r){1&e&&(b.nrm(0,"core-empty-box",31),b.nI1(1,"translate")),2&e&&b.Y8G("message",b.bMT(1,1,"core.notenrolledprofile"))}let S=(()=>{var e;class CoreUserProfilePage{constructor(e){var r=this;this.route=e,this.userLoaded=!1,this.isLoadingHandlers=!1,this.isDeleted=!1,this.isSuspended=!1,this.isEnrolled=!0,this.listItemHandlers=[],this.buttonHandlers=[],this.obsProfileRefreshed=l.z.on(_.USER_PROFILE_REFRESHED,(e=>{this.user&&e.user&&(this.user.email=e.user.email)}),s.CoreSites.getCurrentSiteId()),this.logView=P.j.once(function(){var e=(0,n.A)((function*(e){try{yield _.CoreUser.logView(r.userId,r.courseId,e.fullname)}catch(e){r.isDeleted="userdeleted"===(null==e?void 0:e.errorcode)||"wsaccessuserdeleted"===(null==e?void 0:e.errorcode),r.isSuspended="wsaccessusersuspended"===(null==e?void 0:e.errorcode),r.isEnrolled="notenrolledprofile"!==(null==e?void 0:e.errorcode)}let t="";if(r.userId!==s.CoreSites.getCurrentSiteUserId()){const e=r.courseId&&r.courseId!==s.CoreSites.getCurrentSiteHomeId();t=`?id=${r.userId}`+(e?`&course=${r.courseId}`:"")}C.OF.logEvent({type:C.qr.VIEW_ITEM,ws:"core_user_view_user_profile",name:e.fullname+": "+h.HT.instant("core.publicprofile"),data:{id:r.userId,courseid:r.courseId||void 0,category:"user"},url:`/user/profile.php${t}`})}));return function(r){return e.apply(this,arguments)}}())}ngOnInit(){var e=this;return(0,n.A)((function*(){try{e.site=s.CoreSites.getRequiredCurrentSite(),e.courseId=g.CoreNavigator.getRouteNumberParam("courseId"),e.userId=g.CoreNavigator.getRequiredRouteNumberParam("userId")}catch(e){return a.CoreDomUtils.showErrorModal(e),g.CoreNavigator.back(),void 0}if(e.courseId===e.site.getSiteHomeId()&&(e.courseId=void 0),e.courseId&&"participants"===g.CoreNavigator.getRouteData(e.route).swipeManagerSource){const r=g.CoreNavigator.getRouteParam("search"),t=I.u.getOrCreateSource(m.u,[e.courseId,r]);e.users=new CoreUserSwipeItemsManager(t),e.users.start()}try{yield e.fetchUser()}finally{e.userLoaded=!0}}))()}fetchUser(){var e=this;return(0,n.A)((function*(){try{var r;const t=yield _.CoreUser.getProfile(e.userId,e.courseId);e.rolesFormatted="roles"in t?d.CoreUserHelper.formatRoleList(t.roles):"",e.user=t,null===(r=e.subscription)||void 0===r||r.unsubscribe();const i=e.courseId?c.CoreUserDelegateContext.COURSE:c.CoreUserDelegateContext.SITE;e.subscription=c.CoreUserDelegate.getProfileHandlersFor(t,i,e.courseId).subscribe((r=>{e.listItemHandlers=[],e.buttonHandlers=[],r.forEach((r=>{switch(r.type){case c.CoreUserProfileHandlerType.BUTTON:e.buttonHandlers.push(r.data);break;case c.CoreUserProfileHandlerType.LIST_ACCOUNT_ITEM:break;default:e.listItemHandlers.push(r.data)}})),e.isLoadingHandlers=!c.CoreUserDelegate.areHandlersLoaded(t.id,i,e.courseId)})),e.logView(t)}catch(e){a.CoreDomUtils.showErrorModal(e)}}))()}refreshUser(e){var r=this;return(0,n.A)((function*(){var t;(yield u.g.ignoreErrors(Promise.all([_.CoreUser.invalidateUserCache(r.userId),f.CoreCourses.invalidateUserNavigationOptions(),f.CoreCourses.invalidateUserAdministrationOptions()])),yield r.fetchUser(),null==e||e.complete(),r.user)&&l.z.trigger(_.USER_PROFILE_REFRESHED,{courseId:r.courseId,userId:r.userId,user:r.user},null===(t=r.site)||void 0===t?void 0:t.getId())}))()}openUserDetails(){g.CoreNavigator.navigateToSitePath("user/about",{params:{courseId:this.courseId,userId:this.userId}})}handlerClicked(e,r){if(!this.user)return;r.action(e,this.user,this.courseId?c.CoreUserDelegateContext.COURSE:c.CoreUserDelegateContext.SITE,this.courseId)}ngOnDestroy(){var e,r;null===(e=this.users)||void 0===e||e.destroy(),null===(r=this.subscription)||void 0===r||r.unsubscribe(),this.obsProfileRefreshed.off()}}return(e=CoreUserProfilePage).ɵfac=function CoreUserProfilePage_Factory(r){return new(r||e)(b.rXU(i.nX))},e.ɵcmp=b.VBU({type:e,selectors:[["page-core-user-profile"]],decls:18,vars:15,consts:[["collapsible",""],["slot","start"],[3,"text"],[1,"limited-width",3,"core-swipe-navigation"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["icon","far-user",3,"message",4,"ngIf"],["collapsible","",1,"core-user-profile-maininfo","ion-text-wrap"],["slot","start",3,"user","userId","linkProfile","checkOnline"],["class","core-user-communication-handlers",4,"ngIf"],["button","",1,"ion-text-wrap","core-user-profile-handler",3,"click","detail"],["name","fas-user","slot","start","aria-hidden","true"],[1,"item-heading"],["class","ion-text-center core-loading-handlers",4,"ngIf"],["button","","class","ion-text-wrap",3,"ngClass","hidden","detail","click",4,"ngFor","ngForOf"],["name","fas-location-dot"],[1,"core-user-communication-handlers"],["expand","block","size","default",3,"ngClass","hidden","disabled","click",4,"ngFor","ngForOf"],["expand","block","size","default",3,"click","ngClass","hidden","disabled"],["slot","start","aria-hidden","true",3,"name",4,"ngIf"],["slot","start","aria-hidden","true",3,"name"],[1,"ion-text-center","core-loading-handlers"],["button","",1,"ion-text-wrap",3,"click","ngClass","hidden","detail"],["slot","end","aria-hidden","true",3,"hidden",4,"ngIf"],["class","sr-only",4,"ngIf"],["slot","end",4,"ngIf"],["slot","end","aria-hidden","true",3,"hidden"],[1,"sr-only"],["slot","end"],["icon","far-user",3,"message"]],template:function CoreUserProfilePage_Template(e,r){1&e&&(b.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),b.nrm(3,"ion-back-button",2),b.nI1(4,"translate"),b.k0s(),b.j41(5,"ion-title")(6,"h1"),b.EFF(7),b.k0s()()()(),b.j41(8,"ion-content",3)(9,"ion-refresher",4),b.bIt("ionRefresh",(function CoreUserProfilePage_Template_ion_refresher_ionRefresh_9_listener(e){return r.refreshUser(e.target)})),b.nrm(10,"ion-refresher-content",5),b.nI1(11,"translate"),b.k0s(),b.j41(12,"core-loading",6),b.DNE(13,CoreUserProfilePage_ion_list_13_Template,19,18,"ion-list",7)(14,CoreUserProfilePage_core_empty_box_14_Template,2,3,"core-empty-box",8)(15,CoreUserProfilePage_core_empty_box_15_Template,2,3,"core-empty-box",8)(16,CoreUserProfilePage_core_empty_box_16_Template,2,3,"core-empty-box",8)(17,CoreUserProfilePage_core_empty_box_17_Template,2,3,"core-empty-box",8),b.k0s()()),2&e&&(b.R7$(3),b.Y8G("text",b.bMT(4,11,"core.back")),b.R7$(4),b.JRh(null==r.user?null:r.user.fullname),b.R7$(),b.Y8G("core-swipe-navigation",r.users),b.R7$(),b.Y8G("disabled",!r.userLoaded),b.R7$(),b.FS9("pullingText",b.bMT(11,13,"core.pulltorefresh")),b.R7$(2),b.Y8G("hideUntil",r.userLoaded),b.R7$(),b.Y8G("ngIf",r.user&&!r.isDeleted&&r.isEnrolled),b.R7$(),b.Y8G("ngIf",!r.user&&!r.isDeleted&&r.isEnrolled),b.R7$(),b.Y8G("ngIf",r.isDeleted),b.R7$(),b.Y8G("ngIf",r.isSuspended),b.R7$(),b.Y8G("ngIf",!r.isEnrolled))},dependencies:[U.YU,U.Sq,U.bT,T.h,v.R,R.T,y.t,$.M,k.n,G.i,E.T,M.In,M.Jm,M.QW,M.W9,M.eU,M.iq,M.uz,M.he,M.nf,M.To,M.Ki,M.w2,M.BC,M.ai,M.el,F.A,x.D9],styles:["[_nghost-%COMP%]   core-user-avatar[_ngcontent-%COMP%]{--core-avatar-size: var(--core-large-avatar-size);--contact-status-size: 24px;--margin-end-on-item: 16px}[_nghost-%COMP%]   core-user-avatar[_ngcontent-%COMP%]   .contact-status[_ngcontent-%COMP%]{right:calc(50% - 12px - var(--core-avatar-size) / 2)!important}"]}),CoreUserProfilePage})();class CoreUserSwipeItemsManager extends p.Z{getSelectedItemPathFromRoute(e){return g.CoreNavigator.getRouteParams(e).userId}}const Y=[{path:"",component:S}];let w=(()=>{var e;class CoreUserProfileLazyModule{}return(e=CoreUserProfileLazyModule).ɵfac=function CoreUserProfileLazyModule_Factory(r){return new(r||e)},e.ɵmod=b.$C({type:e}),e.ɵinj=b.G2t({imports:[i.iI.forChild(Y),o.n]}),CoreUserProfileLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&b.Obh(w,{declarations:[S],imports:[i.iI,o.n]}))}}]);