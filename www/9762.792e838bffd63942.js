"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9762],{16450:(e,o,n)=>{n.d(o,{c:()=>AddonModForumDiscussionsSwipeManager});var s=n(52266);class AddonModForumDiscussionsSwipeManager extends s.Z{skipItemInSwipe(e){return this.getSource().isNewDiscussionForm(e)}}},49762:(e,o,n)=>{n.r(o),n.d(o,{default:()=>Q});var s=n(21182),i=n(64548),t=n(6007),r=n(98833),a=n(3353),d=n(10467),u=n(89417),c=n(49882),l=n(15221),m=n(15324),p=n(16179),g=n(41450),f=n(86275),_=n(52749),h=n(89911),I=n(79555),w=n(48966),D=n(11945),v=n(81690),M=n(93956),b=n(16082),C=n(75383),A=n(63153),G=n(16450),F=n(6369),T=n(83696),N=n(24742),y=n(22693),P=n(2216),R=n(23780),S=n(55554),j=n(54438),x=n(29492),E=n(51024),k=n(60177),O=n(95638),$=n(64422),V=n(86198),B=n(58197),U=n(28988),Y=n(88246),X=n(43570),L=n(73465),H=n(73955);const z=["newDiscFormEl"],_c1=e=>({header:e});function AddonModForumNewDiscussionPage_form_15_div_19_ion_item_1_Template(e,o){if(1&e){const e=j.RV6();j.j41(0,"ion-item",21)(1,"ion-toggle",24),j.mxI("ngModelChange",(function AddonModForumNewDiscussionPage_form_15_div_19_ion_item_1_Template_ion_toggle_ngModelChange_1_listener(o){j.eBV(e);const n=j.XpG(3);return j.DH7(n.newDiscussion.postToAllGroups,o)||(n.newDiscussion.postToAllGroups=o),j.Njj(o)})),j.EFF(2),j.nI1(3,"translate"),j.k0s()()}if(2&e){const e=j.XpG(3);j.R7$(),j.R50("ngModel",e.newDiscussion.postToAllGroups),j.R7$(),j.SpI(" ",j.bMT(3,2,"addon.mod_forum.posttomygroups")," ")}}function AddonModForumNewDiscussionPage_form_15_div_19_ion_item_2_ion_select_option_7_Template(e,o){if(1&e&&(j.j41(0,"ion-select-option",29),j.nrm(1,"core-format-text",30),j.k0s()),2&e){const e=o.$implicit,n=j.XpG(4);j.Y8G("value",e.id),j.R7$(),j.Y8G("text",e.name)("contextInstanceId",n.courseId)("wsNotFiltered",!0)}}function AddonModForumNewDiscussionPage_form_15_div_19_ion_item_2_Template(e,o){if(1&e){const e=j.RV6();j.j41(0,"ion-item",25)(1,"ion-select",26),j.nI1(2,"translate"),j.nI1(3,"translate"),j.mxI("ngModelChange",(function AddonModForumNewDiscussionPage_form_15_div_19_ion_item_2_Template_ion_select_ngModelChange_1_listener(o){j.eBV(e);const n=j.XpG(3);return j.DH7(n.newDiscussion.groupId,o)||(n.newDiscussion.groupId=o),j.Njj(o)})),j.bIt("ionChange",(function AddonModForumNewDiscussionPage_form_15_div_19_ion_item_2_Template_ion_select_ionChange_1_listener(){j.eBV(e);const o=j.XpG(3);return j.Njj(o.calculateGroupName())})),j.j41(4,"p",27),j.EFF(5),j.nI1(6,"translate"),j.k0s(),j.DNE(7,AddonModForumNewDiscussionPage_form_15_div_19_ion_item_2_ion_select_option_7_Template,2,4,"ion-select-option",28),j.k0s()()}if(2&e){const e=j.XpG(3);j.R7$(),j.R50("ngModel",e.newDiscussion.groupId),j.Y8G("disabled",e.newDiscussion.postToAllGroups)("interfaceOptions",j.eq3(12,_c1,j.bMT(2,6,"addon.mod_forum.group")))("cancelText",j.bMT(3,8,"core.cancel")),j.R7$(4),j.JRh(j.bMT(6,10,"addon.mod_forum.group")),j.R7$(2),j.Y8G("ngForOf",e.groups)}}function AddonModForumNewDiscussionPage_form_15_div_19_ion_item_7_Template(e,o){if(1&e){const e=j.RV6();j.j41(0,"ion-item",21)(1,"ion-toggle",31),j.mxI("ngModelChange",(function AddonModForumNewDiscussionPage_form_15_div_19_ion_item_7_Template_ion_toggle_ngModelChange_1_listener(o){j.eBV(e);const n=j.XpG(3);return j.DH7(n.newDiscussion.pin,o)||(n.newDiscussion.pin=o),j.Njj(o)})),j.EFF(2),j.nI1(3,"translate"),j.k0s()()}if(2&e){const e=j.XpG(3);j.R7$(),j.R50("ngModel",e.newDiscussion.pin),j.R7$(),j.SpI(" ",j.bMT(3,2,"addon.mod_forum.discussionpinned")," ")}}function AddonModForumNewDiscussionPage_form_15_div_19_core_attachments_8_Template(e,o){if(1&e&&j.nrm(0,"core-attachments",32),2&e){const e=j.XpG(3);j.Y8G("files",e.newDiscussion.files)("maxSize",e.forum.maxbytes)("maxSubmissions",e.forum.maxattachments)("component",e.component)("componentId",e.forum.cmid)("allowOffline",!0)("courseId",e.courseId)}}function AddonModForumNewDiscussionPage_form_15_div_19_Template(e,o){if(1&e){const e=j.RV6();j.j41(0,"div",18),j.DNE(1,AddonModForumNewDiscussionPage_form_15_div_19_ion_item_1_Template,4,4,"ion-item",19)(2,AddonModForumNewDiscussionPage_form_15_div_19_ion_item_2_Template,8,14,"ion-item",20),j.j41(3,"ion-item",21)(4,"ion-toggle",22),j.mxI("ngModelChange",(function AddonModForumNewDiscussionPage_form_15_div_19_Template_ion_toggle_ngModelChange_4_listener(o){j.eBV(e);const n=j.XpG(2);return j.DH7(n.newDiscussion.subscribe,o)||(n.newDiscussion.subscribe=o),j.Njj(o)})),j.EFF(5),j.nI1(6,"translate"),j.k0s()(),j.DNE(7,AddonModForumNewDiscussionPage_form_15_div_19_ion_item_7_Template,4,4,"ion-item",19)(8,AddonModForumNewDiscussionPage_form_15_div_19_core_attachments_8_Template,1,7,"core-attachments",23),j.k0s()}if(2&e){const e=j.XpG(2);j.R7$(),j.Y8G("ngIf",e.showGroups&&e.groupIds.length>1&&e.accessInfo.cancanposttomygroups),j.R7$(),j.Y8G("ngIf",e.showGroups),j.R7$(2),j.R50("ngModel",e.newDiscussion.subscribe),j.R7$(),j.SpI(" ",j.bMT(6,6,"addon.mod_forum.discussionsubscription")," "),j.R7$(2),j.Y8G("ngIf",e.canPin),j.R7$(),j.Y8G("ngIf",e.canCreateAttachments&&e.forum&&e.forum.maxattachments>0)}}function AddonModForumNewDiscussionPage_form_15_ion_item_20_Template(e,o){if(1&e&&(j.j41(0,"ion-item",33),j.nrm(1,"ion-icon",34),j.j41(2,"ion-label"),j.nrm(3,"core-format-text",30),j.k0s()()),2&e){const e=j.XpG(2);j.R7$(3),j.Y8G("text",e.postInGroupMessage)("contextInstanceId",e.courseId)("wsNotFiltered",!0)}}function AddonModForumNewDiscussionPage_form_15_ion_col_24_Template(e,o){if(1&e){const e=j.RV6();j.j41(0,"ion-col")(1,"ion-button",35),j.bIt("click",(function AddonModForumNewDiscussionPage_form_15_ion_col_24_Template_ion_button_click_1_listener(){j.eBV(e);const o=j.XpG(2);return j.Njj(o.discard())})),j.EFF(2),j.nI1(3,"translate"),j.k0s()()}2&e&&(j.R7$(2),j.JRh(j.bMT(3,1,"core.discard")))}function AddonModForumNewDiscussionPage_form_15_Template(e,o){if(1&e){const e=j.RV6();j.j41(0,"form",null,0)(2,"ion-item")(3,"ion-input",9),j.nI1(4,"translate"),j.nI1(5,"translate"),j.mxI("ngModelChange",(function AddonModForumNewDiscussionPage_form_15_Template_ion_input_ngModelChange_3_listener(o){j.eBV(e);const n=j.XpG();return j.DH7(n.newDiscussion.subject,o)||(n.newDiscussion.subject=o),j.Njj(o)})),j.k0s()(),j.j41(6,"ion-item")(7,"ion-label",10),j.EFF(8),j.nI1(9,"translate"),j.k0s(),j.j41(10,"core-rich-text-editor",11),j.nI1(11,"translate"),j.bIt("contentChanged",(function AddonModForumNewDiscussionPage_form_15_Template_core_rich_text_editor_contentChanged_10_listener(o){j.eBV(e);const n=j.XpG();return j.Njj(n.onMessageChange(o))})),j.k0s()(),j.j41(12,"ion-item",12),j.nI1(13,"translate"),j.bIt("click",(function AddonModForumNewDiscussionPage_form_15_Template_ion_item_click_12_listener(){j.eBV(e);const o=j.XpG();return j.Njj(o.toggleAdvanced())})),j.nrm(14,"ion-icon",13),j.j41(15,"ion-label")(16,"h2"),j.EFF(17),j.nI1(18,"translate"),j.k0s()()(),j.DNE(19,AddonModForumNewDiscussionPage_form_15_div_19_Template,9,8,"div",14)(20,AddonModForumNewDiscussionPage_form_15_ion_item_20_Template,4,3,"ion-item",15),j.j41(21,"ion-item",16)(22,"ion-label")(23,"ion-row"),j.DNE(24,AddonModForumNewDiscussionPage_form_15_ion_col_24_Template,4,3,"ion-col",8),j.j41(25,"ion-col")(26,"ion-button",17),j.bIt("click",(function AddonModForumNewDiscussionPage_form_15_Template_ion_button_click_26_listener(){j.eBV(e);const o=j.XpG();return j.Njj(o.add())})),j.EFF(27),j.nI1(28,"translate"),j.k0s()()()()()()}if(2&e){const e=j.XpG();j.R7$(3),j.R50("ngModel",e.newDiscussion.subject),j.Y8G("placeholder",j.bMT(4,21,"addon.mod_forum.subject"))("label",j.bMT(5,23,"addon.mod_forum.subject")),j.R7$(5),j.JRh(j.bMT(9,25,"addon.mod_forum.message")),j.R7$(2),j.Y8G("control",e.messageControl)("placeholder",j.bMT(11,27,"addon.mod_forum.message"))("component",e.component)("componentId",e.forum.cmid)("autoSave",!0)("contextInstanceId",e.forum.cmid),j.R7$(2),j.Y8G("detail",!1),j.BMQ("aria-expanded",e.advanced)("aria-label",j.bMT(13,29,e.advanced?"core.hideadvanced":"core.showadvanced")),j.R7$(2),j.AVh("expandable-status-icon-expanded",e.advanced),j.R7$(3),j.JRh(j.bMT(18,31,"addon.mod_forum.advanced")),j.R7$(2),j.Y8G("ngIf",e.advanced),j.R7$(),j.Y8G("ngIf",e.showGroups&&e.postInGroupMessage&&!e.newDiscussion.postToAllGroups),j.R7$(4),j.Y8G("ngIf",e.hasOffline),j.R7$(2),j.Y8G("disabled",""===e.newDiscussion.subject||null===e.newDiscussion.message),j.R7$(),j.SpI(" ",j.bMT(28,33,"addon.mod_forum.posttoforum")," ")}}let J=(()=>{var e;class AddonModForumNewDiscussionPage{constructor(e,o,n){this.route=e,this.splitView=o,this.courseContentsPage=n,this.component=P.Ep,this.messageControl=new u.MJ(null),this.groupsLoaded=!1,this.showGroups=!1,this.hasOffline=!1,this.canCreateAttachments=!0,this.canPin=!1,this.showForm=!1,this.groups=[],this.groupIds=[],this.newDiscussion={subject:"",message:null,postToAllGroups:!1,groupId:0,subscribe:!0,pin:!1,files:[]},this.advanced=!1,this.accessInfo={},this.isDestroyed=!1,this.forceLeave=!1,this.logView=N.j.once((()=>{y.OF.logEvent({type:y.qr.VIEW_ITEM,ws:"mod_forum_add_discussion",name:I.HT.instant("addon.mod_forum.addanewdiscussion"),data:{id:this.forumId,category:"forum"},url:"/mod/forum/post.php"})}))}ngOnInit(){var e=this;return(0,d.A)((function*(){try{var o;const s=m.CoreNavigator.getRouteData(e.route);if(e.courseId=m.CoreNavigator.getRequiredRouteNumberParam("courseId"),e.cmId=m.CoreNavigator.getRequiredRouteNumberParam("cmId"),e.forumId=m.CoreNavigator.getRequiredRouteNumberParam("forumId"),e.timeCreated=m.CoreNavigator.getRequiredRouteNumberParam("timeCreated"),e.initialGroupId=m.CoreNavigator.getRouteNumberParam("groupId"),e.initialGroupId=0===e.initialGroupId?P.lL:e.initialGroupId,0!==e.timeCreated&&(null===(o=s.swipeEnabled)||void 0===o||o)){var n;const o=T.u.getOrCreateSource(F.a,[e.courseId,e.cmId,null!==(n=s.discussionsPathPrefix)&&void 0!==n?n:""]);e.discussions=new AddonModForumNewDiscussionDiscussionsSwipeManager(o),yield e.discussions.start()}}catch(o){return h.CoreDomUtils.showErrorModal(o),e.goBack(),void 0}e.fetchDiscussionData().finally((()=>{e.groupsLoaded=!0}))}))()}ionViewDidEnter(){this.syncObserver||(this.syncObserver=c.z.on(P.D7,(e=>{e.forumId==this.forumId&&e.userId==_.CoreSites.getCurrentSiteUserId()&&(h.CoreDomUtils.showAlertTranslated("core.notice","core.contenteditingsynced"),this.returnToDiscussions())}),_.CoreSites.getCurrentSiteId()))}fetchDiscussionData(e){var o=this;return(0,d.A)((function*(){try{const n=yield l.CoreGroups.getActivityGroupMode(o.cmId),s=[];n===l.CoreGroupsProvider.SEPARATEGROUPS||n===l.CoreGroupsProvider.VISIBLEGROUPS?s.push(l.CoreGroups.instance.getActivityAllowedGroups(o.cmId).then((e=>{let s;return s=n===l.CoreGroupsProvider.VISIBLEGROUPS?o.validateVisibleGroups(e.groups):o.addAllParticipantsOption(e.groups,!0),s.then(function(){var e=(0,d.A)((function*(e){if(e.length>0)return o.groups=e,o.groupIds=e.map((e=>e.id)).filter((e=>e>0)),o.newDiscussion.groupId=o.newDiscussion.groupId||o.getInitialGroupId(),o.showGroups=!0,yield o.calculateGroupName(),o.groupIds.length<=1&&(o.newDiscussion.postToAllGroups=!1),void 0;throw new Error(I.HT.instant(n===l.CoreGroupsProvider.SEPARATEGROUPS?"addon.mod_forum.cannotadddiscussionall":"addon.mod_forum.cannotadddiscussion"))}));return function(o){return e.apply(this,arguments)}}())}))):(o.showGroups=!1,o.newDiscussion.postToAllGroups=!1,s.push(S.g.ignoreErrors(p.AddonModForum.instance.canAddDiscussionToAll(o.forumId,{cmId:o.cmId}).then((e=>{o.canPin=!!e.canpindiscussions,o.canCreateAttachments=!!e.cancreateattachment}))))),s.push(p.AddonModForum.getForum(o.courseId,o.cmId).then((e=>o.forum=e))),s.push(p.AddonModForum.instance.getAccessInformation(o.forumId,{cmId:o.cmId}).then((e=>o.accessInfo=e))),yield Promise.all(s),o.timeCreated&&!e&&(o.syncId=f.F.getForumSyncId(o.forumId),yield f.F.waitForSync(o.syncId).then((()=>(o.isDestroyed||w.CoreSync.blockOperation(P.Ep,o.syncId),D.p.instance.getNewDiscussion(o.forumId,o.timeCreated).then(function(){var e=(0,d.A)((function*(e){if(o.hasOffline=!0,e.options=e.options||{},e.groupid==P.pQ?(o.newDiscussion.groupId=o.groups[0].id,o.newDiscussion.postToAllGroups=!0):(o.newDiscussion.groupId=e.groupid,o.newDiscussion.postToAllGroups=!1),o.newDiscussion.subject=e.subject,o.newDiscussion.message=e.message,o.newDiscussion.subscribe=!!e.options.discussionsubscribe,o.newDiscussion.pin=!!e.options.discussionpinned,o.messageControl.setValue(e.message),yield o.calculateGroupName(),"object"==typeof e.options.attachmentsid&&e.options.attachmentsid.offline){const e=yield M.i.getNewDiscussionStoredFiles(o.forumId,o.timeCreated);o.newDiscussion.files=e}(!o.newDiscussion.subscribe||o.newDiscussion.pin||o.newDiscussion.files.length||o.groups.length>0&&o.newDiscussion.groupId!=o.groups[0].id||o.newDiscussion.postToAllGroups)&&(o.advanced=!0)}));return function(o){return e.apply(this,arguments)}}()))))),o.originalData||(o.originalData={subject:o.newDiscussion.subject,message:o.newDiscussion.message,files:o.newDiscussion.files.slice()}),o.showForm=!0,o.logView()}catch(e){h.CoreDomUtils.showErrorModalDefault(e,"addon.mod_forum.errorgetgroups",!0),o.showForm=!1}}))()}validateVisibleGroups(e){var o=this;return(0,d.A)((function*(){let n;try{n=yield p.AddonModForum.canAddDiscussionToAll(o.forumId,{cmId:o.cmId})}catch(e){n={status:!1,canpindiscussions:!1,cancreateattachment:!0}}if(o.canPin=!!n.canpindiscussions,o.canCreateAttachments=!!n.cancreateattachment,n.status)return o.addAllParticipantsOption(e,!1);const s=[],i=[];return e.forEach((e=>{s.push(p.AddonModForum.instance.canAddDiscussion(o.forumId,e.id,{cmId:o.cmId}).catch((()=>({status:!0}))).then((o=>{o.status&&i.push(e)})))})),yield Promise.all(s),i}))()}filterGroups(e,o){const n=o.map((e=>e.id));return e.filter((e=>n.indexOf(e.id)>-1))}getInitialGroupId(){return this.initialGroupId&&this.groups.find((e=>e.id===this.initialGroupId))?this.initialGroupId:this.groups[0].id}addAllParticipantsOption(e,o){let n;return n=o?p.AddonModForum.canAddDiscussionToAll(this.forumId,{cmId:this.cmId}).then((e=>(this.canPin=!!e.canpindiscussions,this.canCreateAttachments=!!e.cancreateattachment,e.status))).catch((()=>!1)):Promise.resolve(!0),n.then((o=>(o&&e.unshift({courseid:this.courseId,id:P.lL,name:I.HT.instant("core.allparticipants")}),e)))}refreshGroups(e){const o=[l.CoreGroups.invalidateActivityGroupMode(this.cmId),l.CoreGroups.invalidateActivityAllowedGroups(this.cmId),p.AddonModForum.invalidateCanAddDiscussion(this.forumId)];Promise.all(o).finally((()=>{this.fetchDiscussionData(!0).finally((()=>{null==e||e.complete()}))}))}returnToDiscussions(e,o){var n;this.forceLeave=!0,b.CoreFileUploader.clearTmpFiles(this.newDiscussion.files),c.z.trigger(P.p8,{forumId:this.forumId,cmId:this.cmId,discussionIds:e,discTimecreated:o,groupId:this.showGroups&&!this.newDiscussion.postToAllGroups?this.newDiscussion.groupId:void 0},_.CoreSites.getCurrentSiteId()),null!==(n=this.splitView)&&void 0!==n&&n.outletActivated?(this.hasOffline=!1,this.newDiscussion.subject="",this.newDiscussion.message=null,this.newDiscussion.files=[],this.newDiscussion.postToAllGroups=!1,this.messageEditor.clearText(),this.originalData=v.j.clone(this.newDiscussion)):m.CoreNavigator.back()}onMessageChange(e){this.newDiscussion.message=null!=e?e:null}add(){var e=this;return(0,d.A)((function*(){const o=e.forum.name,n=e.newDiscussion.subject;let s=e.newDiscussion.message||"";const i=e.newDiscussion.pin,t=e.newDiscussion.files,r=e.timeCreated||Date.now(),a={discussionsubscribe:!!e.newDiscussion.subscribe};if(!n)return h.CoreDomUtils.showErrorModal("addon.mod_forum.erroremptysubject",!0),void 0;if(!s)return h.CoreDomUtils.showErrorModal("addon.mod_forum.erroremptymessage",!0),void 0;const d=yield R.CoreLoadings.show("core.sending",!0);s=C.Ni.formatHtmlLines(s),i&&(a.discussionpinned=!0);const u=e.newDiscussion.postToAllGroups?e.groupIds:[e.newDiscussion.groupId];try{const i=yield M.i.addNewDiscussion(e.forumId,o,e.courseId,n,s,t,a,u,r);i&&(M.i.deleteNewDiscussionStoredFiles(e.forumId,r),c.z.trigger(c.z.ACTIVITY_DATA_SENT,{module:"forum"})),i&&i.length<u.length&&h.CoreDomUtils.showErrorModalDefault(null,"addon.mod_forum.errorposttoallgroups",!0),A.R.triggerFormSubmittedEvent(e.formElement,!!i,_.CoreSites.getCurrentSiteId()),e.returnToDiscussions(i,r)}catch(e){h.CoreDomUtils.showErrorModalDefault(e,"addon.mod_forum.cannotcreatediscussion",!0)}finally{d.dismiss()}}))()}discard(){var e=this;return(0,d.A)((function*(){try{yield h.CoreDomUtils.showConfirm(I.HT.instant("core.areyousure"));const o=[];o.push(D.p.deleteNewDiscussion(e.forumId,e.timeCreated)),o.push(S.g.ignoreErrors(M.i.deleteNewDiscussionStoredFiles(e.forumId,e.timeCreated))),yield Promise.all(o),A.R.triggerFormCancelledEvent(e.formElement,_.CoreSites.getCurrentSiteId()),e.returnToDiscussions()}catch(e){}}))()}toggleAdvanced(){this.advanced=!this.advanced}calculateGroupName(){var e=this;return(0,d.A)((function*(){if(e.newDiscussion.groupId<=0)e.postInGroupMessage=void 0;else{var o;const n=null===(o=e.groups.find((o=>o.id===e.newDiscussion.groupId)))||void 0===o?void 0:o.name;e.postInGroupMessage=n&&I.HT.instant("addon.mod_forum.postingroup",{groupname:n})}}))()}canLeave(){var e=this;return(0,d.A)((function*(){return e.forceLeave||(M.i.hasPostDataChanged(e.newDiscussion,e.originalData)&&(yield h.CoreDomUtils.showConfirm(I.HT.instant("core.confirmcanceledit"))),b.CoreFileUploader.clearTmpFiles(e.newDiscussion.files),e.formElement&&A.R.triggerFormCancelledEvent(e.formElement,_.CoreSites.getCurrentSiteId())),!0}))()}ionViewWillLeave(){this.syncObserver&&this.syncObserver.off(),delete this.syncObserver}goBack(){var e;null!==(e=this.splitView)&&void 0!==e&&e.outletActivated?m.CoreNavigator.navigate((this.courseContentsPage?"../":"")+"../../"):m.CoreNavigator.back()}ngOnDestroy(){var e;this.syncId&&w.CoreSync.unblockOperation(P.Ep,this.syncId),this.isDestroyed=!0,null===(e=this.discussions)||void 0===e||e.destroy()}}return(e=AddonModForumNewDiscussionPage).ɵfac=function AddonModForumNewDiscussionPage_Factory(o){return new(o||e)(j.rXU(s.nX),j.rXU(x.M,8),j.rXU(E.k,8))},e.ɵcmp=j.VBU({type:e,selectors:[["page-addon-mod-forum-new-discussion"]],viewQuery:function AddonModForumNewDiscussionPage_Query(e,o){if(1&e&&(j.GBs(z,5),j.GBs(g.u,5)),2&e){let e;j.mGM(e=j.lsd())&&(o.formElement=e.first),j.mGM(e=j.lsd())&&(o.messageEditor=e.first)}},decls:16,vars:13,consts:[["newDiscFormEl",""],["slot","start"],[3,"text"],["slot","end"],[3,"core-swipe-navigation"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["labelPlacement","stacked","type","text","name","subject",3,"ngModelChange","ngModel","placeholder","label"],["position","stacked"],["name","addon_mod_forum_new_discussion","contextLevel","module","elementId","message",3,"contentChanged","control","placeholder","component","componentId","autoSave","contextInstanceId"],["button","","role","heading","aria-controls","addon-mod-forum-new-discussion-advanced",1,"divider","ion-text-wrap",3,"click","detail"],["name","fas-chevron-right","flip-rtl","","slot","start","aria-hidden","true",1,"expandable-status-icon"],["id","addon-mod-forum-new-discussion-advanced",4,"ngIf"],["class","addon-forum-group-info ion-text-wrap",4,"ngIf"],[1,"addon-forum-new-discussion-buttons"],["expand","block",3,"click","disabled"],["id","addon-mod-forum-new-discussion-advanced"],["class","ion-text-wrap",4,"ngIf"],["class","core-edit-set-group ion-text-wrap",4,"ngIf"],[1,"ion-text-wrap"],["name","subscribe",3,"ngModelChange","ngModel"],[3,"files","maxSize","maxSubmissions","component","componentId","allowOffline","courseId",4,"ngIf"],["name","postallgroups",3,"ngModelChange","ngModel"],[1,"core-edit-set-group","ion-text-wrap"],["interface","action-sheet","name","groupid",3,"ngModelChange","ionChange","ngModel","disabled","interfaceOptions","cancelText"],["slot","label",1,"item-heading"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["contextLevel","course",3,"text","contextInstanceId","wsNotFiltered"],["name","pin",3,"ngModelChange","ngModel"],[3,"files","maxSize","maxSubmissions","component","componentId","allowOffline","courseId"],[1,"addon-forum-group-info","ion-text-wrap"],["name","fas-circle-info","slot","start","aria-hidden","true"],["expand","block","fill","outline",3,"click"]],template:function AddonModForumNewDiscussionPage_Template(e,o){1&e&&(j.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),j.nrm(3,"ion-back-button",2),j.nI1(4,"translate"),j.k0s(),j.j41(5,"ion-title")(6,"h1"),j.EFF(7),j.nI1(8,"translate"),j.k0s()(),j.nrm(9,"ion-buttons",3),j.k0s()(),j.j41(10,"ion-content",4)(11,"ion-refresher",5),j.bIt("ionRefresh",(function AddonModForumNewDiscussionPage_Template_ion_refresher_ionRefresh_11_listener(e){return o.refreshGroups(e.target)})),j.nrm(12,"ion-refresher-content",6),j.nI1(13,"translate"),j.k0s(),j.j41(14,"core-loading",7),j.DNE(15,AddonModForumNewDiscussionPage_form_15_Template,29,35,"form",8),j.k0s()()),2&e&&(j.R7$(3),j.Y8G("text",j.bMT(4,7,"core.back")),j.R7$(4),j.JRh(j.bMT(8,9,"addon.mod_forum.addanewdiscussion")),j.R7$(3),j.Y8G("core-swipe-navigation",o.discussions),j.R7$(),j.Y8G("disabled",!o.groupsLoaded),j.R7$(),j.FS9("pullingText",j.bMT(13,11,"core.pulltorefresh")),j.R7$(2),j.Y8G("hideUntil",o.groupsLoaded),j.R7$(),j.Y8G("ngIf",o.showForm))},dependencies:[k.Sq,k.bT,O.V,$.R,V.t,B.B,U.n,Y.i,X.T,u.qT,u.BC,u.cb,u.vS,u.cV,L.Jm,L.QW,L.hU,L.W9,L.eU,L.iq,L.$w,L.uz,L.he,L.To,L.Ki,L.ln,L.Nm,L.Ip,L.BC,L.BY,L.ai,L.hB,L.Je,L.Gw,L.el,g.u,H.D9],styles:["[_nghost-%COMP%]   .addon-forum-group-info[_ngcontent-%COMP%] > ion-icon[slot][_ngcontent-%COMP%]{color:var(--ion-color-info);margin-inline-end:16px}[_nghost-%COMP%]   .addon-forum-new-discussion-buttons[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   .addon-forum-new-discussion-buttons[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding-top:0;padding-bottom:0}"]}),AddonModForumNewDiscussionPage})();class AddonModForumNewDiscussionDiscussionsSwipeManager extends G.c{getSelectedItemPathFromRoute(e){const o=m.CoreNavigator.getRouteParams(e);return`${this.getSource().DISCUSSIONS_PATH_PREFIX}new/${o.timeCreated}`}}const q=[{path:"",component:J,canDeactivate:[t.V]}];let Q=(()=>{var e;class AddonModForumNewDiscussionLazyModule{}return(e=AddonModForumNewDiscussionLazyModule).ɵfac=function AddonModForumNewDiscussionLazyModule_Factory(o){return new(o||e)},e.ɵmod=j.$C({type:e}),e.ɵinj=j.G2t({imports:[s.iI.forChild(q),a.n,i.Y,r.d]}),AddonModForumNewDiscussionLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&j.Obh(Q,{declarations:[J],imports:[s.iI,a.n,i.Y,r.d]}))},52266:(e,o,n)=>{n.d(o,{Z:()=>CoreSwipeNavigationItemsManager});var s=n(10467),i=n(15324),t=n(95990);class CoreSwipeNavigationItemsManager extends t.u{start(){var e=this;return(0,s.A)((function*(){e.updateSelectedItem()}))()}navigateToNextItem(){var e=this;return(0,s.A)((function*(){yield e.navigateToItemBy(1,"forward")}))()}navigateToPreviousItem(){var e=this;return(0,s.A)((function*(){yield e.navigateToItemBy(-1,"back")}))()}hasNextItem(){var e=this;return(0,s.A)((function*(){return!!(yield e.getItemBy(1))}))()}hasPreviousItem(){var e=this;return(0,s.A)((function*(){return!!(yield e.getItemBy(-1))}))()}getCurrentPageRoute(){return i.CoreNavigator.getCurrentRoute()}getSelectedItemPathFromRoute(e){const o=[];for(;e&&(o.push(...i.CoreNavigator.getRouteUrl(e)),e.firstChild);)e=e.firstChild;return o.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(e,o){var n=this;return(0,s.A)((function*(){const s=yield n.getItemBy(e);s&&(yield n.navigateToItem(s,{animationDirection:o,replace:!0}))}))()}getItemBy(e){var o=this;return(0,s.A)((function*(){var n;const s=o.getSource().getItems(),i=null!==(n=o.selectedItem&&(null==s?void 0:s.indexOf(o.selectedItem)))&&void 0!==n?n:-1;if(-1===i||null===s)return null;const t=e>0?1:-1;let r=i,a=0;for(;a!==e;){if(r+=t,r<0)return null;if(r>=s.length)break;o.skipItemInSwipe(s[r])||(a+=t)}return a===e?s[r]:o.getSource().isCompleted()?null:(yield o.getSource().load(),o.getItemBy(e))}))()}skipItemInSwipe(e){return!1}}}}]);