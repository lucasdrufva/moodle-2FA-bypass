"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9854],{39854:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ce});var o=n(21182),s=n(3353),a=n(85996),i=n(31249),r=n(54438);let d=(()=>{var e;class AddonModChatComponentsModule{}return(e=AddonModChatComponentsModule).ɵfac=function AddonModChatComponentsModule_Factory(t){return new(t||e)},e.ɵmod=r.$C({type:e}),e.ɵinj=r.G2t({imports:[s.n,i.r]}),AddonModChatComponentsModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&r.Obh(d,{declarations:[a.AddonModChatIndexComponent],imports:[s.n,i.r],exports:[a.AddonModChatIndexComponent]}));var c=n(2138),l=n(58197),g=n(68273),_=n(88246),m=n(73465),u=n(73955);let h=(()=>{var e;class AddonModChatIndexPage extends c._{}return(e=AddonModChatIndexPage).ɵfac=(()=>{let t;return function AddonModChatIndexPage_Factory(n){return(t||(t=r.xGo(e)))(n||e)}})(),e.ɵcmp=r.VBU({type:e,selectors:[["page-addon-mod-chat-index"]],viewQuery:function AddonModChatIndexPage_Query(e,t){if(1&e&&r.GBs(a.AddonModChatIndexComponent,5),2&e){let e;r.mGM(e=r.lsd())&&(t.activityComponent=e.first)}},features:[r.Vt3],decls:14,vars:12,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"dataRetrieved","module","courseId"]],template:function AddonModChatIndexPage_Template(e,t){1&e&&(r.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),r.nrm(3,"ion-back-button",2),r.nI1(4,"translate"),r.k0s(),r.j41(5,"ion-title")(6,"h1"),r.nrm(7,"core-format-text",3),r.k0s()(),r.nrm(8,"ion-buttons",4),r.k0s()(),r.j41(9,"ion-content",5)(10,"ion-refresher",6),r.bIt("ionRefresh",(function AddonModChatIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==t.activityComponent?null:t.activityComponent.doRefresh(e.target)})),r.nrm(11,"ion-refresher-content",7),r.nI1(12,"translate"),r.k0s(),r.j41(13,"addon-mod-chat-index",8),r.bIt("dataRetrieved",(function AddonModChatIndexPage_Template_addon_mod_chat_index_dataRetrieved_13_listener(e){return t.updateData(e)})),r.k0s()()),2&e&&(r.R7$(3),r.Y8G("text",r.bMT(4,8,"core.back")),r.R7$(4),r.Y8G("text",t.title)("contextInstanceId",t.module.id)("courseId",t.courseId),r.R7$(3),r.Y8G("disabled",null==t.activityComponent?null:t.activityComponent.showLoading),r.R7$(),r.FS9("pullingText",r.bMT(12,10,"core.pulltorefresh")),r.R7$(2),r.Y8G("module",t.module)("courseId",t.courseId))},dependencies:[l.B,g.M,_.i,m.QW,m.W9,m.eU,m.To,m.Ki,m.BC,m.ai,m.el,a.AddonModChatIndexComponent,u.D9],encapsulation:2}),AddonModChatIndexPage})();var p=n(10467),f=n(85122),I=n(94455),C=n(15324),M=n(52749),b=n(89911),v=n(55554),A=n(79555),P=n(49882),T=n(35853),R=n(96508),y=n.n(R);const x=new RegExp(/^To\s([^:]+):(.*)/);let S=(()=>{var e;class AddonModChatHelperProvider{formatMessage(e,t,n){const o=t;if(o.message=o.message.trim(),o.showDate=this.showDate(t,n),o.beep="beep "==t.message.substring(0,5)&&t.message.substring(5).trim()||void 0,o.beep&&!isNaN(Number(o.beep))&&(o.beep=Number(o.beep)),o.special=!!o.beep||t.issystem||t.system,"/me "==o.message.substring(0,4)&&(o.special=!0,o.message=o.message.substring(4).trim()),!o.special&&o.message.match(x)){const e=o.message.match(x);o.message=`<em>\n                <strong>${A.HT.instant("addon.mod_chat.saidto")} </strong>\n                ${e[1]}</em>: ${e[2]}`}return o.showUserData=this.showUserData(e,t,n),n&&(n.showTail=this.showTail(n,t)),o}showUserData(e,t,n){return!(t.userid==e||n&&n.userid==t.userid&&!t.showDate&&!n.special)}showTail(e,t){return!t||t.userid!=e.userid||!!t.showDate||!!t.special}showDate(e,t){return!t||!y()(1e3*e.timestamp).isSame(1e3*t.timestamp,"day")}}return(e=AddonModChatHelperProvider).ɵfac=function AddonModChatHelperProvider_Factory(t){return new(t||e)},e.ɵprov=r.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),AddonModChatHelperProvider})();const $=(0,A.Qd)(S);var w=n(24742),G=n(22693),k=n(44426),F=n(53794),D=n(6319),U=n(23780),E=n(60177),j=n(16986),N=n(64422),O=n(28042),Y=n(86198),V=n(43570),L=n(59528);const _c0=e=>({$a:e});function AddonModChatChatPage_ion_button_9_Template(e,t){if(1&e){const e=r.RV6();r.j41(0,"ion-button",14),r.nI1(1,"translate"),r.bIt("click",(function AddonModChatChatPage_ion_button_9_Template_ion_button_click_0_listener(){r.eBV(e);const t=r.XpG();return r.Njj(t.showChatUsers())})),r.nrm(2,"ion-icon",15),r.k0s()}2&e&&r.Y8G("ariaLabel",r.bMT(1,1,"core.users"))}function AddonModChatChatPage_ng_container_13_p_1_Template(e,t){if(1&e&&(r.j41(0,"p",19),r.EFF(1),r.nI1(2,"coreFormatDate"),r.k0s()),2&e){const e=r.XpG().$implicit;r.R7$(),r.SpI(" ",r.i5U(2,1,1e3*e.timestamp,"strftimedayshort")," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_1_Template(e,t){if(1&e&&(r.j41(0,"ion-badge",26)(1,"span"),r.nrm(2,"ion-icon",27),r.EFF(3),r.nI1(4,"coreFormatDate"),r.nI1(5,"translate"),r.k0s()()),2&e){const e=r.XpG(2).$implicit;r.R7$(3),r.Lme(" ",r.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",r.i5U(5,5,"addon.mod_chat.messageenter",r.eq3(8,_c0,e.userfullname))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_2_Template(e,t){if(1&e&&(r.j41(0,"ion-badge",28)(1,"span"),r.nrm(2,"ion-icon",29),r.EFF(3),r.nI1(4,"coreFormatDate"),r.nI1(5,"translate"),r.k0s()()),2&e){const e=r.XpG(2).$implicit;r.R7$(3),r.Lme(" ",r.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",r.i5U(5,5,"addon.mod_chat.messageexit",r.eq3(8,_c0,e.userfullname))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_3_Template(e,t){if(1&e&&(r.j41(0,"ion-badge",30)(1,"span"),r.nrm(2,"ion-icon",31),r.EFF(3),r.nI1(4,"coreFormatDate"),r.nI1(5,"translate"),r.k0s()()),2&e){const e=r.XpG(2).$implicit;r.R7$(3),r.Lme(" ",r.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",r.i5U(5,5,"addon.mod_chat.messagebeepseveryone",r.eq3(8,_c0,e.userfullname))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_4_Template(e,t){if(1&e&&(r.j41(0,"ion-badge",30)(1,"span"),r.nrm(2,"ion-icon",31),r.EFF(3),r.nI1(4,"coreFormatDate"),r.nI1(5,"translate"),r.k0s()()),2&e){const e=r.XpG(2).$implicit;r.R7$(3),r.Lme(" ",r.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",r.i5U(5,5,"addon.mod_chat.messagebeepsyou",r.eq3(8,_c0,e.userfullname))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_5_Template(e,t){if(1&e&&(r.j41(0,"ion-badge",32)(1,"span"),r.nrm(2,"ion-icon",31),r.EFF(3),r.nI1(4,"coreFormatDate"),r.nI1(5,"translate"),r.k0s()()),2&e){const e=r.XpG(2).$implicit;r.R7$(3),r.Lme(" ",r.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",r.i5U(5,5,"addon.mod_chat.messageyoubeep",r.eq3(8,_c0,e.beepWho))," ")}}function AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template(e,t){if(1&e){const e=r.RV6();r.j41(0,"ion-badge",33)(1,"span"),r.nrm(2,"ion-icon",34),r.EFF(3),r.nI1(4,"coreFormatDate"),r.j41(5,"strong"),r.EFF(6),r.j41(7,"core-format-text",35),r.bIt("afterRender",(function AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template_core_format_text_afterRender_7_listener(){r.eBV(e);const t=r.XpG(2).last,n=r.XpG();return r.Njj(t&&n.scrollToBottom())})),r.k0s()()()()}if(2&e){const e=r.XpG(2).$implicit,t=r.XpG();r.R7$(3),r.SpI(" ",r.i5U(4,5,1e3*e.timestamp,"strftimetime")," "),r.R7$(3),r.SpI(" ",e.userfullname," "),r.R7$(),r.Y8G("text",e.message)("contextInstanceId",t.cmId)("courseId",t.courseId)}}function AddonModChatChatPage_ng_container_13_div_2_Template(e,t){if(1&e&&(r.j41(0,"div",20),r.DNE(1,AddonModChatChatPage_ng_container_13_div_2_ion_badge_1_Template,6,10,"ion-badge",21)(2,AddonModChatChatPage_ng_container_13_div_2_ion_badge_2_Template,6,10,"ion-badge",22)(3,AddonModChatChatPage_ng_container_13_div_2_ion_badge_3_Template,6,10,"ion-badge",23)(4,AddonModChatChatPage_ng_container_13_div_2_ion_badge_4_Template,6,10,"ion-badge",23)(5,AddonModChatChatPage_ng_container_13_div_2_ion_badge_5_Template,6,10,"ion-badge",24)(6,AddonModChatChatPage_ng_container_13_div_2_ion_badge_6_Template,8,8,"ion-badge",25),r.k0s()),2&e){const e=r.XpG().$implicit,t=r.XpG();r.R7$(),r.Y8G("ngIf",e.system&&"enter"===e.message),r.R7$(),r.Y8G("ngIf",e.system&&"exit"===e.message),r.R7$(),r.Y8G("ngIf","all"===e.beep),r.R7$(),r.Y8G("ngIf",e.userid!==t.currentUserId&&e.beep===t.currentUserId),r.R7$(),r.Y8G("ngIf",e.userid===t.currentUserId&&e.beep&&"all"!==e.beep),r.R7$(),r.Y8G("ngIf",!e.system&&!e.beep)}}function AddonModChatChatPage_ng_container_13_core_message_3_Template(e,t){if(1&e){const e=r.RV6();r.j41(0,"core-message",36),r.bIt("afterRender",(function AddonModChatChatPage_ng_container_13_core_message_3_Template_core_message_afterRender_0_listener(){r.eBV(e);const t=r.XpG().last,n=r.XpG();return r.Njj(t&&n.scrollToBottom())})),r.k0s()}if(2&e){const e=r.XpG().$implicit,t=r.XpG();r.Y8G("message",e)("user",e)("text",e.message)("time",1e3*e.timestamp)("instanceId",t.cmId)("courseId",t.courseId)}}function AddonModChatChatPage_ng_container_13_Template(e,t){if(1&e&&(r.qex(0),r.DNE(1,AddonModChatChatPage_ng_container_13_p_1_Template,3,4,"p",16)(2,AddonModChatChatPage_ng_container_13_div_2_Template,7,6,"div",17)(3,AddonModChatChatPage_ng_container_13_core_message_3_Template,1,6,"core-message",18),r.bVm()),2&e){const e=t.$implicit;r.R7$(),r.Y8G("ngIf",e.showDate),r.R7$(),r.Y8G("ngIf",e.special),r.R7$(),r.Y8G("ngIf",!e.special)}}function AddonModChatChatPage_core_empty_box_14_Template(e,t){1&e&&(r.nrm(0,"core-empty-box",37),r.nI1(1,"translate")),2&e&&r.Y8G("message",r.bMT(1,1,"addon.mod_chat.nomessages"))}function AddonModChatChatPage_p_17_Template(e,t){1&e&&(r.j41(0,"p",38),r.EFF(1),r.nI1(2,"translate"),r.k0s()),2&e&&(r.R7$(),r.SpI(" ",r.bMT(2,1,"addon.mod_chat.mustbeonlinetosendmessages")," "))}function AddonModChatChatPage_core_send_message_form_18_Template(e,t){if(1&e){const e=r.RV6();r.j41(0,"core-send-message-form",39),r.nI1(1,"translate"),r.bIt("onSubmit",(function AddonModChatChatPage_core_send_message_form_18_Template_core_send_message_form_onSubmit_0_listener(t){r.eBV(e);const n=r.XpG();return r.Njj(n.sendMessage(t))})),r.k0s()}if(2&e){const e=r.XpG();r.Y8G("sendDisabled",e.sending)("message",e.newMessage)("placeholder",r.bMT(1,3,"addon.messages.newmessage"))}}function AddonModChatChatPage_ion_button_19_Template(e,t){if(1&e){const e=r.RV6();r.j41(0,"ion-button",40),r.bIt("click",(function AddonModChatChatPage_ion_button_19_Template_ion_button_click_0_listener(){r.eBV(e);const t=r.XpG();return r.Njj(t.reconnect())})),r.EFF(1),r.nI1(2,"translate"),r.k0s()}2&e&&(r.R7$(),r.SpI(" ",r.bMT(2,1,"core.login.reconnect")," "))}let X=(()=>{var e;class AddonModChatChatPage{constructor(){this.loaded=!1,this.title="",this.messages=[],this.sending=!1,this.lastTime=0,this.oldContentHeight=0,this.viewDestroyed=!1,this.pollingRunning=!1,this.users=[],this.currentUserId=M.CoreSites.getCurrentSiteUserId(),this.isOnline=I.WE.isOnline(),this.onlineSubscription=I.WE.onChange().subscribe((()=>{A.SK.run((()=>{this.isOnline=I.WE.isOnline()}))})),this.logView=w.j.once((()=>{G.OF.logEvent({type:G.qr.VIEW_ITEM_LIST,ws:"mod_chat_get_chat_latest_messages",name:this.title,data:{chatid:this.chatId,category:"chat"},url:`/mod/chat/gui_ajax/index.php?id=${this.chatId}`})}))}ngOnInit(){var e=this;return(0,p.A)((function*(){try{e.courseId=C.CoreNavigator.getRequiredRouteNumberParam("courseId"),e.cmId=C.CoreNavigator.getRequiredRouteNumberParam("cmId"),e.chatId=C.CoreNavigator.getRequiredRouteNumberParam("chatId"),e.title=C.CoreNavigator.getRouteParam("title")||"",yield e.loginUser(),yield e.fetchMessages(),e.startPolling(),e.logView()}catch(e){b.CoreDomUtils.showErrorModalDefault(e,"addon.mod_chat.errorwhileconnecting",!0),C.CoreNavigator.back()}finally{e.loaded=!0}}))()}ionViewDidEnter(){this.startPolling()}ionViewWillLeave(){P.z.trigger(P.z.ACTIVITY_DATA_SENT,{module:"chat"}),this.stopPolling()}loginUser(){var e=this;return(0,p.A)((function*(){e.sessionId=yield T.V.loginUser(e.chatId)}))()}fetchMessages(){var e=this;return(0,p.A)((function*(){const t=yield T.V.getLatestMessages(e.sessionId,e.lastTime);e.lastTime=t.chatnewlasttime||0;const n=yield T.V.getMessagesUserData(t.messages,e.courseId);if(!n.length)return;const o=e.messages.length;e.messages=e.messages.concat(n);for(let t=o;t<e.messages.length;t++){e.messages[t]=$.formatMessage(e.currentUserId,e.messages[t],t>0?e.messages[t-1]:void 0);const n=e.messages[t];n.beep&&n.beep!==e.currentUserId&&e.loadMessageBeepWho(n)}e.messages[e.messages.length-1].showTail=!0,e.scrollToBottom()}))()}loadMessageBeepWho(e){var t=this;return(0,p.A)((function*(){e.beepWho=yield t.getUserFullname(e.beep)}))()}showChatUsers(){var e=this;return(0,p.A)((function*(){const{AddonModChatUsersModalComponent:t}=yield n.e(5712).then(n.bind(n,35712)),o=yield D.I.openSideModal({component:t,componentProps:{sessionId:e.sessionId,cmId:e.cmId}});if(o){var s;if(o.talkTo)e.newMessage=`To ${o.talkTo}: `+((null===(s=e.sendMessageForm)||void 0===s?void 0:s.message)||"");o.beepTo&&e.sendMessage("",o.beepTo),e.users=o.users}}))()}getUserFullname(e){var t=this;return(0,p.A)((function*(){const n=Number(e);if(isNaN(n))return String(e);const o=t.users.find((e=>e.id==n));if(o)return o.fullname;try{const o=yield T.V.getChatUsers(t.sessionId,{cmId:t.cmId});t.users=o.users;const s=t.users.find((e=>e.id==n));return s?s.fullname:String(e)}catch{return String(e)}}))()}startPolling(){this.polling||(this.polling=window.setInterval((()=>{v.g.ignoreErrors(this.fetchMessagesInterval())}),AddonModChatChatPage.POLL_INTERVAL))}stopPolling(){clearInterval(this.polling),this.polling=void 0}fetchMessagesInterval(){var e=this;return(0,p.A)((function*(){if(e.isOnline&&!e.pollingRunning){e.pollingRunning=!0;try{yield e.fetchMessages()}catch{try{yield e.loginUser(),yield e.fetchMessages()}catch(t){throw e.stopPolling(),b.CoreDomUtils.showErrorModalDefault(t,"addon.mod_chat.errorwhileretrievingmessages",!0),t}}finally{e.pollingRunning=!1}}}))()}sendMessage(e,t=0){var n=this;return(0,p.A)((function*(){if(n.isOnline&&(0!==t||e.trim())){n.sending=!0;try{yield T.V.sendMessage(n.sessionId,e,t),v.g.ignoreErrors(n.fetchMessagesInterval())}catch(t){k.p.close(),n.newMessage=e,b.CoreDomUtils.showErrorModalDefault(t,"addon.mod_chat.errorwhilesendingmessage",!0)}finally{n.sending=!1}}}))()}reconnect(){var e=this;return(0,p.A)((function*(){const t=yield U.CoreLoadings.show();try{yield e.fetchMessagesInterval(),e.startPolling()}catch{}finally{t.dismiss()}}))()}scrollToBottom(){var e=this;return(0,p.A)((function*(){var t;(yield F.H.nextTick(),e.viewDestroyed)||(null===(t=e.content)||void 0===t||t.scrollToBottom())}))()}canLeave(){var e=this;return(0,p.A)((function*(){return!e.messages.some((e=>!e.special))||(yield b.CoreDomUtils.showConfirm(A.HT.instant("addon.mod_chat.confirmloss")),!0)}))()}ngOnDestroy(){this.onlineSubscription&&this.onlineSubscription.unsubscribe(),this.stopPolling(),this.viewDestroyed=!0}}return(e=AddonModChatChatPage).POLL_INTERVAL=4e3,e.ɵfac=function AddonModChatChatPage_Factory(t){return new(t||e)},e.ɵcmp=r.VBU({type:e,selectors:[["page-addon-mod-chat-chat"]],viewQuery:function AddonModChatChatPage_Query(e,t){if(1&e&&(r.GBs(m.W9,5),r.GBs(f.u,5)),2&e){let e;r.mGM(e=r.lsd())&&(t.content=e.first),r.mGM(e=r.lsd())&&(t.sendMessageForm=e.first)}},decls:20,vars:14,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["fill","clear",3,"ariaLabel","click",4,"ngIf"],[3,"hideUntil"],["aria-live","polite",1,"addon-messages-discussion-container"],[4,"ngFor","ngForOf"],["icon","far-comments",3,"message",4,"ngIf"],[1,"footer-adjustable"],[3,"color"],["class","ion-text-center",4,"ngIf"],[3,"sendDisabled","message","placeholder","onSubmit",4,"ngIf"],["expand","block","fill","outline",3,"click",4,"ngIf"],["fill","clear",3,"click","ariaLabel"],["name","fas-users","slot","icon-only","aria-hidden","true"],["class","ion-text-center addon-messages-date",4,"ngIf"],["class","ion-text-center addon-mod_chat-notice",4,"ngIf"],["contextLevel","module",3,"message","user","text","time","instanceId","courseId","afterRender",4,"ngIf"],[1,"ion-text-center","addon-messages-date"],[1,"ion-text-center","addon-mod_chat-notice"],["class","ion-text-wrap","color","success",4,"ngIf"],["class","ion-text-wrap","color","danger",4,"ngIf"],["class","ion-text-wrap","color","primary",4,"ngIf"],["class","ion-text-wrap","color","light",4,"ngIf"],["class","ion-text-wrap","color","info",4,"ngIf"],["color","success",1,"ion-text-wrap"],["name","fas-right-to-bracket","aria-hidden","true"],["color","danger",1,"ion-text-wrap"],["name","fas-right-from-bracket","aria-hidden","true"],["color","primary",1,"ion-text-wrap"],["name","fas-bell","aria-hidden","true"],["color","light",1,"ion-text-wrap"],["color","info",1,"ion-text-wrap"],["name","fas-asterisk","aria-hidden","true"],["contextLevel","module",3,"afterRender","text","contextInstanceId","courseId"],["contextLevel","module",3,"afterRender","message","user","text","time","instanceId","courseId"],["icon","far-comments",3,"message"],[1,"ion-text-center"],[3,"onSubmit","sendDisabled","message","placeholder"],["expand","block","fill","outline",3,"click"]],template:function AddonModChatChatPage_Template(e,t){1&e&&(r.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),r.nrm(3,"ion-back-button",1),r.nI1(4,"translate"),r.k0s(),r.j41(5,"ion-title")(6,"h1"),r.nrm(7,"core-format-text",2),r.k0s()(),r.j41(8,"ion-buttons",3),r.DNE(9,AddonModChatChatPage_ion_button_9_Template,3,3,"ion-button",4),r.k0s()()(),r.j41(10,"ion-content")(11,"core-loading",5)(12,"ion-list",6),r.DNE(13,AddonModChatChatPage_ng_container_13_Template,4,3,"ng-container",7),r.k0s(),r.DNE(14,AddonModChatChatPage_core_empty_box_14_Template,2,3,"core-empty-box",8),r.k0s()(),r.j41(15,"ion-footer",9)(16,"ion-toolbar",10),r.DNE(17,AddonModChatChatPage_p_17_Template,3,3,"p",11)(18,AddonModChatChatPage_core_send_message_form_18_Template,2,5,"core-send-message-form",12)(19,AddonModChatChatPage_ion_button_19_Template,3,3,"ion-button",13),r.k0s()()),2&e&&(r.R7$(3),r.Y8G("text",r.bMT(4,12,"core.back")),r.R7$(4),r.Y8G("text",t.title)("contextInstanceId",t.cmId)("courseId",t.courseId),r.R7$(2),r.Y8G("ngIf",t.loaded),r.R7$(2),r.Y8G("hideUntil",t.loaded),r.R7$(2),r.Y8G("ngForOf",t.messages),r.R7$(),r.Y8G("ngIf",!t.messages||t.messages.length<=0),r.R7$(2),r.Y8G("color",t.isOnline&&t.polling&&t.loaded?null:"light"),r.R7$(),r.Y8G("ngIf",!t.isOnline),r.R7$(),r.Y8G("ngIf",t.isOnline&&t.polling&&t.loaded),r.R7$(),r.Y8G("ngIf",t.isOnline&&!t.polling&&t.loaded))},dependencies:[E.Sq,E.bT,j.h,N.R,O.A,f.u,Y.t,l.B,_.i,V.T,m.In,m.Jm,m.QW,m.W9,m.M0,m.eU,m.iq,m.nf,m.BC,m.ai,m.el,L.f,u.D9],styles:[".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0px}ion-content[_ngcontent-%COMP%]{--content-background: var(--background-alternative);--background: var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}ion-content[_ngcontent-%COMP%]   core-empty-box[_ngcontent-%COMP%]{--core-empty-box-icon-color: var(--dark)}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}","[_nghost-%COMP%]   .addon-mod_chat-notice[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}"]}),AddonModChatChatPage})();var B=n(98870);const session_messages_c0=e=>({$a:e});function AddonModChatSessionMessagesPage_ng_container_15_div_1_Template(e,t){if(1&e&&(r.j41(0,"div",10),r.EFF(1),r.nI1(2,"coreFormatDate"),r.k0s()),2&e){const e=r.XpG().$implicit;r.R7$(),r.SpI(" ",r.i5U(2,1,1e3*e.timestamp,"strftimedayshort")," ")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_1_Template(e,t){if(1&e&&(r.j41(0,"ion-badge",17)(1,"span"),r.nrm(2,"ion-icon",18),r.EFF(3),r.nI1(4,"coreFormatDate"),r.nI1(5,"translate"),r.k0s()()),2&e){const e=r.XpG(2).$implicit;r.R7$(3),r.Lme(" ",r.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",r.i5U(5,5,"addon.mod_chat.messageenter",r.eq3(8,session_messages_c0,e.userfullname))," ")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_2_Template(e,t){if(1&e&&(r.j41(0,"ion-badge",19)(1,"span"),r.nrm(2,"ion-icon",20),r.EFF(3),r.nI1(4,"coreFormatDate"),r.nI1(5,"translate"),r.k0s()()),2&e){const e=r.XpG(2).$implicit;r.R7$(3),r.Lme(" ",r.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",r.i5U(5,5,"addon.mod_chat.messageexit",r.eq3(8,session_messages_c0,e.userfullname))," ")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_3_Template(e,t){if(1&e&&(r.j41(0,"ion-badge",21)(1,"span"),r.nrm(2,"ion-icon",22),r.EFF(3),r.nI1(4,"coreFormatDate"),r.nI1(5,"translate"),r.k0s()()),2&e){const e=r.XpG(2).$implicit;r.R7$(3),r.Lme(" ",r.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",r.i5U(5,5,"addon.mod_chat.messagebeepseveryone",r.eq3(8,session_messages_c0,e.userfullname))," ")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_4_Template(e,t){if(1&e&&(r.j41(0,"ion-badge",21)(1,"span"),r.nrm(2,"ion-icon",22),r.EFF(3),r.nI1(4,"coreFormatDate"),r.nI1(5,"translate"),r.k0s()()),2&e){const e=r.XpG(2).$implicit;r.R7$(3),r.Lme(" ",r.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",r.i5U(5,5,"addon.mod_chat.messagebeepsyou",r.eq3(8,session_messages_c0,e.userfullname))," ")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_5_Template(e,t){if(1&e&&(r.j41(0,"ion-badge",23)(1,"span"),r.nrm(2,"ion-icon",22),r.EFF(3),r.nI1(4,"coreFormatDate"),r.nI1(5,"translate"),r.k0s()()),2&e){const e=r.XpG(2).$implicit;r.R7$(3),r.Lme(" ",r.i5U(4,2,1e3*e.timestamp,"strftimetime")," ",r.i5U(5,5,"addon.mod_chat.messageyoubeep",r.eq3(8,session_messages_c0,e.beepWho))," ")}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_6_Template(e,t){if(1&e&&(r.j41(0,"ion-badge",24)(1,"span"),r.nrm(2,"ion-icon",25),r.EFF(3),r.nI1(4,"coreFormatDate"),r.j41(5,"strong"),r.EFF(6),r.nrm(7,"core-format-text",26),r.k0s()()()),2&e){const e=r.XpG(2).$implicit,t=r.XpG();r.R7$(3),r.SpI(" ",r.i5U(4,5,1e3*e.timestamp,"strftimetime")," "),r.R7$(3),r.SpI(" ",e.userfullname," "),r.R7$(),r.Y8G("text",e.message)("contextInstanceId",t.cmId)("courseId",t.courseId)}}function AddonModChatSessionMessagesPage_ng_container_15_div_2_Template(e,t){if(1&e&&(r.j41(0,"div",11),r.DNE(1,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_1_Template,6,10,"ion-badge",12)(2,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_2_Template,6,10,"ion-badge",13)(3,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_3_Template,6,10,"ion-badge",14)(4,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_4_Template,6,10,"ion-badge",14)(5,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_5_Template,6,10,"ion-badge",15)(6,AddonModChatSessionMessagesPage_ng_container_15_div_2_ion_badge_6_Template,8,8,"ion-badge",16),r.k0s()),2&e){const e=r.XpG().$implicit,t=r.XpG();r.R7$(),r.Y8G("ngIf",e.issystem&&"enter"===e.message),r.R7$(),r.Y8G("ngIf",e.issystem&&"exit"===e.message),r.R7$(),r.Y8G("ngIf","all"===e.beep),r.R7$(),r.Y8G("ngIf",e.userid!==t.currentUserId&&e.beep===t.currentUserId),r.R7$(),r.Y8G("ngIf",e.userid===t.currentUserId&&e.beep&&"all"!==e.beep),r.R7$(),r.Y8G("ngIf",!e.issystem&&!e.beep)}}function AddonModChatSessionMessagesPage_ng_container_15_core_message_3_Template(e,t){if(1&e&&r.nrm(0,"core-message",27),2&e){const e=r.XpG().$implicit,t=r.XpG();r.Y8G("message",e)("user",e)("text",e.message)("time",1e3*e.timestamp)("instanceId",t.cmId)("courseId",t.courseId)}}function AddonModChatSessionMessagesPage_ng_container_15_Template(e,t){if(1&e&&(r.qex(0),r.DNE(1,AddonModChatSessionMessagesPage_ng_container_15_div_1_Template,3,4,"div",7)(2,AddonModChatSessionMessagesPage_ng_container_15_div_2_Template,7,6,"div",8)(3,AddonModChatSessionMessagesPage_ng_container_15_core_message_3_Template,1,6,"core-message",9),r.bVm()),2&e){const e=t.$implicit;r.R7$(),r.Y8G("ngIf",e.showDate),r.R7$(),r.Y8G("ngIf",e.special),r.R7$(),r.Y8G("ngIf",!e.special)}}let q=(()=>{var e;class AddonModChatSessionMessagesPage{constructor(){var e=this;this.messages=[],this.loaded=!1,this.logView=w.j.once((0,p.A)((function*(){yield v.g.ignoreErrors(T.V.logViewSessions(e.cmId,{start:e.sessionStart,end:e.sessionEnd})),G.OF.logEvent({type:G.qr.VIEW_ITEM,ws:"mod_chat_view_sessions",name:A.HT.instant("addon.mod_chat.messages"),data:{chatid:e.chatId,category:"chat",start:e.sessionStart,end:e.sessionEnd},url:`/mod/chat/report.php?id=${e.cmId}&start=${e.sessionStart}&end=${e.sessionEnd}`})})))}ngOnInit(){try{this.courseId=C.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.cmId=C.CoreNavigator.getRequiredRouteNumberParam("cmId"),this.sessionStart=C.CoreNavigator.getRequiredRouteNumberParam("sessionStart"),this.sessionEnd=C.CoreNavigator.getRequiredRouteNumberParam("sessionEnd"),this.chatId=C.CoreNavigator.getRequiredRouteNumberParam("chatId"),this.groupId=C.CoreNavigator.getRouteNumberParam("groupId")||0}catch(e){return b.CoreDomUtils.showErrorModal(e),C.CoreNavigator.back(),void 0}this.currentUserId=M.CoreSites.getCurrentSiteUserId(),this.fetchMessages()}fetchMessages(){var e=this;return(0,p.A)((function*(){try{const t=yield T.V.getSessionMessages(e.chatId,e.sessionStart,e.sessionEnd,e.groupId,{cmId:e.cmId});e.messages=yield T.V.getMessagesUserData(t,e.courseId);for(let t=0;t<e.messages.length;t++){e.messages[t]=$.formatMessage(e.currentUserId,e.messages[t],t>0?e.messages[t-1]:void 0);const n=e.messages[t];n.beep&&n.beep!==e.currentUserId&&e.loadMessageBeepWho(n)}e.messages[e.messages.length-1].showTail=!0}catch(e){b.CoreDomUtils.showErrorModalDefault(e,"core.errorloadingcontent",!0)}finally{e.loaded=!0}}))()}loadMessageBeepWho(e){var t=this;return(0,p.A)((function*(){e.beepWho=yield t.getUserFullname(e.beep)}))()}getUserFullname(e){var t=this;return(0,p.A)((function*(){const n=Number(e);if(isNaN(n))return String(e);try{return(yield B.CoreUser.getProfile(n,t.courseId,!0)).fullname}catch{return String(e)}}))()}refreshMessages(e){var t=this;return(0,p.A)((function*(){try{yield v.g.ignoreErrors(T.V.invalidateSessionMessages(t.chatId,t.sessionStart,t.groupId)),yield t.fetchMessages()}finally{e.complete()}}))()}}return(e=AddonModChatSessionMessagesPage).ɵfac=function AddonModChatSessionMessagesPage_Factory(t){return new(t||e)},e.ɵcmp=r.VBU({type:e,selectors:[["page-addon-mod-chat-session-messages"]],decls:16,vars:12,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[1,"addon-messages-discussion-container"],[4,"ngFor","ngForOf"],["class","ion-text-center addon-messages-date",4,"ngIf"],["class","ion-text-center addon-mod_chat-notice",4,"ngIf"],["contextLevel","module",3,"message","user","text","time","instanceId","courseId",4,"ngIf"],[1,"ion-text-center","addon-messages-date"],[1,"ion-text-center","addon-mod_chat-notice"],["class","ion-text-wrap","color","success",4,"ngIf"],["class","ion-text-wrap","color","danger",4,"ngIf"],["class","ion-text-wrap","color","primary",4,"ngIf"],["class","ion-text-wrap","color","light",4,"ngIf"],["class","ion-text-wrap","color","info",4,"ngIf"],["color","success",1,"ion-text-wrap"],["name","fas-right-to-bracket","aria-hidden","true"],["color","danger",1,"ion-text-wrap"],["name","fas-right-from-bracket","aria-hidden","true"],["color","primary",1,"ion-text-wrap"],["name","fas-bell","aria-hidden","true"],["color","light",1,"ion-text-wrap"],["color","info",1,"ion-text-wrap"],["name","fas-asterisk","aria-hidden","true"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["contextLevel","module",3,"message","user","text","time","instanceId","courseId"]],template:function AddonModChatSessionMessagesPage_Template(e,t){1&e&&(r.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),r.nrm(3,"ion-back-button",1),r.nI1(4,"translate"),r.k0s(),r.j41(5,"ion-title")(6,"h1"),r.EFF(7),r.nI1(8,"translate"),r.k0s()()()(),r.j41(9,"ion-content")(10,"ion-refresher",2),r.bIt("ionRefresh",(function AddonModChatSessionMessagesPage_Template_ion_refresher_ionRefresh_10_listener(e){return t.refreshMessages(e.target)})),r.nrm(11,"ion-refresher-content",3),r.nI1(12,"translate"),r.k0s(),r.j41(13,"core-loading",4)(14,"ion-list",5),r.DNE(15,AddonModChatSessionMessagesPage_ng_container_15_Template,4,3,"ng-container",6),r.k0s()()()),2&e&&(r.R7$(3),r.Y8G("text",r.bMT(4,6,"core.back")),r.R7$(4),r.JRh(r.bMT(8,8,"addon.mod_chat.messages")),r.R7$(3),r.Y8G("disabled",!t.loaded),r.R7$(),r.FS9("pullingText",r.bMT(12,10,"core.pulltorefresh")),r.R7$(2),r.Y8G("hideUntil",t.loaded),r.R7$(2),r.Y8G("ngForOf",t.messages))},dependencies:[E.Sq,E.bT,N.R,O.A,Y.t,l.B,_.i,m.In,m.QW,m.W9,m.eU,m.iq,m.nf,m.To,m.Ki,m.BC,m.ai,m.el,L.f,u.D9],styles:[".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0px}ion-content[_ngcontent-%COMP%]{--content-background: var(--background-alternative);--background: var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}ion-content[_ngcontent-%COMP%]   core-empty-box[_ngcontent-%COMP%]{--core-empty-box-icon-color: var(--dark)}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}","[_nghost-%COMP%]   .addon-mod_chat-notice[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}"]}),AddonModChatSessionMessagesPage})();var W=n(93417),H=n(94114),Q=n(2401),J=n(83696),z=n(29492),K=n(99522),Z=n(15221);class AddonModChatSessionsSource extends K.F{constructor(e,t,n){super(),this.showAll=!1,this.groupId=0,this.COURSE_ID=e,this.CHAT_ID=t,this.CM_ID=n}invalidateCache(){var e=this;return(0,p.A)((function*(){yield v.g.allPromisesIgnoringErrors([Z.CoreGroups.invalidateActivityGroupInfo(e.CM_ID),T.V.invalidateSessions(e.CHAT_ID,e.groupId,e.showAll)])}))()}loadPageItems(){var e=this;return(0,p.A)((function*(){e.groupInfo=yield Z.CoreGroups.getActivityGroupInfo(e.CM_ID,!1),e.groupId=Z.CoreGroups.validateGroupId(e.groupId,e.groupInfo);const t=yield T.V.getSessions(e.CHAT_ID,e.groupId,e.showAll,{cmId:e.CM_ID}),n=[],o=t.map((t=>(t.duration=t.sessionend-t.sessionstart,t.sessionusers.forEach((t=>{n.push(e.loadUserFullname(t))})),t.allsessionusers=t.sessionusers,t.sessionusers.length>4&&(t.sessionusers=t.allsessionusers.slice(0,3)),t)));return yield Promise.all(n),{items:o}}))()}getItemPath(e){return`${e.sessionstart}/${e.sessionend}`}getItemQueryParams(){return{chatId:this.CHAT_ID,groupId:this.groupId}}loadUserFullname(e){var t=this;return(0,p.A)((function*(){if(!e.userfullname)try{const n=yield B.CoreUser.getProfile(e.userid,t.COURSE_ID,!0);e.userfullname=n.fullname}catch{e.userfullname=A.HT.instant("core.deleteduser")+" "+e.userid}}))()}}var ee=n(97818),te=n(89417),ne=n(49780);function AddonModChatSessionsPage_ion_card_20_p_6_Template(e,t){if(1&e&&(r.j41(0,"p"),r.EFF(1),r.nI1(2,"coreDuration"),r.k0s()),2&e){const e=r.XpG().$implicit;r.R7$(),r.JRh(r.bMT(2,1,e.duration))}}function AddonModChatSessionsPage_ion_card_20_ion_item_8_span_3_Template(e,t){if(1&e&&(r.j41(0,"span"),r.EFF(1),r.k0s()),2&e){const e=r.XpG().$implicit;r.R7$(),r.SpI("(",e.messagecount,")")}}function AddonModChatSessionsPage_ion_card_20_ion_item_8_Template(e,t){if(1&e&&(r.j41(0,"ion-item")(1,"ion-label"),r.EFF(2),r.DNE(3,AddonModChatSessionsPage_ion_card_20_ion_item_8_span_3_Template,2,1,"span",12),r.k0s()()),2&e){const e=t.$implicit;r.R7$(2),r.SpI(" ",e.userfullname," "),r.R7$(),r.Y8G("ngIf",e.messagecount)}}function AddonModChatSessionsPage_ion_card_20_ion_button_9_Template(e,t){if(1&e){const e=r.RV6();r.j41(0,"ion-button",15),r.bIt("click",(function AddonModChatSessionsPage_ion_card_20_ion_button_9_Template_ion_button_click_0_listener(t){r.eBV(e);const n=r.XpG().$implicit,o=r.XpG();return r.Njj(o.showMoreUsers(n,t))})),r.EFF(1),r.nI1(2,"translate"),r.k0s()}2&e&&(r.R7$(),r.SpI(" ",r.bMT(2,1,"core.showmore")," "))}function AddonModChatSessionsPage_ion_card_20_Template(e,t){if(1&e){const e=r.RV6();r.j41(0,"ion-card",10),r.bIt("click",(function AddonModChatSessionsPage_ion_card_20_Template_ion_card_click_0_listener(){const t=r.eBV(e).$implicit,n=r.XpG();return r.Njj(n.sessions.select(t))})),r.j41(1,"ion-item",6)(2,"ion-label")(3,"p",11),r.EFF(4),r.nI1(5,"coreFormatDate"),r.k0s(),r.DNE(6,AddonModChatSessionsPage_ion_card_20_p_6_Template,3,3,"p",12),r.k0s()(),r.j41(7,"ion-card-content"),r.DNE(8,AddonModChatSessionsPage_ion_card_20_ion_item_8_Template,4,2,"ion-item",13),r.k0s(),r.DNE(9,AddonModChatSessionsPage_ion_card_20_ion_button_9_Template,3,3,"ion-button",14),r.k0s()}if(2&e){const e=t.$implicit,n=r.XpG();r.AVh("addon-mod-chat-session-show-more",e.sessionusers.length<e.allsessionusers.length),r.BMQ("aria-current",n.sessions.getItemAriaCurrent(e)),r.R7$(4),r.JRh(r.bMT(5,7,1e3*e.sessionstart)),r.R7$(2),r.Y8G("ngIf",e.duration),r.R7$(2),r.Y8G("ngForOf",e.sessionusers),r.R7$(),r.Y8G("ngIf",e.sessionusers.length<e.allsessionusers.length)}}function AddonModChatSessionsPage_core_empty_box_21_Template(e,t){1&e&&(r.nrm(0,"core-empty-box",16),r.nI1(1,"translate")),2&e&&r.Y8G("message",r.bMT(1,1,"addon.mod_chat.nosessionsfound"))}let oe=(()=>{var e;class AddonModChatSessionsPage{constructor(){var e=this;this.logView=w.j.once((0,p.A)((function*(){const t=e.sessions.getSource();yield v.g.ignoreErrors(T.V.logViewSessions(e.sessions.getSource().CM_ID)),G.OF.logEvent({type:G.qr.VIEW_ITEM_LIST,ws:"mod_chat_view_sessions",name:A.HT.instant("addon.mod_chat.chatreport"),data:{chatid:t.CHAT_ID,category:"chat"},url:`/mod/chat/report.php?id=${t.CM_ID}`})})))}ngOnInit(){try{this.courseId=C.CoreNavigator.getRequiredRouteNumberParam("courseId");const e=C.CoreNavigator.getRequiredRouteNumberParam("chatId"),t=C.CoreNavigator.getRequiredRouteNumberParam("cmId"),n=J.u.getOrCreateSource(AddonModChatSessionsSource,[this.courseId,e,t]);this.sessions=new Q.R(n,AddonModChatSessionsPage)}catch(e){return b.CoreDomUtils.showErrorModal(e),C.CoreNavigator.back(),void 0}}get groupId(){return this.sessions.getSource().groupId}set groupId(e){this.sessions.getSource().groupId=e}get showAll(){return this.sessions.getSource().showAll}set showAll(e){this.sessions.getSource().showAll=e}get groupInfo(){return this.sessions.getSource().groupInfo}ngAfterViewInit(){var e=this;return(0,p.A)((function*(){yield e.fetchSessions(),e.sessions.start(e.splitView)}))()}fetchSessions(){var e=this;return(0,p.A)((function*(){try{yield e.sessions.load(),e.logView()}catch(e){b.CoreDomUtils.showErrorModalDefault(e,"core.errorloadingcontent",!0)}}))()}reloadSessions(){var e=this;return(0,p.A)((function*(){const t=yield U.CoreLoadings.show();try{yield e.sessions.reload()}catch(e){b.CoreDomUtils.showErrorModalDefault(e,"core.errorloadingcontent",!0)}finally{t.dismiss()}}))()}refreshSessions(e){var t=this;return(0,p.A)((function*(){try{t.sessions.getSource().setDirty(!0),yield t.sessions.getSource().invalidateCache(),yield t.fetchSessions()}finally{e.complete()}}))()}showMoreUsers(e,t){e.allsessionusers&&(e.sessionusers=e.allsessionusers),t.stopPropagation()}ngOnDestroy(){this.sessions.destroy()}}return(e=AddonModChatSessionsPage).ɵfac=function AddonModChatSessionsPage_Factory(t){return new(t||e)},e.ɵcmp=r.VBU({type:e,selectors:[["page-addon-mod-chat-sessions"]],viewQuery:function AddonModChatSessionsPage_Query(e,t){if(1&e&&r.GBs(z.M,5),2&e){let e;r.mGM(e=r.lsd())&&(t.splitView=e.first)}},decls:22,vars:20,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[3,"selectedChange","groupInfo","selected","courseId"],[1,"ion-text-wrap"],[3,"ngModelChange","ionChange","ngModel"],["button","",3,"addon-mod-chat-session-show-more","click",4,"ngFor","ngForOf"],["icon","far-comments",3,"message",4,"ngIf"],["button","",3,"click"],[1,"item-heading"],[4,"ngIf"],[4,"ngFor","ngForOf"],["fill","clear","expand","block",3,"click",4,"ngIf"],["fill","clear","expand","block",3,"click"],["icon","far-comments",3,"message"]],template:function AddonModChatSessionsPage_Template(e,t){1&e&&(r.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),r.nrm(3,"ion-back-button",1),r.nI1(4,"translate"),r.k0s(),r.j41(5,"ion-title")(6,"h1"),r.EFF(7),r.nI1(8,"translate"),r.k0s()()()(),r.j41(9,"ion-content")(10,"core-split-view")(11,"ion-refresher",2),r.bIt("ionRefresh",(function AddonModChatSessionsPage_Template_ion_refresher_ionRefresh_11_listener(e){return t.refreshSessions(e.target)})),r.nrm(12,"ion-refresher-content",3),r.nI1(13,"translate"),r.k0s(),r.j41(14,"core-loading",4)(15,"core-group-selector",5),r.mxI("selectedChange",(function AddonModChatSessionsPage_Template_core_group_selector_selectedChange_15_listener(e){return r.DH7(t.groupId,e)||(t.groupId=e),e})),r.bIt("selectedChange",(function AddonModChatSessionsPage_Template_core_group_selector_selectedChange_15_listener(){return t.reloadSessions()})),r.k0s(),r.j41(16,"ion-item",6)(17,"ion-toggle",7),r.mxI("ngModelChange",(function AddonModChatSessionsPage_Template_ion_toggle_ngModelChange_17_listener(e){return r.DH7(t.showAll,e)||(t.showAll=e),e})),r.bIt("ionChange",(function AddonModChatSessionsPage_Template_ion_toggle_ionChange_17_listener(){return t.reloadSessions()})),r.EFF(18),r.nI1(19,"translate"),r.k0s()(),r.DNE(20,AddonModChatSessionsPage_ion_card_20_Template,10,9,"ion-card",8)(21,AddonModChatSessionsPage_core_empty_box_21_Template,2,3,"core-empty-box",9),r.k0s()()()),2&e&&(r.R7$(3),r.Y8G("text",r.bMT(4,12,"core.back")),r.R7$(4),r.JRh(r.bMT(8,14,"addon.mod_chat.chatreport")),r.R7$(4),r.Y8G("disabled",!t.sessions.loaded),r.R7$(),r.FS9("pullingText",r.bMT(13,16,"core.pulltorefresh")),r.R7$(2),r.Y8G("hideUntil",t.sessions.loaded),r.R7$(),r.Y8G("groupInfo",t.groupInfo),r.R50("selected",t.groupId),r.Y8G("courseId",t.courseId),r.R7$(2),r.R50("ngModel",t.showAll),r.R7$(),r.SpI(" ",r.bMT(19,18,"addon.mod_chat.showincompletesessions")," "),r.R7$(2),r.Y8G("ngForOf",t.sessions.items),r.R7$(),r.Y8G("ngIf",t.sessions.empty))},dependencies:[E.Sq,E.bT,j.h,ee.F,N.R,z.M,_.i,V.T,te.BC,te.vS,m.Jm,m.QW,m.b_,m.I9,m.W9,m.eU,m.uz,m.he,m.To,m.Ki,m.BC,m.BY,m.ai,m.hB,m.el,ne.S,L.f,u.D9],encapsulation:2}),AddonModChatSessionsPage})();var se=n(6007);const ae=[{path:":courseId/:cmId",component:h},{path:":courseId/:cmId/chat",component:X,canDeactivate:[se.V]}],ie=[...ae,{path:":courseId/:cmId/sessions",component:oe},{path:":courseId/:cmId/sessions/:sessionStart/:sessionEnd",component:q}],re=[...ae,{path:":courseId/:cmId/sessions",component:oe,children:[{path:":sessionStart/:sessionEnd",component:q}]}],de=[...(0,H.VI)(ie,(()=>W.CoreScreen.isMobile)),...(0,H.VI)(re,(()=>W.CoreScreen.isTablet))];let ce=(()=>{var e;class AddonModChatLazyModule{}return(e=AddonModChatLazyModule).ɵfac=function AddonModChatLazyModule_Factory(t){return new(t||e)},e.ɵmod=r.$C({type:e}),e.ɵinj=r.G2t({imports:[o.iI.forChild(de),s.n,d]}),AddonModChatLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&r.Obh(ce,{declarations:[h,X,oe,q],imports:[o.iI,s.n,d]}))}}]);