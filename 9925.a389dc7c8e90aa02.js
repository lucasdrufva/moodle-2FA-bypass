"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9925],{29925:(e,i,n)=>{n.r(i),n.d(i,{default:()=>U});var o=n(3353),t=n(10467),l=n(54438),a=n(89377),s=n(94455),d=n(52749),r=n(89911),c=n(75383),_=n(79555),f=n(49882),p=n(62960),m=n(91029),u=n(55554),F=n(15324),h=n(24742),g=n(22693),C=n(6319),v=n(88793),P=n(45433),b=n(23780),I=n(60177),x=n(16986),A=n(64422),T=n(7570),w=n(19858),k=n(86198),M=n(77199),R=n(88246),y=n(43570),D=n(89417),j=n(73465),G=n(74431),S=n(91416),E=n(6128),N=n(15060),V=n(59528),$=n(73955);const _c0=e=>({"file-selected":e});function AddonPrivateFilesFileComponent_Conditional_1_Conditional_1_Template(e,i){if(1&e){const e=l.RV6();l.j41(0,"ion-checkbox",9),l.mxI("ngModelChange",(function AddonPrivateFilesFileComponent_Conditional_1_Conditional_1_Template_ion_checkbox_ngModelChange_0_listener(i){l.eBV(e);const n=l.XpG(2);return l.DH7(n.selected,i)||(n.selected=i),l.Njj(i)})),l.bIt("ngModelChange",(function AddonPrivateFilesFileComponent_Conditional_1_Conditional_1_Template_ion_checkbox_ngModelChange_0_listener(i){l.eBV(e);const n=l.XpG(2);return l.Njj(n.onSelectedFileChange.emit(i))})),l.k0s()}if(2&e){const e=l.XpG(2);l.R50("ngModel",e.selected)}}function AddonPrivateFilesFileComponent_Conditional_1_Conditional_2_Template(e,i){if(1&e){const e=l.RV6();l.j41(0,"ion-thumbnail",10),l.bIt("click",(function AddonPrivateFilesFileComponent_Conditional_1_Conditional_2_Template_ion_thumbnail_click_0_listener(i){l.eBV(e);const n=l.XpG(2);return l.Njj(n.download(i,!0))})),l.nrm(1,"img",11),l.k0s()}if(2&e){const e=l.XpG(2);l.R7$(),l.Y8G("src",e.fileIcon,l.B4B)}}function AddonPrivateFilesFileComponent_Conditional_1_Conditional_6_Template(e,i){1&e&&(l.nrm(0,"ion-icon",5),l.nI1(1,"translate")),2&e&&l.BMQ("aria-label",l.bMT(1,1,"core.downloaded"))}function AddonPrivateFilesFileComponent_Conditional_1_p_7_ng_container_1_Template(e,i){if(1&e&&(l.qex(0),l.EFF(1),l.bVm()),2&e){const e=l.XpG(3);l.R7$(),l.JRh(e.fileSizeReadable)}}function AddonPrivateFilesFileComponent_Conditional_1_p_7_ng_container_2_Template(e,i){1&e&&(l.qex(0),l.EFF(1," · "),l.bVm())}function AddonPrivateFilesFileComponent_Conditional_1_p_7_ng_container_3_Template(e,i){if(1&e&&(l.qex(0),l.EFF(1),l.nI1(2,"coreFormatDate"),l.bVm()),2&e){const e=l.XpG(3);l.R7$(),l.JRh(l.bMT(2,1,1e3*e.timemodified))}}function AddonPrivateFilesFileComponent_Conditional_1_p_7_Template(e,i){if(1&e&&(l.j41(0,"p"),l.DNE(1,AddonPrivateFilesFileComponent_Conditional_1_p_7_ng_container_1_Template,2,1,"ng-container",6)(2,AddonPrivateFilesFileComponent_Conditional_1_p_7_ng_container_2_Template,2,0,"ng-container",6)(3,AddonPrivateFilesFileComponent_Conditional_1_p_7_ng_container_3_Template,3,3,"ng-container",6),l.k0s()),2&e){const e=l.XpG(2);l.R7$(),l.Y8G("ngIf",e.fileSizeReadable),l.R7$(),l.Y8G("ngIf",e.fileSizeReadable&&e.showTime),l.R7$(),l.Y8G("ngIf",e.showTime)}}function AddonPrivateFilesFileComponent_Conditional_1_ion_button_9_Template(e,i){if(1&e){const e=l.RV6();l.j41(0,"ion-button",12),l.nI1(1,"translate"),l.bIt("click",(function AddonPrivateFilesFileComponent_Conditional_1_ion_button_9_Template_ion_button_click_0_listener(i){l.eBV(e);const n=l.XpG(2);return l.Njj(n.openFile(i,!0))})),l.nrm(2,"ion-icon",13),l.k0s()}if(2&e){const e=l.XpG(2);l.Y8G("title",l.bMT(1,2,e.openButtonLabel)),l.R7$(2),l.Y8G("name",e.openButtonIcon)}}function AddonPrivateFilesFileComponent_Conditional_1_Conditional_10_Conditional_0_Template(e,i){if(1&e){const e=l.RV6();l.j41(0,"core-download-refresh",16),l.bIt("action",(function AddonPrivateFilesFileComponent_Conditional_1_Conditional_10_Conditional_0_Template_core_download_refresh_action_0_listener(){l.eBV(e);const i=l.XpG(3);return l.Njj(i.download())})),l.k0s()}if(2&e){const e=l.XpG(3);l.Y8G("status",e.state)("enabled",e.canDownload)("loading",e.isDownloading)("canTrustDownload",!e.alwaysDownload)}}function AddonPrivateFilesFileComponent_Conditional_1_Conditional_10_Conditional_1_Template(e,i){if(1&e){const e=l.RV6();l.j41(0,"ion-button",17),l.bIt("click",(function AddonPrivateFilesFileComponent_Conditional_1_Conditional_10_Conditional_1_Template_ion_button_click_0_listener(){l.eBV(e);const i=l.XpG(3);return l.Njj(i.openMenuClick())})),l.nrm(1,"ion-icon",18),l.k0s()}}function AddonPrivateFilesFileComponent_Conditional_1_Conditional_10_Template(e,i){if(1&e&&l.DNE(0,AddonPrivateFilesFileComponent_Conditional_1_Conditional_10_Conditional_0_Template,1,4,"core-download-refresh",14)(1,AddonPrivateFilesFileComponent_Conditional_1_Conditional_10_Conditional_1_Template,2,0,"ion-button",15),2&e){const e=l.XpG(2);l.vxM(0,e.state!==e.statusDownloaded?0:-1),l.R7$(),l.vxM(1,e.canDelete?1:-1)}}function AddonPrivateFilesFileComponent_Conditional_1_Template(e,i){if(1&e){const e=l.RV6();l.j41(0,"ion-item",1),l.DNE(1,AddonPrivateFilesFileComponent_Conditional_1_Conditional_1_Template,1,1,"ion-checkbox",2)(2,AddonPrivateFilesFileComponent_Conditional_1_Conditional_2_Template,2,1),l.j41(3,"ion-label",3),l.bIt("click",(function AddonPrivateFilesFileComponent_Conditional_1_Template_ion_label_click_3_listener(i){l.eBV(e);const n=l.XpG();return l.Njj(n.download(i,!0))})),l.j41(4,"p",4),l.EFF(5),l.DNE(6,AddonPrivateFilesFileComponent_Conditional_1_Conditional_6_Template,2,3,"ion-icon",5),l.k0s(),l.DNE(7,AddonPrivateFilesFileComponent_Conditional_1_p_7_Template,4,3,"p",6),l.k0s(),l.j41(8,"div",7),l.DNE(9,AddonPrivateFilesFileComponent_Conditional_1_ion_button_9_Template,3,4,"ion-button",8)(10,AddonPrivateFilesFileComponent_Conditional_1_Conditional_10_Template,2,2),l.k0s()()}if(2&e){const e=l.XpG();l.Y8G("ngClass",l.eq3(8,_c0,e.showCheckbox&&e.selected))("detail",!1),l.R7$(),l.vxM(1,e.showCheckbox?1:2),l.R7$(4),l.SpI(" ",e.fileName," "),l.R7$(),l.vxM(6,e.state===e.statusDownloaded?6:-1),l.R7$(),l.Y8G("ngIf",e.fileSizeReadable||e.showTime),l.R7$(2),l.Y8G("ngIf",e.isDownloaded&&e.isIOS),l.R7$(),l.vxM(10,e.showCheckbox?-1:10)}}let O=(()=>{var e;class AddonPrivateFilesFileComponent extends E.t{constructor(){super(),this.showCheckbox=!0,this.selected=!1,this.statusDownloaded=G.DownloadStatus.DOWNLOADED,this.onSelectedFileChange=new l.bkB,this.onOpenMenuClick=new l.bkB}openMenuClick(){this.onOpenMenuClick.emit(this)}}return(e=AddonPrivateFilesFileComponent).ɵfac=function AddonPrivateFilesFileComponent_Factory(i){return new(i||e)},e.ɵcmp=l.VBU({type:e,selectors:[["addon-privatefiles-file"]],inputs:{showCheckbox:[l.Mj6.HasDecoratorInputTransform,"showCheckbox","showCheckbox",S.G],selected:[l.Mj6.HasDecoratorInputTransform,"selected","selected",S.G]},outputs:{onSelectedFileChange:"onSelectedFileChange",onOpenMenuClick:"onOpenMenuClick"},standalone:!0,features:[l.GFd,l.Vt3,l.aNF],decls:2,vars:1,consts:[[1,"card-file"],["button","",1,"ion-text-wrap","item-file",3,"ngClass","detail"],["labelPlacement","start",3,"ngModel"],[3,"click"],[1,"item-heading"],["color","success","name","fam-cloud-done","role","status",1,"core-icon-downloaded"],[4,"ngIf"],["slot","end",1,"flex-row"],["fill","clear",3,"title","click",4,"ngIf"],["labelPlacement","start",3,"ngModelChange","ngModel"],["slot","start",3,"click"],["alt","","role","presentation",3,"src"],["fill","clear",3,"click","title"],["slot","icon-only","aria-hidden","true",3,"name"],[3,"status","enabled","loading","canTrustDownload"],["fill","clear"],[3,"action","status","enabled","loading","canTrustDownload"],["fill","clear",3,"click"],["name","ellipsis-vertical","slot","icon-only","aria-hidden","true"]],template:function AddonPrivateFilesFileComponent_Template(e,i){1&e&&(l.j41(0,"ion-card",0),l.DNE(1,AddonPrivateFilesFileComponent_Conditional_1_Template,11,10,"ion-item",1),l.k0s()),2&e&&(l.R7$(),l.vxM(1,i.file?1:-1))},dependencies:[o.n,I.YU,I.bT,N.Y,k.t,y.T,D.BC,D.vS,j.Jm,j.b_,j.eY,j.iq,j.uz,j.he,j.Zx,j.hB,V.f,$.D9],styles:["[_nghost-%COMP%]   ion-checkbox[_ngcontent-%COMP%]{flex:none;width:3rem}[_nghost-%COMP%]   ion-item.item.item-file[_ngcontent-%COMP%]{--inner-border-width: 0 !important}[_nghost-%COMP%]   ion-item.item.item-file.file-selected[_ngcontent-%COMP%]{--ion-item-background: var(--primary-tint)}"]}),AddonPrivateFilesFileComponent})();const index_c0=(e,i)=>({used:e,total:i}),_c1=e=>({$a:e});function AddonPrivateFilesIndexPage_Conditional_3_Template(e,i){if(1&e){const e=l.RV6();l.j41(0,"ion-button",10),l.nI1(1,"translate"),l.bIt("click",(function AddonPrivateFilesIndexPage_Conditional_3_Template_ion_button_click_0_listener(){l.eBV(e);const i=l.XpG();return l.Njj(i.cancelFileSelection())})),l.nrm(2,"ion-icon",11),l.k0s()}2&e&&l.Y8G("ariaLabel",l.bMT(1,1,"core.close"))}function AddonPrivateFilesIndexPage_Conditional_4_Template(e,i){1&e&&(l.nrm(0,"ion-back-button",12),l.nI1(1,"translate")),2&e&&l.Y8G("text",l.bMT(1,1,"core.back"))}function AddonPrivateFilesIndexPage_Conditional_9_Template(e,i){if(1&e){const e=l.RV6();l.j41(0,"ion-button",13),l.nI1(1,"translate"),l.bIt("click",(function AddonPrivateFilesIndexPage_Conditional_9_Template_ion_button_click_0_listener(){l.eBV(e);const i=l.XpG();return l.Njj(i.deleteSelectedFiles(!0))})),l.nrm(2,"ion-icon",14),l.k0s()}2&e&&l.Y8G("ariaLabel",l.bMT(1,1,"core.delete"))}function AddonPrivateFilesIndexPage_core_loading_14_core_combobox_1_Template(e,i){if(1&e){const e=l.RV6();l.j41(0,"core-combobox",20),l.bIt("onChange",(function AddonPrivateFilesIndexPage_core_loading_14_core_combobox_1_Template_core_combobox_onChange_0_listener(i){l.eBV(e);const n=l.XpG(2);return l.Njj(n.rootChanged(i))})),l.j41(1,"ion-select-option",21),l.EFF(2),l.nI1(3,"translate"),l.k0s(),l.j41(4,"ion-select-option",22),l.EFF(5),l.nI1(6,"translate"),l.k0s()()}if(2&e){const e=l.XpG(2);l.Y8G("selection",e.root),l.R7$(2),l.SpI(" ",l.bMT(3,3,"addon.privatefiles.privatefiles")," "),l.R7$(3),l.SpI(" ",l.bMT(6,5,"addon.privatefiles.sitefiles")," ")}}function AddonPrivateFilesIndexPage_core_loading_14_ion_card_2_Template(e,i){if(1&e&&(l.j41(0,"ion-card",23)(1,"ion-item"),l.nrm(2,"ion-icon",24),l.j41(3,"ion-label"),l.EFF(4),l.nI1(5,"translate"),l.k0s()()()),2&e){const e=l.XpG(2);l.R7$(4),l.SpI(" ",l.i5U(5,1,"core.quotausage",l.eq3(7,_c1,l.l_i(4,index_c0,e.spaceUsed,e.userQuotaReadable)))," ")}}function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_ion_item_1_Template(e,i){if(1&e){const e=l.RV6();l.j41(0,"ion-item",28),l.bIt("click",(function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_ion_item_1_Template_ion_item_click_0_listener(){l.eBV(e);const i=l.XpG().$implicit,n=l.XpG(3);return l.Njj(n.openFolder(i))})),l.nrm(1,"ion-icon",29),l.nI1(2,"translate"),l.j41(3,"ion-label"),l.EFF(4),l.k0s()()}if(2&e){const e=l.XpG().$implicit;l.Y8G("detail",!0),l.R7$(),l.BMQ("aria-label",l.bMT(2,3,"core.folder")),l.R7$(3),l.JRh(e.filename)}}function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Conditional_2_Template(e,i){if(1&e){const e=l.RV6();l.j41(0,"addon-privatefiles-file",30),l.bIt("onOpenMenuClick",(function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Conditional_2_Template_addon_privatefiles_file_onOpenMenuClick_0_listener(i){l.eBV(e);const n=l.XpG().$implicit,o=l.XpG(3);return l.Njj("my"===o.root&&o.openManagementFileMenu(i,n))}))("longPress",(function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Conditional_2_Template_addon_privatefiles_file_longPress_0_listener(){l.eBV(e);const i=l.XpG().$implicit,n=l.XpG(3);return l.Njj(n.canDeleteFiles&&"my"===n.root&&n.enableMultipleSelection(i))}))("onSelectedFileChange",(function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Conditional_2_Template_addon_privatefiles_file_onSelectedFileChange_0_listener(i){l.eBV(e);const n=l.XpG().$implicit,o=l.XpG(3);return l.Njj("my"===o.root&&o.selectedFileValueChanged(i,n))})),l.k0s()}if(2&e){const e=l.XpG().$implicit,i=l.XpG(3);l.Y8G("file",e)("component",i.component)("componentId",e.contextid)("showCheckbox",i.canDeleteFiles&&"my"===i.root&&i.selectFilesEnabled())("selected",e.selected)("canDelete",i.canDeleteFiles&&"my"===i.root)}}function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Template(e,i){if(1&e&&(l.qex(0),l.DNE(1,AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_ion_item_1_Template,5,5,"ion-item",26)(2,AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Conditional_2_Template,1,6,"addon-privatefiles-file",27),l.bVm()),2&e){const e=i.$implicit;l.R7$(),l.Y8G("ngIf",e.isdir),l.R7$(),l.vxM(2,e.isdir?-1:2)}}function AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_Template(e,i){if(1&e&&(l.j41(0,"ion-list"),l.DNE(1,AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_ng_container_1_Template,3,2,"ng-container",25),l.k0s()),2&e){const e=l.XpG(2);l.R7$(),l.Y8G("ngForOf",e.files)}}function AddonPrivateFilesIndexPage_core_loading_14_core_empty_box_4_Template(e,i){1&e&&(l.nrm(0,"core-empty-box",31),l.nI1(1,"translate")),2&e&&l.Y8G("message",l.bMT(1,1,"addon.privatefiles.emptyfilelist"))}function AddonPrivateFilesIndexPage_core_loading_14_Template(e,i){if(1&e&&(l.j41(0,"core-loading",15),l.DNE(1,AddonPrivateFilesIndexPage_core_loading_14_core_combobox_1_Template,7,7,"core-combobox",16)(2,AddonPrivateFilesIndexPage_core_loading_14_ion_card_2_Template,6,9,"ion-card",17)(3,AddonPrivateFilesIndexPage_core_loading_14_ion_list_3_Template,2,1,"ion-list",18)(4,AddonPrivateFilesIndexPage_core_loading_14_core_empty_box_4_Template,2,3,"core-empty-box",19),l.k0s()),2&e){const e=l.XpG();l.Y8G("hideUntil",e.filesLoaded),l.R7$(),l.Y8G("ngIf",e.showPrivateFiles&&e.showSiteFiles&&!e.path),l.R7$(),l.Y8G("ngIf",e.userQuota&&e.filesInfo&&e.filesInfo.filecount>0),l.R7$(),l.Y8G("ngIf",e.files&&e.files.length>0),l.R7$(),l.Y8G("ngIf",!e.files||!e.files.length)}}function AddonPrivateFilesIndexPage_Conditional_15_Template(e,i){if(1&e){const e=l.RV6();l.j41(0,"ion-fab",8)(1,"ion-fab-button",32),l.nI1(2,"translate"),l.bIt("click",(function AddonPrivateFilesIndexPage_Conditional_15_Template_ion_fab_button_click_1_listener(){l.eBV(e);const i=l.XpG();return l.Njj(i.uploadFile())})),l.nrm(3,"ion-icon",33),l.j41(4,"span",34),l.EFF(5),l.nI1(6,"translate"),l.k0s()()()}2&e&&(l.R7$(),l.BMQ("aria-label",l.bMT(2,2,"core.fileuploader.uploadafile")),l.R7$(4),l.JRh(l.bMT(6,4,"core.fileuploader.uploadafile")))}function AddonPrivateFilesIndexPage_Conditional_16_Template(e,i){if(1&e){const e=l.RV6();l.j41(0,"div",9)(1,"ion-checkbox",35),l.mxI("ngModelChange",(function AddonPrivateFilesIndexPage_Conditional_16_Template_ion_checkbox_ngModelChange_1_listener(i){l.eBV(e);const n=l.XpG();return l.DH7(n.selectAll,i)||(n.selectAll=i),l.Njj(i)})),l.bIt("ngModelChange",(function AddonPrivateFilesIndexPage_Conditional_16_Template_ion_checkbox_ngModelChange_1_listener(i){l.eBV(e);const n=l.XpG();return l.Njj(n.onSelectAllChanges(i))})),l.EFF(2),l.nI1(3,"translate"),l.k0s()()}if(2&e){const e=l.XpG();l.R7$(),l.R50("ngModel",e.selectAll),l.R7$(),l.SpI(" ",l.bMT(3,2,"core.selectall")," ")}}let X=(()=>{var e;class AddonPrivateFilesIndexPage{constructor(){this.filesLoaded=!1,this.selectFilesEnabled=(0,l.vPA)(!1),this.selectedFiles=[],this.selectAll=!1,this.canDeleteFiles=!1,this.updateSiteObserver=f.z.on(f.z.SITE_UPDATED,(()=>{this.setVisibility()}),d.CoreSites.getCurrentSiteId()),this.logView=h.j.once((0,t.A)((function*(){g.OF.logEvent({type:g.qr.VIEW_ITEM_LIST,ws:"core_files_get_files",name:_.HT.instant("addon.privatefiles.files"),data:{category:"files"},url:"/user/files.php"})})))}ngOnInit(){var e=this;return(0,t.A)((function*(){var i,n;try{e.root=F.CoreNavigator.getRouteParam("root");const i=F.CoreNavigator.getRouteNumberParam("contextid");i&&(e.path={contextid:i,component:F.CoreNavigator.getRequiredRouteParam("component"),filearea:F.CoreNavigator.getRequiredRouteParam("filearea"),itemid:F.CoreNavigator.getRequiredRouteNumberParam("itemid"),filepath:F.CoreNavigator.getRequiredRouteParam("filepath"),filename:F.CoreNavigator.getRequiredRouteParam("filename")})}catch(e){return r.CoreDomUtils.showErrorModal(e),F.CoreNavigator.back(),void 0}e.title=(null===(i=e.path)||void 0===i?void 0:i.filename)||_.HT.instant("addon.privatefiles.files"),e.setVisibility(),e.userQuota=null===(n=d.CoreSites.getCurrentSite())||void 0===n||null===(n=n.getInfo())||void 0===n?void 0:n.userquota,e.root||(e.showPrivateFiles?e.root="my":e.showSiteFiles&&(e.root="site")),e.root?e.rootChanged(e.root):e.filesLoaded=!0,e.canDeleteFiles=yield p.AddonPrivateFiles.canDeletePrivateFiles()}))()}setVisibility(){this.showPrivateFiles=p.AddonPrivateFiles.canViewPrivateFiles(),this.showSiteFiles=p.AddonPrivateFiles.canViewSiteFiles(),this.showUpload=p.AddonPrivateFiles.canUploadFiles()}refreshData(e){this.refreshFiles().finally((()=>{null==e||e.complete()}))}rootChanged(e){this.root=e,this.filesLoaded=!1,this.component="my"==this.root?p.AddonPrivateFilesProvider.PRIVATE_FILES_COMPONENT:p.AddonPrivateFilesProvider.SITE_FILES_COMPONENT,this.fetchFiles().finally((()=>{this.filesLoaded=!0})),this.cancelFileSelection()}uploadFile(){var e=this;return(0,t.A)((function*(){if(!s.WE.isOnline())return r.CoreDomUtils.showErrorModal("core.fileuploader.errormustbeonlinetoupload",!0),void 0;try{yield m.AddonPrivateFilesHelper.uploadPrivateFile(e.filesInfo),e.filesLoaded=!1,yield u.g.ignoreErrors(e.refreshFiles()),e.filesLoaded=!0}catch(e){r.CoreDomUtils.showErrorModalDefault(e,"core.fileuploader.errorwhileuploading",!0)}}))()}fetchFiles(){var e=this;return(0,t.A)((function*(){try{if(e.path)return e.files=yield p.AddonPrivateFiles.getFiles(e.path),void 0;"site"==e.root?(e.title=_.HT.instant("addon.privatefiles.sitefiles"),e.files=yield p.AddonPrivateFiles.getSiteFiles()):"my"==e.root?(e.title=_.HT.instant("addon.privatefiles.files"),e.files=yield p.AddonPrivateFiles.getPrivateFiles(),e.showUpload&&e.userQuota&&e.userQuota>0?(e.filesInfo=yield p.AddonPrivateFiles.getPrivateFilesInfo(),e.spaceUsed=c.Ni.bytesToSize(e.filesInfo.filesizewithoutreferences,1),e.userQuotaReadable=c.Ni.bytesToSize(e.userQuota,1)):delete e.userQuota,e.logView()):r.CoreDomUtils.showErrorModal("addon.privatefiles.couldnotloadfiles",!0)}catch(e){r.CoreDomUtils.showErrorModalDefault(e,"addon.privatefiles.couldnotloadfiles",!0)}}))()}refreshFiles(){var e=this;return(0,t.A)((function*(){try{yield Promise.all([p.AddonPrivateFiles.invalidateDirectory(e.root,e.path),p.AddonPrivateFiles.invalidatePrivateFilesInfoForUser()])}finally{yield e.fetchFiles()}}))()}openFolder(e){const i={contextid:e.contextid,component:e.component||"",filearea:e.filearea||"",itemid:e.itemid||0,filepath:e.filepath||"",filename:e.filename||"",root:this.root};e.component&&(i.filename="");const n=a.V.hashAsciiStr(JSON.stringify(i));F.CoreNavigator.navigate(`../${n}`,{params:i})}ngOnDestroy(){var e;null===(e=this.updateSiteObserver)||void 0===e||e.off()}deleteSelectedFiles(e=!1){var i=this;return(0,t.A)((function*(){if(0===i.selectedFiles.length)return;if(e)try{1===i.selectedFiles.length?yield r.CoreDomUtils.showDeleteConfirm("core.confirmremoveselectedfile",{filename:i.selectedFiles[0].filename}):yield r.CoreDomUtils.showDeleteConfirm("core.confirmremoveselectedfiles")}catch{return}const n=d.CoreSites.getCurrentSiteId(),o=yield b.CoreLoadings.show();try{yield p.AddonPrivateFiles.deleteFiles(i.selectedFiles)}catch(e){throw o.dismiss(),yield r.CoreDomUtils.showErrorModalDefault(e,"An error occourred while file was being deleted."),e}for(const e of i.selectedFiles)yield i.deleteOfflineFile(e,n);yield i.refreshFiles(),o.dismiss();const t=_.HT.instant("core.filedeletedsuccessfully",{filename:1===i.selectedFiles.length?i.selectedFiles[0].filename:i.selectedFiles.length+" "+_.HT.instant("addon.privatefiles.files")});i.selectedFiles=[],i.selectFilesEnabled.set(!1),yield P.CoreToasts.show({message:t,translateMessage:!1,duration:P.ToastDuration.SHORT})}))()}selectedFileValueChanged(e,i){if(e)return this.selectedFiles.push(i),void 0;this.selectedFiles=this.selectedFiles.filter((e=>e!==i))}cancelFileSelection(){var e;this.selectFilesEnabled.set(!1),this.selectedFiles=[],this.files=null===(e=this.files)||void 0===e?void 0:e.map((e=>({...e,selected:!1})))}openManagementFileMenu(e,i){var o=this;return(0,t.A)((function*(){const t=d.CoreSites.getCurrentSiteId(),{AddonPrivateFilesFileActionsComponent:l}=yield Promise.all([n.e(2076),n.e(9589)]).then(n.bind(n,29589));try{const{status:n}=yield C.I.openSheet(l,{isDownloaded:e.isDownloaded,filename:i.filename,icon:e.fileIcon},!0);if("cancel"===n)return;if("deleteOnline"===n)return yield r.CoreDomUtils.showDeleteConfirm("core.confirmremoveselectedfile",{filename:i.filename}),o.selectedFiles=[i],yield o.deleteSelectedFiles();if("deleteOffline"===n)return yield o.deleteOfflineFile(i,t);yield e.download()}catch{return}}))()}onSelectAllChanges(e){if(this.files){for(const i of this.files)i.selected=e;this.selectedFiles=e?[...this.files]:[]}}enableMultipleSelection(e){this.selectFilesEnabled.set(!0),this.selectedFiles.push(e),e.selected=!0}deleteOfflineFile(e,i){return(0,t.A)((function*(){try{yield v.CoreFilepool.removeFileByUrl(i,e.fileurl)}catch(e){r.CoreDomUtils.showErrorModalDefault(e,"core.errordeletefile",!0)}}))()}}return(e=AddonPrivateFilesIndexPage).ɵfac=function AddonPrivateFilesIndexPage_Factory(i){return new(i||e)},e.ɵcmp=l.VBU({type:e,selectors:[["page-addon-privatefiles-index"]],decls:17,vars:10,consts:[["slot","start"],["fill","clear",3,"ariaLabel"],["slot","end"],["fill","clear","color","danger",3,"ariaLabel"],[1,"limited-width"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[1,"ion-padding","addons-privatefiles-index-select-all"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","fas-xmark","aria-hidden","true"],[3,"text"],["fill","clear","color","danger",3,"click","ariaLabel"],["slot","icon-only","name","fas-trash","aria-hidden","true"],[3,"hideUntil"],[3,"selection","onChange",4,"ngIf"],["class","core-info-card",4,"ngIf"],[4,"ngIf"],["icon","far-folder-open",3,"message",4,"ngIf"],[3,"onChange","selection"],["value","my",1,"ion-text-wrap"],["value","site",1,"ion-text-wrap"],[1,"core-info-card"],["slot","start","aria-label","hidden","name","fas-cloud"],[4,"ngFor","ngForOf"],["button","","class","ion-text-wrap item-file item-directory",3,"detail","click",4,"ngIf"],["showDownloadStatus","true",3,"file","component","componentId","showCheckbox","selected","canDelete"],["button","",1,"ion-text-wrap","item-file","item-directory",3,"click","detail"],["name","fas-folder","slot","start"],["showDownloadStatus","true",3,"onOpenMenuClick","longPress","onSelectedFileChange","file","component","componentId","showCheckbox","selected","canDelete"],["icon","far-folder-open",3,"message"],[3,"click"],["name","fas-arrow-up-from-bracket","aria-hidden","true"],[1,"sr-only"],["labelPlacement","end",3,"ngModelChange","ngModel"]],template:function AddonPrivateFilesIndexPage_Template(e,i){1&e&&(l.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),l.DNE(3,AddonPrivateFilesIndexPage_Conditional_3_Template,3,3,"ion-button",1)(4,AddonPrivateFilesIndexPage_Conditional_4_Template,2,3),l.k0s(),l.j41(5,"ion-title")(6,"h1"),l.EFF(7),l.k0s()(),l.j41(8,"ion-buttons",2),l.DNE(9,AddonPrivateFilesIndexPage_Conditional_9_Template,3,3,"ion-button",3),l.k0s()()(),l.j41(10,"ion-content",4)(11,"ion-refresher",5),l.bIt("ionRefresh",(function AddonPrivateFilesIndexPage_Template_ion_refresher_ionRefresh_11_listener(e){return i.refreshData(e.target)})),l.nrm(12,"ion-refresher-content",6),l.nI1(13,"translate"),l.k0s(),l.DNE(14,AddonPrivateFilesIndexPage_core_loading_14_Template,5,5,"core-loading",7)(15,AddonPrivateFilesIndexPage_Conditional_15_Template,7,6,"ion-fab",8),l.k0s(),l.DNE(16,AddonPrivateFilesIndexPage_Conditional_16_Template,4,4,"div",9)),2&e&&(l.R7$(3),l.vxM(3,i.selectFilesEnabled()?3:4),l.R7$(4),l.JRh(i.selectFilesEnabled()?i.selectedFiles.length+" "+i.title:i.title),l.R7$(2),l.vxM(9,i.selectFilesEnabled()&&i.selectedFiles.length>0?9:-1),l.R7$(2),l.Y8G("disabled",!i.filesLoaded||!i.showPrivateFiles&&!i.showSiteFiles),l.R7$(),l.FS9("pullingText",l.bMT(13,8,"core.pulltorefresh")),l.R7$(2),l.Y8G("ngIf",i.showPrivateFiles||i.showSiteFiles),l.R7$(),l.vxM(15,!i.showUpload||"site"===i.root||i.path||i.selectFilesEnabled()?-1:15),l.R7$(),l.vxM(16,i.selectFilesEnabled()?16:-1))},dependencies:[I.Sq,I.bT,x.h,A.R,T._,w.A,k.t,M.S,R.i,y.T,D.BC,D.vS,j.Jm,j.QW,j.b_,j.eY,j.W9,j.Q8,j.YW,j.eU,j.iq,j.uz,j.he,j.nf,j.To,j.Ki,j.Ip,j.BC,j.ai,j.hB,j.el,O,$.D9],styles:["[_nghost-%COMP%]{--addons-privatefiles-index-select-all-shadow: 0px 8px 10px 0px #282828}[_nghost-%COMP%]   .addons-privatefiles-index-select-all[_ngcontent-%COMP%]{box-shadow:var(--addons-privatefiles-index-select-all-shadow);z-index:3}"]}),AddonPrivateFilesIndexPage})();var B=n(21182),Y=n(42858);function buildRoutes(e){return[{path:"root",component:X},{path:":hash",component:X},...(0,Y.B)(e,{redirectTo:"root",pathMatch:"full"})]}let U=(()=>{var e;class AddonPrivateFilesLazyModule{}return(e=AddonPrivateFilesLazyModule).ɵfac=function AddonPrivateFilesLazyModule_Factory(i){return new(i||e)},e.ɵmod=l.$C({type:e}),e.ɵinj=l.G2t({providers:[{provide:B.bw,multi:!0,deps:[l.zZn],useFactory:buildRoutes}],imports:[o.n,O]}),AddonPrivateFilesLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&l.Obh(U,{declarations:[X],imports:[o.n,O]}))}}]);