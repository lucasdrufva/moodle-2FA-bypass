"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3875],{63875:(e,o,t)=>{t.r(o),t.d(o,{default:()=>Q});var n=t(21182),d=t(3353),a=t(31249),r=t(78645),i=t(54438);let s=(()=>{var e;class AddonModBookComponentsModule{}return(e=AddonModBookComponentsModule).ɵfac=function AddonModBookComponentsModule_Factory(o){return new(o||e)},e.ɵmod=i.$C({type:e}),e.ɵinj=i.G2t({imports:[d.n,a.r]}),AddonModBookComponentsModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&i.Obh(s,{declarations:[r.AddonModBookIndexComponent],imports:[d.n,a.r],exports:[r.AddonModBookIndexComponent]}));var l=t(2138),c=t(58197),u=t(68273),m=t(88246),p=t(73465),g=t(73955);let h=(()=>{var e;class AddonModBookIndexPage extends l._{}return(e=AddonModBookIndexPage).ɵfac=(()=>{let o;return function AddonModBookIndexPage_Factory(t){return(o||(o=i.xGo(e)))(t||e)}})(),e.ɵcmp=i.VBU({type:e,selectors:[["page-addon-mod-book-index"]],viewQuery:function AddonModBookIndexPage_Query(e,o){if(1&e&&i.GBs(r.AddonModBookIndexComponent,5),2&e){let e;i.mGM(e=i.lsd())&&(o.activityComponent=e.first)}},features:[i.Vt3],decls:14,vars:12,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"dataRetrieved","module","courseId"]],template:function AddonModBookIndexPage_Template(e,o){1&e&&(i.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),i.nrm(3,"ion-back-button",2),i.nI1(4,"translate"),i.k0s(),i.j41(5,"ion-title")(6,"h1"),i.nrm(7,"core-format-text",3),i.k0s()(),i.nrm(8,"ion-buttons",4),i.k0s()(),i.j41(9,"ion-content",5)(10,"ion-refresher",6),i.bIt("ionRefresh",(function AddonModBookIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==o.activityComponent?null:o.activityComponent.doRefresh(e.target)})),i.nrm(11,"ion-refresher-content",7),i.nI1(12,"translate"),i.k0s(),i.j41(13,"addon-mod-book-index",8),i.bIt("dataRetrieved",(function AddonModBookIndexPage_Template_addon_mod_book_index_dataRetrieved_13_listener(e){return o.updateData(e)})),i.k0s()()),2&e&&(i.R7$(3),i.Y8G("text",i.bMT(4,8,"core.back")),i.R7$(4),i.Y8G("text",o.title)("contextInstanceId",o.module.id)("courseId",o.courseId),i.R7$(3),i.Y8G("disabled",null==o.activityComponent?null:o.activityComponent.showLoading),i.R7$(),i.FS9("pullingText",i.bMT(12,10,"core.pulltorefresh")),i.R7$(2),i.Y8G("module",o.module)("courseId",o.courseId))},dependencies:[c.B,u.M,m.i,p.QW,p.W9,p.eU,p.To,p.Ki,p.BC,p.ai,p.el,r.AddonModBookIndexComponent,g.D9],encapsulation:2}),AddonModBookIndexPage})();var _=t(8444),I=t(10467),v=t(75629),f=t(62198),C=t(1602),k=t(55306),b=t(44682),M=t(8979),A=t(41094),B=t(94455),x=t(15324),y=t(89911),T=t(49588),R=t(55554),P=t(79555),w=t(79313),G=t(22693),E=t(8014),D=t(492),S=t(6319),N=t(60177),O=t(64422),$=t(46036),j=t(86198),U=t(66731),L=t(43570),Y=t(25367);function AddonModBookContentsPage_ion_button_9_Template(e,o){if(1&e){const e=i.RV6();i.j41(0,"ion-button",11),i.nI1(1,"translate"),i.bIt("click",(function AddonModBookContentsPage_ion_button_9_Template_ion_button_click_0_listener(){i.eBV(e);const o=i.XpG();return i.Njj(o.showToc())})),i.nrm(2,"ion-icon",12),i.k0s()}2&e&&i.Y8G("ariaLabel",i.bMT(1,1,"addon.mod_book.toc"))}function AddonModBookContentsPage_ng_template_17_div_2_Template(e,o){if(1&e&&(i.j41(0,"div",16)(1,"strong"),i.EFF(2),i.nI1(3,"translate"),i.k0s(),i.nrm(4,"core-tag-list",17),i.k0s()),2&e){const e=i.XpG().item;i.R7$(2),i.SpI("",i.bMT(3,2,"core.tag.tags"),": "),i.R7$(2),i.Y8G("tags",e.tags)}}function AddonModBookContentsPage_ng_template_17_Template(e,o){if(1&e&&(i.j41(0,"div",13),i.nrm(1,"core-format-text",14),i.DNE(2,AddonModBookContentsPage_ng_template_17_div_2_Template,5,4,"div",15),i.k0s()),2&e){const e=o.item,t=o.active,n=i.XpG();i.R7$(),i.Y8G("component",n.component)("componentId",n.cmId)("text",e.content)("contextInstanceId",n.cmId)("courseId",n.courseId)("disabled",!t),i.R7$(),i.Y8G("ngIf",(null==e.tags?null:e.tags.length)>0)}}function AddonModBookContentsPage_core_navigation_bar_18_Template(e,o){if(1&e){const e=i.RV6();i.j41(0,"core-navigation-bar",18),i.bIt("action",(function AddonModBookContentsPage_core_navigation_bar_18_Template_core_navigation_bar_action_0_listener(o){i.eBV(e);const t=i.XpG();return i.Njj(t.changeChapter(o.id))})),i.k0s()}if(2&e){const e=i.XpG();i.Y8G("items",e.navigationItems)}}let V=(()=>{var e;class AddonModBookContentsPage{constructor(){this.title="",this.component=D.G,this.displayNavBar=!0,this.navigationItems=[],this.swiperOpts={autoHeight:!0,observer:!0,observeParents:!0,scrollOnChange:"top"},this.loaded=!1}ngOnInit(){try{this.cmId=x.CoreNavigator.getRequiredRouteNumberParam("cmId"),this.courseId=x.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.initialChapterId=x.CoreNavigator.getRouteNumberParam("chapterId")}catch(e){return y.CoreDomUtils.showErrorModal(e),x.CoreNavigator.back(),void 0}const e=new AddonModBookSlidesItemsManagerSource(this.courseId,this.cmId,A.CoreTag.areTagsAvailableInSite(),this.initialChapterId);this.manager=new f.N(e),this.managerUnsubscribe=this.manager.addListener({onSelectedItemUpdated:e=>{this.onChapterViewed(e.id)}}),this.fetchContent()}get module(){var e;return null===(e=this.manager)||void 0===e?void 0:e.getSource().module}get book(){var e;return null===(e=this.manager)||void 0===e?void 0:e.getSource().book}get chapters(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().chapters)||[]}fetchContent(e=!1){var o=this;return(0,I.A)((function*(){try{var t;const n=null===(t=o.manager)||void 0===t?void 0:t.getSource();if(!n)return;const{book:d}=yield n.loadBookData();o.displayNavBar=0!=d.navstyle,o.title=d.name,yield n.loadContents(e),yield n.load()}catch(e){y.CoreDomUtils.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}finally{o.loaded=!0}}))()}changeChapter(e){var o;e&&(null===(o=this.swipeSlidesComponent)||void 0===o||o.slideToItem({id:e}))}doRefresh(e){var o=this;return(0,I.A)((function*(){o.manager&&(yield R.g.ignoreErrors(Promise.all([o.manager.getSource().invalidateContent(),M.CoreCourseModulePrefetchDelegate.invalidateCourseUpdates(o.courseId)]))),yield R.g.ignoreErrors(o.fetchContent(!0)),null==e||e.complete()}))()}showToc(){var e=this;return(0,I.A)((function*(){var o;const n=null===(o=e.manager)||void 0===o?void 0:o.getSelectedItem(),{AddonModBookTocComponent:d}=yield t.e(9213).then(t.bind(t,9213)),a=yield S.I.openSideModal({component:d,componentProps:{moduleId:e.cmId,chapters:e.chapters,selected:null==n?void 0:n.id,courseId:e.courseId,book:e.book}});a&&e.changeChapter(a)}))()}onChapterViewed(e){var o=this;return(0,I.A)((function*(){if(o.displayNavBar&&(o.navigationItems=o.getNavigationItems(e)),o.book&&w.A.storeLastChapterViewed(o.book.id,e,o.courseId),!o.module)return;yield R.g.ignoreErrors(w.A.logView(o.module.instance,e)),G.OF.logEvent({type:G.qr.VIEW_ITEM,ws:"mod_book_view_book",name:o.module.name,data:{id:o.module.instance,category:"book",chapterid:e},url:E.F.addParamsToUrl(`/mod/book/view.php?id=${o.module.id}`,{chapterid:e})});const t=o.chapters.findIndex((o=>o.id==e));(t<0||void 0===o.chapters[t+1])&&b.CoreCourse.checkModuleCompletion(o.courseId,o.module.completiondata)}))()}getNavigationItems(e){return this.chapters.map((o=>({item:o,title:o.title,current:o.id==e,enabled:!0})))}ngOnDestroy(){var e,o;null===(e=this.manager)||void 0===e||e.destroy(),null===(o=this.managerUnsubscribe)||void 0===o||o.call(this),delete this.manager}}return(e=AddonModBookContentsPage).ɵfac=function AddonModBookContentsPage_Factory(o){return new(o||e)},e.ɵcmp=i.VBU({type:e,selectors:[["page-addon-mod-book-contents"]],viewQuery:function AddonModBookContentsPage_Query(e,o){if(1&e&&i.GBs(k.N,5),2&e){let e;i.mGM(e=i.lsd())&&(o.swipeSlidesComponent=e.first)}},decls:19,vars:15,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["aria-haspopup","true",3,"ariaLabel","click",4,"ngIf"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[1,"safe-area-padding-horizontal","core-swipe-slides-container"],[3,"manager","options"],["collapsible-footer","","appearOnBottom","","previousTranslate","addon.mod_book.navprevtitle","nextTranslate","addon.mod_book.navnexttitle","slot","fixed",3,"items","action",4,"ngIf"],["aria-haspopup","true",3,"click","ariaLabel"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],[1,"ion-padding"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId","disabled"],["class","ion-margin-top",4,"ngIf"],[1,"ion-margin-top"],[3,"tags"],["collapsible-footer","","appearOnBottom","","previousTranslate","addon.mod_book.navprevtitle","nextTranslate","addon.mod_book.navnexttitle","slot","fixed",3,"action","items"]],template:function AddonModBookContentsPage_Template(e,o){1&e&&(i.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),i.nrm(3,"ion-back-button",1),i.nI1(4,"translate"),i.k0s(),i.j41(5,"ion-title")(6,"h1"),i.nrm(7,"core-format-text",2),i.k0s()(),i.j41(8,"ion-buttons",3),i.DNE(9,AddonModBookContentsPage_ion_button_9_Template,3,3,"ion-button",4),i.k0s()()(),i.j41(10,"ion-content")(11,"ion-refresher",5),i.bIt("ionRefresh",(function AddonModBookContentsPage_Template_ion_refresher_ionRefresh_11_listener(e){return o.doRefresh(e.target)})),i.nrm(12,"ion-refresher-content",6),i.nI1(13,"translate"),i.k0s(),i.j41(14,"core-loading",7)(15,"div",8)(16,"core-swipe-slides",9),i.DNE(17,AddonModBookContentsPage_ng_template_17_Template,3,7,"ng-template"),i.k0s()()(),i.DNE(18,AddonModBookContentsPage_core_navigation_bar_18_Template,1,1,"core-navigation-bar",10),i.k0s()),2&e&&(i.R7$(3),i.Y8G("text",i.bMT(4,11,"core.back")),i.R7$(4),i.Y8G("text",o.title)("contextInstanceId",o.cmId)("courseId",o.courseId),i.R7$(2),i.Y8G("ngIf",o.loaded),i.R7$(2),i.Y8G("disabled",!o.loaded),i.R7$(),i.FS9("pullingText",i.bMT(13,13,"core.pulltorefresh")),i.R7$(2),i.Y8G("hideUntil",o.loaded),i.R7$(2),i.Y8G("manager",o.manager)("options",o.swiperOpts),i.R7$(2),i.Y8G("ngIf",o.loaded&&o.displayNavBar&&o.navigationItems.length>1))},dependencies:[N.bT,O.R,$.o,k.N,j.t,c.B,U.i,m.i,L.T,p.Jm,p.QW,p.W9,p.eU,p.iq,p.To,p.Ki,p.BC,p.ai,p.el,Y.v,g.D9],styles:["[_nghost-%COMP%]   .core-swipe-slides-container[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{flex:none}[_nghost-%COMP%]   .has-collapsible-footer[_ngcontent-%COMP%]     swiper-container::part(container){padding-bottom:50px}"]}),AddonModBookContentsPage})();class AddonModBookSlidesItemsManagerSource extends C.O{constructor(e,o,t,n){super(n?{id:n}:void 0),this.chapters=[],this.contentsMap={},this.COURSE_ID=e,this.CM_ID=o,this.TAGS_ENABLED=t}getItemId(e){return e.id}loadBookData(){var e=this;return(0,I.A)((function*(){if(e.module=yield b.CoreCourse.getModule(e.CM_ID,e.COURSE_ID),e.book=yield w.A.getBook(e.COURSE_ID,e.CM_ID),!e.initialItem){const o=yield w.A.getLastChapterViewed(e.book.id);o&&(e.initialItem={id:o})}return{module:e.module,book:e.book}}))()}loadContents(e=!1){var o=this;return(0,I.A)((function*(){if(!o.module)return;const t=yield o.getModuleContents(e);o.contentsMap=w.A.getContentsMap(t),o.chapters=w.A.getTocList(t)}))()}getModuleContents(e=!1){var o=this;return(0,I.A)((function*(){if(!o.module)return[];const t=e&&B.WE.isOnline();try{return yield b.CoreCourse.getModuleContents(o.module,o.COURSE_ID,void 0,!1,t)}catch(e){if(t&&!o.module.contents)return yield b.CoreCourse.getModuleContents(o.module);if(!o.module.contents)throw e;return o.module.contents}}))()}loadItems(){var e=this;return(0,I.A)((function*(){try{const o=yield Promise.all(e.chapters.map(function(){var o=(0,I.A)((function*(o){const t=yield w.A.getChapterContent(e.contentsMap,o.id,e.CM_ID);return{id:o.id,content:t,tags:e.TAGS_ENABLED?e.contentsMap[o.id].tags:[]}}));return function(e){return o.apply(this,arguments)}}()));return o}catch(e){if(!T.CoreErrorHelper.getErrorMessageFromError(e))throw new v.CoreError(P.HT.instant("addon.mod_book.errorchapter"));throw e}}))()}invalidateContent(){return w.A.invalidateContent(this.CM_ID,this.COURSE_ID)}}const F=[{path:":courseId/:cmId",component:h},{path:":courseId/:cmId/contents",component:V}];let Q=(()=>{var e;class AddonModBookLazyModule{}return(e=AddonModBookLazyModule).ɵfac=function AddonModBookLazyModule_Factory(o){return new(o||e)},e.ɵmod=i.$C({type:e}),e.ɵinj=i.G2t({imports:[n.iI.forChild(F),d.n,s,_.O]}),AddonModBookLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&i.Obh(Q,{declarations:[h,V],imports:[n.iI,d.n,s,_.O]}))}}]);