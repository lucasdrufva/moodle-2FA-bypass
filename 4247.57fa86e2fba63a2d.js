"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4247],{14247:(e,o,r)=>{r.r(o),r.d(o,{CoreCourseSummaryPage:()=>N});var t=r(10467),n=r(49882),s=r(52749),c=r(89911),a=r(66110),i=r(78765),u=r(94247),l=r(79555),_=r(15324),m=r(55554),d=r(83219),g=r(55351),p=r(8756),C=r(18022),f=r(24742),h=r(22693),b=r(33499),v=r(59656),y=r(4838),I=r(9538),P=r(54438),T=r(60177),M=r(64422),E=r(49234),x=r(16658),S=r(4060),O=r(10892),G=r(86198),w=r(58197),R=r(23007),k=r(37557),$=r(35407),A=r(88246),D=r(43570),Y=r(73465),j=r(79978),F=r(73955);const B=["courseThumb"];function CoreCourseSummaryPage_ion_buttons_6_Template(e,o){if(1&e){const e=P.RV6();P.j41(0,"ion-buttons",11)(1,"ion-button",12),P.nI1(2,"translate"),P.bIt("click",(function CoreCourseSummaryPage_ion_buttons_6_Template_ion_button_click_1_listener(){P.eBV(e);const o=P.XpG();return P.Njj(o.closeModal())})),P.nrm(3,"ion-icon",13),P.k0s()()}2&e&&(P.R7$(),P.Y8G("ariaLabel",P.bMT(2,1,"core.close")))}function CoreCourseSummaryPage_div_12_img_2_Template(e,o){if(1&e){const e=P.RV6();P.j41(0,"img",17),P.bIt("error",(function CoreCourseSummaryPage_div_12_img_2_Template_img_error_0_listener(){P.eBV(e);const o=P.XpG(2);return P.Njj(o.loadFallbackCourseIcon())})),P.k0s()}if(2&e){const e=P.XpG(2);P.Y8G("url",e.course.courseimage)}}function CoreCourseSummaryPage_div_12_ion_icon_3_Template(e,o){1&e&&P.nrm(0,"ion-icon",18)}function CoreCourseSummaryPage_div_12_Template(e,o){if(1&e&&(P.j41(0,"div",14,0),P.DNE(2,CoreCourseSummaryPage_div_12_img_2_Template,1,1,"img",15)(3,CoreCourseSummaryPage_div_12_ion_icon_3_Template,1,0,"ion-icon",16),P.k0s()),2&e){const e=P.XpG();P.R7$(2),P.Y8G("ngIf",e.course.courseimage),P.R7$(),P.Y8G("ngIf",!e.course.courseimage)}}function CoreCourseSummaryPage_div_13_p_4_Template(e,o){if(1&e&&(P.j41(0,"p",29),P.nrm(1,"core-format-text",24),P.k0s()),2&e){const e=P.XpG(2);P.R7$(),P.Y8G("text",e.course.shortname)("contextInstanceId",e.course.id)}}function CoreCourseSummaryPage_div_13_ion_chip_10_Template(e,o){if(1&e&&(P.j41(0,"ion-chip",30)(1,"span",23),P.EFF(2),P.nI1(3,"translate"),P.k0s(),P.j41(4,"ion-label"),P.nrm(5,"core-format-text",31),P.k0s()()),2&e){const e=P.XpG(2);P.R7$(2),P.JRh(P.bMT(3,3,"core.courses.aria:coursecategory")),P.R7$(3),P.Y8G("text",e.course.categoryname)("contextInstanceId",e.course.categoryid)}}function CoreCourseSummaryPage_div_13_ion_button_11_Template(e,o){if(1&e&&(P.j41(0,"ion-button",32),P.nI1(1,"translate"),P.nrm(2,"ion-icon",33),P.k0s()),2&e){const e=P.XpG(2);P.AVh("hidden",!e.isTeacher),P.Y8G("href",e.courseUrl)("showBrowserWarning",!1)("ariaLabel",P.bMT(1,5,"core.openinbrowser"))}}function CoreCourseSummaryPage_div_13_ion_item_12_div_2_Template(e,o){if(1&e&&(P.j41(0,"div",37),P.nrm(1,"core-progress-bar",38),P.k0s()),2&e){const e=P.XpG(3);P.R7$(),P.Y8G("progress",e.progress)}}function CoreCourseSummaryPage_div_13_ion_item_12_div_3_core_reminders_date_1_Template(e,o){if(1&e&&(P.nrm(0,"core-reminders-date",42),P.nI1(1,"translate")),2&e){const e=P.XpG(4);P.Y8G("instanceId",e.course.id)("label",P.bMT(1,5,"core.course.startdate"))("time",e.course.startdate)("title",e.course.fullname)("url",e.courseUrl)}}function CoreCourseSummaryPage_div_13_ion_item_12_div_3_core_reminders_date_2_Template(e,o){if(1&e&&(P.nrm(0,"core-reminders-date",43),P.nI1(1,"translate")),2&e){const e=P.XpG(4);P.Y8G("instanceId",e.course.id)("label",P.bMT(1,5,"core.course.enddate"))("time",e.course.enddate)("title",e.course.fullname)("url",e.courseUrl)}}function CoreCourseSummaryPage_div_13_ion_item_12_div_3_Template(e,o){if(1&e&&(P.j41(0,"div",39),P.DNE(1,CoreCourseSummaryPage_div_13_ion_item_12_div_3_core_reminders_date_1_Template,2,7,"core-reminders-date",40)(2,CoreCourseSummaryPage_div_13_ion_item_12_div_3_core_reminders_date_2_Template,2,7,"core-reminders-date",41),P.k0s()),2&e){const e=P.XpG(3);P.R7$(),P.Y8G("ngIf",e.course.startdate),P.R7$(),P.Y8G("ngIf",e.course.enddate)}}function CoreCourseSummaryPage_div_13_ion_item_12_Template(e,o){if(1&e&&(P.j41(0,"ion-item",34)(1,"ion-label"),P.DNE(2,CoreCourseSummaryPage_div_13_ion_item_12_div_2_Template,2,1,"div",35)(3,CoreCourseSummaryPage_div_13_ion_item_12_div_3_Template,3,2,"div",36),P.k0s()()),2&e){const e=P.XpG(2);P.R7$(2),P.Y8G("ngIf",void 0!==e.progress),P.R7$(),P.Y8G("ngIf",e.course.startdate||e.course.enddate)}}function CoreCourseSummaryPage_div_13_ion_item_13_Template(e,o){if(1&e&&(P.j41(0,"ion-item",44)(1,"ion-label")(2,"h2",45),P.EFF(3),P.nI1(4,"translate"),P.k0s(),P.nrm(5,"core-format-text",46),P.k0s()()),2&e){const e=P.XpG(2);P.Y8G("detail",!1),P.R7$(3),P.SpI(" ",P.bMT(4,4,"core.course.coursesummary")," "),P.R7$(2),P.Y8G("text",e.course.summary)("contextInstanceId",e.course.id)}}function CoreCourseSummaryPage_div_13_ion_list_14_ion_icon_3_Template(e,o){if(1&e&&P.nrm(0,"ion-icon",49),2&e){const e=P.XpG(3);P.AVh("expandable-status-icon-expanded",e.contactsExpanded)}}function CoreCourseSummaryPage_div_13_ion_list_14_ng_container_8_ion_item_1_Template(e,o){if(1&e&&(P.j41(0,"ion-item",51),P.nI1(1,"translate"),P.nrm(2,"core-user-avatar",52),P.j41(3,"ion-label")(4,"p",45),P.EFF(5),P.k0s()()()),2&e){const e=o.$implicit,r=P.XpG(4);P.Y8G("userId",e.id)("courseId",r.isEnrolled?r.course.id:null)("detail",!0),P.BMQ("aria-label",P.bMT(1,9,"core.viewprofile")),P.R7$(2),P.Y8G("user",e)("userId",e.id)("courseId",r.isEnrolled?r.course.id:null)("linkProfile",!1),P.R7$(3),P.JRh(e.fullname)}}function CoreCourseSummaryPage_div_13_ion_list_14_ng_container_8_Template(e,o){if(1&e&&(P.qex(0),P.DNE(1,CoreCourseSummaryPage_div_13_ion_list_14_ng_container_8_ion_item_1_Template,6,11,"ion-item",50),P.bVm()),2&e){const e=P.XpG(3);P.R7$(),P.Y8G("ngForOf",e.course.contacts)}}function CoreCourseSummaryPage_div_13_ion_list_14_Template(e,o){if(1&e){const e=P.RV6();P.j41(0,"ion-list")(1,"ion-item",47),P.nI1(2,"translate"),P.bIt("click",(function CoreCourseSummaryPage_div_13_ion_list_14_Template_ion_item_click_1_listener(){P.eBV(e);const o=P.XpG(2);return P.Njj(o.toggleContacts())})),P.DNE(3,CoreCourseSummaryPage_div_13_ion_list_14_ion_icon_3_Template,1,2,"ion-icon",48),P.j41(4,"ion-label")(5,"h2",45),P.EFF(6),P.nI1(7,"translate"),P.k0s()()(),P.DNE(8,CoreCourseSummaryPage_div_13_ion_list_14_ng_container_8_Template,2,1,"ng-container",10),P.nrm(9,"core-spacer"),P.k0s()}if(2&e){const e=P.XpG(2);P.R7$(),P.Y8G("button",e.course.contacts.length>=5)("detail",!1),P.BMQ("aria-label",P.bMT(2,6,e.contactsExpanded?"core.collapse":"core.expand")),P.R7$(2),P.Y8G("ngIf",e.course.contacts.length>=5),P.R7$(3),P.SpI(" ",P.bMT(7,8,"core.teachers")," "),P.R7$(2),P.Y8G("ngIf",e.contactsExpanded||e.course.contacts.length<5)}}function CoreCourseSummaryPage_div_13_ion_item_15_ng_container_2_div_1_Template(e,o){if(1&e&&(P.j41(0,"div")(1,"span",55),P.nrm(2,"core-format-text",24),P.j41(3,"span",56),P.EFF(4,": "),P.k0s()(),P.j41(5,"span",57),P.nrm(6,"core-format-text",58),P.k0s()()),2&e){const e=P.XpG().$implicit,o=P.XpG(3);P.STu("core-customfield core-customfield_",e.type," core-customfield_",e.shortname,""),P.R7$(2),P.Y8G("text",e.name)("contextInstanceId",o.course.id),P.R7$(4),P.Y8G("text",e.value)("collapsible-item","textarea"===e.type?"":null)("contextInstanceId",o.course.id)}}function CoreCourseSummaryPage_div_13_ion_item_15_ng_container_2_Template(e,o){if(1&e&&(P.qex(0),P.DNE(1,CoreCourseSummaryPage_div_13_ion_item_15_ng_container_2_div_1_Template,7,9,"div",54),P.bVm()),2&e){const e=o.$implicit;P.R7$(),P.Y8G("ngIf",e.value)}}function CoreCourseSummaryPage_div_13_ion_item_15_Template(e,o){if(1&e&&(P.j41(0,"ion-item",34)(1,"ion-label"),P.DNE(2,CoreCourseSummaryPage_div_13_ion_item_15_ng_container_2_Template,2,1,"ng-container",53),P.k0s()()),2&e){const e=P.XpG(2);P.R7$(2),P.Y8G("ngForOf",e.course.customfields)}}function CoreCourseSummaryPage_div_13_Template(e,o){if(1&e&&(P.j41(0,"div",19)(1,"div",20)(2,"ion-item",21)(3,"ion-label"),P.DNE(4,CoreCourseSummaryPage_div_13_p_4_Template,2,2,"p",22),P.j41(5,"h1")(6,"span",23),P.EFF(7),P.nI1(8,"translate"),P.k0s(),P.nrm(9,"core-format-text",24),P.k0s(),P.DNE(10,CoreCourseSummaryPage_div_13_ion_chip_10_Template,6,5,"ion-chip",25),P.k0s(),P.DNE(11,CoreCourseSummaryPage_div_13_ion_button_11_Template,3,7,"ion-button",26),P.k0s(),P.DNE(12,CoreCourseSummaryPage_div_13_ion_item_12_Template,4,2,"ion-item",27)(13,CoreCourseSummaryPage_div_13_ion_item_13_Template,6,6,"ion-item",28)(14,CoreCourseSummaryPage_div_13_ion_list_14_Template,10,10,"ion-list",10)(15,CoreCourseSummaryPage_div_13_ion_item_15_Template,3,1,"ion-item",27),P.k0s()()),2&e){const e=P.XpG();P.R7$(4),P.Y8G("ngIf",e.course.displayname&&e.course.shortname&&e.course.fullname!==e.course.displayname),P.R7$(3),P.JRh(P.bMT(8,10,"core.courses.aria:coursename")),P.R7$(2),P.Y8G("text",e.course.fullname)("contextInstanceId",e.course.id),P.R7$(),P.Y8G("ngIf",e.course.categoryname),P.R7$(),P.Y8G("ngIf",e.displayOpenInBrowser),P.R7$(),P.Y8G("ngIf",void 0!==e.progress||e.course.startdate||e.course.enddate),P.R7$(),P.Y8G("ngIf",e.course.summary),P.R7$(),P.Y8G("ngIf",e.course.contacts&&e.course.contacts.length),P.R7$(),P.Y8G("ngIf",e.course.customfields)}}function CoreCourseSummaryPage_ion_footer_14_ng_container_2_ion_button_1_ion_icon_1_Template(e,o){if(1&e&&P.nrm(0,"ion-icon",63),2&e){const e=P.XpG().$implicit;P.Y8G("name",e.data.icon)}}function CoreCourseSummaryPage_ion_footer_14_ng_container_2_ion_button_1_Template(e,o){if(1&e){const e=P.RV6();P.j41(0,"ion-button",61),P.bIt("click",(function CoreCourseSummaryPage_ion_footer_14_ng_container_2_ion_button_1_Template_ion_button_click_0_listener(){const o=P.eBV(e).$implicit,r=P.XpG(3);return P.Njj(r.openMenuItem(o))})),P.DNE(1,CoreCourseSummaryPage_ion_footer_14_ng_container_2_ion_button_1_ion_icon_1_Template,1,1,"ion-icon",62),P.j41(2,"ion-label"),P.EFF(3),P.nI1(4,"translate"),P.k0s()()}if(2&e){const e=o.$implicit;P.HbH("ion-text-wrap "+e.data.class),P.R7$(),P.Y8G("ngIf",e.data.icon),P.R7$(2),P.JRh(P.bMT(4,4,e.data.title))}}function CoreCourseSummaryPage_ion_footer_14_ng_container_2_Template(e,o){if(1&e&&(P.qex(0),P.DNE(1,CoreCourseSummaryPage_ion_footer_14_ng_container_2_ion_button_1_Template,5,6,"ion-button",60),P.bVm()),2&e){const e=P.XpG(2);P.R7$(),P.Y8G("ngForOf",e.courseMenuHandlers)}}function CoreCourseSummaryPage_ion_footer_14_ng_container_3_ion_button_1_Template(e,o){if(1&e){const e=P.RV6();P.j41(0,"ion-button",66),P.bIt("click",(function CoreCourseSummaryPage_ion_footer_14_ng_container_3_ion_button_1_Template_ion_button_click_0_listener(){P.eBV(e);const o=P.XpG(3);return P.Njj(o.enrolMe())})),P.EFF(1),P.nI1(2,"translate"),P.k0s()}2&e&&(P.R7$(),P.SpI(" ",P.bMT(2,1,"core.courses.enrolme")," "))}function CoreCourseSummaryPage_ion_footer_14_ng_container_3_ion_card_2_Template(e,o){1&e&&(P.j41(0,"ion-card",67)(1,"ion-item"),P.nrm(2,"ion-icon",68),P.j41(3,"ion-label"),P.EFF(4),P.nI1(5,"translate"),P.k0s()()()),2&e&&(P.R7$(4),P.JRh(P.bMT(5,1,"core.courses.notenrollable")))}function CoreCourseSummaryPage_ion_footer_14_ng_container_3_Template(e,o){if(1&e&&(P.qex(0),P.DNE(1,CoreCourseSummaryPage_ion_footer_14_ng_container_3_ion_button_1_Template,3,3,"ion-button",64)(2,CoreCourseSummaryPage_ion_footer_14_ng_container_3_ion_card_2_Template,6,3,"ion-card",65),P.bVm()),2&e){const e=P.XpG(2);P.R7$(),P.Y8G("ngIf",e.selfEnrolInstances.length||e.hasBrowserEnrolments),P.R7$(),P.Y8G("ngIf",!e.selfEnrolInstances.length&&!e.hasBrowserEnrolments)}}function CoreCourseSummaryPage_ion_footer_14_ion_button_4_Template(e,o){if(1&e){const e=P.RV6();P.j41(0,"ion-button",69),P.bIt("click",(function CoreCourseSummaryPage_ion_footer_14_ion_button_4_Template_ion_button_click_0_listener(){P.eBV(e);const o=P.XpG(2);return P.Njj(o.openCourse())})),P.nrm(1,"ion-icon",70),P.EFF(2),P.nI1(3,"translate"),P.k0s()}2&e&&(P.R7$(2),P.SpI(" ",P.bMT(3,1,"core.course.viewcourse")," "))}function CoreCourseSummaryPage_ion_footer_14_Template(e,o){if(1&e&&(P.j41(0,"ion-footer")(1,"div",20),P.DNE(2,CoreCourseSummaryPage_ion_footer_14_ng_container_2_Template,2,1,"ng-container",10)(3,CoreCourseSummaryPage_ion_footer_14_ng_container_3_Template,3,2,"ng-container",10)(4,CoreCourseSummaryPage_ion_footer_14_ion_button_4_Template,4,3,"ion-button",59),P.k0s()()),2&e){const e=P.XpG();P.R7$(2),P.Y8G("ngIf",e.canAccessCourse),P.R7$(),P.Y8G("ngIf",!e.isEnrolled),P.R7$(),P.Y8G("ngIf",!e.isModal&&e.canAccessCourse)}}let N=(()=>{var e;class CoreCourseSummaryPage{constructor(){var e=this;this.courseId=0,this.isEnrolled=!1,this.canAccessCourse=!0,this.useGuestAccess=!1,this.selfEnrolInstances=[],this.guestEnrolInstances=[],this.hasBrowserEnrolments=!1,this.dataLoaded=!1,this.isModal=!1,this.contactsExpanded=!1,this.courseUrl="",this.courseMenuHandlers=[],this.displayOpenInBrowser=!1,this.isTeacher=!1,this.waitStart=0,this.enrolUrl="",this.pageDestroyed=!1,this.waitingForBrowserEnrol=!1,this.appResumeSubscription=C.CorePlatform.resume.subscribe((()=>{this.waitingForBrowserEnrol&&this.dataLoaded&&l.SK.run((0,t.A)((function*(){e.waitingForBrowserEnrol=!1,e.dataLoaded=!1,yield e.refreshData()})))})),this.logView=f.j.once((0,t.A)((function*(){e.course&&!e.isModal&&h.OF.logEvent({type:h.qr.VIEW_ITEM,ws:"core_course_get_courses",name:e.course.fullname,data:{id:e.course.id,category:"course"},url:`/enrol/index.php?id=${e.course.id}`})})))}ngOnInit(){var e=this;return(0,t.A)((function*(){if(e.courseId)e.isModal=!0;else{try{e.courseId=_.CoreNavigator.getRequiredRouteNumberParam("courseId")}catch(o){return c.CoreDomUtils.showErrorModal(o),_.CoreNavigator.back(),e.closeModal(),void 0}e.course=_.CoreNavigator.getRouteParam("course")}const o=s.CoreSites.getRequiredCurrentSite().getURL();e.enrolUrl=p.$.concatenatePaths(o,"enrol/index.php?id="+e.courseId),e.courseUrl=p.$.concatenatePaths(o,"course/view.php?id="+e.courseId),e.displayOpenInBrowser=s.CoreSites.getRequiredCurrentSite().shouldDisplayInformativeLinks(),yield e.getCourse()}))()}getCourse(e=!1){var o=this;return(0,t.A)((function*(){try{yield o.getCourseData(),o.logView()}catch(e){c.CoreDomUtils.showErrorModalDefault(e,"Error getting enrolment data")}yield o.setCourseColor(),o.progress=!o.course||!("progress"in o.course)||"number"!=typeof o.course.progress||o.course.progress<0||!1===o.course.completionusertracked?void 0:o.course.progress,yield o.loadMenuHandlers(e),o.isTeacher=yield m.g.ignoreErrors(u.CoreCourseHelper.guessIsTeacher(o.courseId,o.course),!1),o.dataLoaded=!0}))()}getCourseData(){var e=this;return(0,t.A)((function*(){e.canAccessCourse=!1,e.useGuestAccess=!1;try{try{e.course=yield a.CoreCourses.getUserCourse(e.courseId),e.isEnrolled=!0}catch{e.isEnrolled=!1,e.course=yield a.CoreCourses.getCourse(e.courseId)}e.canAccessCourse=!0,e.useGuestAccess=!1}catch{}const o=yield m.g.ignoreErrors(a.CoreCourses.getCourseByField("id",e.courseId));o&&(e.course?(e.course.customfields=o.customfields,e.course.contacts=o.contacts,e.course.displayname=o.displayname,e.course.categoryname=o.categoryname,e.course.overviewfiles=o.overviewfiles):e.course=o),yield e.getEnrolmentInfo(null==o?void 0:o.enrollmentmethods)}))()}getEnrolmentInfo(e){var o=this;return(0,t.A)((function*(){if(o.isEnrolled)return;const r=yield b.CoreEnrolHelper.getEnrolmentsByType(o.courseId,e);if(o.hasBrowserEnrolments=r.hasBrowser,o.selfEnrolInstances=r.self,o.guestEnrolInstances=r.guest,!o.canAccessCourse){const e=o.guestEnrolInstances.map(function(){var e=(0,t.A)((function*(e){const{canAccess:r}=yield v.CoreEnrolDelegate.canAccess(e);r&&(o.canAccessCourse=!0)}));return function(o){return e.apply(this,arguments)}}());yield Promise.all(e),o.useGuestAccess=o.canAccessCourse}}))()}loadMenuHandlers(e){var o=this;return(0,t.A)((function*(){o.course&&o.canAccessCourse&&(o.courseMenuHandlers=yield i.CoreCourseOptionsDelegate.getMenuHandlersToDisplay(o.course,e,o.useGuestAccess))}))()}validateAccessAndOpen(e,o){var r=this;return(0,t.A)((function*(){if(!r.canAccessCourse||!r.course||r.isModal)return;let t=!1;try{t=yield v.CoreEnrolDelegate.validateAccess(e)}catch{return r.refreshData(),void 0}t&&u.CoreCourseHelper.openCourse(r.course,{params:{isGuest:r.useGuestAccess},replace:o})}))()}openCourse(e=!1){var o=this;return(0,t.A)((function*(){if(!o.canAccessCourse||!o.course||o.isModal)return;if(!(yield u.CoreCourseHelper.userHasAccessToCourse(o.courseId))&&o.guestEnrolInstances.length){if(1==o.guestEnrolInstances.length)return o.validateAccessAndOpen(o.guestEnrolInstances[0],e),void 0;const r=o.guestEnrolInstances.map((r=>({text:r.name,handler:()=>{o.validateAccessAndOpen(r,e)}})));return r.push({text:l.HT.instant("core.cancel"),role:"cancel"}),o.actionSheet=yield l.GD.create({header:l.HT.instant("core.course.viewcourse"),buttons:r}),yield o.actionSheet.present(),void 0}u.CoreCourseHelper.openCourse(o.course,{params:{isGuest:o.useGuestAccess},replace:e})}))()}browserEnrol(){var e=this;return(0,t.A)((function*(){try{yield c.CoreDomUtils.showConfirm(l.HT.instant("core.courses.browserenrolinstructions"),l.HT.instant("core.courses.completeenrolmentbrowser"),l.HT.instant("core.openinbrowser"))}catch{return}e.waitingForBrowserEnrol=!0,yield s.CoreSites.getRequiredCurrentSite().openInBrowserWithAutoLogin(e.enrolUrl,void 0,{showBrowserWarning:!1})}))()}selfEnrolInCourse(e){var o=this;return(0,t.A)((function*(){let r=!1;try{r=yield v.CoreEnrolDelegate.enrol(e)}catch{return o.refreshData(),void 0}r&&(o.isEnrolled=!0,o.dataLoaded=!1,yield o.waitForEnrolled(!0),yield o.refreshData().finally((()=>{n.z.trigger(I.CORE_COURSES_MY_COURSES_UPDATED_EVENT,{courseId:o.courseId,course:o.course,action:I.CoreCoursesMyCoursesUpdatedEventAction.ENROL},s.CoreSites.getCurrentSiteId())})),o.openCourse(!0))}))()}refreshData(e){var o=this;return(0,t.A)((function*(){const r=[];r.push(a.CoreCourses.invalidateUserCourses()),r.push(a.CoreCourses.invalidateCourse(o.courseId)),r.push(i.CoreCourseOptionsDelegate.clearAndInvalidateCoursesOptions(o.courseId)),r.push(a.CoreCourses.invalidateCoursesByField("id",o.courseId)),r.push(y.CoreEnrol.invalidateCourseEnrolmentMethods(o.courseId)),o.selfEnrolInstances.forEach((e=>{r.push(v.CoreEnrolDelegate.invalidate(e))})),o.guestEnrolInstances.forEach((e=>{r.push(v.CoreEnrolDelegate.invalidate(e))})),yield Promise.all(r).finally((()=>o.getCourse())).finally((()=>{null==e||e.complete()}))}))()}waitForEnrolled(e){var o=this;return(0,t.A)((function*(){e&&(o.waitStart=Date.now()),yield m.g.ignoreErrors(a.CoreCourses.invalidateUserCourses());try{yield a.CoreCourses.getUserCourse(o.courseId)}catch{if(o.pageDestroyed||Date.now()-o.waitStart>6e4)return;return new Promise((e=>{setTimeout((0,t.A)((function*(){o.pageDestroyed||(yield o.waitForEnrolled()),e()})),5e3)}))}}))()}openMenuItem(e){const o=Object.assign({course:this.course},e.data.pageParams);_.CoreNavigator.navigateToSitePath(e.data.page,{params:o})}loadFallbackCourseIcon(){this.course&&(this.course.courseimage=void 0,this.setCourseColor())}setCourseColor(){var e=this;return(0,t.A)((function*(){if(e.course&&(yield d.CoreCoursesHelper.loadCourseColorAndImage(e.course),e.courseThumb))if(e.course.color){e.courseThumb.nativeElement.style.setProperty("--course-color",e.course.color);const o=g.a.lighter(e.course.color,50);e.courseThumb.nativeElement.style.setProperty("--course-color-tint",o)}else void 0!==e.course.colorNumber&&e.courseThumb.nativeElement.classList.add("course-color-"+e.course.colorNumber)}))()}enrolMe(){var e=this;return(0,t.A)((function*(){if(1==e.selfEnrolInstances.length&&!e.hasBrowserEnrolments)return e.selfEnrolInCourse(e.selfEnrolInstances[0]),void 0;if(0==e.selfEnrolInstances.length&&e.hasBrowserEnrolments)return e.browserEnrol(),void 0;const o=e.selfEnrolInstances.map((o=>({text:o.name,handler:()=>{e.selfEnrolInCourse(o)}})));e.hasBrowserEnrolments&&o.push({text:l.HT.instant("core.courses.completeenrolmentbrowser"),handler:()=>{e.browserEnrol()}}),o.push({text:l.HT.instant("core.cancel"),role:"cancel"}),e.actionSheet=yield l.GD.create({header:l.HT.instant("core.courses.enrolme"),buttons:o}),yield e.actionSheet.present()}))()}toggleContacts(){this.contactsExpanded=!this.contactsExpanded}closeModal(){l.W3.dismiss()}ngOnDestroy(){var e;this.pageDestroyed=!0,null===(e=this.courseStatusObserver)||void 0===e||e.off(),this.appResumeSubscription.unsubscribe()}}return(e=CoreCourseSummaryPage).ɵfac=function CoreCourseSummaryPage_Factory(o){return new(o||e)},e.ɵcmp=P.VBU({type:e,selectors:[["page-core-course-summary"]],viewQuery:function CoreCourseSummaryPage_Query(e,o){if(1&e&&P.GBs(B,5),2&e){let e;P.mGM(e=P.lsd())&&(o.courseThumb=e.first)}},inputs:{course:"course",courseId:"courseId"},decls:15,vars:12,consts:[["courseThumb",""],[1,"no-title"],["slot","start"],[3,"text"],["slot","end",4,"ngIf"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],["class","core-course-thumb",4,"ngIf"],["class","course-container",4,"ngIf"],[4,"ngIf"],["slot","end"],["fill","clear",3,"click","ariaLabel"],["slot","icon-only","name","fas-xmark","aria-hidden","true"],[1,"core-course-thumb"],["core-external-content","","alt","",3,"url","error",4,"ngIf"],["name","fas-graduation-cap","class","course-icon","aria-hidden","true",4,"ngIf"],["core-external-content","","alt","",3,"error","url"],["name","fas-graduation-cap","aria-hidden","true",1,"course-icon"],[1,"course-container"],[1,"list-item-limited-width"],[1,"ion-text-wrap","course-name"],["class","core-course-shortname",4,"ngIf"],[1,"sr-only"],["contextLevel","course",3,"text","contextInstanceId"],["color","primary","class","core-course-category ion-text-nowrap",4,"ngIf"],["fill","clear","core-link","","slot","end","class","core-course-oib-button",3,"href","showBrowserWarning","ariaLabel","hidden",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["class","ion-text-wrap",3,"detail",4,"ngIf"],[1,"core-course-shortname"],["color","primary",1,"core-course-category","ion-text-nowrap"],["contextLevel","coursecat",3,"text","contextInstanceId"],["fill","clear","core-link","","slot","end",1,"core-course-oib-button",3,"href","showBrowserWarning","ariaLabel"],["name","fas-up-right-from-square","slot","icon-only","aria-hidden","true"],[1,"ion-text-wrap"],["class","core-course-progress",4,"ngIf"],["class","core-course-dates",4,"ngIf"],[1,"core-course-progress"],["a11yText","core.course.aria:sectionprogress",3,"progress"],[1,"core-course-dates"],["component","course","type","coursestart",3,"instanceId","label","time","title","url",4,"ngIf"],["component","course","type","courseend",3,"instanceId","label","time","title","url",4,"ngIf"],["component","course","type","coursestart",3,"instanceId","label","time","title","url"],["component","course","type","courseend",3,"instanceId","label","time","title","url"],[1,"ion-text-wrap",3,"detail"],[1,"item-heading"],["collapsible-item","","contextLevel","course",3,"text","contextInstanceId"],[1,"ion-text-wrap",3,"click","button","detail"],["name","fas-chevron-right","flip-rtl","","slot","start","aria-hidden","true","class","expandable-status-icon",3,"expandable-status-icon-expanded",4,"ngIf"],["name","fas-chevron-right","flip-rtl","","slot","start","aria-hidden","true",1,"expandable-status-icon"],["button","","class","ion-text-wrap","core-user-link","",3,"userId","courseId","detail",4,"ngFor","ngForOf"],["button","","core-user-link","",1,"ion-text-wrap",3,"userId","courseId","detail"],["slot","start",3,"user","userId","courseId","linkProfile"],[4,"ngFor","ngForOf"],[3,"class",4,"ngIf"],[1,"core-customfieldname"],[1,"core-customfieldseparator"],[1,"core-customfieldvalue"],["contextLevel","course",3,"text","collapsible-item","contextInstanceId"],["expand","block","fill","outline","class","ion-text-wrap",3,"click",4,"ngIf"],["expand","block",3,"class","click",4,"ngFor","ngForOf"],["expand","block",3,"click"],["slot","start","aria-hidden","true",3,"name",4,"ngIf"],["slot","start","aria-hidden","true",3,"name"],["expand","block","class","ion-text-wrap",3,"click",4,"ngIf"],["class","core-info-card ion-text-wrap",4,"ngIf"],["expand","block",1,"ion-text-wrap",3,"click"],[1,"core-info-card","ion-text-wrap"],["name","fas-circle-info","slot","start","aria-hidden","true"],["expand","block","fill","outline",1,"ion-text-wrap",3,"click"],["name","fas-eye","slot","start","aria-hidden","true"]],template:function CoreCourseSummaryPage_Template(e,o){1&e&&(P.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2),P.nrm(3,"ion-back-button",3),P.nI1(4,"translate"),P.k0s(),P.nrm(5,"ion-title"),P.DNE(6,CoreCourseSummaryPage_ion_buttons_6_Template,4,3,"ion-buttons",4),P.k0s()(),P.j41(7,"ion-content")(8,"ion-refresher",5),P.bIt("ionRefresh",(function CoreCourseSummaryPage_Template_ion_refresher_ionRefresh_8_listener(e){return o.refreshData(e.target)})),P.nrm(9,"ion-refresher-content",6),P.nI1(10,"translate"),P.k0s(),P.j41(11,"core-loading",7),P.DNE(12,CoreCourseSummaryPage_div_12_Template,4,2,"div",8)(13,CoreCourseSummaryPage_div_13_Template,16,12,"div",9),P.k0s()(),P.DNE(14,CoreCourseSummaryPage_ion_footer_14_Template,5,3,"ion-footer",10)),2&e&&(P.R7$(3),P.Y8G("text",P.bMT(4,8,"core.back")),P.R7$(3),P.Y8G("ngIf",o.isModal),P.R7$(2),P.Y8G("disabled",!o.dataLoaded),P.R7$(),P.FS9("pullingText",P.bMT(10,10,"core.pulltorefresh")),P.R7$(2),P.Y8G("hideUntil",o.dataLoaded),P.R7$(),P.Y8G("ngIf",o.course),P.R7$(),P.Y8G("ngIf",o.course),P.R7$(),P.Y8G("ngIf",o.course&&o.dataLoaded))},dependencies:[T.Sq,T.bT,M.R,E.z,x.T,S.f,O.l,G.t,w.B,R.j,k.O,$.K,A.i,D.T,Y.Jm,Y.QW,Y.b_,Y.ZB,Y.W9,Y.M0,Y.eU,Y.iq,Y.uz,Y.he,Y.nf,Y.To,Y.Ki,Y.BC,Y.ai,Y.el,j.g,F.D9],styles:['[_nghost-%COMP%]{--thumb-height: 180px}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{position:absolute}[_nghost-%COMP%]   .core-course-thumb[_ngcontent-%COMP%]{background:var(--course-color, white);overflow:hidden;text-align:center;height:var(--thumb-height);position:fixed;z-index:-1;width:100%}[_nghost-%COMP%]   .core-course-thumb.course-color-0[_ngcontent-%COMP%]{--course-color: var(--core-course-color-0);--course-color-tint: var(--core-course-color-0-tint)}[_nghost-%COMP%]   .core-course-thumb.course-color-1[_ngcontent-%COMP%]{--course-color: var(--core-course-color-1);--course-color-tint: var(--core-course-color-1-tint)}[_nghost-%COMP%]   .core-course-thumb.course-color-2[_ngcontent-%COMP%]{--course-color: var(--core-course-color-2);--course-color-tint: var(--core-course-color-2-tint)}[_nghost-%COMP%]   .core-course-thumb.course-color-3[_ngcontent-%COMP%]{--course-color: var(--core-course-color-3);--course-color-tint: var(--core-course-color-3-tint)}[_nghost-%COMP%]   .core-course-thumb.course-color-4[_ngcontent-%COMP%]{--course-color: var(--core-course-color-4);--course-color-tint: var(--core-course-color-4-tint)}[_nghost-%COMP%]   .core-course-thumb.course-color-5[_ngcontent-%COMP%]{--course-color: var(--core-course-color-5);--course-color-tint: var(--core-course-color-5-tint)}[_nghost-%COMP%]   .core-course-thumb.course-color-6[_ngcontent-%COMP%]{--course-color: var(--core-course-color-6);--course-color-tint: var(--core-course-color-6-tint)}[_nghost-%COMP%]   .core-course-thumb.course-color-7[_ngcontent-%COMP%]{--course-color: var(--core-course-color-7);--course-color-tint: var(--core-course-color-7-tint)}[_nghost-%COMP%]   .core-course-thumb.course-color-8[_ngcontent-%COMP%]{--course-color: var(--core-course-color-8);--course-color-tint: var(--core-course-color-8-tint)}[_nghost-%COMP%]   .core-course-thumb.course-color-9[_ngcontent-%COMP%]{--course-color: var(--core-course-color-9);--course-color-tint: var(--core-course-color-9-tint)}[_nghost-%COMP%]   .core-course-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}[_nghost-%COMP%]   .core-course-thumb[_ngcontent-%COMP%]   img[src$=".svg"][_ngcontent-%COMP%]{min-width:100%}[_nghost-%COMP%]   .core-course-thumb[_ngcontent-%COMP%]   ion-icon.course-icon[_ngcontent-%COMP%]{padding:24px;font-size:calc(var(--thumb-height) - 48px);color:var(--course-color-tint)}[_nghost-%COMP%]   .course-container[_ngcontent-%COMP%]{position:relative;top:calc(var(--thumb-height) - var(--mdl-shape-borderRadius-lg));border-radius:var(--mdl-shape-borderRadius-lg) var(--mdl-shape-borderRadius-lg) 0 0;background-color:var(--ion-background-color);box-shadow:var(--drop-shadow-top);clip-path:inset(-5px 0px 0px 0px)}[_nghost-%COMP%]   .course-name[_ngcontent-%COMP%]{--background: transparent}[_nghost-%COMP%]   .course-name[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:0}[_nghost-%COMP%]   h1[_ngcontent-%COMP%]{font-size:var(--mdl-typography-heading4-fontSize)}[_nghost-%COMP%]   .core-course-category[_ngcontent-%COMP%]{margin-left:0;margin-right:0}[_nghost-%COMP%]   .core-course-dates[_ngcontent-%COMP%]{background:var(--light);border-radius:var(--mdl-shape-borderRadius-xs);padding:8px;width:100%}[_nghost-%COMP%]   .core-course-dates[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   .core-course-dates[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:last-child{margin-bottom:0}[_nghost-%COMP%]   .core-course-dates[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-end:8px}[_nghost-%COMP%]   .core-customfield[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   .core-customfield.core-customfield_textarea[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-bottom:12px}[_nghost-%COMP%]   .core-customfield[_ngcontent-%COMP%]   .core-customfieldname[_ngcontent-%COMP%]{margin-inline-end:4px;font-weight:700;display:inline}[_nghost-%COMP%]   .core-customfield[_ngcontent-%COMP%]   .core-customfieldvalue[_ngcontent-%COMP%]{display:inline}[_nghost-%COMP%]   .core-course-oib-button.hidden[_ngcontent-%COMP%]{display:none}']}),CoreCourseSummaryPage})()}}]);