"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2792],{16450:(o,n,e)=>{e.d(n,{c:()=>AddonModForumDiscussionsSwipeManager});var t=e(52266);class AddonModForumDiscussionsSwipeManager extends t.Z{skipItemInSwipe(o){return this.getSource().isNewDiscussionForm(o)}}},72792:(o,n,e)=>{e.r(n),e.d(n,{default:()=>oo});var t=e(21182),s=e(64548),i=e(6007),r=e(3353),d=e(10467),a=e(74431),c=e(83696),u=e(16082),m=e(87326),l=e(32440),g=e(82308),f=e(98870),_=e(73465),I=e(94455),p=e(15324),h=e(93417),P=e(52749),v=e(89911),A=e(81690),D=e(79555),y=e(82907),M=e(49882),C=e(6369),F=e(16450),b=e(16179),S=e(93956),T=e(11945),R=e(86275),k=e(22693),w=e(2216),O=e(45433),j=e(23780),N=e(55554),x=e(58364),G=e(54438),E=e(29492),$=e(51024);const _c0=o=>({$a:o}),_c1=o=>({post:o});function AddonModForumDiscussionPage_h1_6_Template(o,n){if(1&o&&(G.j41(0,"h1"),G.nrm(1,"core-format-text",23),G.k0s()),2&o){const o=G.XpG();G.R7$(),G.Y8G("text",o.startingPost.subject)("contextInstanceId",o.cmId)("courseId",o.courseId)}}function AddonModForumDiscussionPage_core_context_menu_item_10_Template(o,n){if(1&o){const o=G.RV6();G.j41(0,"core-context-menu-item",24),G.nI1(1,"translate"),G.bIt("action",(function AddonModForumDiscussionPage_core_context_menu_item_10_Template_core_context_menu_item_action_0_listener(n){G.eBV(o);const e=G.XpG();return G.Njj(e.doRefresh(null,n))})),G.k0s()}if(2&o){const o=G.XpG();G.Y8G("priority",650)("content",G.bMT(1,4,"addon.mod_forum.refreshposts"))("iconAction",o.refreshIcon)("closeOnClick",!1)}}function AddonModForumDiscussionPage_core_context_menu_item_11_Template(o,n){if(1&o){const o=G.RV6();G.j41(0,"core-context-menu-item",24),G.nI1(1,"translate"),G.bIt("action",(function AddonModForumDiscussionPage_core_context_menu_item_11_Template_core_context_menu_item_action_0_listener(n){G.eBV(o);const e=G.XpG();return G.Njj(e.doRefresh(null,n,!0))})),G.k0s()}if(2&o){const o=G.XpG();G.Y8G("priority",550)("content",G.bMT(1,4,"core.settings.synchronizenow"))("iconAction",o.syncIcon)("closeOnClick",!1)}}function AddonModForumDiscussionPage_ion_card_37_Template(o,n){if(1&o&&(G.j41(0,"ion-card",25)(1,"ion-item"),G.nrm(2,"ion-icon",26),G.j41(3,"ion-label"),G.EFF(4),G.nI1(5,"translate"),G.k0s()()()),2&o){const o=G.XpG();G.R7$(4),G.JRh(G.i5U(5,1,"core.hasdatatosync",G.eq3(4,_c0,o.discussionStr)))}}function AddonModForumDiscussionPage_ion_card_38_Template(o,n){if(1&o&&(G.j41(0,"ion-card",27)(1,"ion-item"),G.nrm(2,"ion-icon",28),G.j41(3,"ion-label"),G.EFF(4),G.k0s()()()),2&o){const o=G.XpG();G.R7$(4),G.JRh(o.availabilityMessage)}}function AddonModForumDiscussionPage_ion_card_39_Template(o,n){1&o&&(G.j41(0,"ion-card",27)(1,"ion-item"),G.nrm(2,"ion-icon",29),G.j41(3,"ion-label"),G.EFF(4),G.nI1(5,"translate"),G.k0s()()()),2&o&&(G.R7$(4),G.JRh(G.bMT(5,1,"addon.mod_forum.discussionlocked")))}function AddonModForumDiscussionPage_ion_card_40_Template(o,n){1&o&&(G.j41(0,"ion-card",27)(1,"ion-item"),G.nrm(2,"ion-icon",28),G.j41(3,"ion-label"),G.EFF(4),G.nI1(5,"translate"),G.k0s()()()),2&o&&(G.R7$(4),G.JRh(G.bMT(5,1,"addon.mod_forum.qandanotify")))}function AddonModForumDiscussionPage_div_41_Template(o,n){if(1&o){const o=G.RV6();G.j41(0,"div",30)(1,"addon-mod-forum-post",31),G.bIt("onPostChange",(function AddonModForumDiscussionPage_div_41_Template_addon_mod_forum_post_onPostChange_1_listener(){G.eBV(o);const n=G.XpG();return G.Njj(n.postListChanged())})),G.k0s()()}if(2&o){const o=G.XpG();G.R7$(),G.Y8G("post",o.startingPost)("discussion",o.discussion)("courseId",o.courseId)("highlight",!0)("discussionId",o.discussionId)("component",o.component)("componentId",o.cmId)("formData",o.formData)("originalData",o.originalData)("forum",o.forum)("accessInfo",o.accessInfo)("trackPosts",o.trackPosts)("ratingInfo",o.ratingInfo)("leavingPage",o.leavingPage)}}function AddonModForumDiscussionPage_ion_card_42_ng_container_1_core_spacer_1_Template(o,n){1&o&&G.nrm(0,"core-spacer")}function AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template(o,n){if(1&o){const o=G.RV6();G.qex(0),G.DNE(1,AddonModForumDiscussionPage_ion_card_42_ng_container_1_core_spacer_1_Template,1,0,"core-spacer",3),G.j41(2,"addon-mod-forum-post",33),G.bIt("onPostChange",(function AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template_addon_mod_forum_post_onPostChange_2_listener(){G.eBV(o);const n=G.XpG(2);return G.Njj(n.postListChanged())})),G.k0s(),G.bVm()}if(2&o){const o=n.$implicit,e=n.first,t=G.XpG(2);G.R7$(),G.Y8G("ngIf",!e),G.R7$(),G.Y8G("post",o)("courseId",t.courseId)("discussionId",t.discussionId)("component",t.component)("componentId",t.cmId)("formData",t.formData)("originalData",t.originalData)("parentSubject",t.postSubjects[o.parentid])("forum",t.forum)("accessInfo",t.accessInfo)("trackPosts",t.trackPosts)("ratingInfo",t.ratingInfo)("leavingPage",t.leavingPage)}}function AddonModForumDiscussionPage_ion_card_42_Template(o,n){if(1&o&&(G.j41(0,"ion-card"),G.DNE(1,AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template,3,14,"ng-container",32),G.k0s()),2&o){const o=G.XpG();G.R7$(),G.Y8G("ngForOf",o.posts)}}function AddonModForumDiscussionPage_ng_container_43_ng_container_1_ng_container_1_Template(o,n){1&o&&G.eu8(0)}function AddonModForumDiscussionPage_ng_container_43_ng_container_1_Template(o,n){if(1&o&&(G.qex(0),G.DNE(1,AddonModForumDiscussionPage_ng_container_43_ng_container_1_ng_container_1_Template,1,0,"ng-container",34),G.bVm()),2&o){const o=n.$implicit;G.XpG(2);const e=G.sdS(45);G.R7$(),G.Y8G("ngTemplateOutlet",e)("ngTemplateOutletContext",G.eq3(2,_c1,o))}}function AddonModForumDiscussionPage_ng_container_43_Template(o,n){if(1&o&&(G.qex(0),G.DNE(1,AddonModForumDiscussionPage_ng_container_43_ng_container_1_Template,2,4,"ng-container",32),G.bVm()),2&o){const o=G.XpG();G.R7$(),G.Y8G("ngForOf",o.posts)}}function AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_ng_container_1_Template(o,n){1&o&&G.eu8(0)}function AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_Template(o,n){if(1&o&&(G.qex(0),G.DNE(1,AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_ng_container_1_Template,1,0,"ng-container",34),G.bVm()),2&o){const o=n.$implicit;G.XpG(3);const e=G.sdS(45);G.R7$(),G.Y8G("ngTemplateOutlet",e)("ngTemplateOutletContext",G.eq3(2,_c1,o))}}function AddonModForumDiscussionPage_ng_template_44_div_2_Template(o,n){if(1&o&&(G.j41(0,"div",36),G.DNE(1,AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_Template,2,4,"ng-container",32),G.k0s()),2&o){const o=G.XpG().post;G.R7$(),G.Y8G("ngForOf",o.children)}}function AddonModForumDiscussionPage_ng_template_44_Template(o,n){if(1&o){const o=G.RV6();G.j41(0,"ion-card")(1,"addon-mod-forum-post",33),G.bIt("onPostChange",(function AddonModForumDiscussionPage_ng_template_44_Template_addon_mod_forum_post_onPostChange_1_listener(){G.eBV(o);const n=G.XpG();return G.Njj(n.postListChanged())})),G.k0s()(),G.DNE(2,AddonModForumDiscussionPage_ng_template_44_div_2_Template,2,1,"div",35)}if(2&o){const o=n.post,e=G.XpG();G.R7$(),G.Y8G("post",o)("courseId",e.courseId)("discussionId",e.discussionId)("component",e.component)("componentId",e.cmId)("formData",e.formData)("originalData",e.originalData)("parentSubject",e.postSubjects[o.parentid])("forum",e.forum)("accessInfo",e.accessInfo)("trackPosts",e.trackPosts)("ratingInfo",e.ratingInfo)("leavingPage",e.leavingPage),G.R7$(),G.Y8G("ngIf",o.children&&o.children.length&&o.children[0].subject)}}let L=(()=>{var o;class AddonModForumDiscussionPage{constructor(o,n,e,t){this.splitView=o,this.elementRef=n,this.route=e,this.courseContentsPage=t,this.forum={},this.accessInfo={},this.posts=[],this.discussionLoaded=!1,this.sort="nested",this.formData={replyingTo:0,isEditing:!1,subject:"",message:null,files:[],isprivatereply:!1},this.originalData={subject:null,message:null,files:[],isprivatereply:!1},this.refreshIcon=a.CoreConstants.ICON_LOADING,this.syncIcon=a.CoreConstants.ICON_LOADING,this.discussionStr="",this.component=w.Ep,this.canPin=!1,this.availabilityMessage=null,this.showQAMessage=!1,this.leavingPage=!1,this.hasOfflineRatings=!1}get isMobile(){return h.CoreScreen.isMobile}ngOnInit(){var o=this;return(0,d.A)((function*(){try{var n;const t=p.CoreNavigator.getRouteData(o.route);var e;if(o.courseId=p.CoreNavigator.getRouteNumberParam("courseId"),o.cmId=p.CoreNavigator.getRouteNumberParam("cmId"),o.forumId=p.CoreNavigator.getRouteNumberParam("forumId"),o.discussion=p.CoreNavigator.getRouteParam("discussion"),o.discussionId=o.discussion?o.discussion.discussion:p.CoreNavigator.getRequiredRouteNumberParam("discussionId"),o.trackPosts=p.CoreNavigator.getRouteBooleanParam("trackPosts")||!1,o.postId=p.CoreNavigator.getRouteNumberParam("postId"),o.parent=p.CoreNavigator.getRouteNumberParam("parent"),o.courseId&&o.cmId&&(null===(n=t.swipeEnabled)||void 0===n||n))o.discussions=new AddonModForumDiscussionDiscussionsSwipeManager(c.u.getOrCreateSource(C.a,[o.courseId,o.cmId,null!==(e=t.discussionsPathPrefix)&&void 0!==e?e:""])),yield o.discussions.start()}catch(n){return v.CoreDomUtils.showErrorModal(n),o.goBack(),void 0}const t=P.CoreSites.getCurrentSite();o.isOnline=I.WE.isOnline(),o.externalUrl=t&&t.shouldDisplayInformativeLinks()?t.createSiteUrl("/mod/forum/discuss.php",{d:o.discussionId.toString()}):void 0,o.onlineObserver=I.WE.onChange().subscribe((()=>{D.SK.run((()=>{o.isOnline=I.WE.isOnline()}))})),o.discussionStr=D.HT.instant("addon.mod_forum.discussion")}))()}ngAfterViewInit(){var o=this;return(0,d.A)((function*(){o.sort=o.parent?"nested":yield o.getUserSort(),yield o.fetchPosts(!0,!1,!0);const n=o.postId||o.parent;n&&y.y.scrollToElement(o.elementRef.nativeElement,"#addon-mod_forum-post-"+n)}))()}ionViewDidEnter(){var o=this;return(0,d.A)((function*(){if(o.syncObserver)return;o.discussion||(yield o.loadDiscussion(o.discussionId,o.forumId,o.cmId));const n=o.discussion;o.syncObserver=M.z.on(w.D7,(n=>{n.forumId==o.forumId&&o.discussionId==n.discussionId&&n.userId==P.CoreSites.getCurrentSiteUserId()&&(o.discussionLoaded=!1,o.refreshPosts())}),P.CoreSites.getCurrentSiteId()),o.syncManualObserver=M.z.on(w.uP,(n=>{"discussion"!=n.source&&n.forumId==o.forumId&&n.userId==P.CoreSites.getCurrentSiteUserId()&&(o.discussionLoaded=!1,o.refreshPosts())}),P.CoreSites.getCurrentSiteId()),o.forumId&&n&&n.numunread>0&&b.AddonModForum.invalidateDiscussionsList(o.forumId),o.ratingOfflineObserver=M.z.on(m.CoreRatingProvider.RATING_SAVED_EVENT,(n=>{"mod_forum"==n.component&&"post"==n.ratingArea&&"module"==n.contextLevel&&n.instanceId==o.cmId&&n.itemSetId==o.discussionId&&(o.hasOfflineRatings=!0)})),o.ratingSyncObserver=M.z.on(g.CoreRatingSyncProvider.SYNCED_EVENT,function(){var n=(0,d.A)((function*(n){"mod_forum"==n.component&&"post"==n.ratingArea&&"module"==n.contextLevel&&n.instanceId==o.cmId&&n.itemSetId==o.discussionId&&(o.hasOfflineRatings=!1)}));return function(o){return n.apply(this,arguments)}}()),o.changeDiscObserver=M.z.on(w.rh,(e=>{n&&o.forumId&&(o.forumId===e.forumId||e.cmId===o.cmId)&&b.AddonModForum.invalidateDiscussionsList(o.forumId).finally((()=>{var t;(void 0!==e.locked&&(n.locked=e.locked),void 0!==e.pinned&&(n.pinned=e.pinned),void 0!==e.starred&&(n.starred=e.starred),void 0!==e.deleted&&e.deleted)&&(null!==(t=e.post)&&void 0!==t&&t.parentid?(o.discussionLoaded=!1,o.refreshPosts()):o.goBack())}))}))}))()}canLeave(){var o=this;return(0,d.A)((function*(){return S.i.hasPostDataChanged(o.formData,o.originalData)&&(yield v.CoreDomUtils.showConfirm(D.HT.instant("core.confirmcanceledit"))),u.CoreFileUploader.clearTmpFiles(o.formData.files),o.leavingPage=!0,!0}))()}goBack(){var o;this.leavingPage||(null!==(o=this.splitView)&&void 0!==o&&o.outletActivated?p.CoreNavigator.navigate((this.courseContentsPage?"../":"")+"../"):p.CoreNavigator.back())}ionViewWillLeave(){this.syncObserver&&this.syncObserver.off(),this.syncManualObserver&&this.syncManualObserver.off(),this.ratingOfflineObserver&&this.ratingOfflineObserver.off(),this.ratingSyncObserver&&this.ratingSyncObserver.off(),this.changeDiscObserver&&this.changeDiscObserver.off(),delete this.syncObserver}ngOnDestroy(){this.onlineObserver&&this.onlineObserver.unsubscribe(),this.discussions&&this.discussions.destroy()}getUserSort(){return(0,d.A)((function*(){try{return yield P.CoreSites.getRequiredCurrentSite().getLocalSiteConfig("AddonModForumDiscussionSort")}catch(o){try{const o=yield f.CoreUser.getUserPreference("forum_displaymode");switch(Number(o)){case 1:return"flat-oldest";case-1:return"flat-newest";case 3:return"nested"}}catch{}}return"flat-oldest"}))()}fetchForum(){if(this.courseId&&this.cmId)return b.AddonModForum.getForum(this.courseId,this.cmId);if(this.courseId&&this.forumId)return b.AddonModForum.getForumById(this.courseId,this.forumId);throw new Error("Cannot get the forum")}fetchPosts(o,n,e){var t=this;return(0,d.A)((function*(){let s=[];const i=[];let r=!1;try{o&&(yield N.g.ignoreErrors(t.syncDiscussion(!!n)));const e=yield b.AddonModForum.getDiscussionPosts(t.discussionId,{cmId:t.cmId}),a=yield T.p.getDiscussionReplies(t.discussionId);t.ratingInfo=e.ratinginfo,s=e.posts,t.courseId=e.courseid||t.courseId,t.forumId=e.forumid||t.forumId,t.postHasOffline=!!a.length;const c=[],u={};s.forEach((o=>{u[o.id]=o,r=r||!!o.unread})),a.forEach((o=>{t.forumId||(t.forumId=o.forumid),t.courseId||(t.courseId=o.courseid),c.push(S.i.instance.convertOfflineReplyToOnline(o).then(function(){var o=(0,d.A)((function*(o){i.push(o),o.parentid&&(u[o.parentid].capabilities.reply=!1)}));return function(n){return o.apply(this,arguments)}}()))})),yield Promise.all(c),s=x.T.toArray(u);let m=i.concat(s);if(t.startingPost=b.AddonModForum.extractStartingPost(m),"nested"==t.sort){b.AddonModForum.sortDiscussionPosts(m,"ASC");m=A.j.formatTree(m,"parentid","id",t.startingPost?t.startingPost.id:t.discussion?t.discussion.id:0)}else{b.AddonModForum.sortDiscussionPosts(m,"flat-newest"==t.sort?"DESC":"ASC")}try{const o=yield t.fetchForum();void 0!==o.istracked&&(t.trackPosts=o.istracked),t.forumId=o.id,t.cmId=o.cmid,t.courseId=o.course,t.forum=o,t.availabilityMessage=S.i.getAvailabilityMessage(o);const n=[];n.push(b.AddonModForum.instance.getAccessInformation(t.forumId,{cmId:t.cmId}).then(function(){var n=(0,d.A)((function*(n){t.accessInfo=n,S.i.isCutoffDateReached(o)&&!n.cancanoverridecutoff&&m.forEach((o=>{o.capabilities.reply=!1}));const e=P.CoreSites.getCurrentSiteUserId();t.showQAMessage="qanda"===o.type&&!n.canviewqandawithoutposting&&!m.some((o=>o.author.id===e))}));return function(o){return n.apply(this,arguments)}}())),t.discussion||n.push(t.loadDiscussion(t.discussionId,t.forumId,t.cmId)),yield Promise.all(n)}catch{}if(!t.discussion&&!t.startingPost)throw new Error("Invalid forum discussion.");if(t.startingPost&&t.startingPost.author&&"single"===t.forum.type&&(delete t.startingPost.author.fullname,delete t.startingPost.author.groups),t.posts=m,t.postSubjects=t.getAllPosts().reduce(((o,n)=>(o[n.id]=n.subject,o)),t.startingPost?{[t.startingPost.id]:t.startingPost.subject}:{}),b.AddonModForum.isSetPinStateAvailableForSite()&&t.forumId)try{const o=yield b.AddonModForum.canAddDiscussionToAll(t.forumId,{cmId:t.cmId});t.canPin=!!o.canpindiscussions}catch(o){t.canPin=!1}else t.canPin=!1;t.hasOfflineRatings=yield l.CoreRatingOffline.hasRatings("mod_forum","post","module",t.cmId,t.discussionId)}catch(o){v.CoreDomUtils.showErrorModal(o)}finally{t.discussionLoaded=!0,t.refreshIcon=a.CoreConstants.ICON_REFRESH,t.syncIcon=a.CoreConstants.ICON_SYNC,(e||r&&t.trackPosts)&&t.logDiscussionView(e)}}))()}loadDiscussion(o,n,e){var t=this;return(0,d.A)((function*(){!t.discussion&&n&&e&&(t.discussion=yield S.i.getDiscussionById(n,e,o),t.discussionId=t.discussion.discussion)}))()}syncDiscussion(o){var n=this;return(0,d.A)((function*(){const e=[];e.push(R.F.instance.syncDiscussionReplies(n.discussionId).then((o=>{o.warnings&&o.warnings.length&&v.CoreDomUtils.showAlert(void 0,o.warnings[0]),o&&o.updated&&n.forumId&&M.z.trigger(w.uP,{forumId:n.forumId,userId:P.CoreSites.getCurrentSiteUserId(),source:"discussion"},P.CoreSites.getCurrentSiteId())}))),e.push(R.F.instance.syncRatings(n.cmId,n.discussionId).then((o=>{o.warnings&&o.warnings.length&&v.CoreDomUtils.showAlert(void 0,o.warnings[0])})));try{yield Promise.all(e)}catch(n){throw o&&v.CoreDomUtils.showErrorModalDefault(n,"core.errorsync",!0),new Error("Failed syncing discussion")}}))()}doRefresh(o,n,e=!1){var t=this;return(0,d.A)((function*(){t.discussionLoaded&&(yield t.refreshPosts(!0,e).finally((()=>{null==o||o.complete(),n&&n()})))}))()}refreshPosts(o,n){var e=this;return(0,d.A)((function*(){e.content.scrollToTop(),e.refreshIcon=a.CoreConstants.ICON_LOADING,e.syncIcon=a.CoreConstants.ICON_LOADING;const t=[];e.courseId&&t.push(b.AddonModForum.invalidateForumData(e.courseId)),t.push(b.AddonModForum.invalidateDiscussionPosts(e.discussionId,e.forumId)),e.forumId&&t.push(b.AddonModForum.invalidateAccessInformation(e.forumId)),e.forumId&&t.push(b.AddonModForum.invalidateCanAddDiscussion(e.forumId)),yield N.g.allPromisesIgnoringErrors(t),yield e.fetchPosts(o,n)}))()}changeSort(o){return this.discussionLoaded=!1,this.sort=o,P.CoreSites.getRequiredCurrentSite().setLocalSiteConfig("AddonModForumDiscussionSort",this.sort),this.content.scrollToTop(),this.fetchPosts()}setLockState(o){var n=this;return(0,d.A)((function*(){if(!n.discussion||!n.forumId||!n.cmId)return;const e=yield j.CoreLoadings.show("core.sending",!0);try{const e=yield b.AddonModForum.setLockState(n.forumId,n.discussionId,o);n.discussion.locked=e.locked;M.z.trigger(w.rh,{forumId:n.forumId,discussionId:n.discussionId,cmId:n.cmId,locked:n.discussion.locked},P.CoreSites.getCurrentSiteId()),O.CoreToasts.show({message:"addon.mod_forum.lockupdated",translateMessage:!0})}catch(o){v.CoreDomUtils.showErrorModal(o)}finally{e.dismiss()}}))()}setPinState(o){var n=this;return(0,d.A)((function*(){if(!n.discussion||!n.forumId||!n.cmId)return;const e=yield j.CoreLoadings.show("core.sending",!0);try{yield b.AddonModForum.setPinState(n.discussionId,o),n.discussion.pinned=o;M.z.trigger(w.rh,{forumId:n.forumId,discussionId:n.discussionId,cmId:n.cmId,pinned:n.discussion.pinned},P.CoreSites.getCurrentSiteId()),O.CoreToasts.show({message:"addon.mod_forum.pinupdated",translateMessage:!0})}catch(o){v.CoreDomUtils.showErrorModal(o)}finally{e.dismiss()}}))()}toggleFavouriteState(o){var n=this;return(0,d.A)((function*(){if(!n.discussion||!n.forumId||!n.cmId)return;const e=yield j.CoreLoadings.show("core.sending",!0);try{yield b.AddonModForum.toggleFavouriteState(n.discussionId,o),n.discussion.starred=o;M.z.trigger(w.rh,{forumId:n.forumId,discussionId:n.discussionId,cmId:n.cmId,starred:n.discussion.starred},P.CoreSites.getCurrentSiteId()),O.CoreToasts.show({message:"addon.mod_forum.favouriteupdated",translateMessage:!0})}catch(o){v.CoreDomUtils.showErrorModal(o)}finally{e.dismiss()}}))()}postListChanged(){if(!this.forumId||!this.cmId)return;M.z.trigger(w.L4,{forumId:this.forumId,discussionId:this.discussionId,cmId:this.cmId},P.CoreSites.getCurrentSiteId()),this.discussionLoaded=!1,this.refreshPosts().finally((()=>{this.discussionLoaded=!0}))}getAllPosts(){const o=this.posts.map((o=>this.flattenPostHierarchy(o)));return o.flat()}flattenPostHierarchy(o){const n=[o],e=o.children||[];for(const o of e)n.push(...this.flattenPostHierarchy(o));return n}logDiscussionView(o=!1){var n=this;return(0,d.A)((function*(){var e,t,s;(yield N.g.ignoreErrors(b.AddonModForum.logDiscussionView(n.discussionId,n.forumId||-1)),o)&&k.OF.logEvent({type:k.qr.VIEW_ITEM,ws:"mod_forum_view_forum_discussion",name:null!==(e=null!==(t=null===(s=n.startingPost)||void 0===s?void 0:s.subject)&&void 0!==t?t:n.forum.name)&&void 0!==e?e:"",data:{id:n.discussionId,forumid:n.forumId,category:"forum"},url:`/mod/forum/discuss.php?d=${n.discussionId}`+(n.postId?`#p${n.postId}`:"")});n.courseId&&n.cmId&&n.trackPosts&&M.z.trigger(w.C7,{courseId:n.courseId,moduleId:n.cmId},P.CoreSites.getCurrentSiteId())}))()}}return(o=AddonModForumDiscussionPage).ɵfac=function AddonModForumDiscussionPage_Factory(n){return new(n||o)(G.rXU(E.M,8),G.rXU(G.aKT),G.rXU(t.nX),G.rXU($.k,8))},o.ɵcmp=G.VBU({type:o,selectors:[["page-addon-mod-forum-discussion"]],viewQuery:function AddonModForumDiscussionPage_Query(o,n){if(1&o&&G.GBs(_.W9,5),2&o){let o;G.mGM(o=G.lsd())&&(n.content=o.first)}},decls:46,vars:73,consts:[["nestedPosts",""],["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],[3,"priority","content","iconAction","closeOnClick","action",4,"ngIf"],["iconAction","fas-arrow-down",3,"action","hidden","priority","content"],["iconAction","fas-arrow-up",3,"action","hidden","priority","content"],["iconAction","fas-right-left",3,"action","hidden","priority","content"],["iconAction","fas-lock",3,"action","hidden","priority","content"],["iconAction","fas-unlock",3,"action","hidden","priority","content"],["iconAction","fas-map-pin",3,"action","hidden","priority","content"],["iconAction","fas-map-pin",3,"action","hidden","priority","content","iconSlash"],["iconAction","fas-star",3,"action","hidden","priority","content"],["iconAction","fas-star",3,"action","hidden","priority","content","iconSlash"],["iconAction","fas-up-right-from-square",3,"hidden","priority","content","href","showBrowserWarning"],[1,"limited-width",3,"core-swipe-navigation"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],["class","core-warning-card",4,"ngIf"],["class","core-info-card",4,"ngIf"],["class","ion-margin-bottom",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId"],[3,"action","priority","content","iconAction","closeOnClick"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[1,"core-info-card"],["name","fas-circle-info","slot","start","aria-hidden","true"],["name","fas-lock","slot","start","aria-hidden","true"],[1,"ion-margin-bottom"],[3,"onPostChange","post","discussion","courseId","highlight","discussionId","component","componentId","formData","originalData","forum","accessInfo","trackPosts","ratingInfo","leavingPage"],[4,"ngFor","ngForOf"],[3,"onPostChange","post","courseId","discussionId","component","componentId","formData","originalData","parentSubject","forum","accessInfo","trackPosts","ratingInfo","leavingPage"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","ion-padding-start",4,"ngIf"],[1,"ion-padding-start"]],template:function AddonModForumDiscussionPage_Template(o,n){if(1&o){const o=G.RV6();G.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),G.nrm(3,"ion-back-button",2),G.nI1(4,"translate"),G.k0s(),G.j41(5,"ion-title"),G.DNE(6,AddonModForumDiscussionPage_h1_6_Template,2,3,"h1",3),G.k0s(),G.nrm(7,"ion-buttons",4),G.k0s()(),G.j41(8,"core-navbar-buttons",4)(9,"core-context-menu"),G.DNE(10,AddonModForumDiscussionPage_core_context_menu_item_10_Template,2,6,"core-context-menu-item",5)(11,AddonModForumDiscussionPage_core_context_menu_item_11_Template,2,6,"core-context-menu-item",5),G.j41(12,"core-context-menu-item",6),G.nI1(13,"translate"),G.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_12_listener(){return G.eBV(o),G.Njj(n.changeSort("flat-oldest"))})),G.k0s(),G.j41(14,"core-context-menu-item",7),G.nI1(15,"translate"),G.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_14_listener(){return G.eBV(o),G.Njj(n.changeSort("flat-newest"))})),G.k0s(),G.j41(16,"core-context-menu-item",8),G.nI1(17,"translate"),G.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_16_listener(){return G.eBV(o),G.Njj(n.changeSort("nested"))})),G.k0s(),G.j41(18,"core-context-menu-item",9),G.nI1(19,"translate"),G.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_18_listener(){return G.eBV(o),G.Njj(n.setLockState(!0))})),G.k0s(),G.j41(20,"core-context-menu-item",10),G.nI1(21,"translate"),G.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_20_listener(){return G.eBV(o),G.Njj(n.setLockState(!1))})),G.k0s(),G.j41(22,"core-context-menu-item",11),G.nI1(23,"translate"),G.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_22_listener(){return G.eBV(o),G.Njj(n.setPinState(!0))})),G.k0s(),G.j41(24,"core-context-menu-item",12),G.nI1(25,"translate"),G.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_24_listener(){return G.eBV(o),G.Njj(n.setPinState(!1))})),G.k0s(),G.j41(26,"core-context-menu-item",13),G.nI1(27,"translate"),G.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_26_listener(){return G.eBV(o),G.Njj(n.toggleFavouriteState(!0))})),G.k0s(),G.j41(28,"core-context-menu-item",14),G.nI1(29,"translate"),G.bIt("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_28_listener(){return G.eBV(o),G.Njj(n.toggleFavouriteState(!1))})),G.k0s(),G.nrm(30,"core-context-menu-item",15),G.nI1(31,"translate"),G.k0s()(),G.j41(32,"ion-content",16)(33,"ion-refresher",17),G.bIt("ionRefresh",(function AddonModForumDiscussionPage_Template_ion_refresher_ionRefresh_33_listener(e){return G.eBV(o),G.Njj(n.doRefresh(e.target))})),G.nrm(34,"ion-refresher-content",18),G.nI1(35,"translate"),G.k0s(),G.j41(36,"core-loading",19),G.DNE(37,AddonModForumDiscussionPage_ion_card_37_Template,6,6,"ion-card",20)(38,AddonModForumDiscussionPage_ion_card_38_Template,5,1,"ion-card",21)(39,AddonModForumDiscussionPage_ion_card_39_Template,6,3,"ion-card",21)(40,AddonModForumDiscussionPage_ion_card_40_Template,6,3,"ion-card",21)(41,AddonModForumDiscussionPage_div_41_Template,2,14,"div",22)(42,AddonModForumDiscussionPage_ion_card_42_Template,2,1,"ion-card",3)(43,AddonModForumDiscussionPage_ng_container_43_Template,2,1,"ng-container",3)(44,AddonModForumDiscussionPage_ng_template_44_Template,3,14,"ng-template",null,0,G.C5r),G.k0s()()}2&o&&(G.R7$(3),G.Y8G("text",G.bMT(4,49,"core.back")),G.R7$(3),G.Y8G("ngIf",n.startingPost),G.R7$(4),G.Y8G("ngIf",n.discussionLoaded&&!n.postHasOffline&&n.isOnline),G.R7$(),G.Y8G("ngIf",n.discussionLoaded&&n.isMobile&&n.postHasOffline&&n.isOnline),G.R7$(),G.Y8G("hidden","flat-oldest"===n.sort)("priority",500)("content",G.bMT(13,51,"addon.mod_forum.modeflatoldestfirst")),G.R7$(2),G.Y8G("hidden","flat-newest"===n.sort)("priority",450)("content",G.bMT(15,53,"addon.mod_forum.modeflatnewestfirst")),G.R7$(2),G.Y8G("hidden","nested"===n.sort)("priority",400)("content",G.bMT(17,55,"addon.mod_forum.modenested")),G.R7$(2),G.Y8G("hidden",!n.discussion||!n.discussion.canlock||n.discussion.locked)("priority",300)("content",G.bMT(19,57,"addon.mod_forum.lockdiscussion")),G.R7$(2),G.Y8G("hidden",!n.discussion||!n.discussion.canlock||!n.discussion.locked)("priority",300)("content",G.bMT(21,59,"addon.mod_forum.unlockdiscussion")),G.R7$(2),G.Y8G("hidden",!n.discussion||!n.canPin||n.discussion.pinned)("priority",250)("content",G.bMT(23,61,"addon.mod_forum.pindiscussion")),G.R7$(2),G.Y8G("hidden",!n.discussion||!n.canPin||!n.discussion.pinned)("priority",250)("content",G.bMT(25,63,"addon.mod_forum.unpindiscussion"))("iconSlash",!0),G.R7$(2),G.Y8G("hidden",!n.discussion||!n.discussion.canfavourite||n.discussion.starred)("priority",200)("content",G.bMT(27,65,"addon.mod_forum.addtofavourites")),G.R7$(2),G.Y8G("hidden",!n.discussion||!n.discussion.canfavourite||!n.discussion.starred)("priority",200)("content",G.bMT(29,67,"addon.mod_forum.removefromfavourites"))("iconSlash",!0),G.R7$(2),G.Y8G("hidden",!n.externalUrl)("priority",100)("content",G.bMT(31,69,"core.openinbrowser"))("href",n.externalUrl)("showBrowserWarning",!1),G.R7$(2),G.Y8G("core-swipe-navigation",n.discussions),G.R7$(),G.Y8G("disabled",!n.discussionLoaded),G.R7$(),G.FS9("pullingText",G.bMT(35,71,"core.pulltorefresh")),G.R7$(2),G.Y8G("hideUntil",n.discussionLoaded),G.R7$(),G.Y8G("ngIf",n.postHasOffline||n.hasOfflineRatings),G.R7$(),G.Y8G("ngIf",n.availabilityMessage),G.R7$(),G.Y8G("ngIf",n.discussion&&n.discussion.locked),G.R7$(),G.Y8G("ngIf",n.showQAMessage),G.R7$(),G.Y8G("ngIf",n.startingPost),G.R7$(),G.Y8G("ngIf","nested"!==n.sort&&n.posts.length),G.R7$(),G.Y8G("ngIf","nested"===n.sort&&n.posts.length))},styles:["[_nghost-%COMP%]   .addon-forum-reply-button[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   addon-mod-forum-post[_ngcontent-%COMP%]{--addon-forum-border-color: 0px}"]}),AddonModForumDiscussionPage})();class AddonModForumDiscussionDiscussionsSwipeManager extends F.c{getSelectedItemPathFromRoute(o){const n=p.CoreNavigator.getRouteParams(o);return this.getSource().DISCUSSIONS_PATH_PREFIX+n.discussionId}}var Y=e(60177),V=e(69502),B=e(17388),U=e(64422),X=e(13988),q=e(4060),z=e(86198),H=e(58197),W=e(28988),Q=e(88246),J=e(88603),K=e(73955);const Z=[{path:"",component:L,canDeactivate:[i.V]}];let oo=(()=>{var o;class AddonModForumDiscussionLazyModule{}return(o=AddonModForumDiscussionLazyModule).ɵfac=function AddonModForumDiscussionLazyModule_Factory(n){return new(n||o)},o.ɵmod=G.$C({type:o}),o.ɵinj=G.G2t({imports:[t.iI.forChild(Z),r.n,s.Y]}),AddonModForumDiscussionLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&G.Obh(oo,{declarations:[L],imports:[t.iI,r.n,s.Y]})),G.wjB(L,(function(){return[Y.Sq,Y.bT,Y.T3,V.B,B.Q,U.R,X.c,q.f,z.t,H.B,W.n,Q.i,_.QW,_.b_,_.W9,_.eU,_.iq,_.uz,_.he,_.To,_.Ki,_.BC,_.ai,_.el,J.v]}),(function(){return[K.D9]}))},52266:(o,n,e)=>{e.d(n,{Z:()=>CoreSwipeNavigationItemsManager});var t=e(10467),s=e(15324),i=e(95990);class CoreSwipeNavigationItemsManager extends i.u{start(){var o=this;return(0,t.A)((function*(){o.updateSelectedItem()}))()}navigateToNextItem(){var o=this;return(0,t.A)((function*(){yield o.navigateToItemBy(1,"forward")}))()}navigateToPreviousItem(){var o=this;return(0,t.A)((function*(){yield o.navigateToItemBy(-1,"back")}))()}hasNextItem(){var o=this;return(0,t.A)((function*(){return!!(yield o.getItemBy(1))}))()}hasPreviousItem(){var o=this;return(0,t.A)((function*(){return!!(yield o.getItemBy(-1))}))()}getCurrentPageRoute(){return s.CoreNavigator.getCurrentRoute()}getSelectedItemPathFromRoute(o){const n=[];for(;o&&(n.push(...s.CoreNavigator.getRouteUrl(o)),o.firstChild);)o=o.firstChild;return n.map((o=>o.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(o,n){var e=this;return(0,t.A)((function*(){const t=yield e.getItemBy(o);t&&(yield e.navigateToItem(t,{animationDirection:n,replace:!0}))}))()}getItemBy(o){var n=this;return(0,t.A)((function*(){var e;const t=n.getSource().getItems(),s=null!==(e=n.selectedItem&&(null==t?void 0:t.indexOf(n.selectedItem)))&&void 0!==e?e:-1;if(-1===s||null===t)return null;const i=o>0?1:-1;let r=s,d=0;for(;d!==o;){if(r+=i,r<0)return null;if(r>=t.length)break;n.skipItemInSwipe(t[r])||(d+=i)}return d===o?t[r]:n.getSource().isCompleted()?null:(yield n.getSource().load(),n.getItemBy(o))}))()}skipItemInSwipe(o){return!1}}}}]);