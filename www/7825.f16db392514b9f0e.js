"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7825],{47825:(e,s,i)=>{i.r(s),i.d(s,{default:()=>ce});var n=i(94114),t=i(3353),o=i(21182),a=i(6007),d=i(93417),r=i(53836),u=i(10467),m=i(75629),l=i(64847),g=i(15324),c=i(52749),_=i(48966),p=i(89911),b=i(63153),f=i(79555),h=i(49882),I=i(5505),A=i(20218),v=i(4175),S=i(75217),M=i(43411),T=i(22693),C=i(66016),y=i(45433),R=i(23780),P=i(55554),x=i(54438),E=i(60177),G=i(6128),w=i(64422),k=i(34198),$=i(58197),D=i(88246),L=i(43570),N=i(89417),O=i(73465),F=i(58841),Y=i(73955);const j=["editSubmissionForm"],_c1=()=>[300,900];function AddonModAssignEditPage_ion_list_14_core_timer_1_Template(e,s){if(1&e){const e=x.RV6();x.j41(0,"core-timer",12),x.nI1(1,"translate"),x.bIt("finished",(function AddonModAssignEditPage_ion_list_14_core_timer_1_Template_core_timer_finished_0_listener(){x.eBV(e);const s=x.XpG(2);return x.Njj(s.timeUp())})),x.k0s()}if(2&e){const e=x.XpG(2);x.Y8G("endTime",e.timeLimitEndTime)("timerText",x.bMT(1,5,"addon.mod_assign.assigntimeleft"))("align","center")("timeLeftClassThreshold",-1)("underTimeClassThresholds",x.lJ4(7,_c1))}}function AddonModAssignEditPage_ion_list_14_ion_item_2_Template(e,s){if(1&e&&(x.j41(0,"ion-item",13)(1,"ion-label"),x.nrm(2,"core-format-text",14),x.k0s()()),2&e){const e=x.XpG(2);x.R7$(2),x.Y8G("text",e.activityInstructions)("component",e.component)("componentId",e.moduleId)("contextInstanceId",e.moduleId)("courseId",e.courseId)}}function AddonModAssignEditPage_ion_list_14_ng_container_3_core_file_1_Template(e,s){if(1&e&&x.nrm(0,"core-file",16),2&e){const e=s.$implicit,i=x.XpG(3);x.Y8G("file",e)("component",i.component)("componentId",i.moduleId)}}function AddonModAssignEditPage_ion_list_14_ng_container_3_Template(e,s){if(1&e&&(x.qex(0),x.DNE(1,AddonModAssignEditPage_ion_list_14_ng_container_3_core_file_1_Template,1,3,"core-file",15),x.bVm()),2&e){const e=x.XpG(2);x.R7$(),x.Y8G("ngForOf",e.introAttachments)}}function AddonModAssignEditPage_ion_list_14_ion_item_6_Template(e,s){if(1&e){const e=x.RV6();x.j41(0,"ion-item",13)(1,"ion-checkbox",17),x.mxI("ngModelChange",(function AddonModAssignEditPage_ion_list_14_ion_item_6_Template_ion_checkbox_ngModelChange_1_listener(s){x.eBV(e);const i=x.XpG(2);return x.DH7(i.submissionStatementAccepted,s)||(i.submissionStatementAccepted=s),x.Njj(s)})),x.nrm(2,"core-format-text",18),x.k0s(),x.nrm(3,"input",19),x.k0s()}if(2&e){const e=x.XpG(2);x.R7$(),x.R50("ngModel",e.submissionStatementAccepted),x.R7$(),x.Y8G("text",e.submissionStatement)("filter",!1),x.R7$(),x.Y8G("ngModel",e.submissionStatementAccepted)}}function AddonModAssignEditPage_ion_list_14_addon_mod_assign_submission_plugin_7_Template(e,s){if(1&e&&x.nrm(0,"addon-mod-assign-submission-plugin",20),2&e){const e=s.$implicit,i=x.XpG(2);x.Y8G("assign",i.assign)("submission",i.userSubmission)("plugin",e)("edit",!0)("allowOffline",i.allowOffline)}}function AddonModAssignEditPage_ion_list_14_Template(e,s){if(1&e&&(x.j41(0,"ion-list"),x.DNE(1,AddonModAssignEditPage_ion_list_14_core_timer_1_Template,2,8,"core-timer",8)(2,AddonModAssignEditPage_ion_list_14_ion_item_2_Template,3,5,"ion-item",9)(3,AddonModAssignEditPage_ion_list_14_ng_container_3_Template,2,1,"ng-container",7),x.j41(4,"form",10,0),x.DNE(6,AddonModAssignEditPage_ion_list_14_ion_item_6_Template,4,4,"ion-item",9)(7,AddonModAssignEditPage_ion_list_14_addon_mod_assign_submission_plugin_7_Template,1,5,"addon-mod-assign-submission-plugin",11),x.k0s()()),2&e){const e=x.XpG();x.R7$(),x.Y8G("ngIf",e.timeLimitEndTime>0),x.R7$(),x.Y8G("ngIf",e.activityInstructions),x.R7$(),x.Y8G("ngIf",null==e.assign?null:e.assign.submissionattachments),x.R7$(3),x.Y8G("ngIf",e.submissionStatement),x.R7$(),x.Y8G("ngForOf",e.userSubmission.plugins)}}let U=(()=>{var e;class AddonModAssignEditPage{constructor(e){this.route=e,this.allowOffline=!1,this.submissionStatementAccepted=!1,this.loaded=!1,this.timeLimitEndTime=0,this.component=C.AC,this.isBlind=!1,this.saveOffline=!1,this.hasOffline=!1,this.isDestroyed=!1,this.forceLeave=!1,this.userId=c.CoreSites.getCurrentSiteUserId(),this.editText=f.HT.instant("addon.mod_assign.editsubmission"),this.title=this.editText}ngOnInit(){try{this.moduleId=g.CoreNavigator.getRequiredRouteNumberParam("cmId"),this.courseId=g.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.isBlind=!!g.CoreNavigator.getRouteNumberParam("blindId")}catch(e){return p.CoreDomUtils.showErrorModal(e),g.CoreNavigator.back(),void 0}this.fetchAssignment().finally((()=>{this.loaded=!0}))}canLeave(){var e=this;return(0,u.A)((function*(){if(e.forceLeave)return!0;return(yield e.hasDataChanged())&&(yield p.CoreDomUtils.showConfirm(f.HT.instant("core.confirmcanceledit"))),A.AddonModAssignHelper.clearSubmissionPluginTmpData(e.assign,e.userSubmission,e.getInputData()),b.R.triggerFormCancelledEvent(e.formElement,c.CoreSites.getCurrentSiteId()),!0}))()}fetchAssignment(){var e=this;return(0,u.A)((function*(){const s=c.CoreSites.getCurrentSiteUserId();try{var i,n,t,o,a;e.assign=yield I.AddonModAssign.getAssignment(e.courseId,e.moduleId),e.title=e.assign.name||e.title,e.isDestroyed||_.CoreSync.blockOperation(C.AC,e.assign.id),yield S.AddonModAssignSync.waitForSync(e.assign.id);const r={userId:e.userId,isBlind:e.isBlind,cmId:e.assign.cmid,filter:!1,readingStrategy:2};let u;try{u=yield I.AddonModAssign.getSubmissionStatus(e.assign.id,r),e.userSubmission=I.AddonModAssign.getSubmissionObjectFromAttempt(e.assign,u.lastattempt)}catch(s){r.filter=!0,r.readingStrategy=1,u=yield I.AddonModAssign.getSubmissionStatus(e.assign.id,r),e.userSubmission=I.AddonModAssign.getSubmissionObjectFromAttempt(e.assign,u.lastattempt);if(!(yield A.AddonModAssignHelper.canEditSubmissionOffline(e.assign,e.userSubmission)))throw e.allowOffline=!1,s}if(null===(i=u.lastattempt)||void 0===i||!i.canedit)throw new m.CoreError(f.HT.instant("core.nopermissions",{$a:e.editText}));if(u=yield e.startSubmissionIfNeeded(u,r),null!==(n=u.assignmentdata)&&void 0!==n&&n.activity){var d;const s=r.filter?u:yield I.AddonModAssign.getSubmissionStatus(e.assign.id,{...r,filter:!0});e.activityInstructions=null===(d=s.assignmentdata)||void 0===d?void 0:d.activity}e.introAttachments=null!==(t=null===(o=u.assignmentdata)||void 0===o||null===(o=o.attachments)||void 0===o?void 0:o.intro)&&void 0!==t?t:e.assign.introattachments,e.allowOffline=!0,e.assign.submissionstatement||void 0===e.assign.submissionstatement||(e.assign.requiresubmissionstatement=0),e.submissionStatement=e.assign.requiresubmissionstatement&&!e.assign.submissiondrafts&&e.userId==s?e.assign.submissionstatement:void 0,e.timeLimitEndTime=e.assign.timelimit&&null!==(a=e.userSubmission)&&void 0!==a&&a.timestarted?A.AddonModAssignHelper.calculateEndTime(e.assign,e.userSubmission):0,e.hasOffline=yield P.g.promiseWorks(v.AddonModAssignOffline.getSubmission(e.assign.id,e.userId)),T.OF.logEvent({type:T.qr.VIEW_ITEM,ws:"mod_assign_save_submission",name:f.HT.instant("addon.mod_assign.subpagetitle",{contextname:e.assign.name,subpage:f.HT.instant("addon.mod_assign.editsubmission")}),data:{id:e.assign.id,category:"assign"},url:`/mod/assign/view.php?action=editsubmission&id=${e.moduleId}`})}catch(s){p.CoreDomUtils.showErrorModalDefault(s,"Error getting assigment data."),e.leaveWithoutCheck()}}))()}startSubmissionIfNeeded(e,s){var i=this;return(0,u.A)((function*(){if(!i.assign||!i.assign.timelimit)return e;if(i.userSubmission&&i.userSubmission.status!==I.AddonModAssignSubmissionStatusValues.NEW&&i.userSubmission.status!==I.AddonModAssignSubmissionStatusValues.REOPENED)return e;yield I.AddonModAssign.startSubmission(i.assign.id),h.z.trigger(C.dl,{assignmentId:i.assign.id},c.CoreSites.getCurrentSiteId());const n=yield I.AddonModAssign.getSubmissionStatus(i.assign.id,{...s,readingStrategy:2});return i.userSubmission=I.AddonModAssign.getSubmissionObjectFromAttempt(i.assign,n.lastattempt),n}))()}getInputData(){return b.R.getDataFromForm(document.forms["addon-mod_assign-edit-form"])}hasDataChanged(){var e=this;return(0,u.A)((function*(){const s=yield R.CoreLoadings.show(),i=e.getInputData();return A.AddonModAssignHelper.hasSubmissionDataChanged(e.assign,e.userSubmission,i).finally((()=>{s.dismiss()}))}))()}leaveWithoutCheck(){this.forceLeave=!0,g.CoreNavigator.back()}prepareSubmissionData(e){var s=this;return(0,u.A)((function*(){s.saveOffline=s.hasOffline;try{return yield A.AddonModAssignHelper.prepareSubmissionPluginData(s.assign,s.userSubmission,e,s.hasOffline)}catch(i){if(s.allowOffline&&!s.saveOffline&&!M.CoreWSError.isWebServiceError(i))return s.saveOffline=!0,A.AddonModAssignHelper.prepareSubmissionPluginData(s.assign,s.userSubmission,e,!0);throw i}}))()}save(){var e=this;return(0,u.A)((function*(){if(!(yield e.hasDataChanged()))return e.leaveWithoutCheck(),void 0;try{yield e.saveSubmission(),e.leaveWithoutCheck()}catch(e){p.CoreDomUtils.showErrorModalDefault(e,"Error saving submission.")}}))()}saveSubmission(){var e=this;return(0,u.A)((function*(){const s=e.getInputData();if(e.submissionStatement&&(!s.submissionstatement||"false"===s.submissionstatement))throw f.HT.instant("addon.mod_assign.acceptsubmissionstatement");if(A.AddonModAssignHelper.isSubmissionEmptyForEdit(e.assign,e.userSubmission,s))throw f.HT.instant("addon.mod_assign.submissionempty");let i=yield R.CoreLoadings.show(),n=-1;try{n=yield A.AddonModAssignHelper.getSubmissionSizeForEdit(e.assign,e.userSubmission,s)}catch(e){n=-1}i.dismiss();try{yield l.CoreFileUploaderHelper.confirmUploadFile(n,!0,e.allowOffline),i=yield R.CoreLoadings.show("core.sending",!0);const t=yield e.prepareSubmissionData(s);if(!Object.keys(t).length)return;let o;e.saveOffline?(o=!1,yield v.AddonModAssignOffline.saveSubmission(e.assign.id,e.courseId,t,e.userSubmission.timemodified,!e.assign.submissiondrafts,e.userId)):o=yield I.AddonModAssign.saveSubmission(e.assign.id,e.courseId,t,e.allowOffline,e.userSubmission.timemodified,!!e.assign.submissiondrafts,e.userId),A.AddonModAssignHelper.clearSubmissionPluginTmpData(e.assign,e.userSubmission,s),o&&h.z.trigger(h.z.ACTIVITY_DATA_SENT,{module:"assign"}),b.R.triggerFormSubmittedEvent(e.formElement,o,c.CoreSites.getCurrentSiteId()),h.z.trigger(C.Ad,{assignmentId:e.assign.id,submissionId:e.userSubmission.id,userId:e.userId},c.CoreSites.getCurrentSiteId()),e.assign.submissiondrafts||h.z.trigger(C._K,{assignmentId:e.assign.id,submissionId:e.userSubmission.id,userId:e.userId},c.CoreSites.getCurrentSiteId())}finally{i.dismiss()}}))()}timeUp(){var e=this;return(0,u.A)((function*(){e.timeUpToast=yield y.CoreToasts.show({message:f.HT.instant("addon.mod_assign.caneditsubmission"),duration:y.ToastDuration.STICKY,buttons:[f.HT.instant("core.dismiss")],cssClass:"core-danger-toast"})}))()}ngOnDestroy(){var e;this.isDestroyed=!0,null===(e=this.timeUpToast)||void 0===e||e.dismiss(),this.assign&&_.CoreSync.unblockOperation(C.AC,this.assign.id)}}return(e=AddonModAssignEditPage).ɵfac=function AddonModAssignEditPage_Factory(s){return new(s||e)(x.rXU(o.nX))},e.ɵcmp=x.VBU({type:e,selectors:[["page-addon-mod-assign-edit"]],viewQuery:function AddonModAssignEditPage_Query(e,s){if(1&e&&x.GBs(j,5),2&e){let e;x.mGM(e=x.lsd())&&(s.formElement=e.first)}},decls:15,vars:11,consts:[["editSubmissionForm",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["fill","clear",3,"click"],[3,"hideUntil"],[4,"ngIf"],["timeUpText","00:00:00",3,"endTime","timerText","align","timeLeftClassThreshold","underTimeClassThresholds","finished",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["name","addon-mod_assign-edit-form"],[3,"assign","submission","plugin","edit","allowOffline",4,"ngFor","ngForOf"],["timeUpText","00:00:00",3,"finished","endTime","timerText","align","timeLeftClassThreshold","underTimeClassThresholds"],[1,"ion-text-wrap"],["contextLevel","module",3,"text","component","componentId","contextInstanceId","courseId"],[3,"file","component","componentId",4,"ngFor","ngForOf"],[3,"file","component","componentId"],["name","submissionstatement",3,"ngModelChange","ngModel"],[3,"text","filter"],["type","hidden","name","submissionstatement",3,"ngModel"],[3,"assign","submission","plugin","edit","allowOffline"]],template:function AddonModAssignEditPage_Template(e,s){1&e&&(x.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),x.nrm(3,"ion-back-button",2),x.nI1(4,"translate"),x.k0s(),x.j41(5,"ion-title")(6,"h1"),x.nrm(7,"core-format-text",3),x.k0s()(),x.j41(8,"ion-buttons",4)(9,"ion-button",5),x.bIt("click",(function AddonModAssignEditPage_Template_ion_button_click_9_listener(){return s.save()})),x.EFF(10),x.nI1(11,"translate"),x.k0s()()()(),x.j41(12,"ion-content")(13,"core-loading",6),x.DNE(14,AddonModAssignEditPage_ion_list_14_Template,8,5,"ion-list",7),x.k0s()()),2&e&&(x.R7$(3),x.Y8G("text",x.bMT(4,7,"core.back")),x.R7$(4),x.Y8G("text",s.title)("contextInstanceId",s.moduleId)("courseId",s.courseId),x.R7$(3),x.SpI(" ",x.bMT(11,9,"core.save")," "),x.R7$(3),x.Y8G("hideUntil",s.loaded),x.R7$(),x.Y8G("ngIf",s.userSubmission&&s.userSubmission.plugins&&s.userSubmission.plugins.length))},dependencies:[E.Sq,E.bT,G.t,w.R,k.G,$.B,D.i,L.T,N.qT,N.me,N.BC,N.cb,N.vS,N.cV,O.Jm,O.QW,O.eY,O.W9,O.eU,O.uz,O.he,O.nf,O.BC,O.ai,O.hB,O.el,F.w,Y.D9],styles:["[_nghost-%COMP%]   core-timer.core-timer-under-300[_ngcontent-%COMP%]{--timer-background: var(--danger-tint);--timer-text-color: var(--danger-shade)}[_nghost-%COMP%]   core-timer.core-timer-under-900[_ngcontent-%COMP%]{--timer-background: var(--warning-tint);--timer-text-color: var(--warning-shade)}"]}),AddonModAssignEditPage})();var B=i(2138),V=i(78497),H=i(53794),X=i(68273);let W=(()=>{var e;class AddonModAssignIndexPage extends B._{constructor(){super(),this.action=g.CoreNavigator.getRouteParam("action")}ngAfterViewInit(){var e=this;return(0,u.A)((function*(){var s;if("editsubmission"===e.action)yield H.H.waitFor((()=>{var s;return!(null===(s=e.activityComponent)||void 0===s||!s.submissionComponent)}),{timeout:5e3}),yield null===(s=e.activityComponent)||void 0===s||null===(s=s.submissionComponent)||void 0===s?void 0:s.goToEdit()}))()}}return(e=AddonModAssignIndexPage).ɵfac=function AddonModAssignIndexPage_Factory(s){return new(s||e)},e.ɵcmp=x.VBU({type:e,selectors:[["page-addon-mod-assign-index"]],viewQuery:function AddonModAssignIndexPage_Query(e,s){if(1&e&&x.GBs(V.AddonModAssignIndexComponent,5),2&e){let e;x.mGM(e=x.lsd())&&(s.activityComponent=e.first)}},features:[x.Vt3],decls:14,vars:12,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"dataRetrieved","module","courseId"]],template:function AddonModAssignIndexPage_Template(e,s){1&e&&(x.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),x.nrm(3,"ion-back-button",2),x.nI1(4,"translate"),x.k0s(),x.j41(5,"ion-title")(6,"h1"),x.nrm(7,"core-format-text",3),x.k0s()(),x.nrm(8,"ion-buttons",4),x.k0s()(),x.j41(9,"ion-content",5)(10,"ion-refresher",6),x.bIt("ionRefresh",(function AddonModAssignIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==s.activityComponent?null:s.activityComponent.doRefresh(e.target)})),x.nrm(11,"ion-refresher-content",7),x.nI1(12,"translate"),x.k0s(),x.j41(13,"addon-mod-assign-index",8),x.bIt("dataRetrieved",(function AddonModAssignIndexPage_Template_addon_mod_assign_index_dataRetrieved_13_listener(e){return s.updateData(e)})),x.k0s()()),2&e&&(x.R7$(3),x.Y8G("text",x.bMT(4,8,"core.back")),x.R7$(4),x.Y8G("text",s.title)("contextInstanceId",s.module.id)("courseId",s.courseId),x.R7$(3),x.Y8G("disabled",null==s.activityComponent?null:s.activityComponent.showLoading),x.R7$(),x.FS9("pullingText",x.bMT(12,10,"core.pulltorefresh")),x.R7$(2),x.Y8G("module",s.module)("courseId",s.courseId))},dependencies:[$.B,X.M,D.i,O.QW,O.W9,O.eU,O.To,O.Ki,O.BC,O.ai,O.el,V.AddonModAssignIndexComponent,Y.D9],encapsulation:2}),AddonModAssignIndexPage})();var q=i(2401),z=i(83696),Q=i(29492),J=i(65045),K=i(16986),Z=i(97818),ee=i(16658);function AddonModAssignSubmissionListPage_ng_container_17_p_4_Template(e,s){if(1&e&&(x.j41(0,"p",14),x.EFF(1),x.k0s()),2&e){const e=x.XpG().$implicit;x.R7$(),x.JRh(e.userfullname)}}function AddonModAssignSubmissionListPage_ng_container_17_p_5_Template(e,s){if(1&e&&(x.j41(0,"p",14),x.EFF(1),x.nI1(2,"translate"),x.k0s()),2&e){const e=x.XpG().$implicit;x.R7$(),x.Lme(" ",x.bMT(2,2,"addon.mod_assign.hiddenuser"),"",e.blindid," ")}}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_1_Template(e,s){if(1&e&&(x.j41(0,"span",17),x.nrm(1,"core-format-text",18),x.k0s()),2&e){const e=x.XpG(2).$implicit,s=x.XpG();x.R7$(),x.Y8G("text",e.groupname)("contextInstanceId",s.courseId)}}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_2_Template(e,s){1&e&&(x.j41(0,"span",19),x.EFF(1),x.nI1(2,"translate"),x.k0s()),2&e&&(x.R7$(),x.SpI(" ",x.bMT(2,1,"addon.mod_assign.noteam")," "))}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_3_Template(e,s){1&e&&(x.j41(0,"span",19),x.EFF(1),x.nI1(2,"translate"),x.k0s()),2&e&&(x.R7$(),x.SpI(" ",x.bMT(2,1,"addon.mod_assign.multipleteams")," "))}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_4_Template(e,s){1&e&&(x.j41(0,"span"),x.EFF(1),x.nI1(2,"translate"),x.k0s()),2&e&&(x.R7$(),x.SpI(" ",x.bMT(2,1,"addon.mod_assign.defaultteam")," "))}function AddonModAssignSubmissionListPage_ng_container_17_p_6_Template(e,s){if(1&e&&(x.j41(0,"p"),x.DNE(1,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_1_Template,2,2,"span",15)(2,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_2_Template,3,3,"span",16)(3,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_3_Template,3,3,"span",16)(4,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_4_Template,3,3,"span",13),x.k0s()),2&e){const e=x.XpG().$implicit,s=x.XpG();x.R7$(),x.Y8G("ngIf",e.groupname),x.R7$(),x.Y8G("ngIf",s.assign.preventsubmissionnotingroup&&!e.groupname&&e.noGroups&&!e.blindid),x.R7$(),x.Y8G("ngIf",s.assign.preventsubmissionnotingroup&&!e.groupname&&e.manyGroups&&!e.blindid),x.R7$(),x.Y8G("ngIf",!s.assign.preventsubmissionnotingroup&&!e.groupname)}}function AddonModAssignSubmissionListPage_ng_container_17_p_7_Template(e,s){if(1&e&&(x.j41(0,"p")(1,"ion-badge",20),x.EFF(2),x.k0s()()),2&e){const e=x.XpG().$implicit;x.R7$(),x.Y8G("color",e.statusColor),x.R7$(),x.SpI(" ",e.statusTranslated," ")}}function AddonModAssignSubmissionListPage_ng_container_17_p_8_Template(e,s){if(1&e&&(x.j41(0,"p")(1,"ion-badge",20),x.EFF(2),x.nI1(3,"translate"),x.k0s()()),2&e){const e=x.XpG().$implicit;x.R7$(),x.Y8G("color",e.gradingColor),x.R7$(),x.SpI(" ",x.bMT(3,2,e.gradingStatusTranslationId)," ")}}function AddonModAssignSubmissionListPage_ng_container_17_Template(e,s){if(1&e){const e=x.RV6();x.qex(0),x.j41(1,"ion-item",10),x.bIt("click",(function AddonModAssignSubmissionListPage_ng_container_17_Template_ion_item_click_1_listener(){const s=x.eBV(e).$implicit,i=x.XpG();return x.Njj(i.submissions.select(s))})),x.nrm(2,"core-user-avatar",11),x.j41(3,"ion-label"),x.DNE(4,AddonModAssignSubmissionListPage_ng_container_17_p_4_Template,2,1,"p",12)(5,AddonModAssignSubmissionListPage_ng_container_17_p_5_Template,3,4,"p",12)(6,AddonModAssignSubmissionListPage_ng_container_17_p_6_Template,5,4,"p",13)(7,AddonModAssignSubmissionListPage_ng_container_17_p_7_Template,3,2,"p",13)(8,AddonModAssignSubmissionListPage_ng_container_17_p_8_Template,4,4,"p",13),x.k0s()(),x.bVm()}if(2&e){const e=s.$implicit,i=x.XpG();x.R7$(),x.Y8G("detail",!0),x.BMQ("aria-current",i.submissions.getItemAriaCurrent(e)),x.R7$(),x.Y8G("user",e)("linkProfile",!1),x.R7$(2),x.Y8G("ngIf",e.userfullname),x.R7$(),x.Y8G("ngIf",!e.userfullname),x.R7$(),x.Y8G("ngIf",i.assign&&i.assign.teamsubmission),x.R7$(),x.Y8G("ngIf",e.statusTranslated),x.R7$(),x.Y8G("ngIf",e.gradingStatusTranslationId)}}function AddonModAssignSubmissionListPage_core_empty_box_18_Template(e,s){1&e&&(x.nrm(0,"core-empty-box",21),x.nI1(1,"translate")),2&e&&x.Y8G("message",x.bMT(1,1,"addon.mod_assign.submissionstatus_"))}let se=(()=>{var e;class AddonModAssignSubmissionListPage{constructor(){this.title="",this.gradedObserver=h.z.on(C.$P,(e=>{var s;this.submissions.loaded&&this.submissions.getSource().assign&&e.assignmentId==(null===(s=this.submissions.getSource().assign)||void 0===s?void 0:s.id)&&e.userId==c.CoreSites.getCurrentSiteUserId()&&this.refreshAllData(!0)}),c.CoreSites.getCurrentSiteId());this.syncObserver=h.z.onMultiple([C.zi,C.Cu],(e=>{!this.submissions.loaded||"context"in e&&"submission-list"==e.context||this.refreshAllData(!1)}),c.CoreSites.getCurrentSiteId());try{const e=g.CoreNavigator.getRequiredRouteNumberParam("cmId"),s=g.CoreNavigator.getRequiredRouteNumberParam("courseId"),i=g.CoreNavigator.getRouteNumberParam("groupId")||0,n=g.CoreNavigator.getRouteParam("status"),t=z.u.getOrCreateSource(J.W,[s,e,n]);t.groupId=i,this.sourceUnsubscribe=t.addListener({onItemsUpdated:()=>{var e;this.title=(null===(e=this.submissions.getSource().assign)||void 0===e?void 0:e.name)||this.title}}),this.submissions=new q.R(t,AddonModAssignSubmissionListPage)}catch(e){return p.CoreDomUtils.showErrorModal(e),g.CoreNavigator.back(),void 0}}get assign(){return this.submissions.getSource().assign}get groupInfo(){return this.submissions.getSource().groupInfo}get moduleId(){return this.submissions.getSource().MODULE_ID}get courseId(){return this.submissions.getSource().COURSE_ID}get groupId(){return this.submissions.getSource().groupId}set groupId(e){this.submissions.getSource().groupId=e}ngAfterViewInit(){const e=this.submissions.getSource().SELECTED_STATUS;this.title=f.HT.instant(e?e===J.N.NEED_GRADING?"addon.mod_assign.numberofsubmissionsneedgrading":`addon.mod_assign.submissionstatus_${e}`:"addon.mod_assign.numberofparticipants"),this.fetchAssignment(!0).finally((()=>{this.submissions.start(this.splitView)}))}fetchAssignment(e=!1){var s=this;return(0,u.A)((function*(){try{if(yield s.submissions.getSource().loadAssignment(e),!s.assign)return;T.OF.logEvent({type:T.qr.VIEW_ITEM_LIST,ws:"mod_assign_get_submissions",name:f.HT.instant("addon.mod_assign.subpagetitle",{contextname:s.assign.name,subpage:f.HT.instant("addon.mod_assign.grading")}),data:{assignid:s.assign.id,category:"assign"},url:`/mod/assign/view.php?id=${s.assign.cmid}&action=grading`})}catch(e){p.CoreDomUtils.showErrorModalDefault(e,"Error getting assigment data.")}}))()}refreshAllData(e){var s=this;return(0,u.A)((function*(){try{yield s.submissions.getSource().invalidateCache()}finally{s.fetchAssignment(e)}}))()}refreshList(e){this.refreshAllData(!0).finally((()=>{null==e||e.complete()}))}reloadSubmissions(){var e=this;return(0,u.A)((function*(){yield e.submissions.reload()}))()}ngOnDestroy(){var e,s;null===(e=this.gradedObserver)||void 0===e||e.off(),null===(s=this.syncObserver)||void 0===s||s.off(),this.submissions.destroy(),this.sourceUnsubscribe&&this.sourceUnsubscribe()}}return(e=AddonModAssignSubmissionListPage).ɵfac=function AddonModAssignSubmissionListPage_Factory(s){return new(s||e)},e.ɵcmp=x.VBU({type:e,selectors:[["page-addon-mod-assign-submission-list"]],viewQuery:function AddonModAssignSubmissionListPage_Query(e,s){if(1&e&&x.GBs(Q.M,5),2&e){let e;x.mGM(e=x.lsd())&&(s.splitView=e.first)}},decls:19,vars:16,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[3,"selectedChange","groupInfo","selected","courseId"],[4,"ngFor","ngForOf"],["icon","fas-file-signature",3,"message",4,"ngIf"],["button","",1,"ion-text-wrap",3,"click","detail"],["slot","start",3,"user","linkProfile"],["class","item-heading",4,"ngIf"],[4,"ngIf"],[1,"item-heading"],["class","core-groupname",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"core-groupname"],["contextLevel","course",3,"text","contextInstanceId"],[1,"text-danger"],[1,"ion-text-start","ion-text-wrap",3,"color"],["icon","fas-file-signature",3,"message"]],template:function AddonModAssignSubmissionListPage_Template(e,s){1&e&&(x.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),x.nrm(3,"ion-back-button",1),x.nI1(4,"translate"),x.k0s(),x.j41(5,"ion-title")(6,"h1"),x.nrm(7,"core-format-text",2),x.k0s()(),x.nrm(8,"ion-buttons",3),x.k0s()(),x.j41(9,"ion-content")(10,"core-split-view")(11,"ion-refresher",4),x.bIt("ionRefresh",(function AddonModAssignSubmissionListPage_Template_ion_refresher_ionRefresh_11_listener(e){return s.refreshList(e.target)})),x.nrm(12,"ion-refresher-content",5),x.nI1(13,"translate"),x.k0s(),x.j41(14,"core-loading",6)(15,"ion-list")(16,"core-group-selector",7),x.mxI("selectedChange",(function AddonModAssignSubmissionListPage_Template_core_group_selector_selectedChange_16_listener(e){return x.DH7(s.groupId,e)||(s.groupId=e),e})),x.bIt("selectedChange",(function AddonModAssignSubmissionListPage_Template_core_group_selector_selectedChange_16_listener(){return s.reloadSubmissions()})),x.k0s(),x.DNE(17,AddonModAssignSubmissionListPage_ng_container_17_Template,9,9,"ng-container",8),x.k0s(),x.DNE(18,AddonModAssignSubmissionListPage_core_empty_box_18_Template,2,3,"core-empty-box",9),x.k0s()()()),2&e&&(x.R7$(3),x.Y8G("text",x.bMT(4,12,"core.back")),x.R7$(4),x.Y8G("text",s.title)("contextInstanceId",s.moduleId)("courseId",s.courseId),x.R7$(4),x.Y8G("disabled",!s.submissions.loaded),x.R7$(),x.FS9("pullingText",x.bMT(13,14,"core.pulltorefresh")),x.R7$(2),x.Y8G("hideUntil",s.submissions.loaded),x.R7$(2),x.Y8G("groupInfo",s.groupInfo),x.R50("selected",s.groupId),x.Y8G("courseId",s.courseId),x.R7$(),x.Y8G("ngForOf",s.submissions.items),x.R7$(),x.Y8G("ngIf",!s.submissions||s.submissions.empty))},dependencies:[E.Sq,E.bT,K.h,Z.F,w.R,Q.M,ee.T,$.B,D.i,O.In,O.QW,O.W9,O.eU,O.uz,O.he,O.nf,O.To,O.Ki,O.BC,O.ai,O.el,Y.D9],encapsulation:2}),AddonModAssignSubmissionListPage})();var ie=i(52266),ne=i(44682),te=i(81679),oe=i(24742),ae=i(13988),de=i(28988);function AddonModAssignSubmissionReviewPage_addon_mod_assign_submission_18_Template(e,s){if(1&e&&x.nrm(0,"addon-mod-assign-submission",10),2&e){const e=x.XpG();x.Y8G("courseId",e.courseId)("moduleId",e.moduleId)("submitId",e.submitId)("blindId",e.blindId)}}let re=(()=>{var e;class AddonModAssignSubmissionReviewPage{constructor(e){this.route=e,this.title="",this.loaded=!1,this.canSaveGrades=!1,this.blindMarking=!1,this.forceLeave=!1,this.logView=oe.j.once((()=>{if(!this.assign)return;const e=this.blindMarking?this.blindId:this.submitId,s=this.blindMarking?"blindid":"userid";T.OF.logEvent({type:T.qr.VIEW_ITEM,ws:"mod_assign_get_submission_status",name:f.HT.instant("addon.mod_assign.subpagetitle",{contextname:this.assign.name,subpage:f.HT.instant("addon.mod_assign.grading")}),data:{id:e,assignid:this.assign.id,category:"assign"},url:`/mod/assign/view.php?id=${this.assign.cmid}&action=grader&${s}=${e}`})}))}ngOnInit(){this.route.queryParams.subscribe((e=>{try{var s;this.moduleId=g.CoreNavigator.getRequiredRouteNumberParam("cmId"),this.courseId=g.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.submitId=g.CoreNavigator.getRouteNumberParam("submitId")||0,this.blindId=g.CoreNavigator.getRouteNumberParam("blindId",{params:e});const i=g.CoreNavigator.getRequiredRouteNumberParam("groupId"),n=g.CoreNavigator.getRouteParam("selectedStatus"),t=z.u.getOrCreateSource(J.W,[this.courseId,this.moduleId,n]);null===(s=this.submissions)||void 0===s||s.destroy(),t.groupId=i,this.submissions=new AddonModAssignSubmissionSwipeItemsManager(t),this.submissions.start()}catch(e){return p.CoreDomUtils.showErrorModal(e),g.CoreNavigator.back(),void 0}this.fetchSubmission().finally((()=>{this.logView(),this.loaded=!0}))}))}ngOnDestroy(){var e;null===(e=this.submissions)||void 0===e||e.destroy()}canLeave(){var e=this;return(0,u.A)((function*(){return!(e.submissionComponent&&!e.forceLeave)||e.submissionComponent.canLeave()}))()}ionViewDidEnter(){var e;null===(e=this.submissionComponent)||void 0===e||e.ionViewDidEnter()}ionViewDidLeave(){var e;null===(e=this.submissionComponent)||void 0===e||e.ionViewDidLeave()}fetchSubmission(){var e=this;return(0,u.A)((function*(){e.assign=yield I.AddonModAssign.getAssignment(e.courseId,e.moduleId),e.title=e.assign.name,e.blindMarking=!!e.assign.blindmarking&&!e.assign.revealidentities;const s=yield ne.CoreCourse.getModuleBasicGradeInfo(e.moduleId);if(s)if(s.advancedgrading&&s.advancedgrading[0]&&void 0!==s.advancedgrading[0].method){e.canSaveGrades="simple"==(s.advancedgrading[0].method||"simple")}else e.canSaveGrades=!0}))()}refreshAllData(){var e=this;return(0,u.A)((function*(){const s=[];s.push(I.AddonModAssign.invalidateAssignmentData(e.courseId)),e.assign&&(s.push(I.AddonModAssign.invalidateSubmissionData(e.assign.id)),s.push(I.AddonModAssign.invalidateAssignmentUserMappingsData(e.assign.id)),s.push(I.AddonModAssign.invalidateSubmissionStatusData(e.assign.id,e.submitId,void 0,e.blindMarking)));try{yield Promise.all(s)}finally{e.submissionComponent&&e.submissionComponent.invalidateAndRefresh(!0),yield e.fetchSubmission()}}))()}refreshSubmission(e){this.refreshAllData().finally((()=>{null==e||e.complete()}))}submitGrade(){var e=this;return(0,u.A)((function*(){if(e.submissionComponent)try{yield e.submissionComponent.submitGrade(),d.CoreScreen.isTablet||(e.forceLeave=!0,g.CoreNavigator.back())}catch(e){p.CoreDomUtils.showErrorModalDefault(e,"core.error",!0)}}))()}}return(e=AddonModAssignSubmissionReviewPage).ɵfac=function AddonModAssignSubmissionReviewPage_Factory(s){return new(s||e)(x.rXU(o.nX))},e.ɵcmp=x.VBU({type:e,selectors:[["page-addon-mod-assign-submission-review"]],viewQuery:function AddonModAssignSubmissionReviewPage_Query(e,s){if(1&e&&x.GBs(te.B,5),2&e){let e;x.mGM(e=x.lsd())&&(s.submissionComponent=e.first)}},decls:19,vars:18,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["fill","clear",3,"click"],[3,"core-swipe-navigation"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[3,"courseId","moduleId","submitId","blindId",4,"ngIf"],[3,"courseId","moduleId","submitId","blindId"]],template:function AddonModAssignSubmissionReviewPage_Template(e,s){1&e&&(x.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),x.nrm(3,"ion-back-button",1),x.nI1(4,"translate"),x.k0s(),x.j41(5,"ion-title")(6,"h1"),x.nrm(7,"core-format-text",2),x.k0s()(),x.nrm(8,"ion-buttons",3),x.k0s(),x.j41(9,"core-navbar-buttons",3)(10,"ion-button",4),x.bIt("click",(function AddonModAssignSubmissionReviewPage_Template_ion_button_click_10_listener(){return s.submitGrade()})),x.EFF(11),x.nI1(12,"translate"),x.k0s()()(),x.j41(13,"ion-content",5)(14,"ion-refresher",6),x.bIt("ionRefresh",(function AddonModAssignSubmissionReviewPage_Template_ion_refresher_ionRefresh_14_listener(e){return s.refreshSubmission(e.target)})),x.nrm(15,"ion-refresher-content",7),x.nI1(16,"translate"),x.k0s(),x.j41(17,"core-loading",8),x.DNE(18,AddonModAssignSubmissionReviewPage_addon_mod_assign_submission_18_Template,1,4,"addon-mod-assign-submission",9),x.k0s()()),2&e&&(x.R7$(3),x.Y8G("text",x.bMT(4,12,"core.back")),x.R7$(4),x.Y8G("text",s.title)("contextInstanceId",s.moduleId)("courseId",s.courseId),x.R7$(3),x.AVh("hidden",!s.canSaveGrades),x.R7$(),x.SpI(" ",x.bMT(12,14,"core.done")," "),x.R7$(2),x.Y8G("core-swipe-navigation",s.submissions),x.R7$(),x.Y8G("disabled",!s.loaded),x.R7$(),x.FS9("pullingText",x.bMT(16,16,"core.pulltorefresh")),x.R7$(2),x.Y8G("hideUntil",s.loaded),x.R7$(),x.Y8G("ngIf",s.loaded))},dependencies:[E.bT,w.R,ae.c,$.B,de.n,D.i,L.T,O.Jm,O.QW,O.W9,O.eU,O.To,O.Ki,O.BC,O.ai,O.el,te.B,Y.D9],encapsulation:2}),AddonModAssignSubmissionReviewPage})();class AddonModAssignSubmissionSwipeItemsManager extends ie.Z{getSelectedItemPathFromRoute(e){return g.CoreNavigator.getRouteParams(e).submitId}}const ue=[{path:":courseId/:cmId",component:W},{path:":courseId/:cmId/edit",component:U,canDeactivate:[a.V]}],me=[...ue,{path:":courseId/:cmId/submission",component:se},{path:":courseId/:cmId/submission/:submitId",component:re,canDeactivate:[a.V]}],le=[...ue,{path:":courseId/:cmId/submission",component:se,children:[{path:":submitId",component:re,canDeactivate:[a.V]}]}],ge=[...(0,n.VI)(me,(()=>d.CoreScreen.isMobile)),...(0,n.VI)(le,(()=>d.CoreScreen.isTablet))];let ce=(()=>{var e;class AddonModAssignLazyModule{}return(e=AddonModAssignLazyModule).ɵfac=function AddonModAssignLazyModule_Factory(s){return new(s||e)},e.ɵmod=x.$C({type:e}),e.ɵinj=x.G2t({imports:[o.iI.forChild(ge),t.n,r.AddonModAssignComponentsModule]}),AddonModAssignLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&x.Obh(ce,{declarations:[W,se,re,U],imports:[o.iI,t.n,r.AddonModAssignComponentsModule]}))},52266:(e,s,i)=>{i.d(s,{Z:()=>CoreSwipeNavigationItemsManager});var n=i(10467),t=i(15324),o=i(95990);class CoreSwipeNavigationItemsManager extends o.u{start(){var e=this;return(0,n.A)((function*(){e.updateSelectedItem()}))()}navigateToNextItem(){var e=this;return(0,n.A)((function*(){yield e.navigateToItemBy(1,"forward")}))()}navigateToPreviousItem(){var e=this;return(0,n.A)((function*(){yield e.navigateToItemBy(-1,"back")}))()}hasNextItem(){var e=this;return(0,n.A)((function*(){return!!(yield e.getItemBy(1))}))()}hasPreviousItem(){var e=this;return(0,n.A)((function*(){return!!(yield e.getItemBy(-1))}))()}getCurrentPageRoute(){return t.CoreNavigator.getCurrentRoute()}getSelectedItemPathFromRoute(e){const s=[];for(;e&&(s.push(...t.CoreNavigator.getRouteUrl(e)),e.firstChild);)e=e.firstChild;return s.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(e,s){var i=this;return(0,n.A)((function*(){const n=yield i.getItemBy(e);n&&(yield i.navigateToItem(n,{animationDirection:s,replace:!0}))}))()}getItemBy(e){var s=this;return(0,n.A)((function*(){var i;const n=s.getSource().getItems(),t=null!==(i=s.selectedItem&&(null==n?void 0:n.indexOf(s.selectedItem)))&&void 0!==i?i:-1;if(-1===t||null===n)return null;const o=e>0?1:-1;let a=t,d=0;for(;d!==e;){if(a+=o,a<0)return null;if(a>=n.length)break;s.skipItemInSwipe(n[a])||(d+=o)}return d===e?n[a]:s.getSource().isCompleted()?null:(yield s.getSource().load(),s.getItemBy(e))}))()}skipItemInSwipe(e){return!1}}}}]);