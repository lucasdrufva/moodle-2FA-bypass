"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8355],{88355:(e,o,s)=>{s.r(o),s.d(o,{default:()=>N});var r=s(3353),t=s(54438),n=s(21182),a=s(42814),i=s(10467),l=s(52749),c=s(89911),d=s(81690),u=s(66110),g=s(79555),_=s(15324),C=s(49882),h=s(22693),m=s(24742),p=s(9538),f=s(60177),b=s(69502),E=s(17388),y=s(16986),w=s(64422),I=s(86198),T=s(58197),R=s(35407),x=s(88246),D=s(73465),P=s(16449),M=s(73955);const _c0=e=>({$a:e});function CoreCoursesCategoriesPage_core_context_menu_item_10_Template(e,o){if(1&e){const e=t.RV6();t.j41(0,"core-context-menu-item",5),t.nI1(1,"translate"),t.bIt("action",(function CoreCoursesCategoriesPage_core_context_menu_item_10_Template_core_context_menu_item_action_0_listener(){t.eBV(e);const o=t.XpG();return t.Njj(o.toggleDownload())})),t.mxI("toggleChange",(function CoreCoursesCategoriesPage_core_context_menu_item_10_Template_core_context_menu_item_toggleChange_0_listener(o){t.eBV(e);const s=t.XpG();return t.DH7(s.downloadEnabled,o)||(s.downloadEnabled=o),t.Njj(o)})),t.k0s()}if(2&e){const e=t.XpG();t.Y8G("priority",1e3)("content",t.bMT(1,3,"core.settings.showdownloadoptions")),t.R50("toggle",e.downloadEnabled)}}function CoreCoursesCategoriesPage_ion_item_19_p_6_Template(e,o){if(1&e&&(t.j41(0,"p"),t.nrm(1,"core-format-text",16),t.k0s()),2&e){const e=t.XpG(2);t.R7$(),t.Y8G("text",e.currentCategory.description)("contextInstanceId",e.currentCategory.id)}}function CoreCoursesCategoriesPage_ion_item_19_Template(e,o){if(1&e&&(t.j41(0,"ion-item",13),t.nrm(1,"ion-icon",14),t.nI1(2,"translate"),t.j41(3,"ion-label")(4,"p",15),t.nrm(5,"core-format-text",2),t.k0s(),t.DNE(6,CoreCoursesCategoriesPage_ion_item_19_p_6_Template,2,2,"p",11),t.k0s()()),2&e){const e=t.XpG();t.R7$(),t.BMQ("aria-label",t.bMT(2,4,"core.category")),t.R7$(4),t.Y8G("text",e.currentCategory.name)("contextInstanceId",e.currentCategory.id),t.R7$(),t.Y8G("ngIf",e.currentCategory.description)}}function CoreCoursesCategoriesPage_ng_container_20_ion_card_6_ion_badge_7_Template(e,o){if(1&e&&(t.j41(0,"ion-badge",21)(1,"span",22),t.EFF(2),t.k0s(),t.j41(3,"span",23),t.EFF(4),t.nI1(5,"translate"),t.k0s()()),2&e){const e=t.XpG().$implicit;t.R7$(2),t.JRh(e.coursecount),t.R7$(2),t.JRh(t.i5U(5,2,"core.courses.therearecourses",t.eq3(5,_c0,e.coursecount)))}}function CoreCoursesCategoriesPage_ng_container_20_ion_card_6_Template(e,o){if(1&e){const e=t.RV6();t.j41(0,"ion-card")(1,"ion-item",19),t.bIt("click",(function CoreCoursesCategoriesPage_ng_container_20_ion_card_6_Template_ion_item_click_1_listener(){const o=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.openCategory(o.id))})),t.nrm(2,"ion-icon",14),t.nI1(3,"translate"),t.j41(4,"ion-label")(5,"p",15),t.nrm(6,"core-format-text",2),t.k0s()(),t.DNE(7,CoreCoursesCategoriesPage_ng_container_20_ion_card_6_ion_badge_7_Template,6,7,"ion-badge",20),t.k0s()()}if(2&e){const e=o.$implicit,s=t.XpG(2);t.R7$(),t.Y8G("detail",!0),t.BMQ("aria-label",e.name),t.R7$(),t.BMQ("aria-label",t.bMT(3,6,"core.category")),t.R7$(4),t.Y8G("text",e.name)("contextInstanceId",e.id),t.R7$(),t.Y8G("ngIf",!s.showOnlyEnrolled&&e.coursecount>0)}}function CoreCoursesCategoriesPage_ng_container_20_Template(e,o){if(1&e&&(t.qex(0),t.j41(1,"ion-item-divider")(2,"ion-label")(3,"h2",17),t.EFF(4),t.nI1(5,"translate"),t.k0s()()(),t.DNE(6,CoreCoursesCategoriesPage_ng_container_20_ion_card_6_Template,8,8,"ion-card",18),t.bVm()),2&e){const e=t.XpG();t.R7$(4),t.JRh(t.bMT(5,2,"core.courses.categories")),t.R7$(2),t.Y8G("ngForOf",e.categories)}}function CoreCoursesCategoriesPage_ng_container_21_h2_3_Template(e,o){1&e&&(t.j41(0,"h2",17),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&e&&(t.R7$(),t.JRh(t.bMT(2,1,"core.courses.courses")))}function CoreCoursesCategoriesPage_ng_container_21_h2_4_Template(e,o){1&e&&(t.j41(0,"h2",17),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&e&&(t.R7$(),t.JRh(t.bMT(2,1,"core.courses.mycourses")))}function CoreCoursesCategoriesPage_ng_container_21_core_courses_course_list_item_5_Template(e,o){if(1&e&&t.nrm(0,"core-courses-course-list-item",26),2&e){const e=o.$implicit,s=t.XpG(2);t.Y8G("course",e)("showDownload",s.downloadEnabled)}}function CoreCoursesCategoriesPage_ng_container_21_Template(e,o){if(1&e&&(t.qex(0),t.j41(1,"ion-item-divider")(2,"ion-label"),t.DNE(3,CoreCoursesCategoriesPage_ng_container_21_h2_3_Template,3,3,"h2",24)(4,CoreCoursesCategoriesPage_ng_container_21_h2_4_Template,3,3,"h2",24),t.k0s()(),t.DNE(5,CoreCoursesCategoriesPage_ng_container_21_core_courses_course_list_item_5_Template,1,2,"core-courses-course-list-item",25),t.bVm()),2&e){const e=t.XpG();t.R7$(3),t.Y8G("ngIf",!e.showOnlyEnrolled),t.R7$(),t.Y8G("ngIf",e.showOnlyEnrolled),t.R7$(),t.Y8G("ngForOf",e.courses)}}function CoreCoursesCategoriesPage_core_empty_box_22_Template(e,o){1&e&&(t.nrm(0,"core-empty-box",27),t.nI1(1,"translate")),2&e&&t.Y8G("message",t.bMT(1,1,"core.courses.nocoursesyet"))}let O=(()=>{var e;class CoreCoursesCategoriesPage{constructor(){this.categories=[],this.courses=[],this.categoriesLoaded=!1,this.showOnlyEnrolled=!1,this.downloadEnabled=!1,this.downloadCourseEnabled=!1,this.downloadCoursesEnabled=!1,this.categoryCourses=[],this.categoryId=0,this.isDestroyed=!1,this.title=g.HT.instant("core.courses.categories"),this.currentSiteId=l.CoreSites.getRequiredCurrentSite().getId(),this.myCoursesObserver=C.z.on(p.CORE_COURSES_MY_COURSES_UPDATED_EVENT,(e=>{e.action===p.CoreCoursesMyCoursesUpdatedEventAction.ENROL&&this.fetchCategories()}),this.currentSiteId),this.siteUpdatedObserver=C.z.on(C.z.SITE_UPDATED,(()=>{this.downloadCourseEnabled=!u.CoreCourses.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!u.CoreCourses.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&this.downloadEnabled}),this.currentSiteId),this.downloadEnabledObserver=C.z.on(p.CORE_COURSES_DASHBOARD_DOWNLOAD_ENABLED_CHANGED_EVENT,(e=>{this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&e.enabled})),this.logView=m.j.once((()=>{h.OF.logEvent({type:h.qr.VIEW_ITEM_LIST,ws:"core_course_get_categories",name:this.title,data:{categoryid:this.categoryId,category:"course"},url:"/course/index.php"+(this.categoryId>0?`?categoryid=${this.categoryId}`:"")})}))}ngOnInit(){this.categoryId=_.CoreNavigator.getRouteNumberParam("id")||0,this.showOnlyEnrolled=_.CoreNavigator.getRouteBooleanParam("enrolled")||this.showOnlyEnrolled,this.downloadCourseEnabled=!u.CoreCourses.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!u.CoreCourses.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&u.CoreCourses.getCourseDownloadOptionsEnabled(),this.fetchCategories().finally((()=>{this.categoriesLoaded=!0}))}fetchCategories(){var e=this;return(0,i.A)((function*(){try{const o=yield u.CoreCourses.getCategories(e.categoryId,!0);e.currentCategory=void 0;const s=o.findIndex((o=>o.id==e.categoryId));if(s>=0&&(e.currentCategory=o[s],delete o[s]),o.sort(((e,o)=>e.depth==o.depth?e.sortorder>o.sortorder?1:o.sortorder>e.sortorder?-1:0:e.depth>o.depth?1:-1)),e.categories=d.j.formatTree(o,"parent","id",e.categoryId),e.currentCategory){e.title=e.currentCategory.name;try{e.categoryCourses=yield u.CoreCourses.getCoursesByField("category",e.categoryId),yield e.filterEnrolled()}catch(o){!e.isDestroyed&&c.CoreDomUtils.showErrorModalDefault(o,"core.courses.errorloadcourses",!0)}}e.logView()}catch(o){!e.isDestroyed&&c.CoreDomUtils.showErrorModalDefault(o,"core.courses.errorloadcategories",!0)}}))()}refreshCategories(e){const o=[];o.push(u.CoreCourses.invalidateUserCourses()),o.push(u.CoreCourses.invalidateCategories(this.categoryId,!0)),o.push(u.CoreCourses.invalidateCoursesByField("category",this.categoryId)),o.push(l.CoreSites.getRequiredCurrentSite().invalidateConfig()),Promise.all(o).finally((()=>{this.fetchCategories().finally((()=>{null==e||e.complete()}))}))}openCategory(e){_.CoreNavigator.navigateToSitePath("courses/categories/"+e,{params:{enrolled:this.showOnlyEnrolled}})}filterEnrolled(){var e=this;return(0,i.A)((function*(){e.showOnlyEnrolled?(yield Promise.all(e.categoryCourses.map(function(){var e=(0,i.A)((function*(e){if(!(void 0!==e.progress))try{const o=yield u.CoreCourses.getUserCourse(e.id);e.progress=o.progress,e.completionusertracked=o.completionusertracked}catch{}}));return function(o){return e.apply(this,arguments)}}())),e.courses=e.categoryCourses.filter((e=>"progress"in e))):e.courses=e.categoryCourses}))()}toggleDownload(){u.CoreCourses.setCourseDownloadOptionsEnabled(this.downloadEnabled)}ngOnDestroy(){this.myCoursesObserver.off(),this.siteUpdatedObserver.off(),this.downloadEnabledObserver.off(),this.isDestroyed=!0}}return(e=CoreCoursesCategoriesPage).ɵfac=function CoreCoursesCategoriesPage_Factory(o){return new(o||e)},e.ɵcmp=t.VBU({type:e,selectors:[["page-core-courses-categories"]],decls:23,vars:20,consts:[["slot","start"],[3,"text"],["contextLevel","coursecat",3,"text","contextInstanceId"],["slot","end"],["iconAction","toggle",3,"priority","content","toggle","action","toggleChange",4,"ngIf"],["iconAction","toggle",3,"action","toggleChange","priority","content","toggle"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[1,"list-item-limited-width"],["class","ion-text-wrap",4,"ngIf"],[4,"ngIf"],["icon","fas-graduation-cap",3,"message",4,"ngIf"],[1,"ion-text-wrap"],["name","fas-folder","slot","start"],[1,"item-heading"],["collapsible-item","","contextLevel","coursecat",3,"text","contextInstanceId"],[1,"big"],[4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap",3,"click","detail"],["slot","end","color","light",4,"ngIf"],["slot","end","color","light"],["aria-hidden","true"],[1,"sr-only"],["class","big",4,"ngIf"],[3,"course","showDownload",4,"ngFor","ngForOf"],[3,"course","showDownload"],["icon","fas-graduation-cap",3,"message"]],template:function CoreCoursesCategoriesPage_Template(e,o){1&e&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t.nrm(3,"ion-back-button",1),t.nI1(4,"translate"),t.k0s(),t.j41(5,"ion-title")(6,"h1"),t.nrm(7,"core-format-text",2),t.k0s()(),t.j41(8,"ion-buttons",3)(9,"core-context-menu"),t.DNE(10,CoreCoursesCategoriesPage_core_context_menu_item_10_Template,2,5,"core-context-menu-item",4),t.j41(11,"core-context-menu-item",5),t.nI1(12,"translate"),t.bIt("action",(function CoreCoursesCategoriesPage_Template_core_context_menu_item_action_11_listener(){return o.filterEnrolled()})),t.mxI("toggleChange",(function CoreCoursesCategoriesPage_Template_core_context_menu_item_toggleChange_11_listener(e){return t.DH7(o.showOnlyEnrolled,e)||(o.showOnlyEnrolled=e),e})),t.k0s()()()()(),t.j41(13,"ion-content")(14,"ion-refresher",6),t.bIt("ionRefresh",(function CoreCoursesCategoriesPage_Template_ion_refresher_ionRefresh_14_listener(e){return o.refreshCategories(e.target)})),t.nrm(15,"ion-refresher-content",7),t.nI1(16,"translate"),t.k0s(),t.j41(17,"core-loading",8)(18,"ion-list",9),t.DNE(19,CoreCoursesCategoriesPage_ion_item_19_Template,7,6,"ion-item",10)(20,CoreCoursesCategoriesPage_ng_container_20_Template,7,4,"ng-container",11)(21,CoreCoursesCategoriesPage_ng_container_21_Template,6,3,"ng-container",11),t.k0s(),t.DNE(22,CoreCoursesCategoriesPage_core_empty_box_22_Template,2,3,"core-empty-box",12),t.k0s()()),2&e&&(t.R7$(3),t.Y8G("text",t.bMT(4,14,"core.back")),t.R7$(4),t.Y8G("text",o.title)("contextInstanceId",o.currentCategory&&o.currentCategory.id),t.R7$(3),t.Y8G("ngIf",o.downloadCourseEnabled||o.downloadCoursesEnabled),t.R7$(),t.Y8G("priority",900)("content",t.bMT(12,16,"core.courses.showonlyenrolled")),t.R50("toggle",o.showOnlyEnrolled),t.R7$(3),t.Y8G("disabled",!o.categoriesLoaded),t.R7$(),t.FS9("pullingText",t.bMT(16,18,"core.pulltorefresh")),t.R7$(2),t.Y8G("hideUntil",o.categoriesLoaded),t.R7$(2),t.Y8G("ngIf",o.currentCategory),t.R7$(),t.Y8G("ngIf",o.categories.length>0),t.R7$(),t.Y8G("ngIf",o.courses.length>0),t.R7$(),t.Y8G("ngIf",!o.categories.length&&!o.courses.length))},dependencies:[f.Sq,f.bT,b.B,E.Q,y.h,w.R,I.t,T.B,R.K,x.i,D.In,D.QW,D.b_,D.W9,D.eU,D.iq,D.uz,D.Dg,D.he,D.nf,D.To,D.Ki,D.BC,D.ai,D.el,P.F,M.D9],encapsulation:2}),CoreCoursesCategoriesPage})();var G=s(83219),S=s(66198),v=s(19547),L=s(75357);const list_c0=e=>({$a:e});function CoreCoursesListPage_h1_6_Template(e,o){1&e&&(t.j41(0,"h1"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&e&&(t.R7$(),t.JRh(t.bMT(2,1,"core.courses.availablecourses")))}function CoreCoursesListPage_h1_7_Template(e,o){1&e&&(t.j41(0,"h1"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&e&&(t.R7$(),t.JRh(t.bMT(2,1,"core.courses.mycourses")))}function CoreCoursesListPage_core_context_menu_item_10_Template(e,o){if(1&e){const e=t.RV6();t.j41(0,"core-context-menu-item",5),t.nI1(1,"translate"),t.bIt("action",(function CoreCoursesListPage_core_context_menu_item_10_Template_core_context_menu_item_action_0_listener(){t.eBV(e);const o=t.XpG();return t.Njj(o.toggleDownload())})),t.mxI("toggleChange",(function CoreCoursesListPage_core_context_menu_item_10_Template_core_context_menu_item_toggleChange_0_listener(o){t.eBV(e);const s=t.XpG();return t.DH7(s.downloadEnabled,o)||(s.downloadEnabled=o),t.Njj(o)})),t.k0s()}if(2&e){const e=t.XpG();t.Y8G("priority",1e3)("content",t.bMT(1,3,"core.settings.showdownloadoptions")),t.R50("toggle",e.downloadEnabled)}}function CoreCoursesListPage_core_search_box_18_Template(e,o){if(1&e){const e=t.RV6();t.j41(0,"core-search-box",15),t.nI1(1,"translate"),t.nI1(2,"translate"),t.bIt("onSubmit",(function CoreCoursesListPage_core_search_box_18_Template_core_search_box_onSubmit_0_listener(o){t.eBV(e);const s=t.XpG();return t.Njj(s.search(o))}))("onClear",(function CoreCoursesListPage_core_search_box_18_Template_core_search_box_onClear_0_listener(){t.eBV(e);const o=t.XpG();return t.Njj(o.clearSearch())})),t.k0s()}if(2&e){const e=t.XpG();t.Y8G("placeholder",t.bMT(1,4,"core.courses.search"))("searchLabel",t.bMT(2,6,"core.courses.search"))("autoFocus",e.searchMode)("lengthCheck",1)}}function CoreCoursesListPage_ng_container_20_Template(e,o){if(1&e&&(t.qex(0),t.j41(1,"ion-item-divider")(2,"ion-label")(3,"h2"),t.EFF(4),t.nI1(5,"translate"),t.k0s()()(),t.bVm()),2&e){const e=t.XpG();t.R7$(4),t.JRh(t.i5U(5,1,"core.courses.totalcoursesearchresults",t.eq3(4,list_c0,e.searchTotal)))}}function CoreCoursesListPage_core_courses_course_list_item_22_Template(e,o){if(1&e&&t.nrm(0,"core-courses-course-list-item",16),2&e){const e=o.$implicit,s=t.XpG();t.Y8G("course",e)("showDownload",s.downloadEnabled)}}function CoreCoursesListPage_core_empty_box_24_Template(e,o){1&e&&(t.nrm(0,"core-empty-box",17),t.nI1(1,"translate")),2&e&&t.Y8G("message",t.bMT(1,1,"core.courses.nosearchresults"))}function CoreCoursesListPage_core_empty_box_25_Template(e,o){1&e&&(t.nrm(0,"core-empty-box",18),t.nI1(1,"translate")),2&e&&t.Y8G("message",t.bMT(1,1,"core.courses.nocourses"))}let $=(()=>{var e;class CoreCoursesListPage{constructor(){var e=this;this.downloadAllCoursesEnabled=!1,this.searchEnabled=!1,this.searchMode=!1,this.searchTotal=0,this.downloadEnabled=!1,this.downloadCourseEnabled=!1,this.downloadCoursesEnabled=!1,this.courses=[],this.loaded=!1,this.coursesLoaded=0,this.canLoadMore=!1,this.loadMoreError=!1,this.loadingMessage=g.HT.instant("core.loading"),this.showOnlyEnrolled=!1,this.loadedCourses=[],this.loadCoursesPerPage=20,this.searchPage=0,this.searchText="",this.courseIds="",this.isDestroyed=!1,this.currentSiteId=l.CoreSites.getRequiredCurrentSite().getId(),this.frontpageCourseId=l.CoreSites.getRequiredCurrentSite().getSiteHomeId(),this.myCoursesObserver=C.z.on(p.CORE_COURSES_MY_COURSES_UPDATED_EVENT,(e=>{e.action==p.CoreCoursesMyCoursesUpdatedEventAction.ENROL&&this.fetchCourses()}),this.currentSiteId),this.siteUpdatedObserver=C.z.on(C.z.SITE_UPDATED,(()=>{this.searchEnabled=!u.CoreCourses.isSearchCoursesDisabledInSite(),this.downloadCourseEnabled=!u.CoreCourses.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!u.CoreCourses.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&this.downloadEnabled,!this.searchEnabled&&this.searchMode&&(this.searchMode=!1,this.fetchCourses())}),this.currentSiteId),this.downloadEnabledObserver=C.z.on(p.CORE_COURSES_DASHBOARD_DOWNLOAD_ENABLED_CHANGED_EVENT,(e=>{this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&e.enabled})),this.logView=m.j.once((0,i.A)((function*(){h.OF.logEvent(e.showOnlyEnrolled?{type:h.qr.VIEW_ITEM_LIST,ws:"core_enrol_get_users_courses",name:g.HT.instant("core.courses.mycourses"),data:{category:"course"},url:"/my/courses.php"}:{type:h.qr.VIEW_ITEM_LIST,ws:"core_course_get_courses_by_field",name:g.HT.instant("core.courses.availablecourses"),data:{category:"course"},url:"/course/index.php"})})))}ngOnInit(){this.downloadCourseEnabled=!u.CoreCourses.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!u.CoreCourses.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&u.CoreCourses.getCourseDownloadOptionsEnabled();const e=_.CoreNavigator.getRouteParam("mode")||"my";"search"==e&&(this.searchMode=!0),"my"==e&&(this.showOnlyEnrolled=!0),this.searchEnabled=!u.CoreCourses.isSearchCoursesDisabledInSite(),this.searchEnabled||(this.searchMode=!1),this.fetchCourses()}fetchCourses(){var e=this;return(0,i.A)((function*(){try{e.searchMode?e.searchText&&(yield e.searchCourses()):yield e.loadCourses(!0)}finally{e.loaded=!0}}))()}loadCourses(e=!1){var o=this;return(0,i.A)((function*(){o.loadingMessage=g.HT.instant("core.loading"),o.loadMoreError=!1;try{if(e){if(o.showOnlyEnrolled)o.loadedCourses=yield u.CoreCourses.getUserCourses();else{const e=yield u.CoreCourses.getCoursesByField();o.loadedCourses=e.filter((e=>e.id!=o.frontpageCourseId))}o.coursesLoaded=0,o.courses=[]}const s=o.loadedCourses.slice(o.coursesLoaded,o.coursesLoaded+o.loadCoursesPerPage);yield G.CoreCoursesHelper.loadCoursesExtraInfo(s,!0),o.courses=o.courses.concat(s),o.courseIds=o.courses.map((e=>e.id)).join(","),o.coursesLoaded=o.courses.length,o.canLoadMore=o.loadedCourses.length>o.courses.length,o.logView()}catch(e){o.loadMoreError=!0,!o.isDestroyed&&c.CoreDomUtils.showErrorModalDefault(e,"core.courses.errorloadcourses",!0)}}))()}refreshCourses(e){const o=[];this.searchMode||(o.push(this.showOnlyEnrolled?u.CoreCourses.invalidateUserCourses():u.CoreCourses.invalidateCoursesByField()),this.courseIds&&o.push(u.CoreCourses.invalidateCoursesByField("ids",this.courseIds))),Promise.all(o).finally((()=>{this.fetchCourses().finally((()=>{null==e||e.complete()}))}))}search(e){var o=this;return(0,i.A)((function*(){o.searchMode=!0,o.searchText=e,o.courses=[],o.searchPage=0,o.searchTotal=0,o.logSearch=m.j.once((()=>o.performLogSearch())),o.loaded=!1,yield o.searchCourses().finally((()=>{o.loaded=!0}))}))()}clearSearch(){this.searchText="",this.courses=[],this.searchPage=0,this.searchTotal=0,this.searchMode=!1,this.loaded=!1,this.fetchCourses()}performLogSearch(){var e=this;return(0,i.A)((function*(){e.searchMode&&h.OF.logEvent({type:h.qr.VIEW_ITEM_LIST,ws:"core_course_search_courses",name:g.HT.instant("core.courses.availablecourses"),data:{search:e.searchText,category:"course"},url:`/course/search.php?search=${e.searchText}`})}))()}loadMoreCourses(e){var o=this;return(0,i.A)((function*(){try{o.searchMode?yield o.searchCourses():yield o.loadCourses()}finally{e&&e()}}))()}searchCourses(){var e=this;return(0,i.A)((function*(){e.loadMoreError=!1,e.loadingMessage=g.HT.instant("core.searching");try{var o;const s=yield u.CoreCourses.search(e.searchText,e.searchPage,void 0,e.showOnlyEnrolled);e.courses=0===e.searchPage?s.courses:e.courses.concat(s.courses),e.searchTotal=s.total,e.searchPage++,e.canLoadMore=e.courses.length<e.searchTotal,null===(o=e.logSearch)||void 0===o||o.call(e)}catch(o){e.loadMoreError=!0,!e.isDestroyed&&c.CoreDomUtils.showErrorModalDefault(o,"core.courses.errorsearching",!0)}}))()}toggleEnrolled(){this.loaded=!1,this.fetchCourses()}toggleDownload(){u.CoreCourses.setCourseDownloadOptionsEnabled(this.downloadEnabled)}ngOnDestroy(){this.myCoursesObserver.off(),this.siteUpdatedObserver.off(),this.downloadEnabledObserver.off(),this.isDestroyed=!0}}return(e=CoreCoursesListPage).ɵfac=function CoreCoursesListPage_Factory(o){return new(o||e)},e.ɵcmp=t.VBU({type:e,selectors:[["page-core-courses-list"]],decls:26,vars:24,consts:[["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],["iconAction","toggle",3,"priority","content","toggle","action","toggleChange",4,"ngIf"],["iconAction","toggle",3,"action","toggleChange","priority","content","toggle"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],["searchArea","CoreCoursesSearch",3,"placeholder","searchLabel","autoFocus","lengthCheck","onSubmit","onClear",4,"ngIf"],[3,"hideUntil","message"],[1,"list-item-limited-width"],[3,"course","showDownload",4,"ngFor","ngForOf"],[3,"action","enabled","error"],["icon","fas-magnifying-glass","role","alert",3,"message",4,"ngIf"],["icon","fas-graduation-cap",3,"message",4,"ngIf"],["searchArea","CoreCoursesSearch",3,"onSubmit","onClear","placeholder","searchLabel","autoFocus","lengthCheck"],[3,"course","showDownload"],["icon","fas-magnifying-glass","role","alert",3,"message"],["icon","fas-graduation-cap",3,"message"]],template:function CoreCoursesListPage_Template(e,o){1&e&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t.nrm(3,"ion-back-button",1),t.nI1(4,"translate"),t.k0s(),t.j41(5,"ion-title"),t.DNE(6,CoreCoursesListPage_h1_6_Template,3,3,"h1",2)(7,CoreCoursesListPage_h1_7_Template,3,3,"h1",2),t.k0s(),t.j41(8,"ion-buttons",3)(9,"core-context-menu"),t.DNE(10,CoreCoursesListPage_core_context_menu_item_10_Template,2,5,"core-context-menu-item",4),t.j41(11,"core-context-menu-item",5),t.nI1(12,"translate"),t.bIt("action",(function CoreCoursesListPage_Template_core_context_menu_item_action_11_listener(){return o.toggleEnrolled()})),t.mxI("toggleChange",(function CoreCoursesListPage_Template_core_context_menu_item_toggleChange_11_listener(e){return t.DH7(o.showOnlyEnrolled,e)||(o.showOnlyEnrolled=e),e})),t.k0s()(),t.nrm(13,"core-user-menu-button"),t.k0s()()(),t.j41(14,"ion-content")(15,"ion-refresher",6),t.bIt("ionRefresh",(function CoreCoursesListPage_Template_ion_refresher_ionRefresh_15_listener(e){return o.refreshCourses(e.target)})),t.nrm(16,"ion-refresher-content",7),t.nI1(17,"translate"),t.k0s(),t.DNE(18,CoreCoursesListPage_core_search_box_18_Template,3,8,"core-search-box",8),t.j41(19,"core-loading",9),t.DNE(20,CoreCoursesListPage_ng_container_20_Template,6,6,"ng-container",2),t.j41(21,"ion-list",10),t.DNE(22,CoreCoursesListPage_core_courses_course_list_item_22_Template,1,2,"core-courses-course-list-item",11),t.k0s(),t.j41(23,"core-infinite-loading",12),t.bIt("action",(function CoreCoursesListPage_Template_core_infinite_loading_action_23_listener(e){return o.loadMoreCourses(e)})),t.k0s(),t.DNE(24,CoreCoursesListPage_core_empty_box_24_Template,2,3,"core-empty-box",13)(25,CoreCoursesListPage_core_empty_box_25_Template,2,3,"core-empty-box",14),t.k0s()()),2&e&&(t.R7$(3),t.Y8G("text",t.bMT(4,18,"core.back")),t.R7$(3),t.Y8G("ngIf",!o.showOnlyEnrolled),t.R7$(),t.Y8G("ngIf",o.showOnlyEnrolled),t.R7$(3),t.Y8G("ngIf",o.downloadCourseEnabled||o.downloadCoursesEnabled),t.R7$(),t.Y8G("priority",900)("content",t.bMT(12,20,"core.courses.showonlyenrolled")),t.R50("toggle",o.showOnlyEnrolled),t.R7$(4),t.Y8G("disabled",!o.loaded),t.R7$(),t.FS9("pullingText",t.bMT(17,22,"core.pulltorefresh")),t.R7$(2),t.Y8G("ngIf",o.searchEnabled),t.R7$(),t.Y8G("hideUntil",o.loaded)("message",o.loadingMessage),t.R7$(),t.Y8G("ngIf",o.searchMode&&o.searchTotal>0),t.R7$(2),t.Y8G("ngForOf",o.courses),t.R7$(),t.Y8G("enabled",o.canLoadMore)("error",o.loadMoreError),t.R7$(),t.Y8G("ngIf",o.searchMode&&!o.courses.length),t.R7$(),t.Y8G("ngIf",!o.searchMode&&!o.courses.length))},dependencies:[f.Sq,f.bT,b.B,E.Q,y.h,S.b,w.R,x.i,D.QW,D.W9,D.eU,D.Dg,D.he,D.nf,D.To,D.Ki,D.BC,D.ai,D.el,P.F,v.U,L.M,M.D9],encapsulation:2}),CoreCoursesListPage})();var j=s(47720),k=s(42858),F=s(51734),Y=s(5054);function buildRoutes(e){return[{path:"my",data:{mainMenuTabRoot:Y.n.PAGE_NAME},loadChildren:()=>G.CoreCoursesHelper.getMyRouteModule()},{path:"categories",redirectTo:"categories/root",pathMatch:"full"},{path:"categories/:id",component:O},{path:"list",component:$},...(0,k.B)(e,{redirectTo:"my",pathMatch:"full"})]}let N=(()=>{var e;class CoreCoursesLazyModule{}return(e=CoreCoursesLazyModule).ɵfac=function CoreCoursesLazyModule_Factory(o){return new(o||e)},e.ɵmod=t.$C({type:e}),e.ɵinj=t.G2t({providers:[{provide:n.bw,multi:!0,deps:[t.zZn],useFactory:buildRoutes}],imports:[r.n,a.I,j.E,F._]}),CoreCoursesLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&t.Obh(N,{declarations:[O,$],imports:[r.n,a.I,j.E,F._]}))}}]);