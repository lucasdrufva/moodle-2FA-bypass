"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6045],{16045:(e,o,t)=>{t.r(o),t.d(o,{default:()=>O});var n=t(21182),r=t(3353),d=t(31249),i=t(14110),a=t(54438);let s=(()=>{var e;class AddonModImscpComponentsModule{}return(e=AddonModImscpComponentsModule).ɵfac=function AddonModImscpComponentsModule_Factory(o){return new(o||e)},e.ɵmod=a.$C({type:e}),e.ɵinj=a.G2t({imports:[r.n,d.r]}),AddonModImscpComponentsModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&a.Obh(s,{declarations:[i.AddonModImscpIndexComponent],imports:[r.n,d.r],exports:[i.AddonModImscpIndexComponent]}));var c=t(2138),l=t(58197),m=t(68273),u=t(88246),p=t(73465),I=t(73955);let f=(()=>{var e;class AddonModImscpIndexPage extends c._{}return(e=AddonModImscpIndexPage).ɵfac=(()=>{let o;return function AddonModImscpIndexPage_Factory(t){return(o||(o=a.xGo(e)))(t||e)}})(),e.ɵcmp=a.VBU({type:e,selectors:[["page-addon-mod-imscp-index"]],viewQuery:function AddonModImscpIndexPage_Query(e,o){if(1&e&&a.GBs(i.AddonModImscpIndexComponent,5),2&e){let e;a.mGM(e=a.lsd())&&(o.activityComponent=e.first)}},features:[a.Vt3],decls:11,vars:8,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],[3,"dataRetrieved","module","courseId"]],template:function AddonModImscpIndexPage_Template(e,o){1&e&&(a.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),a.nrm(3,"ion-back-button",2),a.nI1(4,"translate"),a.k0s(),a.j41(5,"ion-title")(6,"h1"),a.nrm(7,"core-format-text",3),a.k0s()(),a.nrm(8,"ion-buttons",4),a.k0s()(),a.j41(9,"ion-content",5)(10,"addon-mod-imscp-index",6),a.bIt("dataRetrieved",(function AddonModImscpIndexPage_Template_addon_mod_imscp_index_dataRetrieved_10_listener(e){return o.updateData(e)})),a.k0s()()),2&e&&(a.R7$(3),a.Y8G("text",a.bMT(4,6,"core.back")),a.R7$(4),a.Y8G("text",o.title)("contextInstanceId",o.module.id)("courseId",o.courseId),a.R7$(3),a.Y8G("module",o.module)("courseId",o.courseId))},dependencies:[l.B,m.M,u.i,p.QW,p.W9,p.eU,p.BC,p.ai,p.el,i.AddonModImscpIndexComponent,I.D9],encapsulation:2}),AddonModImscpIndexPage})();var g=t(10467),_=t(74431),h=t(75629),M=t(44682),b=t(8979),v=t(94455),w=t(15324),C=t(89911),y=t(49588),A=t(55554),x=t(79555),P=t(99201),T=t(6319),R=t(60177),k=t(7476),G=t(64422),V=t(46036),H=t(86198),D=t(66731),j=t(43570);function AddonModImscpViewPage_ion_button_9_Template(e,o){if(1&e){const e=a.RV6();a.j41(0,"ion-button",9),a.nI1(1,"translate"),a.bIt("click",(function AddonModImscpViewPage_ion_button_9_Template_ion_button_click_0_listener(){a.eBV(e);const o=a.XpG();return a.Njj(o.showToc())})),a.nrm(2,"ion-icon",10),a.k0s()}2&e&&a.Y8G("ariaLabel",a.bMT(1,1,"addon.mod_imscp.toc"))}function AddonModImscpViewPage_ion_card_12_Template(e,o){if(1&e&&(a.j41(0,"ion-card",11)(1,"ion-item"),a.nrm(2,"ion-icon",12),a.j41(3,"ion-label"),a.nrm(4,"span",13),a.k0s()()()),2&e){const e=a.XpG();a.R7$(4),a.Y8G("innerHTML",e.warning,a.npT)}}function AddonModImscpViewPage_core_iframe_13_Template(e,o){if(1&e&&a.nrm(0,"core-iframe",14),2&e){const e=a.XpG();a.Y8G("src",e.src)("showFullscreenOnToolbar",!0)("autoFullscreenOnRotate",!0)}}function AddonModImscpViewPage_core_navigation_bar_14_Template(e,o){if(1&e){const e=a.RV6();a.j41(0,"core-navigation-bar",15),a.bIt("action",(function AddonModImscpViewPage_core_navigation_bar_14_Template_core_navigation_bar_action_0_listener(o){a.eBV(e);const t=a.XpG();return a.Njj(t.loadItem(o))})),a.k0s()}if(2&e){const e=a.XpG();a.Y8G("items",e.navigationItems)}}let E=(()=>{var e;class AddonModImscpViewPage{constructor(){this.title="",this.src="",this.warning="",this.navigationItems=[],this.loaded=!1,this.items=[]}ngOnInit(){try{this.cmId=w.CoreNavigator.getRequiredRouteNumberParam("cmId"),this.courseId=w.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.initialItemHref=w.CoreNavigator.getRouteParam("initialHref")}catch(e){return C.CoreDomUtils.showErrorModal(e),w.CoreNavigator.back(),void 0}this.fetchContent()}fetchContent(e=!1){var o=this;return(0,g.A)((function*(){try{const{module:t,imscp:n}=yield o.loadImscpData();o.title=n.name;const r=yield o.downloadResourceIfNeeded(t,e),d=yield M.CoreCourse.getModuleContents(t,o.courseId);if(o.items=P.x.createItemList(d),o.items.length&&(o.initialItemHref&&o.items.some((e=>e.href===o.initialItemHref))&&(o.currentHref=o.initialItemHref),void 0===o.currentHref)){const e=yield P.x.getLastItemViewed(n.id);o.currentHref=void 0!==e?e:o.items[0].href}if(void 0===o.currentHref)throw new h.CoreError("Empty TOC");try{yield o.loadItemHref(o.currentHref)}catch(e){return C.CoreDomUtils.showErrorModalDefault(e,"addon.mod_imscp.deploymenterror",!0),void 0}if(null!=r&&r.failed){const e=y.CoreErrorHelper.getErrorMessageFromError(r.error)||r.error;o.warning=x.HT.instant("core.errordownloadingsomefiles")+(e?" "+e:"")}else o.warning=""}catch(e){C.CoreDomUtils.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}finally{o.loaded=!0}}))()}loadImscpData(){var e=this;return(0,g.A)((function*(){return e.module=yield M.CoreCourse.getModule(e.cmId,e.courseId),e.imscp=yield P.x.getImscp(e.courseId,e.cmId),{module:e.module,imscp:e.imscp}}))()}downloadResourceIfNeeded(e,o=!1){var t=this;return(0,g.A)((function*(){var n;const r={failed:!1};let d=!1;if((yield b.CoreCourseModulePrefetchDelegate.getModuleStatus(e,t.courseId,void 0,o))!==_.DownloadStatus.DOWNLOADED)try{yield b.CoreCourseModulePrefetchDelegate.downloadModule(e,t.courseId),d=!0}catch(e){r.failed=!0,r.error=e}if(null===(n=e.contents)||void 0===n||!n.length||o&&!d){const t=o&&v.WE.isOnline();try{yield M.CoreCourse.loadModuleContents(e,void 0,void 0,!1,t)}catch(o){if(t&&!e.contents)yield M.CoreCourse.loadModuleContents(e);else if(!e.contents)throw o}}return r}))()}doRefresh(e){var o=this;return(0,g.A)((function*(){yield A.g.ignoreErrors(Promise.all([P.x.invalidateContent(o.cmId,o.courseId),b.CoreCourseModulePrefetchDelegate.invalidateCourseUpdates(o.courseId)])),yield A.g.ignoreErrors(o.fetchContent(!0)),null==e||e.complete()}))()}loadItemHref(e){var o=this;return(0,g.A)((function*(){if(!o.module)return;const t=yield P.x.getIframeSrc(o.module,e);o.currentHref=e,o.navigationItems=o.items.map((e=>({item:e,current:e.href==o.currentHref,enabled:!!e.href}))),o.src&&t==o.src?(o.src="",setTimeout((()=>{o.src=t}))):o.src=t,o.imscp&&P.x.storeLastItemViewed(o.imscp.id,e,o.courseId)}))()}loadItem(e){this.loadItemHref(e.href)}showToc(){var e=this;return(0,g.A)((function*(){const{AddonModImscpTocComponent:o}=yield t.e(3158).then(t.bind(t,93158)),n=yield T.I.openSideModal({component:o,componentProps:{items:e.items,selected:e.currentHref}});n&&e.loadItemHref(n)}))()}}return(e=AddonModImscpViewPage).ɵfac=function AddonModImscpViewPage_Factory(o){return new(o||e)},e.ɵcmp=a.VBU({type:e,selectors:[["page-addon-mod-imscp-view"]],decls:15,vars:11,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["aria-haspopup","true",3,"ariaLabel","click",4,"ngIf"],[3,"hideUntil"],["class","core-warning-card",4,"ngIf"],[3,"src","showFullscreenOnToolbar","autoFullscreenOnRotate",4,"ngIf"],["collapsible-footer","","appearOnBottom","",3,"items","action",4,"ngIf"],["aria-haspopup","true",3,"click","ariaLabel"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[3,"innerHTML"],[3,"src","showFullscreenOnToolbar","autoFullscreenOnRotate"],["collapsible-footer","","appearOnBottom","",3,"action","items"]],template:function AddonModImscpViewPage_Template(e,o){1&e&&(a.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),a.nrm(3,"ion-back-button",1),a.nI1(4,"translate"),a.k0s(),a.j41(5,"ion-title")(6,"h1"),a.nrm(7,"core-format-text",2),a.k0s()(),a.j41(8,"ion-buttons",3),a.DNE(9,AddonModImscpViewPage_ion_button_9_Template,3,3,"ion-button",4),a.k0s()()(),a.j41(10,"ion-content")(11,"core-loading",5),a.DNE(12,AddonModImscpViewPage_ion_card_12_Template,5,1,"ion-card",6)(13,AddonModImscpViewPage_core_iframe_13_Template,1,3,"core-iframe",7),a.k0s(),a.DNE(14,AddonModImscpViewPage_core_navigation_bar_14_Template,1,1,"core-navigation-bar",8),a.k0s()),2&e&&(a.R7$(3),a.Y8G("text",a.bMT(4,9,"core.back")),a.R7$(4),a.Y8G("text",o.title)("contextInstanceId",o.cmId)("courseId",o.courseId),a.R7$(2),a.Y8G("ngIf",o.loaded),a.R7$(2),a.Y8G("hideUntil",o.loaded),a.R7$(),a.Y8G("ngIf",o.warning),a.R7$(),a.Y8G("ngIf",o.loaded),a.R7$(),a.Y8G("ngIf",o.loaded&&o.navigationItems.length>1))},dependencies:[R.bT,k.l,G.R,V.o,H.t,l.B,D.i,u.i,j.T,p.Jm,p.QW,p.b_,p.W9,p.eU,p.iq,p.uz,p.he,p.BC,p.ai,p.el,I.D9],encapsulation:2}),AddonModImscpViewPage})();const L=[{path:":courseId/:cmId",component:f},{path:":courseId/:cmId/view",component:E}];let O=(()=>{var e;class AddonModImscpLazyModule{}return(e=AddonModImscpLazyModule).ɵfac=function AddonModImscpLazyModule_Factory(o){return new(o||e)},e.ɵmod=a.$C({type:e}),e.ɵinj=a.G2t({imports:[n.iI.forChild(L),r.n,s]}),AddonModImscpLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&a.Obh(O,{declarations:[f,E],imports:[n.iI,r.n,s]}))}}]);