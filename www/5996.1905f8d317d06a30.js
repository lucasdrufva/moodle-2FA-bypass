"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5996],{85996:(e,t,n)=>{n.r(t),n.d(t,{AddonModChatIndexComponent:()=>M});var o=n(10467),i=n(69006),a=n(15324),s=n(16474),d=n(24742),r=n(35853),c=n(22535),l=n(54438),u=n(73465),h=n(51024),m=n(60177),_=n(69502),C=n(17388),g=n(64422),p=n(13988),f=n(86198),y=n(66731),I=n(43570),S=n(6736),v=n(30864),A=n(73955);const _c0=e=>({$a:e});function AddonModChatIndexComponent_Conditional_1_Template(e,t){if(1&e){const e=l.RV6();l.j41(0,"ion-button",7),l.nI1(1,"translate"),l.bIt("click",(function AddonModChatIndexComponent_Conditional_1_Template_ion_button_click_0_listener(){l.eBV(e);const t=l.XpG();return l.Njj(t.openModuleSummary())})),l.nrm(2,"ion-icon",8),l.k0s()}2&e&&l.Y8G("ariaLabel",l.bMT(1,1,"core.info"))}function AddonModChatIndexComponent_Conditional_2_Template(e,t){if(1&e){const e=l.RV6();l.j41(0,"core-context-menu")(1,"core-context-menu-item",9),l.nI1(2,"translate"),l.bIt("action",(function AddonModChatIndexComponent_Conditional_2_Template_core_context_menu_item_action_1_listener(){l.eBV(e);const t=l.XpG();return l.Njj(t.openModuleSummary())})),l.k0s()()}2&e&&(l.R7$(),l.Y8G("priority",5e3)("content",l.bMT(2,2,"core.info")))}function AddonModChatIndexComponent_ion_card_5_Template(e,t){if(1&e&&(l.j41(0,"ion-card",10)(1,"ion-item"),l.nrm(2,"ion-icon",11),l.j41(3,"ion-label"),l.EFF(4),l.nI1(5,"translate"),l.k0s()()()),2&e){const e=l.XpG();l.R7$(4),l.JRh(l.i5U(5,1,"addon.mod_chat.sessionstartsin",l.eq3(4,_c0,e.chatTime)))}}function AddonModChatIndexComponent_ion_button_6_Template(e,t){if(1&e){const e=l.RV6();l.j41(0,"ion-button",12),l.bIt("click",(function AddonModChatIndexComponent_ion_button_6_Template_ion_button_click_0_listener(){l.eBV(e);const t=l.XpG();return l.Njj(t.viewSessions())})),l.EFF(1),l.nI1(2,"translate"),l.k0s()}2&e&&(l.R7$(),l.SpI(" ",l.bMT(2,1,"addon.mod_chat.viewreport")," "))}function AddonModChatIndexComponent_div_7_div_1_Template(e,t){if(1&e){const e=l.RV6();l.j41(0,"div",16)(1,"ion-button",17),l.bIt("click",(function AddonModChatIndexComponent_div_7_div_1_Template_ion_button_click_1_listener(){l.eBV(e);const t=l.XpG(2);return l.Njj(t.enterChat())})),l.EFF(2),l.nI1(3,"translate"),l.k0s()()}2&e&&(l.R7$(2),l.SpI(" ",l.bMT(3,1,"addon.mod_chat.enterchat")," "))}function AddonModChatIndexComponent_div_7_Template(e,t){if(1&e&&(l.j41(0,"div",13),l.DNE(1,AddonModChatIndexComponent_div_7_div_1_Template,4,3,"div",14),l.nrm(2,"core-course-module-navigation",15),l.k0s()),2&e){const e=l.XpG();l.R7$(),l.Y8G("ngIf",e.chat),l.R7$(),l.Y8G("courseId",e.courseId)("currentModuleId",e.module.id)}}let M=(()=>{var e;class AddonModChatIndexComponent extends i.y{constructor(e,t){super("AddonModChatIndexComponent",e,t),this.content=e,this.component=c.L5,this.pluginName="chat"}ngOnInit(){var _superprop_getNgOnInit=()=>super.ngOnInit,e=this;return(0,o.A)((function*(){_superprop_getNgOnInit().call(e),yield e.loadContent()}))()}fetchContent(){var e=this;return(0,o.A)((function*(){e.chat=yield r.V.getChat(e.courseId,e.module.id),e.description=e.chat.intro;const t=(e.chat.chattime||0)-s.CoreTimeUtils.timestamp();e.chatTime=e.chat.schedule&&t>0?d.j.formatTime(t):void 0,e.dataRetrieved.emit(e.chat)}))()}logActivity(){var e=this;return(0,o.A)((function*(){e.chat&&(yield r.V.logView(e.chat.id),e.analyticsLogEvent("mod_chat_view_chat"))}))()}enterChat(){var e;const t=(null===(e=this.chat)||void 0===e?void 0:e.name)||this.moduleName;a.CoreNavigator.navigateToSitePath(`${c.VU}/${this.courseId}/${this.module.id}/chat`,{params:{title:t,chatId:this.chat.id}})}viewSessions(){a.CoreNavigator.navigateToSitePath(`${c.VU}/${this.courseId}/${this.module.id}/sessions`,{params:{chatId:this.chat.id}})}}return(e=AddonModChatIndexComponent).ɵfac=function AddonModChatIndexComponent_Factory(t){return new(t||e)(l.rXU(u.W9),l.rXU(h.k,8))},e.ɵcmp=l.VBU({type:e,selectors:[["addon-mod-chat-index"]],features:[l.Vt3],decls:8,vars:10,consts:[["slot","end"],["fill","clear","aria-haspopup","true",3,"ariaLabel"],[3,"hideUntil"],[3,"completionChanged","module","description","component","componentId","courseId"],["class","core-info-card",4,"ngIf"],["class","ion-margin ion-text-wrap","expand","block","fill","outline",3,"click",4,"ngIf"],["collapsible-footer","","slot","fixed",4,"ngIf"],["fill","clear","aria-haspopup","true",3,"click","ariaLabel"],["name","fas-circle-info","slot","icon-only","aria-hidden","true"],["iconAction","fas-circle-info",3,"action","priority","content"],[1,"core-info-card"],["name","fas-clock","slot","start","aria-hidden","true"],["expand","block","fill","outline",1,"ion-margin","ion-text-wrap",3,"click"],["collapsible-footer","","slot","fixed"],["class","list-item-limited-width",4,"ngIf"],[3,"courseId","currentModuleId"],[1,"list-item-limited-width"],["expand","block",1,"ion-margin","ion-text-wrap",3,"click"]],template:function AddonModChatIndexComponent_Template(e,t){1&e&&(l.j41(0,"core-navbar-buttons",0),l.DNE(1,AddonModChatIndexComponent_Conditional_1_Template,3,3,"ion-button",1)(2,AddonModChatIndexComponent_Conditional_2_Template,3,4),l.k0s(),l.j41(3,"core-loading",2)(4,"core-course-module-info",3),l.bIt("completionChanged",(function AddonModChatIndexComponent_Template_core_course_module_info_completionChanged_4_listener(){return t.onCompletionChange()})),l.k0s(),l.DNE(5,AddonModChatIndexComponent_ion_card_5_Template,6,6,"ion-card",4)(6,AddonModChatIndexComponent_ion_button_6_Template,3,3,"ion-button",5)(7,AddonModChatIndexComponent_div_7_Template,3,3,"div",6),l.k0s()),2&e&&(l.R7$(),l.vxM(1,t.courseContentsPage?2:1),l.R7$(2),l.Y8G("hideUntil",!t.showLoading),l.R7$(),l.Y8G("module",t.module)("description",t.description)("component",t.component)("componentId",t.componentId)("courseId",t.courseId),l.R7$(),l.Y8G("ngIf",t.chatTime),l.R7$(),l.Y8G("ngIf",t.chat),l.R7$(),l.Y8G("ngIf",!t.showLoading))},dependencies:[m.bT,_.B,C.Q,g.R,p.c,f.t,y.i,I.T,u.Jm,u.b_,u.iq,u.uz,u.he,S.Y,v.Q,A.D9],encapsulation:2}),AddonModChatIndexComponent})()},35853:(e,t,n)=>{n.d(t,{V:()=>m});var o=n(10467),i=n(75629),a=n(97254),s=n(98870),d=n(52749),r=n(79555),c=n(22535),l=n(74431),u=n(54438);let h=(()=>{var e;class AddonModChatProvider{getChat(e,t,n={}){var a=this;return(0,o.A)((function*(){const o=yield d.CoreSites.getSite(n.siteId),s={courseids:[e]},u={cacheKey:a.getChatsCacheKey(e),updateFrequency:l.CoreCacheUpdateFrequency.RARELY,component:c.L5,...d.CoreSites.getReadingStrategyPreSets(n.readingStrategy)},h=(yield o.read("mod_chat_get_chats_by_courses",s,u)).chats.find((e=>e.coursemodule==t));if(h)return h;throw new i.CoreError(r.HT.instant("core.course.modulenotfound"))}))()}loginUser(e,t){return(0,o.A)((function*(){const n=yield d.CoreSites.getSite(t),o={chatid:e};return(yield n.write("mod_chat_login_user",o)).chatsid}))()}logView(e,t){return(0,o.A)((function*(){const n={chatid:e};yield a.CoreCourseLogHelper.log("mod_chat_view_chat",n,c.L5,e,t)}))()}logViewSessions(e,t){return(0,o.A)((function*(){const n={cmid:e};t&&(n.start=t.start,n.end=t.end),yield a.CoreCourseLogHelper.log("mod_chat_view_sessions",n,c.L5,e)}))()}sendMessage(e,t,n,i){return(0,o.A)((function*(){const o=yield d.CoreSites.getSite(i),a={chatsid:e,messagetext:t,beepid:String(n)};return(yield o.write("mod_chat_send_chat_message",a)).messageid}))()}getLatestMessages(e,t,n){return(0,o.A)((function*(){return(yield d.CoreSites.getSite(n)).write("mod_chat_get_chat_latest_messages",{chatsid:e,chatlasttime:t})}))()}getMessagesUserData(e,t,n){return(0,o.A)((function*(){const i=e;return yield Promise.all(i.map(function(){var e=(0,o.A)((function*(e){try{const o=yield s.CoreUser.getProfile(e.userid,t,!0,n);e.userfullname=o.fullname,e.userprofileimageurl=o.profileimageurl}catch{e.userfullname=r.HT.instant("core.deleteduser")+" "+e.userid}}));return function(t){return e.apply(this,arguments)}}())),i}))()}getChatUsers(e,t={}){return(0,o.A)((function*(){t.readingStrategy=t.readingStrategy||3;const n=yield d.CoreSites.getSite(t.siteId),o={chatsid:e},i={component:c.L5,componentId:t.cmId,...d.CoreSites.getReadingStrategyPreSets(t.readingStrategy)};return n.read("mod_chat_get_chat_users",o,i)}))()}getSessions(e,t=0,n=!1,i={}){var a=this;return(0,o.A)((function*(){const o=yield d.CoreSites.getSite(i.siteId),s={chatid:e,groupid:t,showall:n},r={cacheKey:a.getSessionsCacheKey(e,t,n),updateFrequency:l.CoreCacheUpdateFrequency.SOMETIMES,component:c.L5,componentId:i.cmId,...d.CoreSites.getReadingStrategyPreSets(i.readingStrategy)};return(yield o.read("mod_chat_get_sessions",s,r)).sessions}))()}getSessionMessages(e,t,n,i=0,a={}){var s=this;return(0,o.A)((function*(){const o=yield d.CoreSites.getSite(a.siteId),r={chatid:e,sessionstart:t,sessionend:n,groupid:i},u={cacheKey:s.getSessionMessagesCacheKey(e,t,i),updateFrequency:l.CoreCacheUpdateFrequency.RARELY,component:c.L5,componentId:a.cmId,...d.CoreSites.getReadingStrategyPreSets(a.readingStrategy)};return(yield o.read("mod_chat_get_session_messages",r,u)).messages}))()}invalidateChats(e,t){var n=this;return(0,o.A)((function*(){const o=yield d.CoreSites.getSite(t);yield o.invalidateWsCacheForKey(n.getChatsCacheKey(e))}))()}invalidateSessions(e,t=0,n=!1,i){var a=this;return(0,o.A)((function*(){const o=yield d.CoreSites.getSite(i);yield o.invalidateWsCacheForKey(a.getSessionsCacheKey(e,t,n))}))()}invalidateAllSessions(e,t){var n=this;return(0,o.A)((function*(){const o=yield d.CoreSites.getSite(t);yield o.invalidateWsCacheForKeyStartingWith(n.getSessionsCacheKeyPrefix(e))}))()}invalidateSessionMessages(e,t,n=0,i){var a=this;return(0,o.A)((function*(){const o=yield d.CoreSites.getSite(i);yield o.invalidateWsCacheForKey(a.getSessionMessagesCacheKey(e,t,n))}))()}invalidateAllSessionMessages(e,t){var n=this;return(0,o.A)((function*(){const o=yield d.CoreSites.getSite(t);yield o.invalidateWsCacheForKeyStartingWith(n.getSessionMessagesCacheKeyPrefix(e))}))()}getChatsCacheKey(e){return AddonModChatProvider.ROOT_CACHE_KEY+"chats:"+e}getSessionsCacheKey(e,t,n){return this.getSessionsCacheKeyPrefix(e)+t+":"+(n?1:0)}getSessionsCacheKeyPrefix(e){return AddonModChatProvider.ROOT_CACHE_KEY+"sessions:"+e+":"}getSessionMessagesCacheKey(e,t,n){return this.getSessionMessagesCacheKeyPrefix(e)+t+":"+n}getSessionMessagesCacheKeyPrefix(e){return AddonModChatProvider.ROOT_CACHE_KEY+"sessionsMessages:"+e+":"}}return(e=AddonModChatProvider).ROOT_CACHE_KEY="AddonModChat:",e.ɵfac=function AddonModChatProvider_Factory(t){return new(t||e)},e.ɵprov=u.jDH({token:e,factory:e.ɵfac,providedIn:"root"}),AddonModChatProvider})();const m=(0,r.Qd)(h)}}]);