"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[895],{895:(e,t,o)=>{o.r(t),o.d(t,{default:()=>ne});var n=o(21182),i=o(3353),r=o(87800),a=o(2138),d=o(8901),s=o(54438),c=o(58197),u=o(68273),l=o(88246),m=o(73465),_=o(73955);let p=(()=>{var e;class AddonModQuizIndexPage extends a._{}return(e=AddonModQuizIndexPage).ɵfac=(()=>{let t;return function AddonModQuizIndexPage_Factory(o){return(t||(t=s.xGo(e)))(o||e)}})(),e.ɵcmp=s.VBU({type:e,selectors:[["page-addon-mod-quiz-index"]],viewQuery:function AddonModQuizIndexPage_Query(e,t){if(1&e&&s.GBs(d.AddonModQuizIndexComponent,5),2&e){let e;s.mGM(e=s.lsd())&&(t.activityComponent=e.first)}},features:[s.Vt3],decls:14,vars:12,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"dataRetrieved","module","courseId"]],template:function AddonModQuizIndexPage_Template(e,t){1&e&&(s.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),s.nrm(3,"ion-back-button",2),s.nI1(4,"translate"),s.k0s(),s.j41(5,"ion-title")(6,"h1"),s.nrm(7,"core-format-text",3),s.k0s()(),s.nrm(8,"ion-buttons",4),s.k0s()(),s.j41(9,"ion-content",5)(10,"ion-refresher",6),s.bIt("ionRefresh",(function AddonModQuizIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==t.activityComponent?null:t.activityComponent.doRefresh(e.target)})),s.nrm(11,"ion-refresher-content",7),s.nI1(12,"translate"),s.k0s(),s.j41(13,"addon-mod-quiz-index",8),s.bIt("dataRetrieved",(function AddonModQuizIndexPage_Template_addon_mod_quiz_index_dataRetrieved_13_listener(e){return t.updateData(e)})),s.k0s()()),2&e&&(s.R7$(3),s.Y8G("text",s.bMT(4,8,"core.back")),s.R7$(4),s.Y8G("text",t.title)("contextInstanceId",t.module.id)("courseId",t.courseId),s.R7$(3),s.Y8G("disabled",null==t.activityComponent?null:t.activityComponent.showLoading),s.R7$(),s.FS9("pullingText",s.bMT(12,10,"core.pulltorefresh")),s.R7$(2),s.Y8G("module",t.module)("courseId",t.courseId))},dependencies:[c.B,u.M,l.i,m.QW,m.W9,m.eU,m.To,m.Ki,m.BC,m.ai,m.el,d.AddonModQuizIndexComponent,_.D9],encapsulation:2}),AddonModQuizIndexPage})();var g=o(67842),f=o(10467),h=o(58529),v=o(69319),b=o(15324),q=o(52749),P=o(48966),I=o(89911),z=o(55554),A=o(79555),y=o(49882),M=o(84412),C=o(6787),w=o(64766),Q=o(23039);class AddonModQuizAutoSave{constructor(e,t){this.formName=e,this.buttonSelector=t,this.CHECK_CHANGES_INTERVAL=5e3,this.popoverShown=!1,this.logger=C.CoreLogger.getInstance("AddonModQuizAutoSave"),this.errorObservable=new M.t(!1)}cancelAutoSave(){clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=void 0}checkChanges(e,t,o,n){if(this.autoSaveTimeout)return;const i=this.getAnswers();if(!this.previousAnswers)return this.previousAnswers=i,void 0;let r=!0;for(const e in i)if(this.previousAnswers[e]!=i[e]){r=!1;break}r||this.setAutoSaveTimer(e,t,o,n),this.previousAnswers=i}getAnswers(){return v.CoreQuestionHelper.getAnswersFromForm(document.forms[this.formName])}hideAutoSaveError(){var e;this.errorObservable.next(!1),null===(e=this.popover)||void 0===e||e.dismiss()}onError(){return this.errorObservable}setAutoSaveTimer(e,t,o,n){var i=this;!e.autosaveperiod||this.autoSaveTimeout||w.AddonModQuiz.isAttemptTimeNearlyOver(e,t)||(this.autoSaveTimeout=window.setTimeout((0,f.A)((function*(){const r=i.getAnswers();i.cancelAutoSave(),i.previousAnswers=r;try{yield w.AddonModQuiz.saveAttempt(e,t,r,o,n),i.hideAutoSaveError()}catch(r){i.logger.warn("Error auto-saving data.",r),i.errorObservable.getValue()||(i.errorObservable.next(!0),i.showAutoSaveError()),i.setAutoSaveTimer(e,t,o,n)}})),1e3*e.autosaveperiod))}showAutoSaveError(e){var t=this;return(0,f.A)((function*(){if(t.popoverShown)return;const n=e||{target:document.querySelector(t.buttonSelector),stopPropagation:()=>{},preventDefault:()=>{}};t.popoverShown=!0;const{AddonModQuizConnectionErrorComponent:i}=yield o.e(245).then(o.bind(o,80245));t.popover=yield Q.CorePopovers.openWithoutResult({component:i,event:n}),t.popoverShown=!1}))()}startCheckChangesProcess(e,t,o,n){!this.checkChangesInterval&&e.autosaveperiod&&(this.previousAnswers=void 0,this.loadPreviousAnswersTimeout=window.setTimeout((()=>{this.checkChanges(e,t,o,n)}),2500),this.checkChangesInterval=window.setInterval((()=>{this.checkChanges(e,t,o,n)}),this.CHECK_CHANGES_INTERVAL))}stopCheckChangesProcess(){clearTimeout(this.loadPreviousAnswersTimeout),clearInterval(this.checkChangesInterval),this.loadPreviousAnswersTimeout=void 0,this.checkChangesInterval=void 0}}var k=o(93918),T=o(74149),R=o(63153),x=o(82907),S=o(24742),G=o(62393),E=o(43411),O=o(22693),$=o(20860),D=o(53794),j=o(6319),N=o(23780),F=o(60177),Y=o(64422),V=o(34198),B=o(86198),L=o(23007),H=o(66731),X=o(43570),U=o(89417),W=o(65377);const J=["quizForm"],_c1=e=>({$a:e});function AddonModQuizPlayerPage_core_format_text_7_Template(e,t){if(1&e&&s.nrm(0,"core-format-text",17),2&e){const e=s.XpG();s.Y8G("text",e.quiz.name)("contextInstanceId",e.quiz.coursemodule)("courseId",e.courseId)}}function AddonModQuizPlayerPage_ion_button_12_Template(e,t){if(1&e){const e=s.RV6();s.j41(0,"ion-button",18),s.nI1(1,"translate"),s.bIt("click",(function AddonModQuizPlayerPage_ion_button_12_Template_ion_button_click_0_listener(){s.eBV(e);const t=s.XpG();return s.Njj(t.openNavigation())})),s.nrm(2,"ion-icon",19),s.k0s()}2&e&&s.Y8G("ariaLabel",s.bMT(1,1,"addon.mod_quiz.opentoc"))}function AddonModQuizPlayerPage_core_timer_13_Template(e,t){if(1&e){const e=s.RV6();s.j41(0,"core-timer",20),s.nI1(1,"translate"),s.bIt("finished",(function AddonModQuizPlayerPage_core_timer_13_Template_core_timer_finished_0_listener(){s.eBV(e);const t=s.XpG();return s.Njj(t.timeUp())})),s.k0s()}if(2&e){const e=s.XpG();s.Y8G("endTime",e.endTime)("timerText",s.bMT(1,4,"addon.mod_quiz.timeleft"))("hidable",!0)("hidden",!e.loaded)}}function AddonModQuizPlayerPage_ion_button_16_Template(e,t){if(1&e){const e=s.RV6();s.j41(0,"ion-button",21),s.bIt("click",(function AddonModQuizPlayerPage_ion_button_16_Template_ion_button_click_0_listener(){s.eBV(e);const t=s.XpG();return s.Njj(t.start())})),s.EFF(1),s.nI1(2,"translate"),s.k0s()}2&e&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"addon.mod_quiz.startattempt")," "))}function AddonModQuizPlayerPage_form_17_ng_container_2_Template(e,t){if(1&e){const e=s.RV6();s.qex(0),s.j41(1,"addon-mod-quiz-question-card",24)(2,"core-question",25),s.bIt("onAbort",(function AddonModQuizPlayerPage_form_17_ng_container_2_Template_core_question_onAbort_2_listener(){s.eBV(e);const t=s.XpG(2);return s.Njj(t.abortQuiz())}))("buttonClicked",(function AddonModQuizPlayerPage_form_17_ng_container_2_Template_core_question_buttonClicked_2_listener(t){s.eBV(e);const o=s.XpG(2);return s.Njj(o.behaviourButtonClicked(t))})),s.k0s()(),s.bVm()}if(2&e){const e=t.$implicit,o=s.XpG(2);s.R7$(),s.Y8G("question",e),s.R7$(),s.Y8G("question",e)("component",o.component)("componentId",o.cmId)("attemptId",o.attempt.id)("usageId",o.attempt.uniqueid)("offlineEnabled",o.offline)("contextInstanceId",o.cmId)("courseId",o.courseId)("preferredBehaviour",o.quiz.preferredbehaviour)("review",!1)}}function AddonModQuizPlayerPage_form_17_Template(e,t){if(1&e&&(s.j41(0,"form",22,0),s.DNE(2,AddonModQuizPlayerPage_form_17_ng_container_2_Template,3,11,"ng-container",23),s.k0s()),2&e){const e=s.XpG();s.R7$(2),s.Y8G("ngForOf",e.questions)}}function AddonModQuizPlayerPage_ion_row_18_ion_col_1_Template(e,t){if(1&e){const e=s.RV6();s.j41(0,"ion-col")(1,"ion-button",27),s.bIt("click",(function AddonModQuizPlayerPage_ion_row_18_ion_col_1_Template_ion_button_click_1_listener(){s.eBV(e);const t=s.XpG(2);return s.Njj(t.changePage(t.previousPage))})),s.nrm(2,"ion-icon",28),s.EFF(3),s.nI1(4,"translate"),s.k0s()()}2&e&&(s.R7$(3),s.SpI(" ",s.bMT(4,1,"core.previous")," "))}function AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_1_Template(e,t){if(1&e){const e=s.RV6();s.j41(0,"ion-button",30),s.bIt("click",(function AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_1_Template_ion_button_click_0_listener(){s.eBV(e);const t=s.XpG(3);return s.Njj(t.changePage(t.nextPage))})),s.EFF(1),s.nI1(2,"translate"),s.nrm(3,"ion-icon",31),s.k0s()}2&e&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"core.next")," "))}function AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_2_Template(e,t){if(1&e){const e=s.RV6();s.j41(0,"ion-button",30),s.bIt("click",(function AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_2_Template_ion_button_click_0_listener(){s.eBV(e);const t=s.XpG(3);return s.Njj(t.changePage(t.nextPage))})),s.EFF(1),s.nI1(2,"translate"),s.k0s()}2&e&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"core.submit")," "))}function AddonModQuizPlayerPage_ion_row_18_ion_col_2_Template(e,t){if(1&e&&(s.j41(0,"ion-col"),s.DNE(1,AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_1_Template,4,3,"ion-button",29)(2,AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_2_Template,3,3,"ion-button",29),s.k0s()),2&e){const e=s.XpG(2);s.R7$(),s.Y8G("ngIf",e.nextPage>0),s.R7$(),s.Y8G("ngIf",-1===e.nextPage)}}function AddonModQuizPlayerPage_ion_row_18_Template(e,t){if(1&e&&(s.j41(0,"ion-row",26),s.DNE(1,AddonModQuizPlayerPage_ion_row_18_ion_col_1_Template,5,3,"ion-col",15)(2,AddonModQuizPlayerPage_ion_row_18_ion_col_2_Template,3,2,"ion-col",15),s.k0s()),2&e){const e=s.XpG();s.R7$(),s.Y8G("ngIf",e.previousPage>=0),s.R7$(),s.Y8G("ngIf",e.nextPage>=-1)}}function AddonModQuizPlayerPage_ion_card_19_ng_container_5_ion_item_1_ion_icon_7_Template(e,t){1&e&&s.nrm(0,"ion-icon",45)}function AddonModQuizPlayerPage_ion_card_19_ng_container_5_ion_item_1_ion_icon_8_Template(e,t){if(1&e&&s.nrm(0,"ion-icon",46),2&e){const e=s.XpG(4);s.Y8G("name",e.correctIcon)}}function AddonModQuizPlayerPage_ion_card_19_ng_container_5_ion_item_1_ion_icon_9_Template(e,t){if(1&e&&s.nrm(0,"ion-icon",47),2&e){const e=s.XpG(4);s.Y8G("name",e.partialCorrectIcon)}}function AddonModQuizPlayerPage_ion_card_19_ng_container_5_ion_item_1_ion_icon_10_Template(e,t){if(1&e&&s.nrm(0,"ion-icon",48),2&e){const e=s.XpG(4);s.Y8G("name",e.incorrectIcon)}}function AddonModQuizPlayerPage_ion_card_19_ng_container_5_ion_item_1_ion_icon_11_Template(e,t){1&e&&s.nrm(0,"ion-icon",49)}function AddonModQuizPlayerPage_ion_card_19_ng_container_5_ion_item_1_Template(e,t){if(1&e){const e=s.RV6();s.j41(0,"ion-item",38),s.bIt("click",(function AddonModQuizPlayerPage_ion_card_19_ng_container_5_ion_item_1_Template_ion_item_click_0_listener(){s.eBV(e);const t=s.XpG().$implicit,o=s.XpG(2);return s.Njj(!o.isSequential&&o.canReturn&&o.changePage(t.page,!1,t.slot))})),s.j41(1,"ion-label",33)(2,"p",39),s.EFF(3),s.nI1(4,"translate"),s.k0s(),s.j41(5,"p"),s.EFF(6),s.k0s()(),s.DNE(7,AddonModQuizPlayerPage_ion_card_19_ng_container_5_ion_item_1_ion_icon_7_Template,1,0,"ion-icon",40)(8,AddonModQuizPlayerPage_ion_card_19_ng_container_5_ion_item_1_ion_icon_8_Template,1,1,"ion-icon",41)(9,AddonModQuizPlayerPage_ion_card_19_ng_container_5_ion_item_1_ion_icon_9_Template,1,1,"ion-icon",42)(10,AddonModQuizPlayerPage_ion_card_19_ng_container_5_ion_item_1_ion_icon_10_Template,1,1,"ion-icon",43)(11,AddonModQuizPlayerPage_ion_card_19_ng_container_5_ion_item_1_ion_icon_11_Template,1,0,"ion-icon",44),s.k0s()}if(2&e){const e=s.XpG().$implicit,t=s.XpG(2);s.HbH("ion-text-wrap "+e.stateClass),s.Y8G("detail",!t.isSequential&&t.canReturn)("button",!t.isSequential&&t.canReturn),s.R7$(3),s.SpI(" ",s.i5U(4,11,"core.question.questionno",s.eq3(14,_c1,e.questionnumber))," "),s.R7$(3),s.JRh(e.status),s.R7$(),s.Y8G("ngIf","requiresgrading"===e.stateclass),s.R7$(),s.Y8G("ngIf","correct"===e.stateclass),s.R7$(),s.Y8G("ngIf","partiallycorrect"===e.stateclass),s.R7$(),s.Y8G("ngIf","incorrect"===e.stateclass||"notanswered"===e.stateclass),s.R7$(),s.Y8G("ngIf","invalidanswer"===e.stateclass)}}function AddonModQuizPlayerPage_ion_card_19_ng_container_5_Template(e,t){if(1&e&&(s.qex(0),s.DNE(1,AddonModQuizPlayerPage_ion_card_19_ng_container_5_ion_item_1_Template,12,16,"ion-item",37),s.bVm()),2&e){const e=t.$implicit;s.R7$(),s.Y8G("ngIf","description"!==e.type&&e.questionnumber)}}function AddonModQuizPlayerPage_ion_card_19_ion_item_6_Template(e,t){if(1&e&&(s.j41(0,"ion-item",50),s.nrm(1,"ion-icon",51),s.j41(2,"ion-label"),s.EFF(3),s.k0s()()),2&e){const e=s.XpG(2);s.R7$(3),s.JRh(e.dueDateWarning)}}function AddonModQuizPlayerPage_ion_card_19_core_timer_7_Template(e,t){if(1&e){const e=s.RV6();s.j41(0,"core-timer",52),s.nI1(1,"translate"),s.bIt("finished",(function AddonModQuizPlayerPage_ion_card_19_core_timer_7_Template_core_timer_finished_0_listener(){s.eBV(e);const t=s.XpG(2);return s.Njj(t.timeUp())})),s.k0s()}if(2&e){const e=s.XpG(2);s.Y8G("endTime",e.endTime)("timerText",s.bMT(1,2,"addon.mod_quiz.timeleft"))}}function AddonModQuizPlayerPage_ion_card_19_ion_item_8_p_5_Template(e,t){if(1&e&&(s.j41(0,"p"),s.EFF(1),s.k0s()),2&e){const e=t.$implicit;s.R7$(),s.JRh(e)}}function AddonModQuizPlayerPage_ion_card_19_ion_item_8_Template(e,t){if(1&e&&(s.j41(0,"ion-item",33)(1,"ion-label")(2,"p",39),s.EFF(3),s.nI1(4,"translate"),s.k0s(),s.DNE(5,AddonModQuizPlayerPage_ion_card_19_ion_item_8_p_5_Template,2,1,"p",23),s.k0s()()),2&e){const e=s.XpG(2);s.R7$(3),s.JRh(s.bMT(4,2,"addon.mod_quiz.cannotsubmitquizdueto")),s.R7$(2),s.Y8G("ngForOf",e.preventSubmitMessages)}}function AddonModQuizPlayerPage_ion_card_19_Template(e,t){if(1&e&&(s.j41(0,"ion-card",32)(1,"ion-card-header",33)(2,"ion-card-title"),s.EFF(3),s.nI1(4,"translate"),s.k0s()(),s.DNE(5,AddonModQuizPlayerPage_ion_card_19_ng_container_5_Template,2,1,"ng-container",23)(6,AddonModQuizPlayerPage_ion_card_19_ion_item_6_Template,4,1,"ion-item",34)(7,AddonModQuizPlayerPage_ion_card_19_core_timer_7_Template,2,4,"core-timer",35)(8,AddonModQuizPlayerPage_ion_card_19_ion_item_8_Template,6,4,"ion-item",36),s.k0s()),2&e){const e=s.XpG();s.R7$(3),s.JRh(s.bMT(4,5,"addon.mod_quiz.summaryofattempt")),s.R7$(2),s.Y8G("ngForOf",e.summaryQuestions),s.R7$(),s.Y8G("ngIf",e.dueDateWarning),s.R7$(),s.Y8G("ngIf",e.endTime),s.R7$(),s.Y8G("ngIf",e.preventSubmitMessages.length)}}function AddonModQuizPlayerPage_ion_card_20_ion_button_5_Template(e,t){if(1&e){const e=s.RV6();s.j41(0,"ion-button",54),s.bIt("click",(function AddonModQuizPlayerPage_ion_card_20_ion_button_5_Template_ion_button_click_0_listener(){s.eBV(e);const t=s.XpG(2);return s.Njj(t.changePage(t.attempt.currentpage))})),s.EFF(1),s.nI1(2,"translate"),s.k0s()}2&e&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"addon.mod_quiz.returnattempt")," "))}function AddonModQuizPlayerPage_ion_card_20_Template(e,t){if(1&e&&(s.j41(0,"ion-card")(1,"ion-item",33)(2,"ion-label"),s.EFF(3),s.nI1(4,"translate"),s.k0s()(),s.DNE(5,AddonModQuizPlayerPage_ion_card_20_ion_button_5_Template,3,3,"ion-button",53),s.k0s()),2&e){const e=s.XpG();s.R7$(3),s.JRh(s.bMT(4,2,"addon.mod_quiz.errorparsequestions")),s.R7$(2),s.Y8G("ngIf",e.canReturn)}}function AddonModQuizPlayerPage_div_21_ion_button_2_Template(e,t){if(1&e&&(s.j41(0,"ion-button",59),s.EFF(1),s.nI1(2,"translate"),s.nrm(3,"ion-icon",60),s.k0s()),2&e){const e=s.XpG(2);s.Y8G("href",e.moduleUrl)("showBrowserWarning",!1),s.R7$(),s.SpI(" ",s.bMT(2,3,"core.openinbrowser")," ")}}function AddonModQuizPlayerPage_div_21_ion_button_3_Template(e,t){if(1&e){const e=s.RV6();s.j41(0,"ion-button",61),s.bIt("click",(function AddonModQuizPlayerPage_div_21_ion_button_3_Template_ion_button_click_0_listener(){s.eBV(e);const t=s.XpG(2);return s.Njj(t.finishAttempt(!0))})),s.EFF(1),s.nI1(2,"translate"),s.k0s()}2&e&&(s.R7$(),s.SpI(" ",s.bMT(2,1,"addon.mod_quiz.submitallandfinish")," "))}function AddonModQuizPlayerPage_div_21_Template(e,t){if(1&e&&(s.j41(0,"div",55)(1,"div",56),s.DNE(2,AddonModQuizPlayerPage_div_21_ion_button_2_Template,4,5,"ion-button",57)(3,AddonModQuizPlayerPage_div_21_ion_button_3_Template,3,3,"ion-button",58),s.k0s()()),2&e){const e=s.XpG();s.R7$(2),s.Y8G("ngIf",e.preventSubmitMessages.length),s.R7$(),s.Y8G("ngIf",!e.attempt.finishedOffline&&!e.preventSubmitMessages.length)}}let K=(()=>{var e;class AddonModQuizPlayerPage{constructor(e,t){this.changeDetector=e,this.elementRef=t,this.component=$.Qs,this.loaded=!1,this.quizAborted=!1,this.offline=!1,this.navigation=[],this.questions=[],this.nextPage=-2,this.previousPage=-1,this.showSummary=!1,this.summaryQuestions=[],this.canReturn=!1,this.preventSubmitMessages=[],this.autoSaveError=!1,this.isSequential=!1,this.correctIcon="",this.incorrectIcon="",this.partialCorrectIcon="",this.preflightData={},this.newAttempt=!1,this.quizDataLoaded=!1,this.timeUpCalled=!1,this.forceLeave=!1,this.reloadNavigation=!1}ngOnInit(){try{this.cmId=b.CoreNavigator.getRequiredRouteNumberParam("cmId"),this.courseId=b.CoreNavigator.getRequiredRouteNumberParam("courseId"),this.moduleUrl=b.CoreNavigator.getRouteParam("moduleUrl")}catch(e){return I.CoreDomUtils.showErrorModal(e),b.CoreNavigator.back(),void 0}this.autoSave=new AddonModQuizAutoSave("addon-mod_quiz-player-form","#addon-mod_quiz-connection-error-button"),this.start(),this.autoSaveErrorSubscription=this.autoSave.onError().subscribe((e=>{this.autoSaveError=e,this.changeDetector.detectChanges()}))}ngOnDestroy(){this.stopAutoSave(),this.quiz&&P.CoreSync.unblockOperation($.Qs,this.quiz.id)}canLeave(){var e=this;return(0,f.A)((function*(){if(e.forceLeave||e.quizAborted||!e.questions.length||e.showSummary)return!0;const t=yield N.CoreLoadings.show("core.sending",!0);try{yield e.processAttempt(!1,!1)}catch(o){t.dismiss(),yield I.CoreDomUtils.showConfirm(A.HT.instant("addon.mod_quiz.confirmleavequizonerror")),R.R.triggerFormCancelledEvent(e.formElement,q.CoreSites.getCurrentSiteId())}finally{t.dismiss()}return!0}))()}ionViewWillLeave(){return(0,f.A)((function*(){const e=yield A.W3.getTop();null==e||e.dismiss()}))()}abortQuiz(){this.quizAborted=!0}behaviourButtonClicked(e){var t=this;return(0,f.A)((function*(){if(!t.quiz||!t.attempt)return;let o;try{var n,i;yield I.CoreDomUtils.showConfirm(A.HT.instant("core.areyousure")),o=yield N.CoreLoadings.show("core.sending",!0);const a=yield t.prepareAnswers(t.quiz.coursemodule);a[e.name]=e.value,yield w.AddonModQuiz.processAttempt(t.quiz,t.attempt,a,t.preflightData),t.reloadNavigation=!0;const d=yield null===(n=t.content)||void 0===n?void 0:n.getScrollElement(),s=(null==d?void 0:d.scrollTop)||-1;t.loaded=!1,null===(i=t.content)||void 0===i||i.scrollToTop();try{var r;yield t.loadPage(null!==(r=t.attempt.currentpage)&&void 0!==r?r:0)}finally{t.loaded=!0,-1!=s&&setTimeout((()=>{var e;null===(e=t.content)||void 0===e||e.scrollToPoint(0,s)}),50)}}catch(e){I.CoreDomUtils.showErrorModalDefault(e,"Error performing action.")}finally{var a;null===(a=o)||void 0===a||a.dismiss()}}))()}changePage(e,t,o){var n=this;return(0,f.A)((function*(){var i;if(n.attempt&&(-1==e||"overdue"!==n.attempt.state&&!n.attempt.finishedOffline)){if(e==n.attempt.currentpage&&!n.showSummary&&void 0!==o)return yield n.scrollToQuestion(o),void 0;if(!(e==n.attempt.currentpage&&!n.showSummary||t&&n.isSequential&&e!=n.attempt.currentpage&&e!==n.nextPage||-1===e&&n.showSummary)){if(null===(i=n.content)||void 0===i||i.scrollToTop(),!n.showSummary){const e=yield N.CoreLoadings.show("core.sending",!0);try{yield n.processAttempt(!1,!1),e.dismiss()}catch(t){return I.CoreDomUtils.showErrorModalDefault(t,"addon.mod_quiz.errorsaveattempt",!0),e.dismiss(),void 0}n.reloadNavigation=!0}n.loaded=!1;try{n.autoSave.stopCheckChangesProcess(),-1===e?yield n.loadSummary():yield n.loadPage(e)}catch(e){!n.showSummary&&n.quiz&&n.autoSave.startCheckChangesProcess(n.quiz,n.attempt,n.preflightData,n.offline),I.CoreDomUtils.showErrorModalDefault(e,"addon.mod_quiz.errorgetquestions",!0)}finally{n.loaded=!0,void 0!==o&&(yield n.scrollToQuestion(o))}}}}))()}fetchData(){var e=this;return(0,f.A)((function*(){e.quiz=yield w.AddonModQuiz.getQuiz(e.courseId,e.cmId),P.CoreSync.blockOperation($.Qs,e.quiz.id),yield T.AddonModQuizSync.waitForSync(e.quiz.id),e.isSequential=w.AddonModQuiz.isNavigationSequential(e.quiz),e.offline=!!w.AddonModQuiz.isQuizOffline(e.quiz)||(yield w.AddonModQuiz.isLastAttemptOfflineUnfinished(e.quiz)),e.quiz.timelimit&&e.quiz.timelimit>0&&(e.readableTimeLimit=S.j.formatTime(e.quiz.timelimit)),e.quizAccessInfo=yield w.AddonModQuiz.getQuizAccessInformation(e.quiz.id,{cmId:e.quiz.coursemodule,readingStrategy:e.offline?1:2});const t=yield w.AddonModQuiz.getUserAttempts(e.quiz.id,{cmId:e.quiz.coursemodule,readingStrategy:e.offline?1:2});if(!t.length)return e.newAttempt=!0,void 0;e.lastAttempt=t[t.length-1],e.lastAttempt.finishedOffline=yield w.AddonModQuiz.isAttemptFinishedOffline(e.lastAttempt.id),e.newAttempt=w.AddonModQuiz.isAttemptCompleted(e.lastAttempt.state)}))()}finishAttempt(e,t){var o=this;return(0,f.A)((function*(){if(!o.quiz||!o.attempt)return;let n;try{if(!t&&"inprogress"===o.attempt.state){let e=A.HT.instant("addon.mod_quiz.confirmclose");const t=o.summaryQuestions.filter((e=>w.AddonModQuiz.isQuestionUnanswered(e))).length;if(!o.isSequential&&t>0){e+=`\n                        <ion-card class="core-warning-card">\n                            <ion-item>\n                                <ion-label>\n                                    ${A.HT.instant("addon.mod_quiz.submission_confirmation_unanswered",{$a:t})}\n                                </ion-label>\n                            </ion-item>\n                        </ion-card>\n                    `}yield I.CoreDomUtils.showConfirm(e,A.HT.instant("addon.mod_quiz.submitallandfinish"),A.HT.instant("core.submit"))}n=yield N.CoreLoadings.show("core.sending",!0),yield o.processAttempt(e,t),y.z.trigger($.I5,{quizId:o.quiz.id,attemptId:o.attempt.id,synced:!o.offline},q.CoreSites.getCurrentSiteId()),y.z.trigger(y.z.ACTIVITY_DATA_SENT,{module:"quiz"}),t&&o.quiz.graceperiod?(o.stopAutoSave(),o.clearTimer(),yield o.refreshAttempt(),yield o.loadSummary()):(o.forceLeave=!0,b.CoreNavigator.back())}catch(e){I.CoreDomUtils.showErrorModalDefault(e,"addon.mod_quiz.errorsaveattempt",!0).then(function(){var t=(0,f.A)((function*(t){yield null==t?void 0:t.onWillDismiss(),e instanceof E.CoreWSError&&"attemptalreadyclosed"===e.errorcode&&b.CoreNavigator.back()}));return function(e){return t.apply(this,arguments)}}())}finally{var i;null===(i=n)||void 0===i||i.dismiss()}}))()}fixSequenceChecks(){var e=this;return(0,f.A)((function*(){var t,o,n;if(!e.attempt)return;const i=yield w.AddonModQuiz.getAttemptData(e.attempt.id,null!==(t=e.attempt.currentpage)&&void 0!==t?t:0,e.preflightData,{cmId:null===(o=e.quiz)||void 0===o?void 0:o.coursemodule,readingStrategy:e.offline?1:2}),r={};i.questions.forEach((e=>{const t=v.CoreQuestionHelper.getQuestionSequenceCheckFromHtml(e.html);t&&(r[e.slot]=t)})),null===(n=e.questionComponents)||void 0===n||n.forEach((e=>{e.updateSequenceCheck(r)}))}))()}getAnswers(){return v.CoreQuestionHelper.getAnswersFromForm(document.forms["addon-mod_quiz-player-form"])}initTimer(){var e;if(!this.quizAccessInfo||!this.attempt||null===(e=this.attemptAccessInfo)||void 0===e||!e.endtime||this.attemptAccessInfo.endtime<0)return;w.AddonModQuiz.shouldShowTimeLeft(this.quizAccessInfo.activerulenames,this.attempt,this.attemptAccessInfo.endtime)?this.endTime=this.attemptAccessInfo.endtime:delete this.endTime}clearTimer(){delete this.endTime}loadPage(e){var t=this;return(0,f.A)((function*(){if(!t.quiz||!t.attempt)return;t.isSequential&&(yield t.logViewPage(e));const o=yield w.AddonModQuiz.getAttemptData(t.attempt.id,e,t.preflightData,{cmId:t.quiz.coursemodule,readingStrategy:t.offline?1:2});t.attempt=o.attempt,t.attempt.currentpage=e,t.questions=o.questions,t.nextPage=o.nextpage,t.previousPage=t.isSequential?-1:e-1,t.showSummary=!1,t.questions.forEach((e=>{e.readableMark=k.AddonModQuizHelper.getQuestionMarkFromHtml(e.html),v.CoreQuestionHelper.extractQuestionInfoBox(e,".info"),w.AddonModQuiz.isQuestionBlocked(e)&&(e.type="description")})),t.isSequential||(yield t.logViewPage(e)),t.autoSave.startCheckChangesProcess(t.quiz,t.attempt,t.preflightData,t.offline)}))()}logViewPage(e){var t=this;return(0,f.A)((function*(){t.quiz&&t.attempt&&(yield z.g.ignoreErrors(w.AddonModQuiz.logViewAttempt(t.attempt.id,e,t.preflightData,t.offline)),O.OF.logEvent({type:O.qr.VIEW_ITEM,ws:"mod_quiz_view_attempt",name:t.quiz.name,data:{id:t.attempt.id,quizid:t.quiz.id,page:e,category:"quiz"},url:`/mod/quiz/attempt.php?attempt=${t.attempt.id}&cmid=${t.cmId}`+(e>0?`&page=${e}`:"")}))}))()}logViewSummary(){var e=this;return(0,f.A)((function*(){e.quiz&&e.attempt&&(yield z.g.ignoreErrors(w.AddonModQuiz.logViewAttemptSummary(e.attempt.id,e.preflightData,e.quiz.id)),O.OF.logEvent({type:O.qr.VIEW_ITEM,ws:"mod_quiz_view_attempt_summary",name:e.quiz.name,data:{id:e.attempt.id,quizid:e.quiz.id,category:"quiz"},url:`/mod/quiz/summary.php?attempt=${e.attempt.id}&cmid=${e.cmId}`}))}))()}refreshAttempt(){var e=this;return(0,f.A)((function*(){if(!e.quiz)return;const t=yield w.AddonModQuiz.getUserAttempts(e.quiz.id,{cmId:e.quiz.coursemodule,readingStrategy:e.offline?1:2});e.attempt=t.find((t=>{var o;return t.id===(null===(o=e.attempt)||void 0===o?void 0:o.id)}))}))()}loadSummary(){var e=this;return(0,f.A)((function*(){e.quiz&&e.attempt&&(e.correctIcon||(e.correctIcon=v.CoreQuestionHelper.getCorrectIcon().fullName,e.incorrectIcon=v.CoreQuestionHelper.getIncorrectIcon().fullName,e.partialCorrectIcon=v.CoreQuestionHelper.getPartiallyCorrectIcon().fullName),e.summaryQuestions=[],e.summaryQuestions=yield w.AddonModQuiz.getAttemptSummary(e.attempt.id,e.preflightData,{cmId:e.quiz.coursemodule,loadLocal:e.offline,readingStrategy:e.offline?1:2}),e.summaryQuestions.forEach((e=>{v.CoreQuestionHelper.populateQuestionStateClass(e)})),e.showSummary=!0,e.canReturn="inprogress"===e.attempt.state&&!e.attempt.finishedOffline,e.preventSubmitMessages=w.AddonModQuiz.getPreventSubmitMessages(e.summaryQuestions),e.dueDateWarning=w.AddonModQuiz.getAttemptDueDateWarning(e.quiz,e.attempt),e.logViewSummary())}))()}loadNavigation(){var e=this;return(0,f.A)((function*(){var t;e.attempt&&(e.navigation=yield w.AddonModQuiz.getAttemptSummary(e.attempt.id,e.preflightData,{cmId:null===(t=e.quiz)||void 0===t?void 0:t.coursemodule,loadLocal:e.offline,readingStrategy:e.offline?1:2}),e.navigation.forEach((e=>{v.CoreQuestionHelper.populateQuestionStateClass(e)})))}))()}openNavigation(){var e=this;return(0,f.A)((function*(){var t;if(e.reloadNavigation){const t=yield N.CoreLoadings.show();yield z.g.ignoreErrors(e.loadNavigation()),t.dismiss(),e.reloadNavigation=!1}const{AddonModQuizNavigationModalComponent:n}=yield o.e(2423).then(o.bind(o,12423)),i=yield j.I.openSideModal({component:n,componentProps:{navigation:e.navigation,summaryShown:e.showSummary,currentPage:null===(t=e.attempt)||void 0===t?void 0:t.currentpage,nextPage:e.nextPage,isReview:!1,isSequential:e.isSequential}});i&&e.changePage(i.page,!0,i.slot)}))()}prepareAnswers(e){return v.CoreQuestionHelper.prepareAnswers(this.questions,this.getAnswers(),this.offline,this.component,e)}processAttempt(e,t,o){var n=this;return(0,f.A)((function*(){if(!n.quiz||!n.attempt)return;let i={};n.showSummary||(i=yield n.prepareAnswers(n.quiz.coursemodule));try{yield w.AddonModQuiz.processAttempt(n.quiz,n.attempt,i,n.preflightData,e,t,n.offline)}catch(i){if(!i||"submissionoutofsequencefriendlymessage"!=i.errorcode)throw i;try{yield n.fixSequenceChecks()}catch{throw i}if(o)throw i;return n.processAttempt(e,t,!0)}return n.autoSave.cancelAutoSave(),n.autoSave.hideAutoSaveError(),n.formElement&&R.R.triggerFormSubmittedEvent(n.formElement,!n.offline,q.CoreSites.getCurrentSiteId()),v.CoreQuestionHelper.clearTmpData(n.questions,n.component,n.quiz.coursemodule)}))()}scrollToQuestion(e){var t=this;return(0,f.A)((function*(){yield D.H.nextTick(),yield G.D.waitDirectivesReady(t.elementRef.nativeElement,"core-question"),yield x.y.scrollToElement(t.elementRef.nativeElement,"#addon-mod_quiz-question-"+e)}))()}showConnectionError(e){this.autoSave.showAutoSaveError(e)}start(){var e=this;return(0,f.A)((function*(){try{e.loaded=!1,e.quizDataLoaded||(yield e.fetchData(),e.quizDataLoaded=!0),yield e.startOrContinueAttempt()}catch(e){I.CoreDomUtils.showErrorModalDefault(e,"addon.mod_quiz.errorgetquiz",!0)}finally{e.loaded=!0}}))()}startOrContinueAttempt(){var e=this;return(0,f.A)((function*(){var t;if(!e.quiz||!e.quizAccessInfo)return;let o=e.newAttempt?void 0:e.lastAttempt;var n;(o=yield k.AddonModQuizHelper.getAndCheckPreflightData(e.quiz,e.quizAccessInfo,e.preflightData,{attempt:o,offline:e.offline,finishedOffline:null===(t=o)||void 0===t?void 0:t.finishedOffline,title:"addon.mod_quiz.startattempt"}),e.attemptAccessInfo=yield w.AddonModQuiz.getAttemptAccessInformation(e.quiz.id,o.id,{cmId:e.quiz.coursemodule,readingStrategy:e.offline?1:2}),e.attempt=o,yield e.loadNavigation(),"overdue"===e.attempt.state||e.attempt.finishedOffline)?yield e.loadSummary():(yield e.loadPage(null!==(n=e.attempt.currentpage)&&void 0!==n?n:0),e.initTimer())}))()}timeUp(){this.timeUpCalled||(this.timeUpCalled=!0,this.finishAttempt(!1,!0))}stopAutoSave(){var e;this.autoSave.cancelAutoSave(),this.autoSave.stopCheckChangesProcess(),null===(e=this.autoSaveErrorSubscription)||void 0===e||e.unsubscribe()}}return(e=AddonModQuizPlayerPage).ɵfac=function AddonModQuizPlayerPage_Factory(t){return new(t||e)(s.rXU(s.gRc),s.rXU(s.aKT))},e.ɵcmp=s.VBU({type:e,selectors:[["page-addon-mod-quiz-player"]],viewQuery:function AddonModQuizPlayerPage_Query(e,t){if(1&e&&(s.GBs(m.W9,5),s.GBs(J,5),s.GBs(h.b,5)),2&e){let e;s.mGM(e=s.lsd())&&(t.content=e.first),s.mGM(e=s.lsd())&&(t.formElement=e.first),s.mGM(e=s.lsd())&&(t.questionComponents=e)}},decls:22,vars:18,consts:[["quizForm",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId",4,"ngIf"],["slot","end"],["fill","clear","id","addon-mod_quiz-connection-error-button","aria-haspopup","dialog",3,"click","ariaLabel"],["name","fas-circle-exclamation","slot","icon-only","aria-hidden","true"],[3,"ariaLabel","click",4,"ngIf"],["timerHiddenPreferenceName","quiz_timerhidden",3,"endTime","timerText","hidable","hidden","finished",4,"ngIf"],[1,"limited-width"],[1,"has-spacer",3,"hideUntil"],["expand","block","class","ion-margin",3,"click",4,"ngIf"],["name","addon-mod_quiz-player-form",4,"ngIf"],["class","spacer-top",4,"ngIf"],["class","addon-mod_quiz-table",4,"ngIf"],[4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId"],[3,"click","ariaLabel"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],["timerHiddenPreferenceName","quiz_timerhidden",3,"finished","endTime","timerText","hidable","hidden"],["expand","block",1,"ion-margin",3,"click"],["name","addon-mod_quiz-player-form"],[4,"ngFor","ngForOf"],[3,"question"],["contextLevel","module",1,"ion-text-wrap",3,"onAbort","buttonClicked","question","component","componentId","attemptId","usageId","offlineEnabled","contextInstanceId","courseId","preferredBehaviour","review"],[1,"spacer-top"],["expand","block","fill","outline",1,"ion-text-wrap",3,"click"],["name","fas-chevron-left","slot","start","aria-hidden","true"],["expand","block","class","ion-text-wrap",3,"click",4,"ngIf"],["expand","block",1,"ion-text-wrap",3,"click"],["name","fas-chevron-right","slot","end","aria-hidden","true"],[1,"addon-mod_quiz-table"],[1,"ion-text-wrap"],["class","ion-text-wrap core-warning-item",4,"ngIf"],[3,"endTime","timerText","finished",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],[3,"detail","button","class","click",4,"ngIf"],[3,"click","detail","button"],[1,"item-heading"],["name","fas-circle-question","aria-hidden","true","slot","end",4,"ngIf"],["color","success","aria-hidden","true","slot","end",3,"name",4,"ngIf"],["color","warning","aria-hidden","true","slot","end",3,"name",4,"ngIf"],["color","danger","aria-hidden","true","slot","end",3,"name",4,"ngIf"],["name","fas-triangle-exclamation","color","danger","aria-hidden","true","slot","end",4,"ngIf"],["name","fas-circle-question","aria-hidden","true","slot","end"],["color","success","aria-hidden","true","slot","end",3,"name"],["color","warning","aria-hidden","true","slot","end",3,"name"],["color","danger","aria-hidden","true","slot","end",3,"name"],["name","fas-triangle-exclamation","color","danger","aria-hidden","true","slot","end"],[1,"ion-text-wrap","core-warning-item"],["slot","start","name","fas-triangle-exclamation","color","warning","aria-hidden","true"],[3,"finished","endTime","timerText"],["expand","block","class","ion-margin ion-text-wrap","fill","outline",3,"click",4,"ngIf"],["expand","block","fill","outline",1,"ion-margin","ion-text-wrap",3,"click"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"list-item-limited-width"],["expand","block","class","ion-margin ion-text-wrap","core-link","",3,"href","showBrowserWarning",4,"ngIf"],["expand","block","class","ion-margin ion-text-wrap",3,"click",4,"ngIf"],["expand","block","core-link","",1,"ion-margin","ion-text-wrap",3,"href","showBrowserWarning"],["name","fas-up-right-from-square","slot","end","aria-hidden","true"],["expand","block",1,"ion-margin","ion-text-wrap",3,"click"]],template:function AddonModQuizPlayerPage_Template(e,t){1&e&&(s.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),s.nrm(3,"ion-back-button",2),s.nI1(4,"translate"),s.k0s(),s.j41(5,"ion-title")(6,"h1"),s.DNE(7,AddonModQuizPlayerPage_core_format_text_7_Template,1,3,"core-format-text",3),s.k0s()(),s.j41(8,"ion-buttons",4)(9,"ion-button",5),s.nI1(10,"translate"),s.bIt("click",(function AddonModQuizPlayerPage_Template_ion_button_click_9_listener(e){return t.showConnectionError(e)})),s.nrm(11,"ion-icon",6),s.k0s(),s.DNE(12,AddonModQuizPlayerPage_ion_button_12_Template,3,3,"ion-button",7),s.k0s()(),s.DNE(13,AddonModQuizPlayerPage_core_timer_13_Template,2,6,"core-timer",8),s.k0s(),s.j41(14,"ion-content",9)(15,"core-loading",10),s.DNE(16,AddonModQuizPlayerPage_ion_button_16_Template,3,3,"ion-button",11)(17,AddonModQuizPlayerPage_form_17_Template,3,1,"form",12)(18,AddonModQuizPlayerPage_ion_row_18_Template,3,2,"ion-row",13)(19,AddonModQuizPlayerPage_ion_card_19_Template,9,7,"ion-card",14)(20,AddonModQuizPlayerPage_ion_card_20_Template,6,4,"ion-card",15)(21,AddonModQuizPlayerPage_div_21_Template,4,2,"div",16),s.k0s()()),2&e&&(s.R7$(3),s.Y8G("text",s.bMT(4,14,"core.back")),s.R7$(4),s.Y8G("ngIf",t.quiz),s.R7$(2),s.AVh("hidden",!t.autoSaveError),s.Y8G("ariaLabel",s.bMT(10,16,"addon.mod_quiz.connectionerror")),s.R7$(3),s.Y8G("ngIf",t.navigation.length&&!t.showSummary),s.R7$(),s.Y8G("ngIf",t.endTime&&t.questions.length&&!t.quizAborted&&!t.showSummary),s.R7$(2),s.Y8G("hideUntil",t.loaded),s.R7$(),s.Y8G("ngIf",!t.attempt),s.R7$(),s.Y8G("ngIf",t.questions.length&&!t.quizAborted&&!t.showSummary),s.R7$(),s.Y8G("ngIf",t.questions.length&&!t.quizAborted&&!t.showSummary),s.R7$(),s.Y8G("ngIf",!t.quizAborted&&t.showSummary&&t.summaryQuestions.length),s.R7$(),s.Y8G("ngIf",t.attempt&&(!t.questions.length&&!t.showSummary||t.quizAborted)),s.R7$(),s.Y8G("ngIf",!t.quizAborted&&t.showSummary&&t.summaryQuestions.length&&t.loaded))},dependencies:[F.Sq,F.bT,Y.R,V.G,B.t,c.B,L.j,H.i,l.i,X.T,U.qT,U.cb,U.cV,m.Jm,m.QW,m.b_,m.ME,m.tN,m.hU,m.W9,m.eU,m.iq,m.uz,m.he,m.ln,m.BC,m.ai,m.el,W.P,h.b,_.D9],styles:["[_nghost-%COMP%]   core-timer.core-timer-timeleft-0[_ngcontent-%COMP%]{--timer-background: #ca3120;--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-1[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .9333333333);--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-2[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .8666666667);--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-3[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .8);--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-4[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .7333333333);--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-5[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .6666666667);--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-6[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .6);--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-7[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .5333333333);--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-8[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .4666666667)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-9[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .4)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-10[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .3333333333)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-11[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .2666666667)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-12[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .2)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-13[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .1333333333)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-14[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .0666666667)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-15[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, 0)}[_nghost-%COMP%]   ion-item.core-question-blocked[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item.core-question-complete[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item.core-question-answersaved[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item.core-question-requiresgrading[_ngcontent-%COMP%]{--background: var(--gray-300)}"]}),AddonModQuizPlayerPage})();var Z=o(6007),ee=o(31283);function AddonModQuizReviewPage_ion_button_10_Template(e,t){if(1&e){const e=s.RV6();s.j41(0,"ion-button",10),s.nI1(1,"translate"),s.bIt("click",(function AddonModQuizReviewPage_ion_button_10_Template_ion_button_click_0_listener(){s.eBV(e);const t=s.XpG();return s.Njj(t.openNavigation())})),s.nrm(2,"ion-icon",11),s.k0s()}2&e&&s.Y8G("ariaLabel",s.bMT(1,1,"addon.mod_quiz.opentoc"))}function AddonModQuizReviewPage_ion_card_16_Template(e,t){if(1&e&&(s.j41(0,"ion-card")(1,"ion-list"),s.nrm(2,"addon-mod-quiz-attempt-info",12),s.k0s()()),2&e){const e=s.XpG();s.R7$(2),s.Y8G("quiz",e.quiz)("attempt",e.attempt)("additionalData",e.additionalData)}}function AddonModQuizReviewPage_ng_container_17_ng_container_1_Template(e,t){if(1&e&&(s.qex(0),s.j41(1,"addon-mod-quiz-question-card",14),s.nrm(2,"core-question",15),s.k0s(),s.bVm()),2&e){const e=t.$implicit,o=s.XpG(2);s.R7$(),s.Y8G("question",e),s.R7$(),s.Y8G("question",e)("component",o.component)("componentId",o.cmId)("attemptId",o.attempt.id)("usageId",o.attempt.uniqueid)("offlineEnabled",!1)("contextInstanceId",o.cmId)("courseId",o.courseId)("review",!0)("preferredBehaviour",null==o.quiz?null:o.quiz.preferredbehaviour)}}function AddonModQuizReviewPage_ng_container_17_Template(e,t){if(1&e&&(s.qex(0),s.DNE(1,AddonModQuizReviewPage_ng_container_17_ng_container_1_Template,3,11,"ng-container",13),s.bVm()),2&e){const e=s.XpG();s.R7$(),s.Y8G("ngForOf",e.questions)}}function AddonModQuizReviewPage_div_18_ion_col_2_Template(e,t){if(1&e){const e=s.RV6();s.j41(0,"ion-col",22)(1,"ion-button",23),s.nI1(2,"translate"),s.bIt("click",(function AddonModQuizReviewPage_div_18_ion_col_2_Template_ion_button_click_1_listener(){s.eBV(e);const t=s.XpG(2);return s.Njj(t.changePage(t.previousPage))})),s.nrm(3,"ion-icon",24),s.k0s()()}if(2&e){const e=s.XpG(2);s.R7$(),s.Y8G("disabled",e.previousPage<0)("ariaLabel",s.bMT(2,2,"core.previous"))}}function AddonModQuizReviewPage_div_18_ion_button_4_span_1_Template(e,t){1&e&&(s.j41(0,"span"),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&e&&(s.R7$(),s.JRh(s.bMT(2,1,"addon.mod_quiz.showall")))}function AddonModQuizReviewPage_div_18_ion_button_4_span_2_Template(e,t){1&e&&(s.j41(0,"span"),s.EFF(1),s.nI1(2,"translate"),s.k0s()),2&e&&(s.R7$(),s.JRh(s.bMT(2,1,"addon.mod_quiz.showeachpage")))}function AddonModQuizReviewPage_div_18_ion_button_4_Template(e,t){if(1&e){const e=s.RV6();s.j41(0,"ion-button",25),s.bIt("click",(function AddonModQuizReviewPage_div_18_ion_button_4_Template_ion_button_click_0_listener(){s.eBV(e);const t=s.XpG(2);return s.Njj(t.switchMode())})),s.DNE(1,AddonModQuizReviewPage_div_18_ion_button_4_span_1_Template,3,3,"span",8)(2,AddonModQuizReviewPage_div_18_ion_button_4_span_2_Template,3,3,"span",8),s.k0s()}if(2&e){const e=s.XpG(2);s.R7$(),s.Y8G("ngIf",!e.showAll),s.R7$(),s.Y8G("ngIf",e.showAll)}}function AddonModQuizReviewPage_div_18_ion_col_5_Template(e,t){if(1&e){const e=s.RV6();s.j41(0,"ion-col",26)(1,"ion-button",23),s.nI1(2,"translate"),s.bIt("click",(function AddonModQuizReviewPage_div_18_ion_col_5_Template_ion_button_click_1_listener(){s.eBV(e);const t=s.XpG(2);return s.Njj(t.changePage(t.nextPage))})),s.nrm(3,"ion-icon",27),s.k0s()()}if(2&e){const e=s.XpG(2);s.R7$(),s.Y8G("disabled",e.nextPage>=e.numPages)("ariaLabel",s.bMT(2,2,"core.next"))}}function AddonModQuizReviewPage_div_18_Template(e,t){if(1&e&&(s.j41(0,"div",16)(1,"ion-row",17),s.DNE(2,AddonModQuizReviewPage_div_18_ion_col_2_Template,4,4,"ion-col",18),s.j41(3,"ion-col",19),s.DNE(4,AddonModQuizReviewPage_div_18_ion_button_4_Template,3,2,"ion-button",20),s.k0s(),s.DNE(5,AddonModQuizReviewPage_div_18_ion_col_5_Template,4,4,"ion-col",21),s.k0s()()),2&e){const e=s.XpG();s.R7$(2),s.Y8G("ngIf",!e.showAll),s.R7$(2),s.Y8G("ngIf",e.numPages>1),s.R7$(),s.Y8G("ngIf",!e.showAll)}}let te=(()=>{var e;class AddonModQuizReviewPage{constructor(e){this.elementRef=e,this.component=$.Qs,this.showAll=!1,this.numPages=1,this.showCompleted=!1,this.loaded=!1,this.navigation=[],this.questions=[],this.nextPage=-2,this.previousPage=-2,this.gradeItemMarks=[],this.logView=S.j.once((()=>this.performLogView(!0,{showAllDisabled:!this.showAll,page:this.currentPage})))}ngOnInit(){var e=this;return(0,f.A)((function*(){try{e.cmId=b.CoreNavigator.getRequiredRouteNumberParam("cmId"),e.courseId=b.CoreNavigator.getRequiredRouteNumberParam("courseId"),e.attemptId=b.CoreNavigator.getRequiredRouteNumberParam("attemptId"),e.currentPage=b.CoreNavigator.getRouteNumberParam("page")||-1,e.showAll=-1==e.currentPage}catch(e){return I.CoreDomUtils.showErrorModal(e),b.CoreNavigator.back(),void 0}try{yield e.fetchData()}finally{e.loaded=!0}}))()}changePage(e,t){var o=this;return(0,f.A)((function*(){var n,i;if(void 0!==t&&(-1==(null===(n=o.attempt)||void 0===n?void 0:n.currentpage)||e==o.currentPage))return o.scrollToQuestion(t),void 0;if(e!=o.currentPage){o.loaded=!1,null===(i=o.content)||void 0===i||i.scrollToTop();try{yield o.loadPage(e),o.performLogView(!1,{page:e})}catch(e){I.CoreDomUtils.showErrorModalDefault(e,"addon.mod_quiz.errorgetquestions",!0)}finally{o.loaded=!0,void 0!==t&&o.scrollToQuestion(t)}}}))()}fetchData(){var e=this;return(0,f.A)((function*(){try{e.quiz=yield w.AddonModQuiz.getQuiz(e.courseId,e.cmId),e.options=yield w.AddonModQuiz.getCombinedReviewOptions(e.quiz.id,{cmId:e.cmId}),k.AddonModQuizHelper.setQuizCalculatedData(e.quiz,e.options),yield e.loadNavigation(),yield e.loadPage(e.currentPage),e.logView()}catch(e){I.CoreDomUtils.showErrorModalDefault(e,"addon.mod_quiz.errorgetquiz",!0)}}))()}loadPage(e){var t=this;return(0,f.A)((function*(){if(!t.quiz)return;const o=yield w.AddonModQuiz.getAttemptReview(t.attemptId,{page:e,cmId:t.quiz.coursemodule});t.attempt=yield k.AddonModQuizHelper.setAttemptCalculatedData(t.quiz,o.attempt),t.attempt.currentpage=e,t.additionalData=o.additionaldata,t.currentPage=e,t.questions=o.questions,t.nextPage=e+1,t.previousPage=e-1,t.questions.forEach((e=>{e.readableMark=k.AddonModQuizHelper.getQuestionMarkFromHtml(e.html),v.CoreQuestionHelper.extractQuestionInfoBox(e,".info")}))}))()}loadNavigation(){var e=this;return(0,f.A)((function*(){var t;const o=yield w.AddonModQuiz.getAttemptReview(e.attemptId,{page:-1,cmId:null===(t=e.quiz)||void 0===t?void 0:t.coursemodule});e.navigation=o.questions,e.navigation.forEach((e=>{v.CoreQuestionHelper.populateQuestionStateClass(e)}));const n=o.questions[o.questions.length-1];e.numPages=n?n.page+1:0}))()}refreshData(e){var t=this;return(0,f.A)((function*(){const o=[];o.push(w.AddonModQuiz.invalidateQuizData(t.courseId)),o.push(w.AddonModQuiz.invalidateAttemptReview(t.attemptId)),t.quiz&&o.push(w.AddonModQuiz.invalidateCombinedReviewOptionsForUser(t.quiz.id)),yield z.g.ignoreErrors(Promise.all(o));try{yield t.fetchData()}finally{e.complete()}}))()}scrollToQuestion(e){x.y.scrollToElement(this.elementRef.nativeElement,`#addon-mod_quiz-question-${e}`)}switchMode(){var e=this;return(0,f.A)((function*(){e.showAll=!e.showAll,yield e.loadPage(e.showAll?-1:0),e.performLogView(!1,{showAllDisabled:!e.showAll})}))()}openNavigation(){var e=this;return(0,f.A)((function*(){var t;const{AddonModQuizNavigationModalComponent:n}=yield o.e(2423).then(o.bind(o,12423)),i=yield j.I.openSideModal({component:n,componentProps:{navigation:e.navigation,summaryShown:!1,currentPage:null===(t=e.attempt)||void 0===t?void 0:t.currentpage,nextPage:e.nextPage,isReview:!0,isSequential:e.quiz&&w.AddonModQuiz.isNavigationSequential(e.quiz)}});i&&e.changePage(i.page,i.slot)}))()}performLogView(e=!1,t={}){var o=this;return(0,f.A)((function*(){if(!o.quiz)return;e&&(yield z.g.ignoreErrors(w.AddonModQuiz.logViewAttemptReview(o.attemptId,o.quiz.id)));let n=`/mod/quiz/review.php?attempt=${o.attemptId}&cmid=${o.cmId}`;t.showAllDisabled?n+="&showall=0":t.page&&t.page>0&&(n+=`&page=${t.page}`),O.OF.logEvent({type:O.qr.VIEW_ITEM,ws:"mod_quiz_view_attempt_review",name:o.quiz.name,data:{id:o.attemptId,quizid:o.quiz.id,page:t.page,category:"quiz"},url:n})}))()}}return(e=AddonModQuizReviewPage).ɵfac=function AddonModQuizReviewPage_Factory(t){return new(t||e)(s.rXU(s.aKT))},e.ɵcmp=s.VBU({type:e,selectors:[["page-addon-mod-quiz-review"]],viewQuery:function AddonModQuizReviewPage_Query(e,t){if(1&e&&s.GBs(m.W9,5),2&e){let e;s.mGM(e=s.lsd())&&(t.content=e.first)}},decls:19,vars:15,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear","aria-haspopup","true",3,"ariaLabel","click",4,"ngIf"],[1,"limited-width"],["slot","fixed",3,"ionRefresh","disabled"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],["fill","clear","aria-haspopup","true",3,"click","ariaLabel"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],[3,"quiz","attempt","additionalData"],[4,"ngFor","ngForOf"],[3,"question"],["contextLevel","module",1,"ion-text-wrap",3,"question","component","componentId","attemptId","usageId","offlineEnabled","contextInstanceId","courseId","review","preferredBehaviour"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"ion-justify-content-between","ion-align-items-center","ion-no-padding","ion-wrap"],["class","ion-text-start ion-no-padding core-navigation-arrow","size","auto",4,"ngIf"],[1,"ion-text-center"],["class","ion-text-wrap","fill","outline",3,"click",4,"ngIf"],["class","ion-text-end ion-no-padding core-navigation-arrow","size","auto",4,"ngIf"],["size","auto",1,"ion-text-start","ion-no-padding","core-navigation-arrow"],["fill","clear",3,"click","disabled","ariaLabel"],["name","fas-chevron-left","slot","icon-only","aria-hidden","true"],["fill","outline",1,"ion-text-wrap",3,"click"],["size","auto",1,"ion-text-end","ion-no-padding","core-navigation-arrow"],["name","fas-chevron-right","slot","icon-only","aria-hidden","true"]],template:function AddonModQuizReviewPage_Template(e,t){1&e&&(s.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),s.nrm(3,"ion-back-button",1),s.nI1(4,"translate"),s.k0s(),s.j41(5,"ion-title")(6,"h1"),s.EFF(7),s.nI1(8,"translate"),s.k0s()(),s.j41(9,"ion-buttons",2),s.DNE(10,AddonModQuizReviewPage_ion_button_10_Template,3,3,"ion-button",3),s.k0s()()(),s.j41(11,"ion-content",4)(12,"ion-refresher",5),s.bIt("ionRefresh",(function AddonModQuizReviewPage_Template_ion_refresher_ionRefresh_12_listener(e){return t.refreshData(e.target)})),s.nrm(13,"ion-refresher-content",6),s.nI1(14,"translate"),s.k0s(),s.j41(15,"core-loading",7),s.DNE(16,AddonModQuizReviewPage_ion_card_16_Template,3,3,"ion-card",8)(17,AddonModQuizReviewPage_ng_container_17_Template,2,1,"ng-container",8)(18,AddonModQuizReviewPage_div_18_Template,6,3,"div",9),s.k0s()()),2&e&&(s.R7$(3),s.Y8G("text",s.bMT(4,9,"core.back")),s.R7$(4),s.JRh(s.bMT(8,11,"addon.mod_quiz.review")),s.R7$(3),s.Y8G("ngIf",t.navigation.length),s.R7$(2),s.Y8G("disabled",!t.loaded),s.R7$(),s.FS9("pullingText",s.bMT(14,13,"core.pulltorefresh")),s.R7$(2),s.Y8G("hideUntil",t.loaded),s.R7$(),s.Y8G("ngIf",t.attempt),s.R7$(),s.Y8G("ngIf",t.attempt&&t.questions.length),s.R7$(),s.Y8G("ngIf",t.loaded&&t.numPages>1))},dependencies:[F.Sq,F.bT,Y.R,B.t,H.i,l.i,X.T,m.Jm,m.QW,m.b_,m.hU,m.W9,m.eU,m.iq,m.nf,m.To,m.Ki,m.ln,m.BC,m.ai,m.el,ee.m,W.P,h.b,_.D9],encapsulation:2}),AddonModQuizReviewPage})();const oe=[{path:":courseId/:cmId",component:p},{path:":courseId/:cmId/player",component:K,canDeactivate:[Z.V]},{path:":courseId/:cmId/review/:attemptId",component:te}];let ne=(()=>{var e;class AddonModQuizLazyModule{}return(e=AddonModQuizLazyModule).ɵfac=function AddonModQuizLazyModule_Factory(t){return new(t||e)},e.ɵmod=s.$C({type:e}),e.ɵinj=s.G2t({imports:[n.iI.forChild(oe),i.n,r.AddonModQuizComponentsModule,g.s]}),AddonModQuizLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&s.Obh(ne,{declarations:[p,K,te],imports:[n.iI,i.n,r.AddonModQuizComponentsModule,g.s]}))},67842:(e,t,o)=>{o.d(t,{s:()=>a});var n=o(3353),i=o(58529),r=o(54438);let a=(()=>{var e;class CoreQuestionComponentsModule{}return(e=CoreQuestionComponentsModule).ɵfac=function CoreQuestionComponentsModule_Factory(t){return new(t||e)},e.ɵmod=r.$C({type:e}),e.ɵinj=r.G2t({imports:[n.n]}),CoreQuestionComponentsModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&r.Obh(a,{declarations:[i.b],imports:[n.n],exports:[i.b]}))},58529:(e,t,o)=>{o.d(t,{b:()=>P});var n=o(10467),i=o(91416),r=o(54438),a=o(25124),d=o(13482),s=o(89857),c=o(69319),u=o(89911),l=o(55554),m=o(79555),_=o(62393),p=o(6787),g=o(60177),f=o(68162),h=o(58197),v=o(43570),b=o(73465),q=o(73955);const _c0=e=>({$a:e});function CoreQuestionComponent_core_dynamic_component_0_Template(e,t){if(1&e&&(r.j41(0,"core-dynamic-component",7)(1,"p",8),r.EFF(2),r.nI1(3,"translate"),r.k0s()()),2&e){const e=r.XpG();r.ZvI("core-question-",null==e.question?null:e.question.slot,""),r.Y8G("component",e.componentClass)("data",e.data),r.R7$(2),r.JRh(r.i5U(3,6,"core.question.errorquestionnotsupported",r.eq3(9,_c0,null==e.question?null:e.question.type)))}}function CoreQuestionComponent_input_1_Template(e,t){if(1&e&&r.nrm(0,"input",9),2&e){const e=r.XpG();r.FS9("name",e.seqCheck.name),r.FS9("value",e.seqCheck.value)}}function CoreQuestionComponent_core_dynamic_component_2_Template(e,t){if(1&e&&r.nrm(0,"core-dynamic-component",7),2&e){const e=t.$implicit,o=r.XpG();r.Y8G("component",e)("data",o.data)}}function CoreQuestionComponent_ion_item_3_Template(e,t){if(1&e&&(r.j41(0,"ion-item",10)(1,"ion-label")(2,"p"),r.EFF(3),r.k0s()()()),2&e){const e=r.XpG();r.R7$(3),r.JRh(e.validationError)}}function CoreQuestionComponent_ion_button_4_Template(e,t){if(1&e){const e=r.RV6();r.j41(0,"ion-button",11),r.bIt("click",(function CoreQuestionComponent_ion_button_4_Template_ion_button_click_0_listener(){const t=r.eBV(e).$implicit,o=r.XpG();return r.Njj(o.buttonClicked.emit(t))})),r.nrm(1,"core-format-text",12),r.k0s()}if(2&e){const e=t.$implicit,o=r.XpG();r.Y8G("disabled",e.disabled),r.R7$(),r.Y8G("component",o.component)("componentId",o.componentId)("text",e.value)("contextLevel",o.contextLevel)("contextInstanceId",o.contextInstanceId)("courseId",o.courseId)}}function CoreQuestionComponent_ion_item_5_Template(e,t){if(1&e&&(r.j41(0,"ion-item",13)(1,"ion-label"),r.nrm(2,"core-format-text",12),r.k0s()()),2&e){const e=r.XpG();r.R7$(2),r.Y8G("component",e.component)("componentId",e.componentId)("text",e.question.feedbackHtml)("contextLevel",e.contextLevel)("contextInstanceId",e.contextInstanceId)("courseId",e.courseId)}}function CoreQuestionComponent_ion_item_6_Template(e,t){if(1&e&&(r.j41(0,"ion-item",14)(1,"ion-label"),r.nrm(2,"core-format-text",12),r.k0s()()),2&e){const e=r.XpG();r.R7$(2),r.Y8G("component",e.component)("componentId",e.componentId)("text",e.question.commentHtml)("contextLevel",e.contextLevel)("contextInstanceId",e.contextInstanceId)("courseId",e.courseId)}}let P=(()=>{var e;class CoreQuestionComponent{get loaded(){return this.promisedReady.isResolved()}constructor(e,t){this.changeDetector=e,this.element=t,this.offlineEnabled=!1,this.review=!1,this.buttonClicked=new r.bkB,this.onAbort=new r.bkB,this.data={},this.behaviourComponents=[],this.logger=p.CoreLogger.getInstance("CoreQuestionComponent"),this.promisedReady=new a._,_.D.register(this.element.nativeElement,this)}ready(){var e=this;return(0,n.A)((function*(){yield e.promisedReady}))()}ngOnInit(){var e=this;return(0,n.A)((function*(){if(!e.question||"random"!=e.question.type&&!s.CoreQuestionDelegate.isQuestionSupported(e.question.type))return e.promisedReady.resolve(),void 0;if(e.componentClass=yield l.g.ignoreErrors(s.CoreQuestionDelegate.getComponentForQuestion(e.question)),!e.componentClass)return e.promisedReady.resolve(),void 0;e.data={question:e.question,component:e.component,componentId:e.componentId,attemptId:e.attemptId,offlineEnabled:e.offlineEnabled,contextLevel:e.contextLevel,contextInstanceId:e.contextInstanceId,courseId:e.courseId,review:e.review,preferredBehaviour:e.preferredBehaviour,buttonClicked:e.buttonClicked,onAbort:e.onAbort},c.CoreQuestionHelper.extractQuestionScripts(e.question,e.usageId);const t=s.CoreQuestionDelegate.getBehaviourForQuestion(e.question,e.preferredBehaviour||"");if(!d.CoreQuestionBehaviourDelegate.isBehaviourSupported(t))return e.logger.warn("Aborting question because the behaviour is not supported.",e.question.slot),c.CoreQuestionHelper.showComponentError(e.onAbort,m.HT.instant("addon.mod_quiz.errorbehaviournotsupported")+" "+t),void 0;if(e.seqCheck=c.CoreQuestionHelper.getQuestionSequenceCheckFromHtml(e.question.html),!e.seqCheck)return e.logger.warn("Aborting question because couldn't retrieve sequence check.",e.question.slot),c.CoreQuestionHelper.showComponentError(e.onAbort),void 0;c.CoreQuestionHelper.extractQbehaviourRedoButton(e.question),e.validationError=c.CoreQuestionHelper.getValidationErrorFromHtml(e.question.html),e.offlineEnabled&&e.component&&e.attemptId?(yield c.CoreQuestionHelper.loadLocalAnswers(e.question,e.component,e.attemptId),e.validationError=s.CoreQuestionDelegate.getValidationError(e.question,e.question.localAnswers||{},e.validationError,e.component,e.attemptId)):e.question.localAnswers={},c.CoreQuestionHelper.loadLocalAnswersInHtml(e.question),c.CoreQuestionHelper.extractQuestionFeedback(e.question),c.CoreQuestionHelper.extractQuestionComment(e.question);try{e.behaviourComponents=yield d.CoreQuestionBehaviourDelegate.handleQuestion(e.preferredBehaviour||"",e.question)}finally{e.question.html=u.CoreDomUtils.removeElementFromHtml(e.question.html,".im-controls"),e.promisedReady.resolve()}}))()}updateSequenceCheck(e){this.question&&e[this.question.slot]&&(this.seqCheck=e[this.question.slot],this.changeDetector.detectChanges())}}return(e=CoreQuestionComponent).ɵfac=function CoreQuestionComponent_Factory(t){return new(t||e)(r.rXU(r.gRc),r.rXU(r.aKT))},e.ɵcmp=r.VBU({type:e,selectors:[["core-question"]],inputs:{question:"question",component:"component",componentId:"componentId",attemptId:"attemptId",usageId:"usageId",offlineEnabled:[r.Mj6.HasDecoratorInputTransform,"offlineEnabled","offlineEnabled",i.G],contextLevel:"contextLevel",contextInstanceId:"contextInstanceId",courseId:"courseId",review:[r.Mj6.HasDecoratorInputTransform,"review","review",i.G],preferredBehaviour:"preferredBehaviour"},outputs:{buttonClicked:"buttonClicked",onAbort:"onAbort"},features:[r.GFd],decls:7,vars:7,consts:[[3,"component","data","class",4,"ngIf"],["type","hidden",3,"name","value",4,"ngIf"],[3,"component","data",4,"ngFor","ngForOf"],["class","ion-text-wrap core-danger-item",4,"ngIf"],["class","ion-margin-vertical ion-text-wrap","expand","block",3,"disabled","click",4,"ngFor","ngForOf"],["class","ion-text-wrap core-question-feedback-container",4,"ngIf"],["class","ion-text-wrap core-question-comment",4,"ngIf"],[3,"component","data"],[1,"ion-padding"],["type","hidden",3,"name","value"],[1,"ion-text-wrap","core-danger-item"],["expand","block",1,"ion-margin-vertical","ion-text-wrap",3,"click","disabled"],[3,"component","componentId","text","contextLevel","contextInstanceId","courseId"],[1,"ion-text-wrap","core-question-feedback-container"],[1,"ion-text-wrap","core-question-comment"]],template:function CoreQuestionComponent_Template(e,t){1&e&&r.DNE(0,CoreQuestionComponent_core_dynamic_component_0_Template,4,11,"core-dynamic-component",0)(1,CoreQuestionComponent_input_1_Template,1,2,"input",1)(2,CoreQuestionComponent_core_dynamic_component_2_Template,1,2,"core-dynamic-component",2)(3,CoreQuestionComponent_ion_item_3_Template,4,1,"ion-item",3)(4,CoreQuestionComponent_ion_button_4_Template,2,7,"ion-button",4)(5,CoreQuestionComponent_ion_item_5_Template,3,6,"ion-item",5)(6,CoreQuestionComponent_ion_item_6_Template,3,6,"ion-item",6),2&e&&(r.Y8G("ngIf",t.loaded),r.R7$(),r.Y8G("ngIf",t.seqCheck),r.R7$(),r.Y8G("ngForOf",t.behaviourComponents),r.R7$(),r.Y8G("ngIf",t.validationError),r.R7$(),r.Y8G("ngForOf",null==t.question?null:t.question.behaviourButtons),r.R7$(),r.Y8G("ngIf",t.question&&t.question.feedbackHtml),r.R7$(),r.Y8G("ngIf",t.question&&t.question.commentHtml))},dependencies:[g.Sq,g.bT,f.m,h.B,v.T,b.Jm,b.uz,b.he,q.D9],styles:["[_nghost-%COMP%]     .core-question-answer-correct{color:var(--core-question-correct-color)}[_nghost-%COMP%]     .core-question-answer-partiallycorrect{color:var(--core-question-partial-color)}[_nghost-%COMP%]     .core-question-answer-incorrect{color:var(--core-question-incorrect-color)}[_nghost-%COMP%]     input.core-question-answer-correct, [_nghost-%COMP%]     select.core-question-answer-correct{--background: var(--core-question-correct-color-bg);--contrast-background: var(--background)}[_nghost-%COMP%]     input.core-question-answer-partiallycorrect, [_nghost-%COMP%]     select.core-question-answer-partiallycorrect{--background: var(--core-question-partial-color-bg);--contrast-background: var(--background)}[_nghost-%COMP%]     input.core-question-answer-incorrect, [_nghost-%COMP%]     select.core-question-answer-incorrect{--background: var(--core-question-incorrect-color-bg);--contrast-background: var(--background)}[_nghost-%COMP%]     .core-question-feedback-container  {--color: var(--core-question-feedback-color);--background: var(--core-question-feedback-background-color);color:var(--core-question-feedback-color);background-color:var(--core-question-feedback-background-color)}[_nghost-%COMP%]     .core-question-feedback-container   .specificfeedback, [_nghost-%COMP%]     .core-question-feedback-container   .rightanswer, [_nghost-%COMP%]     .core-question-feedback-container   .im-feedback, [_nghost-%COMP%]     .core-question-feedback-container   .feedback, [_nghost-%COMP%]     .core-question-feedback-container   .generalfeedback{font:var(--mdl-typography-body-font-md);margin:0 0 .5em}[_nghost-%COMP%]     .core-question-feedback-container   .specificfeedback p, [_nghost-%COMP%]     .core-question-feedback-container   .rightanswer p, [_nghost-%COMP%]     .core-question-feedback-container   .im-feedback p, [_nghost-%COMP%]     .core-question-feedback-container   .feedback p, [_nghost-%COMP%]     .core-question-feedback-container   .generalfeedback p{--color: var(--core-question-feedback-color)}[_nghost-%COMP%]     .core-question-feedback-container   .correctness{display:inline-block;padding:2px 4px;font-weight:700;line-height:14px;color:var(--white);text-shadow:0 -1px 0 rgba(0,0,0,.25);background-color:var(--gray-500);border-radius:3px}[_nghost-%COMP%]     .core-question-feedback-container   .correctness.incorrect{background-color:var(--danger)}[_nghost-%COMP%]     .core-question-feedback-container   .correctness.correct{background-color:var(--success)}[_nghost-%COMP%]     .core-question-feedback-inline{display:inline-block;margin-inline-start:4px;margin-inline-end:0px}[_nghost-%COMP%]     .core-question-feedback-padding{padding-inline-start:14px;padding-inline-end:35px;padding-top:8px;padding-bottom:8px}[_nghost-%COMP%]     .core-question-correct, [_nghost-%COMP%]     .core-question-comment{--background: var(--core-question-correct-color-bg);background-color:var(--core-question-correct-color-bg);color:var(--core-question-correct-color)}[_nghost-%COMP%]     .core-question-partiallycorrect{--background: var(--core-question-partial-color-bg);background-color:var(--core-question-partial-color-bg);color:var(--core-question-partial-color)}[_nghost-%COMP%]     .core-question-notanswered, [_nghost-%COMP%]     .core-question-incorrect{--background: var(--core-question-incorrect-color-bg);background-color:var(--core-question-incorrect-color-bg);color:var(--core-question-incorrect-color)}[_nghost-%COMP%]     .core-question-answersaved, [_nghost-%COMP%]     .core-question-requiresgrading{color:var(--ion-text-color);background-color:var(--core-question-saved-color-bg)}[_nghost-%COMP%]     .core-question-warning{color:var(--core-question-warning-color)}[_nghost-%COMP%]     .questioncorrectnessicon, [_nghost-%COMP%]     .fa.icon.questioncorrectnessicon{font-size:var(--mdl-typography-icon-fontSize-md)}"]}),CoreQuestionComponent})()}}]);